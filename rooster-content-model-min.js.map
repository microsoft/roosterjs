{"version":3,"file":"rooster-content-model-min.js","mappings":"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3C,EAAkBz3C,YAC/Be,SAAU02C,EAAkB12C,SAC5BE,WAAYw2C,EAAkBx2C,WAC9BD,QAASy2C,EAAkBz2C,UAGnC,MACJ,IAAK,QACD,IAAMlI,EAAQkb,EAAai/B,cACvB,IAAMwE,EAAkBtE,SAGxBr6C,IACA4+C,EAAe,CACX3xC,KAAM,QACNjN,MAAOA,IAOvB4+C,GACA9jC,EAAKqB,IAAI4C,gBAAgBjE,EAAM8jC,EAEvC,C,mJC7DA,cAMa,EAAAjW,YAAqC,CAC9C,IACA,OACA,UACA,OACA,UACA,QACA,IACA,MACA,MACA,aACA,OACA,KACA,SACA,SACA,UACA,SACA,OACA,OACA,MACA,WACA,OACA,WACA,KACA,MACA,UACA,MACA,SACA,MACA,MACA,KACA,KACA,KACA,WACA,aACA,SACA,OACA,SACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,SACA,SACA,KACA,OACA,IACA,MACA,QACA,MACA,MACA,QACA,SACA,KACA,OACA,MACA,OACA,OACA,WACA,QACA,MACA,KACA,WACA,SACA,SACA,IACA,UACA,MACA,WACA,IACA,KACA,KACA,OACA,IACA,OACA,UACA,SACA,QACA,OACA,SACA,SACA,MACA,UACA,MACA,QACA,QACA,KACA,WACA,QACA,KACA,QACA,OACA,KACA,KACA,IACA,KACA,MACA,MACA,OAMS,EAAAG,eAAwC,CACjD,SACA,QACA,OACA,WACA,QACA,QACA,WACA,SACA,OACA,OACA,WACA,SACA,QACA,SACA,OACA,SACA,QACA,WACA,QACA,QACA,SAGJ,IAAMiW,EAAiB,iDACjBC,EAAkB,OAElBC,EAAoB,CACtB,SACA,QACA,MACA,UACA,OACA,QACA,QACA,OACA,UACA,cACA,SACA,WACA,UACA,MACA,UACA,WACA,WACA,OACA,UACA,SACA,SACA,OACA,OACA,WACA,QACA,OACA,QACA,OACA,OACA,MACA,MACA,YACA,QACA,MACA,WACA,OACA,UACA,UACA,cACA,WACA,MACA,WACA,WACA,OACA,UACA,QACA,WACA,QACA,OAC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","sources":["webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/index.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/block/setModelAlignment.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/block/setModelDirection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/block/setModelIndentation.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/block/toggleModelBlockQuote.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/common/clearModelFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/common/wrapBlock.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/entity/insertEntityModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/image/applyImageBorderFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/link/matchLink.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/list/findListItemsInSameThread.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/list/setListType.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/selection/adjustSegmentSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/selection/adjustTrailingSpaceSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/selection/adjustWordSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/selection/collapseTableSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/alignTable.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/alignTableCell.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/canMergeCells.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/clearSelectedCells.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/createTableStructure.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/deleteTable.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/deleteTableColumn.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/deleteTableRow.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/ensureFocusableParagraphForTable.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/insertTableColumn.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/insertTableRow.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/mergeTableCells.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/mergeTableColumn.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/mergeTableRow.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/splitTableCellHorizontally.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/modelApi/table/splitTableCellVertically.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/block/setAlignment.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/block/setDirection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/block/setHeadingLevel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/block/setIndentation.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/block/setParagraphMargin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/block/setSpacing.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/block/toggleBlockQuote.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/entity/insertEntity.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/format/clearFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/format/getFormatState.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/image/adjustImageSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/image/changeImage.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/image/insertImage.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/image/setImageAltText.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/image/setImageBorder.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/image/setImageBoxShadow.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/link/adjustLinkSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/link/insertLink.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/link/removeLink.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/list/setListStartNumber.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/list/setListStyle.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/list/toggleBullet.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/list/toggleNumbering.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/applySegmentFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/changeCapitalization.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/changeFontSize.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/setBackgroundColor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/setFontName.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/setFontSize.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/setTextColor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/toggleBold.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/toggleCode.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/toggleItalic.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/toggleStrikethrough.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/toggleSubscript.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/toggleSuperscript.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/segment/toggleUnderline.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/table/applyTableBorderFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/table/editTable.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/table/formatTable.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/table/insertTable.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/table/setTableCellShade.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/utils/formatImageWithContentModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/utils/formatParagraphWithContentModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/utils/formatSegmentWithContentModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-api/lib/publicApi/utils/formatTableWithContentModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/constants/BulletListType.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/constants/ChangeSource.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/constants/NumberingListType.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/constants/TableBorderFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/addUndoSnapshot.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/attachDomEvent.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/createContentModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/createEditorContext.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/focus.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/formatContentModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/getDOMSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/getVisibleViewport.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/restoreUndoSnapshot.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/setContentModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/setDOMSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/setEditorStyle/ensureUniqueId.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/setEditorStyle/setEditorStyle.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/switchShadowEdit.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/coreApi/triggerEvent.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/CachePlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/ContextMenuPlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/CopyPastePlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/DOMEventPlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/EntityPlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/FormatPlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/LifecyclePlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/SelectionPlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/UndoPlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/createEditorCorePlugins.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/utils/addRangeToSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/utils/applyDefaultFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/utils/applyPendingFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/utils/areSameSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/utils/deleteEmptyList.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/utils/domIndexerImpl.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/utils/entityDelimiterUtils.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/utils/findAllEntities.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/corePlugin/utils/textMutationObserver.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/editor/DOMHelperImpl.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/editor/DarkColorHandlerImpl.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/editor/Editor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/editor/SnapshotsManagerImpl.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/editor/coreApiMap.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/editor/createEditorCore.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/editor/createEditorDefaultSettings.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/index.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/metadata/definitionCreators.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/metadata/updateImageMetadata.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/metadata/updateListMetadata.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/metadata/updateTableCellMetadata.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/metadata/updateTableMetadata.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/modelApi/edit/deleteExpandedSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/modelApi/edit/deleteSingleChar.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/override/containerSizeFormatParser.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/override/pasteCopyBlockEntityParser.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/override/pasteDisplayFormatParser.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/override/pasteEntityProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/override/pasteGeneralProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/override/pasteTextProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/override/reducedModelChildProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/override/tablePreProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/color/transformColor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/domUtils/borderValues.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/domUtils/cacheGetEventData.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/domUtils/eventUtils.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/domUtils/getSegmentTextFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/domUtils/readFile.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/domUtils/stringUtil.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/domUtils/tableCellUtils.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/format/retrieveModelFormatState.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/model/cloneModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/model/createModelFromHtml.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/model/exportContent.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/model/getClosestAncestorBlockGroupIndex.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/model/isBlockGroupOfType.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/model/isBold.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/model/mergeModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/paste/paste.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/selection/collectSelections.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/selection/deleteBlock.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/selection/deleteSegment.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/selection/deleteSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/selection/getSelectionRootNode.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/selection/hasSelectionInBlock.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/selection/hasSelectionInBlockGroup.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/selection/hasSelectionInSegment.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/selection/iterateSelections.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/selection/setSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/table/applyTableFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/table/getSelectedCells.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/table/normalizeTable.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/table/setTableCellBackgroundColor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/undo/redo.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/publicApi/undo/undo.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/convertInlineCss.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/createDomToModelContextForSanitizing.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/createSnapshotSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/extractClipboardItems.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/getRootComputedStyleForContext.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/paste/createPasteFragment.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/paste/generatePasteOptionFromPlugins.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/paste/mergePasteContent.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/paste/retrieveHtmlInfo.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/restoreSnapshotColors.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/restoreSnapshotHTML.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/restoreSnapshotSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-core/lib/utils/sanitizeElement.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/config/defaultContentModelFormatMap.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/config/defaultHTMLStyleMap.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/context/createDomToModelContext.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/context/defaultProcessors.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/domToContentModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/blockProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/brProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/childProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/codeProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/delimiterProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/elementProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/entityProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/fontProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/formatContainerProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/generalProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/headingProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/hrProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/imageProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/knownElementProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/linkProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/listItemProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/listProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/pProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/tableProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/processors/textProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/utils/addSelectionMarker.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/utils/areSameFormats.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/utils/getBoundingClientRect.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/utils/getDefaultStyle.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/utils/getRegularSelectionOffsets.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/utils/isBlockElement.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/utils/parseFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domToModel/utils/stackFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/entityUtils.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/getObjectKeys.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/isElementOfType.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/isNodeOfType.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/isWhiteSpacePreserved.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/metadata/updateMetadata.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/metadata/validate.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/moveChildNodes.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/normalizeRect.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/reuseCachedElement.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/toArray.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/unwrap.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/domUtils/wrap.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/block/directionFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/block/displayFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/block/htmlAlignFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/block/lineHeightFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/block/marginFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/block/paddingFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/block/textAlignFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/block/textIndentFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/block/whiteSpaceFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/common/backgroundColorFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/common/borderBoxFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/common/borderFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/common/boxShadowFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/common/datasetFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/common/floatFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/common/idFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/common/sizeFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/common/verticalAlignFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/common/wordBreakFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/defaultFormatHandlers.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/entity/entityFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/list/listItemThreadFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/list/listLevelThreadFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/list/listStyleFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/segment/boldFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/segment/fontFamilyFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/segment/fontSizeFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/segment/italicFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/segment/letterSpacingFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/segment/linkFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/segment/strikeFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/segment/superOrSubScriptFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/segment/textColorFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/segment/underlineFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/table/tableLayoutFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/table/tableSpacingFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/table/textColorOnTableCellFormatHandler.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/utils/color.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/utils/dir.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/utils/parseValueWithUnit.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/formatHandlers/utils/shouldSetValue.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/index.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/block/setParagraphNotImplicit.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/common/addBlock.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/common/addDecorators.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/common/addSegment.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/common/ensureParagraph.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/common/hasSpacesOnly.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/common/isEmpty.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/common/isGeneralSegment.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/common/normalizeContentModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/common/normalizeParagraph.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/common/normalizeSegment.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/common/unwrapBlock.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createBr.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createContentModelDocument.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createDivider.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createEmptyModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createEntity.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createFormatContainer.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createGeneralBlock.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createGeneralSegment.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createImage.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createListItem.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createListLevel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createParagraph.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createParagraphDecorator.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createSelectionMarker.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createTable.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createTableCell.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelApi/creators/createText.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/contentModelToDom.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/context/createModelToDomContext.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/context/defaultContentModelHandlers.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleBlock.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleBlockGroupChildren.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleBr.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleDivider.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleEntity.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleFormatContainer.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleGeneralModel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleImage.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleList.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleListItem.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleParagraph.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleSegment.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleSegmentDecorator.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleTable.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/handlers/handleText.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/optimizers/mergeNode.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/optimizers/optimize.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/optimizers/removeUnnecessarySpan.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/utils/applyFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/utils/applyMetadata.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/utils/handleSegmentCommon.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToDom/utils/stackFormat.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-dom/lib/modelToText/contentModelToText.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/autoFormat/AutoFormatPlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/autoFormat/link/createLink.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/autoFormat/link/createLinkAfterSpace.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/autoFormat/link/getLinkSegment.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/autoFormat/link/unlink.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/autoFormat/list/convertAlphaToDecimals.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/autoFormat/list/getIndex.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/autoFormat/list/getListTypeStyle.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/autoFormat/list/getNumberingListStyle.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/autoFormat/list/keyboardListTrigger.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/contextMenuBase/ContextMenuPluginBase.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/EditPlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/deleteSteps/deleteAllSegmentBefore.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/deleteSteps/deleteCollapsedSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/deleteSteps/deleteEmptyQuote.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/deleteSteps/deleteList.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/deleteSteps/deleteWordSelection.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/handleKeyboardEventCommon.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/inputSteps/handleEnterOnList.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/keyboardDelete.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/keyboardInput.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/keyboardTab.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/tabUtils/handleTabOnList.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/tabUtils/handleTabOnParagraph.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/edit/utils/getLeafSiblingBlock.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/index.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/Excel/processPastedContentFromExcel.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/PastePlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/PowerPoint/processPastedContentFromPowerPoint.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/WacComponents/constants.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/WacComponents/processPastedContentWacComponents.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/WordDesktop/getStyleMetadata.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/WordDesktop/processPastedContentFromWordDesktop.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/WordDesktop/processWordComments.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/WordDesktop/processWordLists.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/WordDesktop/removeNegativeTextIndentParser.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/pasteSourceValidations/constants.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/pasteSourceValidations/documentContainWacElements.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/pasteSourceValidations/getPasteSource.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/pasteSourceValidations/isExcelDesktopDocument.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/pasteSourceValidations/isExcelOnlineDocument.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/pasteSourceValidations/isGoogleSheetDocument.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/pasteSourceValidations/isPowerPointDesktopDocument.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/pasteSourceValidations/isWordDesktopDocument.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/pasteSourceValidations/shouldConvertToSingleImage.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/utils/addParser.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/utils/deprecatedColorParser.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/utils/getStyles.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/utils/linkParser.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/paste/utils/setProcessor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/pluginUtils/CreateElement/createElement.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/pluginUtils/DragAndDrop/DragAndDropHelper.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/pluginUtils/Rect/getIntersectedRect.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/shortcut/ShortcutPlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/shortcut/shortcuts.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/shortcut/utils/setShortcutIndentationCommand.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/tableEdit/TableEditPlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/tableEdit/editors/TableEditor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/tableEdit/editors/features/CellResizer.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/tableEdit/editors/features/TableEditFeature.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/tableEdit/editors/features/TableInserter.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/tableEdit/editors/features/TableMover.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/tableEdit/editors/features/TableResizer.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/watermark/WatermarkPlugin.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model-plugins/lib/watermark/isModelEmptyFast.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model/lib/createEditor.ts","webpack://roosterjsContentModel/./packages/roosterjs-content-model/lib/index.ts","webpack://roosterjsContentModel/./node_modules/tslib/tslib.es6.mjs","webpack://roosterjsContentModel/webpack/bootstrap","webpack://roosterjsContentModel/webpack/runtime/define property getters","webpack://roosterjsContentModel/webpack/runtime/hasOwnProperty shorthand","webpack://roosterjsContentModel/webpack/runtime/make namespace object","webpack://roosterjsContentModel/webpack/startup"],"sourcesContent":["export { insertTable } from './publicApi/table/insertTable';\nexport { formatTable } from './publicApi/table/formatTable';\nexport { setTableCellShade } from './publicApi/table/setTableCellShade';\nexport { editTable } from './publicApi/table/editTable';\nexport { applyTableBorderFormat } from './publicApi/table/applyTableBorderFormat';\nexport { toggleBullet } from './publicApi/list/toggleBullet';\nexport { toggleNumbering } from './publicApi/list/toggleNumbering';\nexport { toggleBold } from './publicApi/segment/toggleBold';\nexport { toggleItalic } from './publicApi/segment/toggleItalic';\nexport { toggleUnderline } from './publicApi/segment/toggleUnderline';\nexport { toggleStrikethrough } from './publicApi/segment/toggleStrikethrough';\nexport { toggleSubscript } from './publicApi/segment/toggleSubscript';\nexport { toggleSuperscript } from './publicApi/segment/toggleSuperscript';\nexport { setBackgroundColor } from './publicApi/segment/setBackgroundColor';\nexport { setFontName } from './publicApi/segment/setFontName';\nexport { setFontSize } from './publicApi/segment/setFontSize';\nexport { setTextColor } from './publicApi/segment/setTextColor';\nexport { changeFontSize } from './publicApi/segment/changeFontSize';\nexport { applySegmentFormat } from './publicApi/segment/applySegmentFormat';\nexport { changeCapitalization } from './publicApi/segment/changeCapitalization';\nexport { insertImage } from './publicApi/image/insertImage';\nexport { setListStyle } from './publicApi/list/setListStyle';\nexport { setListStartNumber } from './publicApi/list/setListStartNumber';\nexport { setIndentation } from './publicApi/block/setIndentation';\nexport { setAlignment } from './publicApi/block/setAlignment';\nexport { setDirection } from './publicApi/block/setDirection';\nexport { setHeadingLevel } from './publicApi/block/setHeadingLevel';\nexport { toggleBlockQuote } from './publicApi/block/toggleBlockQuote';\nexport { setSpacing } from './publicApi/block/setSpacing';\nexport { setImageBorder } from './publicApi/image/setImageBorder';\nexport { setImageBoxShadow } from './publicApi/image/setImageBoxShadow';\nexport { changeImage } from './publicApi/image/changeImage';\nexport { getFormatState } from './publicApi/format/getFormatState';\nexport { clearFormat } from './publicApi/format/clearFormat';\nexport { insertLink } from './publicApi/link/insertLink';\nexport { removeLink } from './publicApi/link/removeLink';\nexport { adjustLinkSelection } from './publicApi/link/adjustLinkSelection';\nexport { setImageAltText } from './publicApi/image/setImageAltText';\nexport { adjustImageSelection } from './publicApi/image/adjustImageSelection';\nexport { setParagraphMargin } from './publicApi/block/setParagraphMargin';\nexport { toggleCode } from './publicApi/segment/toggleCode';\nexport { insertEntity } from './publicApi/entity/insertEntity';\nexport { insertTableRow } from './modelApi/table/insertTableRow';\nexport { insertTableColumn } from './modelApi/table/insertTableColumn';\n\nexport { formatTableWithContentModel } from './publicApi/utils/formatTableWithContentModel';\nexport { formatImageWithContentModel } from './publicApi/utils/formatImageWithContentModel';\nexport { formatParagraphWithContentModel } from './publicApi/utils/formatParagraphWithContentModel';\nexport { formatSegmentWithContentModel } from './publicApi/utils/formatSegmentWithContentModel';\n\nexport { setListType } from './modelApi/list/setListType';\nexport { findListItemsInSameThread } from './modelApi/list/findListItemsInSameThread';\nexport { setModelIndentation } from './modelApi/block/setModelIndentation';\nexport { matchLink } from './modelApi/link/matchLink';\n","import { alignTable } from '../table/alignTable';\nimport { getOperationalBlocks } from 'roosterjs-content-model-core';\nimport type {\n    ContentModelDocument,\n    ContentModelListItem,\n    TableAlignOperation,\n} from 'roosterjs-content-model-types';\n\nconst ResultMap: Record<\n    'left' | 'center' | 'right' | 'justify',\n    Record<'ltr' | 'rtl', 'start' | 'center' | 'end' | 'justify'>\n> = {\n    left: {\n        ltr: 'start',\n        rtl: 'end',\n    },\n    center: {\n        ltr: 'center',\n        rtl: 'center',\n    },\n    right: {\n        ltr: 'end',\n        rtl: 'start',\n    },\n    justify: {\n        ltr: 'justify',\n        rtl: 'justify',\n    },\n};\n\nconst TableAlignMap: Record<\n    'left' | 'center' | 'right',\n    Record<'ltr' | 'rtl', TableAlignOperation>\n> = {\n    left: {\n        ltr: 'alignLeft',\n        rtl: 'alignRight',\n    },\n    center: {\n        ltr: 'alignCenter',\n        rtl: 'alignCenter',\n    },\n    right: {\n        ltr: 'alignRight',\n        rtl: 'alignLeft',\n    },\n};\n\n/**\n * @internal\n */\nexport function setModelAlignment(\n    model: ContentModelDocument,\n    alignment: 'left' | 'center' | 'right' | 'justify'\n) {\n    const paragraphOrListItemOrTable = getOperationalBlocks<ContentModelListItem>(\n        model,\n        ['ListItem'],\n        ['TableCell']\n    );\n\n    paragraphOrListItemOrTable.forEach(({ block }) => {\n        const newAlignment = ResultMap[alignment][block.format.direction == 'rtl' ? 'rtl' : 'ltr'];\n        if (block.blockType === 'Table' && alignment !== 'justify') {\n            alignTable(\n                block,\n                TableAlignMap[alignment][block.format.direction == 'rtl' ? 'rtl' : 'ltr']\n            );\n        } else if (block) {\n            if (block.blockType === 'BlockGroup' && block.blockGroupType === 'ListItem') {\n                block.blocks.forEach(b => {\n                    const { format } = b;\n                    format.textAlign = newAlignment;\n                });\n            }\n            const { format } = block;\n            format.textAlign = newAlignment;\n        }\n    });\n\n    return paragraphOrListItemOrTable.length > 0;\n}\n","import { findListItemsInSameThread } from '../list/findListItemsInSameThread';\nimport {\n    applyTableFormat,\n    getOperationalBlocks,\n    isBlockGroupOfType,\n    updateTableCellMetadata,\n} from 'roosterjs-content-model-core';\nimport type {\n    BorderFormat,\n    ContentModelBlock,\n    ContentModelBlockFormat,\n    ContentModelDocument,\n    ContentModelListItem,\n    MarginFormat,\n    PaddingFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function setModelDirection(model: ContentModelDocument, direction: 'ltr' | 'rtl') {\n    const paragraphOrListItemOrTable = getOperationalBlocks<ContentModelListItem>(\n        model,\n        ['ListItem'],\n        ['TableCell']\n    );\n\n    paragraphOrListItemOrTable.forEach(({ block }) => {\n        if (isBlockGroupOfType<ContentModelListItem>(block, 'ListItem')) {\n            const items = findListItemsInSameThread(model, block);\n\n            items.forEach(item => {\n                item.levels.forEach(level => {\n                    level.format.direction = direction;\n                });\n\n                item.blocks.forEach(block => internalSetDirection(block.format, direction));\n            });\n        } else if (block) {\n            internalSetDirection(block.format, direction, block);\n        }\n    });\n\n    return paragraphOrListItemOrTable.length > 0;\n}\n\nfunction internalSetDirection(\n    format: ContentModelBlockFormat,\n    direction: 'ltr' | 'rtl',\n    block?: ContentModelBlock\n) {\n    const wasRtl = format.direction == 'rtl';\n    const isRtl = direction == 'rtl';\n\n    if (wasRtl != isRtl) {\n        format.direction = direction;\n\n        // Adjust margin when change direction\n        const marginLeft = format.marginLeft;\n        const paddingLeft = format.paddingLeft;\n\n        setProperty(format, 'marginLeft', format.marginRight);\n        setProperty(format, 'marginRight', marginLeft);\n        setProperty(format, 'paddingLeft', format.paddingRight);\n        setProperty(format, 'paddingRight', paddingLeft);\n\n        // If whole Table direction changed, flip cell side borders\n        if (block && block.blockType == 'Table') {\n            block.rows.forEach(row => {\n                row.cells.forEach(cell => {\n                    // Optimise by skipping cells with unchanged borders\n                    updateTableCellMetadata(cell, metadata => {\n                        if (metadata?.borderOverride) {\n                            const storeBorderLeft = cell.format.borderLeft;\n                            setProperty(cell.format, 'borderLeft', cell.format.borderRight);\n                            setProperty(cell.format, 'borderRight', storeBorderLeft);\n                        }\n                        return metadata;\n                    });\n                });\n            });\n\n            // Apply changed borders\n            applyTableFormat(block, undefined /* newFormat */, true /* keepCellShade*/);\n        }\n    }\n}\n\nfunction setProperty(\n    format: MarginFormat & PaddingFormat & BorderFormat,\n    key: keyof (MarginFormat & PaddingFormat & BorderFormat),\n    value: string | undefined\n) {\n    if (value) {\n        format[key] = value;\n    } else {\n        delete format[key];\n    }\n}\n","import { createListLevel, parseValueWithUnit } from 'roosterjs-content-model-dom';\nimport { findListItemsInSameThread } from '../list/findListItemsInSameThread';\nimport {\n    getOperationalBlocks,\n    isBlockGroupOfType,\n    updateListMetadata,\n} from 'roosterjs-content-model-core';\n\nimport type {\n    ContentModelBlock,\n    ContentModelBlockFormat,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelListItem,\n    ContentModelListLevel,\n} from 'roosterjs-content-model-types';\n\nconst IndentStepInPixel = 40;\n\n/**\n * @param model The content model to set indentation\n * @param indentation The indentation type, 'indent' to indent, 'outdent' to outdent\n * @param length The length of indentation in pixel, default value is 40\n * Set indentation for selected list items or paragraphs\n */\nexport function setModelIndentation(\n    model: ContentModelDocument,\n    indentation: 'indent' | 'outdent',\n    length: number = IndentStepInPixel\n) {\n    const paragraphOrListItem = getOperationalBlocks<ContentModelListItem>(\n        model,\n        ['ListItem'],\n        ['TableCell']\n    );\n    const isIndent = indentation == 'indent';\n    const modifiedBlocks: ContentModelBlock[] = [];\n\n    paragraphOrListItem.forEach(({ block, parent, path }) => {\n        if (isBlockGroupOfType<ContentModelListItem>(block, 'ListItem')) {\n            const thread = findListItemsInSameThread(model, block);\n            const firstItem = thread[0];\n            //if the first item is selected and has only one level, we should add margin to the whole list\n            if (isSelected(firstItem) && firstItem.levels.length == 1) {\n                const level = block.levels[0];\n                const { format } = level;\n                const { marginLeft, marginRight } = format;\n                const newValue = calculateMarginValue(format, isIndent, length);\n                const isRtl = format.direction == 'rtl';\n                const originalValue = parseValueWithUnit(isRtl ? marginRight : marginLeft);\n\n                if (!isIndent && originalValue == 0) {\n                    block.levels.pop();\n                } else if (newValue !== null) {\n                    if (isRtl) {\n                        level.format.marginRight = newValue + 'px';\n                    } else {\n                        level.format.marginLeft = newValue + 'px';\n                    }\n                }\n                //if block has only one level, there is not need to check if it is multilevel selection\n            } else if (block.levels.length == 1 || !isMultilevelSelection(model, block, parent)) {\n                if (isIndent) {\n                    const lastLevel = block.levels[block.levels.length - 1];\n                    const newLevel: ContentModelListLevel = createListLevel(\n                        lastLevel?.listType || 'UL',\n                        lastLevel?.format\n                    );\n\n                    updateListMetadata(newLevel, metadata => {\n                        metadata = metadata || {};\n                        metadata.applyListStyleFromLevel = true;\n                        return metadata;\n                    });\n\n                    // New level is totally new, no need to have these attributes for now\n                    delete newLevel.format.startNumberOverride;\n\n                    block.levels.push(newLevel);\n                } else {\n                    block.levels.pop();\n                }\n            }\n        } else if (block) {\n            let currentBlock: ContentModelBlock = block;\n            let currentParent: ContentModelBlockGroup = parent;\n\n            while (currentParent && modifiedBlocks.indexOf(currentBlock) < 0) {\n                const index = path.indexOf(currentParent);\n                const { format } = currentBlock;\n                const newValue = calculateMarginValue(format, isIndent, length);\n\n                if (newValue !== null) {\n                    const isRtl = format.direction == 'rtl';\n\n                    if (isRtl) {\n                        format.marginRight = newValue + 'px';\n                    } else {\n                        format.marginLeft = newValue + 'px';\n                    }\n\n                    modifiedBlocks.push(currentBlock);\n\n                    break;\n                } else if (currentParent.blockGroupType == 'FormatContainer' && index >= 0) {\n                    delete currentParent.cachedElement;\n\n                    currentBlock = currentParent;\n                    currentParent = path[index + 1];\n                } else {\n                    break;\n                }\n            }\n        }\n    });\n\n    return paragraphOrListItem.length > 0;\n}\n\nfunction isSelected(listItem: ContentModelListItem) {\n    return listItem.blocks.some(block => {\n        if (block.blockType == 'Paragraph') {\n            return block.segments.some(segment => segment.isSelected);\n        }\n    });\n}\n\n/*\n * Check if the selection has list items with different levels and the first item of the list is selected, do not create a sub list.\n * Otherwise, the margin of the first item will be changed, and the sub list will be created, creating a unintentional margin difference between the list items.\n */\nfunction isMultilevelSelection(\n    model: ContentModelDocument,\n    listItem: ContentModelListItem,\n    parent: ContentModelBlockGroup\n) {\n    const listIndex = parent.blocks.indexOf(listItem);\n    for (let i = listIndex - 1; i >= 0; i--) {\n        const block = parent.blocks[i];\n        if (\n            isBlockGroupOfType<ContentModelListItem>(block, 'ListItem') &&\n            block.levels.length == 1 &&\n            isSelected(block)\n        ) {\n            const firstItem = findListItemsInSameThread(model, block)[0];\n            return isSelected(firstItem);\n        }\n\n        if (!isBlockGroupOfType<ContentModelListItem>(block, 'ListItem')) {\n            return false;\n        }\n    }\n    return false;\n}\n\nfunction calculateMarginValue(\n    format: ContentModelBlockFormat,\n    isIndent: boolean,\n    length: number = IndentStepInPixel\n): number | null {\n    const { marginLeft, marginRight, direction } = format;\n    const isRtl = direction == 'rtl';\n    const originalValue = parseValueWithUnit(isRtl ? marginRight : marginLeft);\n    let newValue = (isIndent ? Math.ceil : Math.floor)(originalValue / length) * length;\n\n    if (newValue == originalValue) {\n        newValue = Math.max(newValue + length * (isIndent ? 1 : -1), 0);\n    }\n\n    if (newValue == originalValue) {\n        // Return null to let caller know nothing is changed\n        return null;\n    } else {\n        return newValue;\n    }\n}\n","import { areSameFormats, createFormatContainer, unwrapBlock } from 'roosterjs-content-model-dom';\nimport { getOperationalBlocks, isBlockGroupOfType } from 'roosterjs-content-model-core';\nimport { wrapBlockStep1, wrapBlockStep2 } from '../common/wrapBlock';\nimport type { WrapBlockStep1Result } from '../common/wrapBlock';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelFormatContainer,\n    ContentModelFormatContainerFormat,\n    ContentModelListItem,\n    OperationalBlocks,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function toggleModelBlockQuote(\n    model: ContentModelDocument,\n    formatLtr: ContentModelFormatContainerFormat,\n    formatRtl: ContentModelFormatContainerFormat\n): boolean {\n    const paragraphOfQuote = getOperationalBlocks<\n        ContentModelFormatContainer | ContentModelListItem\n    >(model, ['FormatContainer', 'ListItem'], ['TableCell'], true /*deepFirst*/);\n\n    if (areAllBlockQuotes(paragraphOfQuote)) {\n        // All selections are already in quote, we need to unquote them\n        paragraphOfQuote.forEach(({ block, parent }) => {\n            unwrapBlock(parent, block);\n        });\n    } else {\n        const step1Results: WrapBlockStep1Result<ContentModelFormatContainer>[] = [];\n        const creator = (isRtl: boolean) =>\n            createFormatContainer('blockquote', isRtl ? formatRtl : formatLtr);\n        const canMerge = (\n            isRtl: boolean,\n            target: ContentModelBlock,\n            current?: ContentModelFormatContainer\n        ): target is ContentModelFormatContainer =>\n            canMergeQuote(target, current?.format || (isRtl ? formatRtl : formatLtr));\n\n        paragraphOfQuote.forEach(({ block, parent }) => {\n            if (isQuote(block)) {\n                // Already in quote, no op\n            } else {\n                wrapBlockStep1(step1Results, parent, block, creator, canMerge);\n            }\n        });\n\n        wrapBlockStep2(step1Results, canMerge);\n    }\n\n    return paragraphOfQuote.length > 0;\n}\n\nfunction canMergeQuote(\n    target: ContentModelBlock,\n    format: ContentModelFormatContainerFormat\n): target is ContentModelFormatContainer {\n    return isQuote(target) && areSameFormats(format, target.format);\n}\n\nfunction isQuote(block: ContentModelBlock): block is ContentModelFormatContainer {\n    return (\n        isBlockGroupOfType<ContentModelFormatContainer>(block, 'FormatContainer') &&\n        block.tagName == 'blockquote'\n    );\n}\n\nfunction areAllBlockQuotes(\n    blockAndParents: OperationalBlocks<ContentModelFormatContainer | ContentModelListItem>[]\n): blockAndParents is {\n    block: ContentModelFormatContainer;\n    parent: ContentModelBlockGroup;\n    path: ContentModelBlockGroup[];\n}[] {\n    return blockAndParents.every(blockAndParent => isQuote(blockAndParent.block));\n}\n","import { adjustWordSelection } from '../selection/adjustWordSelection';\nimport { createFormatContainer } from 'roosterjs-content-model-dom';\nimport {\n    iterateSelections,\n    applyTableFormat,\n    getClosestAncestorBlockGroupIndex,\n    updateTableCellMetadata,\n    updateTableMetadata,\n} from 'roosterjs-content-model-core';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelFormatContainer,\n    ContentModelListItem,\n    ContentModelSegment,\n    ContentModelSegmentFormat,\n    ContentModelTable,\n    Selectable,\n    TableSelectionContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function clearModelFormat(\n    model: ContentModelDocument,\n    blocksToClear: [ContentModelBlockGroup[], ContentModelBlock][],\n    segmentsToClear: ContentModelSegment[],\n    tablesToClear: [ContentModelTable, boolean][]\n) {\n    iterateSelections(\n        model,\n        (path, tableContext, block, segments) => {\n            if (segments) {\n                segmentsToClear.push(...segments);\n            }\n\n            if (block) {\n                blocksToClear.push([path, block]);\n            } else if (tableContext) {\n                clearTableCellFormat(tableContext, tablesToClear);\n            }\n        },\n        {\n            // When there is a default format to apply, we know how to handle segment format under list.\n            // So no need to clear format of list number.\n            // Otherwise, we will clear all format of selected text. And since they are under LI tag, we\n            // also need to clear the format of LI (format holder) so that the format is really cleared\n            includeListFormatHolder: model.format ? 'never' : 'anySegment',\n        }\n    );\n\n    const marker = segmentsToClear[0];\n\n    // 2. If selection is collapsed, add selection to whole word to clear if any\n    if (\n        blocksToClear.length == 1 &&\n        isOnlySelectionMarkerSelected(blocksToClear[0][1]) &&\n        blocksToClear.length == 1\n    ) {\n        segmentsToClear.splice(0, segmentsToClear.length, ...adjustWordSelection(model, marker));\n        clearListFormat(blocksToClear[0][0]);\n    } else if (blocksToClear.length > 1 || blocksToClear.some(x => isWholeBlockSelected(x[1]))) {\n        // 2. If a full block or multiple blocks are selected, clear block format\n        for (let i = blocksToClear.length - 1; i >= 0; i--) {\n            const [path, block] = blocksToClear[i];\n\n            clearBlockFormat(path, block);\n            clearListFormat(path);\n            clearContainerFormat(path, block);\n        }\n    }\n\n    // 3. Finally clear format for segments\n    clearSegmentsFormat(segmentsToClear, model.format);\n\n    // 4. Clear format for table if any\n    createTablesFormat(tablesToClear);\n}\n\nfunction createTablesFormat(tablesToClear: [ContentModelTable, boolean][]) {\n    tablesToClear.forEach(x => {\n        const [table, isWholeTableSelected] = x;\n        if (isWholeTableSelected) {\n            table.format = {\n                useBorderBox: table.format.useBorderBox,\n                borderCollapse: table.format.borderCollapse,\n            };\n            updateTableMetadata(table, () => null);\n        }\n\n        applyTableFormat(table, undefined /*newFormat*/, true);\n    });\n}\n\nfunction clearSegmentsFormat(\n    segmentsToClear: ContentModelSegment[],\n    defaultSegmentFormat: ContentModelSegmentFormat | undefined\n) {\n    segmentsToClear.forEach(x => {\n        x.format = { ...(defaultSegmentFormat || {}) };\n\n        if (x.link) {\n            delete x.link.format.textColor;\n        }\n\n        delete x.code;\n    });\n}\n\nfunction clearTableCellFormat(\n    tableContext: TableSelectionContext | undefined,\n    tablesToClear: [ContentModelTable, boolean][]\n) {\n    if (tableContext) {\n        const { table, colIndex, rowIndex, isWholeTableSelected } = tableContext;\n        const cell = table.rows[rowIndex].cells[colIndex];\n\n        if (cell.isSelected) {\n            updateTableCellMetadata(cell, () => null);\n            cell.isHeader = false;\n            cell.format = {\n                useBorderBox: cell.format.useBorderBox,\n            };\n        }\n\n        if (!tablesToClear.find(x => x[0] == table)) {\n            tablesToClear.push([table, isWholeTableSelected]);\n        }\n    }\n}\n\nfunction clearContainerFormat(path: ContentModelBlockGroup[], block: ContentModelBlock) {\n    const containerPathIndex = getClosestAncestorBlockGroupIndex(\n        path,\n        ['FormatContainer'],\n        ['TableCell']\n    );\n\n    if (containerPathIndex >= 0 && containerPathIndex < path.length - 1) {\n        const container = path[containerPathIndex] as ContentModelFormatContainer;\n        const containerIndex = path[containerPathIndex + 1].blocks.indexOf(container);\n        const blockIndex = container.blocks.indexOf(block);\n\n        if (blockIndex >= 0 && containerIndex >= 0) {\n            const newContainer = createFormatContainer(container.tagName, container.format);\n\n            container.blocks.splice(blockIndex, 1);\n            newContainer.blocks = container.blocks.splice(blockIndex);\n\n            path[containerPathIndex + 1].blocks.splice(containerIndex + 1, 0, block, newContainer);\n        }\n    }\n}\n\nfunction clearListFormat(path: ContentModelBlockGroup[]) {\n    const listItem = path[getClosestAncestorBlockGroupIndex(path, ['ListItem'], ['TableCell'])] as\n        | ContentModelListItem\n        | undefined;\n\n    if (listItem) {\n        listItem.levels = [];\n    }\n}\n\nfunction clearBlockFormat(path: ContentModelBlockGroup[], block: ContentModelBlock) {\n    if (block.blockType == 'Divider') {\n        const index = path[0].blocks.indexOf(block);\n\n        if (index >= 0) {\n            path[0].blocks.splice(index, 1);\n        }\n    } else if (block.blockType == 'Paragraph') {\n        block.format = {};\n        delete block.decorator;\n    }\n}\n\nfunction isOnlySelectionMarkerSelected(block: ContentModelBlock) {\n    const segments = block.blockType == 'Paragraph' ? block.segments.filter(x => x.isSelected) : [];\n\n    return segments.length == 1 && segments[0].segmentType == 'SelectionMarker';\n}\n\nfunction isWholeBlockSelected(block: ContentModelBlock) {\n    return (\n        (block as Selectable).isSelected ||\n        (block.blockType == 'Paragraph' && block.segments.every(x => x.isSelected))\n    );\n}\n","import { addBlock, setParagraphNotImplicit } from 'roosterjs-content-model-dom';\nimport type { ContentModelBlock, ContentModelBlockGroup } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport interface WrapBlockStep1Result<T extends ContentModelBlockGroup & ContentModelBlock> {\n    parent: ContentModelBlockGroup;\n    wrapper: T;\n}\n\n/**\n * @internal\n */\nexport function wrapBlockStep1<T extends ContentModelBlockGroup & ContentModelBlock>(\n    step1Result: WrapBlockStep1Result<T>[],\n    parent: ContentModelBlockGroup | null,\n    blockToWrap: ContentModelBlock,\n    creator: (isRtl: boolean) => T,\n    canMerge: (isRtl: boolean, target: ContentModelBlock) => target is T\n) {\n    const index = parent?.blocks.indexOf(blockToWrap) ?? -1;\n\n    if (parent && index >= 0) {\n        parent.blocks.splice(index, 1);\n\n        const prevBlock: ContentModelBlock = parent.blocks[index - 1];\n        const isRtl = blockToWrap.format.direction == 'rtl';\n        const wrapper = canMerge(isRtl, prevBlock)\n            ? prevBlock\n            : createAndAdd(parent, index, creator, isRtl);\n\n        setParagraphNotImplicit(blockToWrap);\n        addBlock(wrapper, blockToWrap);\n\n        // Use reverse order, so that we can merge from last to first to avoid modifying unmerged quotes\n        step1Result.unshift({ parent, wrapper });\n    }\n}\n\n/**\n * @internal\n */\nexport function wrapBlockStep2<T extends ContentModelBlockGroup & ContentModelBlock>(\n    step1Result: WrapBlockStep1Result<T>[],\n    canMerge: (isRtl: boolean, target: ContentModelBlock, current: T) => target is T\n) {\n    step1Result.forEach(({ parent, wrapper }) => {\n        const index = parent.blocks.indexOf(wrapper);\n        const nextBlock = parent.blocks[index + 1];\n        const isRtl = wrapper.format.direction == 'rtl';\n\n        if (index >= 0 && canMerge(isRtl, nextBlock, wrapper)) {\n            wrapper.blocks.forEach(setParagraphNotImplicit);\n            wrapper.blocks.push(...nextBlock.blocks);\n            parent.blocks.splice(index + 1, 1);\n        }\n    });\n}\n\nfunction createAndAdd<T extends ContentModelBlockGroup & ContentModelBlock>(\n    parent: ContentModelBlockGroup,\n    index: number,\n    creator: (isRtl: boolean) => T,\n    isRtl: boolean\n): T {\n    const block = creator(isRtl);\n\n    parent.blocks.splice(index, 0, block);\n    return block;\n}\n","import {\n    deleteSelection,\n    getClosestAncestorBlockGroupIndex,\n    setSelection,\n} from 'roosterjs-content-model-core';\nimport {\n    createBr,\n    createParagraph,\n    createSelectionMarker,\n    normalizeContentModel,\n} from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelEntity,\n    ContentModelParagraph,\n    DeleteSelectionResult,\n    FormatContentModelContext,\n    InsertEntityPosition,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function insertEntityModel(\n    model: ContentModelDocument,\n    entityModel: ContentModelEntity,\n    position: InsertEntityPosition,\n    isBlock: boolean,\n    focusAfterEntity?: boolean,\n    context?: FormatContentModelContext\n) {\n    let blockParent: ContentModelBlockGroup | undefined;\n    let blockIndex = -1;\n    let deleteResult: DeleteSelectionResult;\n\n    if (position == 'begin' || position == 'end') {\n        blockParent = model;\n        blockIndex = position == 'begin' ? 0 : model.blocks.length;\n\n        if (!isBlock) {\n            Object.assign(entityModel.format, model.format);\n        }\n    } else if ((deleteResult = deleteSelection(model, [], context)).insertPoint) {\n        const { marker, paragraph, path } = deleteResult.insertPoint;\n\n        if (deleteResult.deleteResult == 'range') {\n            normalizeContentModel(model);\n        }\n\n        if (!isBlock) {\n            const index = paragraph.segments.indexOf(marker);\n\n            Object.assign(entityModel.format, marker.format);\n\n            if (index >= 0) {\n                paragraph.segments.splice(focusAfterEntity ? index : index + 1, 0, entityModel);\n            }\n        } else {\n            const pathIndex =\n                position == 'root'\n                    ? getClosestAncestorBlockGroupIndex(path, ['TableCell', 'Document'])\n                    : 0;\n            blockParent = path[pathIndex];\n            const child = path[pathIndex - 1];\n            const directChild: ContentModelBlock =\n                child?.blockGroupType == 'FormatContainer' ||\n                child?.blockGroupType == 'General' ||\n                child?.blockGroupType == 'ListItem'\n                    ? child\n                    : paragraph;\n            const childIndex = blockParent.blocks.indexOf(directChild);\n            blockIndex = childIndex >= 0 ? childIndex + 1 : -1;\n        }\n    }\n\n    if (blockIndex >= 0 && blockParent) {\n        const blocksToInsert: ContentModelBlock[] = [];\n        let nextParagraph: ContentModelParagraph | undefined;\n\n        if (isBlock) {\n            const nextBlock = blockParent.blocks[blockIndex];\n\n            blocksToInsert.push(entityModel);\n\n            if (nextBlock?.blockType == 'Paragraph') {\n                nextParagraph = nextBlock;\n            } else if (!nextBlock || nextBlock.blockType == 'Entity' || focusAfterEntity) {\n                nextParagraph = createParagraph(false /*isImplicit*/, {}, model.format);\n                nextParagraph.segments.push(createBr(model.format));\n                blocksToInsert.push(nextParagraph);\n            }\n        } else {\n            nextParagraph = createParagraph(\n                false /*isImplicit*/,\n                undefined /*format*/,\n                model.format\n            );\n\n            nextParagraph.segments.push(entityModel);\n            blocksToInsert.push(nextParagraph);\n        }\n\n        blockParent.blocks.splice(blockIndex, 0, ...blocksToInsert);\n\n        if (focusAfterEntity && nextParagraph) {\n            const marker = createSelectionMarker(nextParagraph.segments[0]?.format || model.format);\n            const segments = nextParagraph.segments;\n\n            isBlock ? segments.unshift(marker) : segments.push(marker);\n            setSelection(model, marker, marker);\n        }\n    }\n}\n","import { extractBorderValues } from 'roosterjs-content-model-core';\nimport { parseValueWithUnit } from 'roosterjs-content-model-dom';\nimport type { Border, ContentModelImage } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function applyImageBorderFormat(\n    image: ContentModelImage,\n    border: Border | null,\n    borderRadius?: string\n) {\n    if (border) {\n        const format = image.format;\n        const { width, style, color } = border;\n        const borderKey = 'borderTop';\n        const extractedBorder = extractBorderValues(format[borderKey]);\n        const borderColor = extractedBorder.color;\n        const borderWidth = extractedBorder.width;\n        const borderStyle = extractedBorder.style;\n        let borderFormat = '';\n\n        if (width) {\n            borderFormat = parseValueWithUnit(width) + 'px';\n        } else if (borderWidth) {\n            borderFormat = borderWidth;\n        } else {\n            borderFormat = '1px';\n        }\n\n        if (style) {\n            borderFormat = `${borderFormat} ${style}`;\n        } else if (borderStyle) {\n            borderFormat = `${borderFormat} ${borderStyle}`;\n        } else {\n            borderFormat = `${borderFormat} solid`;\n        }\n\n        if (color) {\n            borderFormat = `${borderFormat} ${color}`;\n        } else if (borderColor) {\n            borderFormat = `${borderFormat} ${borderColor}`;\n        }\n        image.format.borderLeft = borderFormat;\n        image.format.borderTop = borderFormat;\n        image.format.borderBottom = borderFormat;\n        image.format.borderRight = borderFormat;\n    } else {\n        delete image.format.borderLeft;\n        delete image.format.borderTop;\n        delete image.format.borderBottom;\n        delete image.format.borderRight;\n    }\n\n    if (borderRadius) {\n        image.format.borderRadius = borderRadius;\n    }\n}\n","import { getObjectKeys } from 'roosterjs-content-model-dom';\nimport type { LinkData } from 'roosterjs-content-model-types';\n\ninterface LinkMatchRule {\n    match: RegExp;\n    except?: RegExp;\n    normalizeUrl?: (url: string) => string;\n}\n\n// http exclude matching regex\n// invalid URL example (in particular on IE and Edge):\n// - http://www.bing.com%00, %00 before ? (question mark) is considered invalid. IE/Edge throws invalid argument exception\n// - http://www.bing.com%1, %1 is invalid\n// - http://www.bing.com%g, %g is invalid (IE and Edge expects a two hex value after a %)\n// - http://www.bing.com%, % as ending is invalid (IE and Edge expects a two hex value after a %)\n// All above % cases if they're after ? (question mark) is then considered valid again\n// Similar for @, it needs to be after / (forward slash), or ? (question mark). Otherwise IE/Edge will throw security exception\n// - http://www.bing.com@name, @name before ? (question mark) is considered invalid\n// - http://www.bing.com/@name, is valid sine it is after / (forward slash)\n// - http://www.bing.com?@name, is also valid since it is after ? (question mark)\n// The regex below is essentially a break down of:\n// ^[^?]+%[^0-9a-f]+ => to exclude URL like www.bing.com%%\n// ^[^?]+%[0-9a-f][^0-9a-f]+ => to exclude URL like www.bing.com%1\n// ^[^?]+%00 => to exclude URL like www.bing.com%00\n// ^[^?]+%$ => to exclude URL like www.bing.com%\n// ^https?:\\/\\/[^?\\/]+@ => to exclude URL like http://www.bing.com@name\n// ^www\\.[^?\\/]+@ => to exclude URL like www.bing.com@name\n// , => to exclude url like www.bing,,com\nconst httpExcludeRegEx = /^[^?]+%[^0-9a-f]+|^[^?]+%[0-9a-f][^0-9a-f]+|^[^?]+%00|^[^?]+%$|^https?:\\/\\/[^?\\/]+@|^www\\.[^?\\/]+@/i;\n\n// via https://tools.ietf.org/html/rfc1035 Page 7\nconst labelRegEx = '[a-z0-9](?:[a-z0-9-]*[a-z0-9])?'; // We're using case insensitive regexps below so don't bother including A-Z\nconst domainNameRegEx = `(?:${labelRegEx}\\\\.)*${labelRegEx}`;\nconst domainPortRegEx = `${domainNameRegEx}(?:\\\\:[0-9]+)?`;\nconst domainPortWithUrlRegEx = `${domainPortRegEx}(?:[\\\\/\\\\?]\\\\S*)?`;\n\nconst linkMatchRules: Record<string, LinkMatchRule> = {\n    http: {\n        match: new RegExp(\n            `^(?:microsoft-edge:)?http:\\\\/\\\\/${domainPortWithUrlRegEx}|www\\\\.${domainPortWithUrlRegEx}`,\n            'i'\n        ),\n        except: httpExcludeRegEx,\n        normalizeUrl: url =>\n            new RegExp('^(?:microsoft-edge:)?http:\\\\/\\\\/', 'i').test(url) ? url : 'http://' + url,\n    },\n    https: {\n        match: new RegExp(`^(?:microsoft-edge:)?https:\\\\/\\\\/${domainPortWithUrlRegEx}`, 'i'),\n        except: httpExcludeRegEx,\n    },\n    mailto: { match: new RegExp('^mailto:\\\\S+@\\\\S+\\\\.\\\\S+', 'i') },\n    notes: { match: new RegExp('^notes:\\\\/\\\\/\\\\S+', 'i') },\n    file: { match: new RegExp('^file:\\\\/\\\\/\\\\/?\\\\S+', 'i') },\n    unc: { match: new RegExp('^\\\\\\\\\\\\\\\\\\\\S+', 'i') },\n    ftp: {\n        match: new RegExp(\n            `^ftp:\\\\/\\\\/${domainPortWithUrlRegEx}|ftp\\\\.${domainPortWithUrlRegEx}`,\n            'i'\n        ),\n        normalizeUrl: url => (new RegExp('^ftp:\\\\/\\\\/', 'i').test(url) ? url : 'ftp://' + url),\n    },\n    news: { match: new RegExp(`^news:(\\\\/\\\\/)?${domainPortWithUrlRegEx}`, 'i') },\n    telnet: { match: new RegExp(`^telnet:(\\\\/\\\\/)?${domainPortWithUrlRegEx}`, 'i') },\n    gopher: { match: new RegExp(`^gopher:\\\\/\\\\/${domainPortWithUrlRegEx}`, 'i') },\n    wais: { match: new RegExp(`^wais:(\\\\/\\\\/)?${domainPortWithUrlRegEx}`, 'i') },\n};\n\n/**\n * Try to match a given string with link match rules, return matched link\n * @param url Input url to match\n * @param option Link match option, exact or partial. If it is exact match, we need\n * to check the length of matched link and url\n * @param rules Optional link match rules, if not passed, only the default link match\n * rules will be applied\n * @returns The matched link data, or null if no match found.\n * The link data includes an original url and a normalized url\n */\nexport function matchLink(url: string): LinkData | null {\n    if (url) {\n        for (const schema of getObjectKeys(linkMatchRules)) {\n            const rule = linkMatchRules[schema];\n            const matches = url.match(rule.match);\n            if (matches && matches[0] == url && (!rule.except || !rule.except.test(url))) {\n                return {\n                    scheme: schema,\n                    originalUrl: url,\n                    normalizedUrl: rule.normalizeUrl ? rule.normalizeUrl(url) : url,\n                };\n            }\n        }\n    }\n\n    return null;\n}\n","import type {\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelListItem,\n} from 'roosterjs-content-model-types';\n\n/**\n * @param model The content model\n * @param currentItem The current list item\n * Search for all list items in the same thread as the current list item\n */\nexport function findListItemsInSameThread(\n    model: ContentModelDocument,\n    currentItem: ContentModelListItem\n): ContentModelListItem[] {\n    const items: (ContentModelListItem | null)[] = [];\n\n    findListItems(model, items);\n\n    return filterListItems(items, currentItem);\n}\n\nfunction findListItems(group: ContentModelBlockGroup, result: (ContentModelListItem | null)[]) {\n    group.blocks.forEach(block => {\n        switch (block.blockType) {\n            case 'BlockGroup':\n                if (block.blockGroupType == 'ListItem') {\n                    result.push(block);\n                } else {\n                    pushNullIfNecessary(result);\n                    findListItems(block, result);\n                    pushNullIfNecessary(result);\n                }\n                break;\n\n            case 'Paragraph':\n                pushNullIfNecessary(result);\n\n                block.segments.forEach(segment => {\n                    if (segment.segmentType == 'General') {\n                        findListItems(segment, result);\n                    }\n                });\n\n                pushNullIfNecessary(result);\n                break;\n\n            case 'Table':\n                pushNullIfNecessary(result);\n\n                block.rows.forEach(row =>\n                    row.cells.forEach(cell => {\n                        findListItems(cell, result);\n                    })\n                );\n                pushNullIfNecessary(result);\n\n                break;\n        }\n    });\n}\n\nfunction pushNullIfNecessary(result: (ContentModelListItem | null)[]) {\n    const last = result[result.length - 1];\n\n    if (!last || last !== null) {\n        result.push(null);\n    }\n}\n\nfunction filterListItems(\n    items: (ContentModelListItem | null)[],\n    currentItem: ContentModelListItem\n) {\n    const result: ContentModelListItem[] = [];\n    const currentIndex = items.indexOf(currentItem);\n    const levelLength = currentItem.levels.length;\n    const isOrderedList = currentItem.levels[levelLength - 1]?.listType == 'OL';\n\n    if (currentIndex >= 0) {\n        for (let i = currentIndex; i >= 0; i--) {\n            const item = items[i];\n\n            if (!item) {\n                if (isOrderedList) {\n                    continue;\n                } else {\n                    break;\n                }\n            }\n\n            const startNumberOverride = hasStartNumberOverride(item, levelLength);\n\n            if (areListTypesCompatible(items, currentIndex, i)) {\n                result.unshift(item);\n\n                if (isOrderedList && startNumberOverride) {\n                    break;\n                }\n            } else if (!isOrderedList || startNumberOverride) {\n                break;\n            }\n        }\n\n        for (let i = currentIndex + 1; i < items.length; i++) {\n            const item = items[i];\n\n            if (!item) {\n                if (isOrderedList) {\n                    continue;\n                } else {\n                    break;\n                }\n            }\n\n            const startNumberOverride = hasStartNumberOverride(item, levelLength);\n\n            if (areListTypesCompatible(items, currentIndex, i) && !startNumberOverride) {\n                result.push(item);\n            } else if (!isOrderedList || startNumberOverride) {\n                break;\n            }\n        }\n    }\n\n    return result;\n}\n\nfunction areListTypesCompatible(\n    listItems: (ContentModelListItem | null)[],\n    currentIndex: number,\n    compareToIndex: number\n): boolean {\n    const currentLevels = listItems[currentIndex]!.levels;\n    const compareToLevels = listItems[compareToIndex]!.levels;\n\n    return (\n        currentLevels.length <= compareToLevels.length &&\n        currentLevels.every(\n            (currentLevel, i) => currentLevel.listType == compareToLevels[i].listType\n        )\n    );\n}\n\nfunction hasStartNumberOverride(item: ContentModelListItem, levelLength: number): boolean {\n    return item.levels\n        .slice(0, levelLength)\n        .some(level => level.format.startNumberOverride !== undefined);\n}\n","import { getOperationalBlocks, isBlockGroupOfType } from 'roosterjs-content-model-core';\nimport {\n    createListItem,\n    createListLevel,\n    normalizeContentModel,\n    setParagraphNotImplicit,\n} from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlock,\n    ContentModelDocument,\n    ContentModelListItem,\n} from 'roosterjs-content-model-types';\n\n/**\n * Set a list type to content model\n * @param model the model document\n * @param listType the list type OL | UL\n * @param removeMargins true to remove margins, false to keep margins @default false\n */\nexport function setListType(\n    model: ContentModelDocument,\n    listType: 'OL' | 'UL',\n    removeMargins: boolean = false\n) {\n    const paragraphOrListItems = getOperationalBlocks<ContentModelListItem>(\n        model,\n        ['ListItem'],\n        [] // Set stop types to be empty so we can find list items even cross the boundary of table, then we can always operation on the list item if any\n    );\n    const alreadyInExpectedType = paragraphOrListItems.every(({ block }) =>\n        isBlockGroupOfType<ContentModelListItem>(block, 'ListItem')\n            ? block.levels[block.levels.length - 1]?.listType == listType\n            : shouldIgnoreBlock(block)\n    );\n    let existingListItems: ContentModelListItem[] = [];\n\n    paragraphOrListItems.forEach(({ block, parent }, itemIndex) => {\n        if (isBlockGroupOfType<ContentModelListItem>(block, 'ListItem')) {\n            const level = block.levels.pop();\n\n            if (!alreadyInExpectedType && level) {\n                level.listType = listType;\n                block.levels.push(level);\n            } else if (block.blocks.length == 1) {\n                setParagraphNotImplicit(block.blocks[0]);\n            }\n\n            if (alreadyInExpectedType) {\n                //if the list item has margins or textAlign, we need to apply them to the block to preserve the indention and alignment\n                block.blocks.forEach(x => {\n                    if (block.format.marginLeft) {\n                        x.format.marginLeft = block.format.marginLeft;\n                    }\n\n                    if (block.format.marginRight) {\n                        x.format.marginRight = block.format.marginRight;\n                    }\n\n                    if (block.format.textAlign) {\n                        x.format.textAlign = block.format.textAlign;\n                    }\n                });\n            }\n        } else {\n            const index = parent.blocks.indexOf(block);\n\n            if (index >= 0) {\n                if (paragraphOrListItems.length == 1 || !shouldIgnoreBlock(block)) {\n                    const prevBlock = parent.blocks[index - 1];\n                    const segmentFormat =\n                        (block.blockType == 'Paragraph' && block.segments[0]?.format) || {};\n                    const newListItem = createListItem(\n                        [\n                            createListLevel(listType, {\n                                startNumberOverride:\n                                    itemIndex > 0 ||\n                                    (prevBlock?.blockType == 'BlockGroup' &&\n                                        prevBlock.blockGroupType == 'ListItem' &&\n                                        prevBlock.levels[0]?.listType == 'OL')\n                                        ? undefined\n                                        : 1,\n                                direction: block.format.direction,\n                                textAlign: block.format.textAlign,\n                                marginBottom: removeMargins ? '0px' : undefined,\n                                marginTop: removeMargins ? '0px' : undefined,\n                            }),\n                        ],\n                        // For list bullet, we only want to carry over these formats from segments:\n                        {\n                            fontFamily: segmentFormat.fontFamily,\n                            fontSize: segmentFormat.fontSize,\n                            textColor: segmentFormat.textColor,\n                        }\n                    );\n\n                    if (block.blockType == 'Paragraph') {\n                        setParagraphNotImplicit(block);\n                    }\n\n                    newListItem.blocks.push(block);\n\n                    if (block.format.marginRight) {\n                        newListItem.format.marginRight = block.format.marginRight;\n                        block.format.marginRight = undefined;\n                    }\n\n                    if (block.format.marginLeft) {\n                        newListItem.format.marginLeft = block.format.marginLeft;\n                        block.format.marginLeft = undefined;\n                    }\n\n                    if (block.format.textAlign) {\n                        newListItem.format.textAlign = block.format.textAlign;\n                    }\n\n                    parent.blocks.splice(index, 1, newListItem);\n                    existingListItems.push(newListItem);\n                } else {\n                    existingListItems.forEach(x => (x.levels[0].format.marginBottom = '0px'));\n                    existingListItems = [];\n                }\n            }\n        }\n    });\n\n    normalizeContentModel(model);\n\n    return paragraphOrListItems.length > 0;\n}\n\nfunction shouldIgnoreBlock(block: ContentModelBlock) {\n    switch (block.blockType) {\n        case 'Table':\n            return false;\n        case 'Paragraph':\n            return block.segments.every(\n                x => x.segmentType == 'Br' || x.segmentType == 'SelectionMarker'\n            );\n        default:\n            return true;\n    }\n}\n","import { getSelectedParagraphs, setSelection } from 'roosterjs-content-model-core';\nimport type { ContentModelDocument, ContentModelSegment } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function adjustSegmentSelection(\n    model: ContentModelDocument,\n    firstMatcher: (target: ContentModelSegment) => boolean,\n    siblingMatcher: (target: ContentModelSegment, ref: ContentModelSegment) => boolean\n): boolean {\n    const paragraphs = getSelectedParagraphs(model);\n    let first: ContentModelSegment | undefined;\n    let last: ContentModelSegment | undefined;\n    let changed = false;\n\n    paragraphs.forEach(p => {\n        const index = first ? 0 : p.segments.findIndex(x => firstMatcher(x));\n        const segments = p.segments;\n\n        if (!first) {\n            first = segments[index];\n\n            for (let i = index; i > 0; i--) {\n                if (siblingMatcher(segments[i - 1], first)) {\n                    first = segments[i - 1];\n                    changed = changed || !segments[i - 1].isSelected;\n                } else {\n                    changed = changed || !!segments[i - 1].isSelected;\n                    break;\n                }\n            }\n        }\n\n        if (first) {\n            for (let i = index; i < p.segments.length; i++) {\n                if (i == index || siblingMatcher(segments[i], last || segments[index])) {\n                    last = segments[i];\n                    changed = changed || !segments[i].isSelected;\n                } else {\n                    changed = changed || !!segments[i].isSelected;\n                    break;\n                }\n            }\n        }\n    });\n\n    if (first && last) {\n        setSelection(model, first, last);\n    }\n\n    return changed;\n}\n","import { createText } from 'roosterjs-content-model-dom';\nimport { iterateSelections } from 'roosterjs-content-model-core';\nimport type {\n    ContentModelDocument,\n    ContentModelParagraph,\n    ContentModelText,\n} from 'roosterjs-content-model-types';\n\n/**\n * If a format cannot be applied to be applied to a trailing space, split the trailing space into a separate segment\n * @internal\n */\nexport function adjustTrailingSpaceSelection(model: ContentModelDocument) {\n    iterateSelections(model, (_, __, block, segments) => {\n        if (block?.blockType === 'Paragraph' && segments && segments.length > 0) {\n            if (\n                segments.length === 1 &&\n                segments[0].segmentType === 'Text' &&\n                shouldSplitTrailingSpace(segments[0])\n            ) {\n                splitTextSegment(block, segments[0]);\n            } else {\n                const lastTextSegment =\n                    segments[segments.length - 1].segmentType === 'SelectionMarker'\n                        ? segments[segments.length - 2]\n                        : segments[segments.length - 1];\n                if (\n                    lastTextSegment &&\n                    lastTextSegment.segmentType === 'Text' &&\n                    shouldSplitTrailingSpace(lastTextSegment)\n                ) {\n                    splitTextSegment(block, lastTextSegment);\n                }\n            }\n        }\n\n        return false;\n    });\n}\n\nfunction shouldSplitTrailingSpace(segment: ContentModelText) {\n    return segment.isSelected && hasTrailingSpace(segment.text) && !isTrailingSpace(segment.text);\n}\n\nfunction hasTrailingSpace(text: string) {\n    return text.trimRight() !== text;\n}\n\nfunction isTrailingSpace(text: string) {\n    return text.trimRight().length == 0;\n}\n\nfunction splitTextSegment(block: ContentModelParagraph, textSegment: Readonly<ContentModelText>) {\n    const text = textSegment.text.trimRight();\n    const trailingSpace = textSegment.text.substring(text.length);\n    const newText = createText(text, textSegment.format, textSegment.link, textSegment.code);\n    newText.isSelected = true;\n    const trailingSpaceLink = textSegment.link\n        ? {\n              ...textSegment.link,\n              format: {\n                  ...textSegment.link?.format,\n                  underline: false, // Remove underline for trailing space link\n              },\n          }\n        : undefined;\n    const trailingSpaceSegment = createText(\n        trailingSpace,\n        undefined,\n        trailingSpaceLink,\n        textSegment.code\n    );\n    trailingSpaceSegment.isSelected = true;\n    const index = block.segments.indexOf(textSegment);\n    block.segments.splice(index, 1, newText, trailingSpaceSegment);\n}\n","import { createText } from 'roosterjs-content-model-dom';\nimport { isPunctuation, isSpace, iterateSelections } from 'roosterjs-content-model-core';\nimport type {\n    ContentModelDocument,\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelText,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function adjustWordSelection(\n    model: ContentModelDocument,\n    marker: ContentModelSegment\n): ContentModelSegment[] {\n    let markerBlock: ContentModelParagraph | undefined;\n\n    iterateSelections(model, (_, __, block, segments) => {\n        //Find the block with the selection marker\n        if (block?.blockType == 'Paragraph' && segments?.length == 1 && segments[0] == marker) {\n            markerBlock = block;\n        }\n        return true;\n    });\n\n    const tempSegments = markerBlock ? [...markerBlock.segments] : undefined;\n\n    if (tempSegments && markerBlock) {\n        const segments: ContentModelSegment[] = [];\n        let markerSelectionIndex = tempSegments.indexOf(marker);\n        for (let i = markerSelectionIndex - 1; i >= 0; i--) {\n            const currentSegment = tempSegments[i];\n            if (currentSegment.segmentType == 'Text') {\n                const found = findDelimiter(currentSegment, false /*moveRightward*/);\n                if (found > -1) {\n                    if (found == currentSegment.text.length) {\n                        break;\n                    }\n\n                    splitTextSegment(tempSegments, currentSegment, i, found);\n\n                    segments.push(tempSegments[i + 1]);\n\n                    break;\n                } else {\n                    segments.push(tempSegments[i]);\n                }\n            } else {\n                break;\n            }\n        }\n\n        markerSelectionIndex = tempSegments.indexOf(marker);\n        segments.push(marker);\n\n        // Marker is at start of word\n        if (segments.length <= 1) {\n            return segments;\n        }\n\n        for (let i = markerSelectionIndex + 1; i < tempSegments.length; i++) {\n            const currentSegment = tempSegments[i];\n            if (currentSegment.segmentType == 'Text') {\n                const found = findDelimiter(currentSegment, true /*moveRightward*/);\n                if (found > -1) {\n                    if (found == 0) {\n                        break;\n                    }\n                    splitTextSegment(tempSegments, currentSegment, i, found);\n                    segments.push(tempSegments[i]);\n                    break;\n                } else {\n                    segments.push(tempSegments[i]);\n                }\n            } else {\n                break;\n            }\n        }\n\n        // Marker is at end of word\n        if (segments[segments.length - 1] == marker) {\n            return [marker];\n        }\n\n        markerBlock.segments = tempSegments;\n        return segments;\n    } else {\n        return [marker];\n    }\n}\n\n/*\n// These are unicode characters mostly from the Category Space Separator (Zs)\nhttps://unicode.org/Public/UNIDATA/Scripts.txt\n\n\\u2000 = EN QUAD\n\\u2009 = THIN SPACE\n\\u200a = HAIR SPACE\n\\u200b = ZERO WIDTH SPACE\n\\u202f = NARROW NO-BREAK SPACE\n\\u205f = MEDIUM MATHEMATICAL SPACE\n\\u3000 = IDEOGRAPHIC SPACE\n*/\nfunction findDelimiter(segment: ContentModelText, moveRightward: boolean): number {\n    const word = segment.text;\n    let offset = -1;\n    if (moveRightward) {\n        for (let i = 0; i < word.length; i++) {\n            const char = word[i];\n\n            if (isPunctuation(char) || isSpace(char)) {\n                offset = i;\n                break;\n            }\n        }\n    } else {\n        for (let i = word.length - 1; i >= 0; i--) {\n            const char = word[i];\n\n            if (isPunctuation(char) || isSpace(char)) {\n                offset = i + 1;\n                break;\n            }\n        }\n    }\n    return offset;\n}\n\nfunction splitTextSegment(\n    segments: ContentModelSegment[],\n    textSegment: Readonly<ContentModelText>,\n    index: number,\n    found: number\n) {\n    const text = textSegment.text;\n    const newSegmentLeft = createText(\n        text.substring(0, found),\n        textSegment.format,\n        textSegment.link,\n        textSegment.code\n    );\n    const newSegmentRight = createText(\n        text.substring(found, text.length),\n        textSegment.format,\n        textSegment.link,\n        textSegment.code\n    );\n    segments.splice(index, 1, newSegmentLeft, newSegmentRight);\n}\n","import { addSegment, createSelectionMarker } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelTableRow,\n    TableSelectionCoordinates,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function collapseTableSelection(\n    rows: ContentModelTableRow[],\n    selection: TableSelectionCoordinates\n) {\n    const { firstColumn, firstRow } = selection;\n    const cell = rows[firstRow]?.cells[firstColumn];\n    if (cell) {\n        addSegment(cell, createSelectionMarker());\n    }\n}\n","import type { ContentModelTable, TableAlignOperation } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function alignTable(table: ContentModelTable, operation: TableAlignOperation) {\n    table.format.marginLeft = operation == 'alignLeft' ? '' : 'auto';\n    table.format.marginRight = operation == 'alignRight' ? '' : 'auto';\n\n    delete table.cachedElement;\n}\n","import { getSelectedCells, updateTableCellMetadata } from 'roosterjs-content-model-core';\nimport type {\n    ContentModelTable,\n    ContentModelTableCell,\n    TableCellHorizontalAlignOperation,\n    TableCellVerticalAlignOperation,\n} from 'roosterjs-content-model-types';\n\nconst TextAlignValueMap: Partial<Record<\n    TableCellHorizontalAlignOperation,\n    'start' | 'center' | 'end'\n>> = {\n    alignCellLeft: 'start',\n    alignCellCenter: 'center',\n    alignCellRight: 'end',\n};\n\nconst VerticalAlignValueMap: Partial<Record<\n    TableCellVerticalAlignOperation,\n    'top' | 'middle' | 'bottom'\n>> = {\n    alignCellTop: 'top',\n    alignCellMiddle: 'middle',\n    alignCellBottom: 'bottom',\n};\n\n/**\n * @internal\n */\nexport function alignTableCellHorizontally(\n    table: ContentModelTable,\n    operation: TableCellHorizontalAlignOperation\n) {\n    alignTableCellInternal(table, cell => {\n        cell.format.textAlign = TextAlignValueMap[operation];\n    });\n}\n\n/**\n * @internal\n */\nexport function alignTableCellVertically(\n    table: ContentModelTable,\n    operation: TableCellVerticalAlignOperation\n) {\n    alignTableCellInternal(table, cell => {\n        cell.format.verticalAlign = VerticalAlignValueMap[operation];\n\n        updateTableCellMetadata(cell, metadata => {\n            metadata = metadata || {};\n            metadata.vAlignOverride = true;\n            return metadata;\n        });\n    });\n}\n\nfunction alignTableCellInternal(\n    table: ContentModelTable,\n    callback: (cell: ContentModelTableCell) => void\n) {\n    const sel = getSelectedCells(table);\n\n    if (sel) {\n        for (let rowIndex = sel.firstRow; rowIndex <= sel.lastRow; rowIndex++) {\n            for (let colIndex = sel.firstColumn; colIndex <= sel.lastColumn; colIndex++) {\n                const cell = table.rows[rowIndex]?.cells[colIndex];\n                const format = cell?.format;\n\n                if (format) {\n                    delete cell.cachedElement;\n\n                    callback(cell);\n\n                    cell.blocks.forEach(block => {\n                        if (block.blockType === 'Paragraph') {\n                            delete block.format.textAlign;\n                        }\n                    });\n                }\n            }\n        }\n    }\n}\n","import type { ContentModelTableRow } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function canMergeCells(\n    rows: ContentModelTableRow[],\n    firstRow: number,\n    firstCol: number,\n    lastRow: number,\n    lastCol: number\n): boolean {\n    const noSpanAbove =\n        firstCol == lastCol ||\n        rows[firstRow].cells.every(\n            (cell, colIndex) => colIndex < firstCol || colIndex > lastCol || !cell.spanAbove\n        );\n    const noSpanLeft =\n        firstRow == lastRow ||\n        rows.every(\n            (row, rowIndex) =>\n                rowIndex < firstRow || rowIndex > lastRow || !row.cells[firstCol].spanLeft\n        );\n\n    const noDifferentBelowSpan = rows[lastRow].cells\n        .map((_, colIndex) =>\n            colIndex >= firstCol && colIndex <= lastCol\n                ? getBelowSpanCount(rows, lastRow, colIndex)\n                : -1\n        )\n        .every((x, _, a) => x < 0 || x == a[firstCol]);\n    const noDifferentRightSpan = rows\n        .map((_, rowIndex) =>\n            rowIndex >= firstRow && rowIndex <= lastRow\n                ? getRightSpanCount(rows, rowIndex, lastCol)\n                : -1\n        )\n        .every((x, _, a) => x < 0 || x == a[firstRow]);\n\n    return noSpanAbove && noSpanLeft && noDifferentBelowSpan && noDifferentRightSpan;\n}\n\nfunction getBelowSpanCount(rows: ContentModelTableRow[], rowIndex: number, colIndex: number) {\n    let spanCount = 0;\n\n    for (let row = rowIndex + 1; row < rows.length; row++) {\n        if (rows[row]?.cells[colIndex]?.spanAbove) {\n            spanCount++;\n        } else {\n            break;\n        }\n    }\n\n    return spanCount;\n}\n\nfunction getRightSpanCount(rows: ContentModelTableRow[], rowIndex: number, colIndex: number) {\n    let spanCount = 0;\n\n    for (let col = colIndex + 1; col < rows[rowIndex]?.cells.length; col++) {\n        if (rows[rowIndex]?.cells[col]?.spanLeft) {\n            spanCount++;\n        } else {\n            break;\n        }\n    }\n\n    return spanCount;\n}\n","import { setSelection } from 'roosterjs-content-model-core';\nimport type { ContentModelTable, TableSelectionCoordinates } from 'roosterjs-content-model-types';\n\n/**\n * Clear selection of a table.\n * @internal\n * @param table The table model where the selection is to be cleared\n * @param sel The selection coordinates to be cleared\n */\nexport function clearSelectedCells(table: ContentModelTable, sel: TableSelectionCoordinates) {\n    if (\n        sel.firstColumn >= 0 &&\n        sel.firstRow >= 0 &&\n        sel.lastColumn < table.widths.length &&\n        sel.lastRow < table.rows.length\n    ) {\n        for (let i = sel.firstRow; i <= sel.lastRow; i++) {\n            const row = table.rows[i];\n            for (let j = sel.firstColumn; j <= sel.lastColumn; j++) {\n                const cell = row.cells[j];\n                cell.isSelected = false;\n                setSelection(cell);\n            }\n        }\n    }\n}\n","import { addBlock, createTable, createTableCell } from 'roosterjs-content-model-dom';\nimport type { ContentModelBlockGroup, ContentModelTable } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function createTableStructure(\n    parent: ContentModelBlockGroup,\n    columns: number,\n    rows: number\n): ContentModelTable {\n    const table = createTable(rows);\n\n    addBlock(parent, table);\n\n    table.rows.forEach(row => {\n        for (let i = 0; i < columns; i++) {\n            const cell = createTableCell();\n\n            row.cells.push(cell);\n        }\n    });\n\n    return table;\n}\n","import type { ContentModelTable } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function deleteTable(table: ContentModelTable) {\n    table.rows = [];\n    delete table.cachedElement;\n}\n","import { collapseTableSelection } from '../selection/collapseTableSelection';\nimport { getSelectedCells } from 'roosterjs-content-model-core';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function deleteTableColumn(table: ContentModelTable) {\n    const sel = getSelectedCells(table);\n\n    if (sel) {\n        for (let rowIndex = 0; rowIndex < table.rows.length; rowIndex++) {\n            const cellInNextCol = table.rows[rowIndex].cells[sel.lastColumn + 1];\n\n            if (cellInNextCol) {\n                cellInNextCol.spanLeft =\n                    cellInNextCol.spanLeft && table.rows[rowIndex].cells[sel.firstColumn].spanLeft;\n            }\n\n            table.rows[rowIndex].cells.splice(\n                sel.firstColumn,\n                sel.lastColumn - sel.firstColumn + 1\n            );\n        }\n\n        table.widths.splice(sel.firstColumn, sel.lastColumn - sel.firstColumn + 1);\n        collapseTableSelection(table.rows, sel);\n    }\n}\n","import { collapseTableSelection } from '../selection/collapseTableSelection';\nimport { getSelectedCells } from 'roosterjs-content-model-core';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function deleteTableRow(table: ContentModelTable) {\n    const sel = getSelectedCells(table);\n\n    if (sel) {\n        table.rows[sel.firstRow].cells.forEach((cell, colIndex) => {\n            const cellInNextRow = table.rows[sel.lastRow + 1]?.cells[colIndex];\n\n            if (cellInNextRow) {\n                cellInNextRow.spanAbove = cellInNextRow.spanAbove && cell.spanAbove;\n            }\n        });\n\n        table.rows.splice(sel.firstRow, sel.lastRow - sel.firstRow + 1);\n\n        collapseTableSelection(table.rows, sel);\n    }\n}\n","import { createBr, createParagraph } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelParagraph,\n    ContentModelTable,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * After edit table, it maybe in a abnormal state, e.g. selected table cell is removed, or all rows are removed causes no place to put cursor.\n * We need to make sure table is in normal state, and there is a place to put cursor.\n * @returns a new paragraph that can but put focus in, or undefined if not needed\n */\nexport function ensureFocusableParagraphForTable(\n    model: ContentModelDocument,\n    path: ContentModelBlockGroup[],\n    table: ContentModelTable\n): ContentModelParagraph | undefined {\n    let paragraph: ContentModelParagraph | undefined;\n    const firstCell = table.rows.filter(row => row.cells.length > 0)[0]?.cells[0];\n\n    if (firstCell) {\n        // When there is a valid cell to put focus, use it\n        paragraph = firstCell.blocks.filter(\n            (block): block is ContentModelParagraph => block.blockType == 'Paragraph'\n        )[0];\n\n        if (!paragraph) {\n            // If there is not a paragraph under this cell, create one\n            paragraph = createEmptyParagraph(model);\n            firstCell.blocks.push(paragraph);\n        }\n    } else {\n        // No table cell at all, which means the whole table is deleted. So we need to remove it from content model.\n        let block: ContentModelBlock = table;\n        let parent: ContentModelBlockGroup | undefined;\n        paragraph = createEmptyParagraph(model);\n\n        // If the table is the only block of its parent and parent is a FormatContainer, remove the parent as well.\n        // We need to do this in a loop in case there are multiple layer of FormatContainer that match this case\n        while ((parent = path.shift())) {\n            const index = parent.blocks.indexOf(block) ?? -1;\n\n            if (parent && index >= 0) {\n                parent.blocks.splice(index, 1, paragraph);\n            }\n\n            if (\n                parent.blockGroupType == 'FormatContainer' &&\n                parent.blocks.length == 1 &&\n                parent.blocks[0] == paragraph\n            ) {\n                // If the new paragraph is the only child of parent format container, unwrap parent as well\n                block = parent;\n            } else {\n                // Otherwise, just stop here and keep processing the new paragraph\n                break;\n            }\n        }\n    }\n\n    return paragraph;\n}\n\nfunction createEmptyParagraph(model: ContentModelDocument) {\n    const newPara = createParagraph(false /*isImplicit*/, undefined /*blockFormat*/, model.format);\n    const br = createBr(model.format);\n\n    newPara.segments.push(br);\n\n    return newPara;\n}\n","import { clearSelectedCells } from './clearSelectedCells';\nimport { createTableCell } from 'roosterjs-content-model-dom';\nimport { getSelectedCells } from 'roosterjs-content-model-core';\nimport type {\n    ContentModelTable,\n    TableHorizontalInsertOperation,\n} from 'roosterjs-content-model-types';\n\n/**\n * Insert a column to the table\n * @param table The table model where the column is to be inserted\n * @param operation The operation to be performed\n */\nexport function insertTableColumn(\n    table: ContentModelTable,\n    operation: TableHorizontalInsertOperation\n) {\n    const sel = getSelectedCells(table);\n    const insertLeft = operation == 'insertLeft';\n\n    if (sel) {\n        clearSelectedCells(table, sel);\n        for (let i = sel?.firstColumn; i <= sel.lastColumn; i++) {\n            table.rows.forEach(row => {\n                const cell = row.cells[insertLeft ? sel.firstColumn : sel.lastColumn];\n\n                const newCell = createTableCell(\n                    cell.spanLeft,\n                    cell.spanAbove,\n                    cell.isHeader,\n                    cell.format,\n                    cell.dataset\n                );\n                newCell.isSelected = true;\n\n                row.cells.splice(insertLeft ? sel.firstColumn : sel.lastColumn + 1, 0, newCell);\n            });\n            table.widths.splice(\n                insertLeft ? sel.firstColumn : sel.lastColumn + 1,\n                0,\n                table.widths[insertLeft ? sel.firstColumn : sel.lastColumn]\n            );\n        }\n    }\n}\n","import { clearSelectedCells } from './clearSelectedCells';\nimport { createTableCell } from 'roosterjs-content-model-dom';\nimport { getSelectedCells } from 'roosterjs-content-model-core';\nimport type {\n    ContentModelTable,\n    TableVerticalInsertOperation,\n} from 'roosterjs-content-model-types';\n\n/**\n * Insert a row to the table\n * @param table The table model where the row is to be inserted\n * @param operation The operation to be performed\n */\nexport function insertTableRow(table: ContentModelTable, operation: TableVerticalInsertOperation) {\n    const sel = getSelectedCells(table);\n    const insertAbove = operation == 'insertAbove';\n\n    if (sel) {\n        clearSelectedCells(table, sel);\n        for (let i = sel.firstRow; i <= sel.lastRow; i++) {\n            const sourceRow = table.rows[insertAbove ? sel.firstRow : sel.lastRow];\n\n            table.rows.splice(insertAbove ? sel.firstRow : sel.lastRow + 1, 0, {\n                format: { ...sourceRow.format },\n                cells: sourceRow.cells.map(cell => {\n                    const newCell = createTableCell(\n                        cell.spanLeft,\n                        cell.spanAbove,\n                        cell.isHeader,\n                        cell.format,\n                        cell.dataset\n                    );\n                    newCell.isSelected = true;\n                    return newCell;\n                }),\n                height: sourceRow.height,\n            });\n        }\n    }\n}\n","import { canMergeCells } from './canMergeCells';\nimport { getSelectedCells } from 'roosterjs-content-model-core';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function mergeTableCells(table: ContentModelTable) {\n    const sel = getSelectedCells(table);\n\n    if (\n        sel &&\n        canMergeCells(table.rows, sel.firstRow, sel.firstColumn, sel.lastRow, sel.lastColumn)\n    ) {\n        for (let rowIndex = sel.firstRow; rowIndex <= sel.lastRow; rowIndex++) {\n            for (let colIndex = sel.firstColumn; colIndex <= sel.lastColumn; colIndex++) {\n                const cell = table.rows[rowIndex].cells[colIndex];\n\n                if (cell) {\n                    cell.spanLeft = colIndex > sel.firstColumn;\n                    cell.spanAbove = rowIndex > sel.firstRow;\n\n                    delete cell.cachedElement;\n                }\n            }\n\n            delete table.rows[rowIndex].cachedElement;\n        }\n    }\n}\n","import { canMergeCells } from './canMergeCells';\nimport { getSelectedCells } from 'roosterjs-content-model-core';\nimport type {\n    ContentModelTable,\n    TableHorizontalMergeOperation,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function mergeTableColumn(\n    table: ContentModelTable,\n    operation: TableHorizontalMergeOperation\n) {\n    const sel = getSelectedCells(table);\n    const mergeLeft = operation == 'mergeLeft';\n\n    if (sel) {\n        const mergingColIndex = mergeLeft ? sel.firstColumn : sel.lastColumn + 1;\n\n        if (mergingColIndex > 0 && mergingColIndex < table.rows[0].cells.length) {\n            for (let rowIndex = sel.firstRow; rowIndex <= sel.lastRow; rowIndex++) {\n                const cell = table.rows[rowIndex]?.cells[mergingColIndex];\n\n                if (\n                    cell &&\n                    canMergeCells(\n                        table.rows,\n                        rowIndex,\n                        mergingColIndex - 1,\n                        rowIndex,\n                        mergingColIndex\n                    )\n                ) {\n                    cell.spanLeft = true;\n\n                    let newSelectedCol = mergingColIndex;\n\n                    while (table.rows[rowIndex]?.cells[newSelectedCol]?.spanLeft) {\n                        delete table.rows[rowIndex].cells[newSelectedCol].cachedElement;\n                        newSelectedCol--;\n                    }\n\n                    if (table.rows[rowIndex]?.cells[newSelectedCol]) {\n                        table.rows[rowIndex].cells[newSelectedCol].isSelected = true;\n\n                        delete table.rows[rowIndex].cells[newSelectedCol].cachedElement;\n                    }\n\n                    delete cell.cachedElement;\n                }\n\n                delete table.rows[rowIndex].cachedElement;\n            }\n        }\n    }\n}\n","import { canMergeCells } from './canMergeCells';\nimport { getSelectedCells } from 'roosterjs-content-model-core';\nimport type { ContentModelTable, TableVerticalMergeOperation } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function mergeTableRow(table: ContentModelTable, operation: TableVerticalMergeOperation) {\n    const sel = getSelectedCells(table);\n    const mergeAbove = operation == 'mergeAbove';\n\n    if (sel) {\n        const mergingRowIndex = mergeAbove ? sel.firstRow : sel.lastRow + 1;\n\n        if (mergingRowIndex > 0 && mergingRowIndex < table.rows.length) {\n            for (let colIndex = sel.firstColumn; colIndex <= sel.lastColumn; colIndex++) {\n                const cell = table.rows[mergingRowIndex].cells[colIndex];\n\n                if (\n                    cell &&\n                    canMergeCells(\n                        table.rows,\n                        mergingRowIndex - 1,\n                        colIndex,\n                        mergingRowIndex,\n                        colIndex\n                    )\n                ) {\n                    cell.spanAbove = true;\n\n                    let newSelectedRow = mergingRowIndex;\n\n                    while (table.rows[newSelectedRow]?.cells[colIndex]?.spanAbove) {\n                        delete table.rows[newSelectedRow].cells[colIndex].cachedElement;\n                        delete table.rows[newSelectedRow].cachedElement;\n                        newSelectedRow--;\n                    }\n\n                    if (table.rows[newSelectedRow]?.cells[colIndex]) {\n                        table.rows[newSelectedRow].cells[colIndex].isSelected = true;\n\n                        delete table.rows[newSelectedRow].cells[colIndex].cachedElement;\n                        delete table.rows[newSelectedRow].cachedElement;\n                    }\n\n                    delete cell.cachedElement;\n                }\n            }\n        }\n    }\n}\n","import { createTableCell } from 'roosterjs-content-model-dom';\nimport { getSelectedCells } from 'roosterjs-content-model-core';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\n\nconst MIN_WIDTH = 30;\n\n/**\n * @internal\n */\nexport function splitTableCellHorizontally(table: ContentModelTable) {\n    const sel = getSelectedCells(table);\n\n    if (sel) {\n        for (let colIndex = sel.lastColumn; colIndex >= sel.firstColumn; colIndex--) {\n            if (\n                table.rows.every(\n                    (row, rowIndex) =>\n                        rowIndex < sel.firstRow ||\n                        rowIndex > sel.lastRow ||\n                        row.cells[colIndex + 1]?.spanLeft\n                )\n            ) {\n                table.rows.forEach((row, rowIndex) => {\n                    delete row.cells[colIndex].cachedElement;\n\n                    if (rowIndex >= sel.firstRow && rowIndex <= sel.lastRow) {\n                        row.cells[colIndex + 1].spanLeft = false;\n                        delete row.cells[colIndex + 1].cachedElement;\n                    }\n                });\n            } else {\n                table.rows.forEach((row, rowIndex) => {\n                    const cell = row.cells[colIndex];\n                    if (cell) {\n                        const newCell = createTableCell(\n                            cell.spanLeft,\n                            cell.spanAbove,\n                            cell.isHeader,\n                            cell.format\n                        );\n\n                        newCell.dataset = { ...cell.dataset };\n\n                        if (rowIndex < sel.firstRow || rowIndex > sel.lastRow) {\n                            newCell.spanLeft = true;\n                        } else {\n                            newCell.isSelected = cell.isSelected;\n                        }\n                        row.cells.splice(colIndex + 1, 0, newCell);\n\n                        delete row.cells[colIndex].cachedElement;\n                    }\n                });\n\n                const newWidth = Math.max(table.widths[colIndex] / 2, MIN_WIDTH);\n\n                table.widths.splice(colIndex, 1, newWidth, newWidth);\n            }\n        }\n    }\n}\n","import { createTableCell } from 'roosterjs-content-model-dom';\nimport { getSelectedCells } from 'roosterjs-content-model-core';\nimport type { ContentModelTable, ContentModelTableRow } from 'roosterjs-content-model-types';\n\nconst MIN_HEIGHT = 22;\n\n/**\n * @internal\n */\nexport function splitTableCellVertically(table: ContentModelTable) {\n    const sel = getSelectedCells(table);\n\n    if (sel) {\n        for (let rowIndex = sel.lastRow; rowIndex >= sel.firstRow; rowIndex--) {\n            const row = table.rows[rowIndex];\n            const belowRow = table.rows[rowIndex + 1];\n\n            row.cells.forEach(cell => {\n                delete cell.cachedElement;\n            });\n\n            delete row.cachedElement;\n\n            if (\n                belowRow?.cells.every(\n                    (belowCell, colIndex) =>\n                        colIndex < sel.firstColumn ||\n                        colIndex > sel.lastColumn ||\n                        belowCell.spanAbove\n                )\n            ) {\n                belowRow.cells.forEach((belowCell, colIndex) => {\n                    if (colIndex >= sel.firstColumn && colIndex <= sel.lastColumn) {\n                        belowCell.spanAbove = false;\n                        delete belowCell.cachedElement;\n                    }\n                });\n\n                delete belowRow.cachedElement;\n            } else {\n                const newHeight = Math.max((row.height /= 2), MIN_HEIGHT);\n                const newRow: ContentModelTableRow = {\n                    format: { ...row.format },\n                    height: newHeight,\n                    cells: row.cells.map((cell, colIndex) => {\n                        const newCell = createTableCell(\n                            cell.spanLeft,\n                            cell.spanAbove,\n                            cell.isHeader,\n                            cell.format\n                        );\n\n                        newCell.dataset = { ...cell.dataset };\n\n                        if (colIndex < sel.firstColumn || colIndex > sel.lastColumn) {\n                            newCell.spanAbove = true;\n                        } else {\n                            newCell.isSelected = cell.isSelected;\n                        }\n\n                        return newCell;\n                    }),\n                };\n\n                row.height = newHeight;\n                table.rows.splice(rowIndex + 1, 0, newRow);\n            }\n        }\n    }\n}\n","import { setModelAlignment } from '../../modelApi/block/setModelAlignment';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Set text alignment of selected paragraphs\n * @param editor The editor to set alignment\n * @param alignment Alignment value: left, center or right\n */\nexport function setAlignment(editor: IEditor, alignment: 'left' | 'center' | 'right' | 'justify') {\n    editor.focus();\n\n    editor.formatContentModel(model => setModelAlignment(model, alignment), {\n        apiName: 'setAlignment',\n    });\n}\n","import { setModelDirection } from '../../modelApi/block/setModelDirection';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Set text direction of selected paragraphs (Left to right or Right to left)\n * @param editor The editor to set alignment\n * @param direction Direction value: ltr (Left to right) or rtl (Right to left)\n */\nexport function setDirection(editor: IEditor, direction: 'ltr' | 'rtl') {\n    editor.focus();\n\n    editor.formatContentModel(model => setModelDirection(model, direction), {\n        apiName: 'setDirection',\n    });\n}\n","import { formatParagraphWithContentModel } from '../utils/formatParagraphWithContentModel';\nimport type { ContentModelParagraphDecorator, IEditor } from 'roosterjs-content-model-types';\n\ntype HeadingLevelTags = 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6';\n\nconst HeaderFontSizes: Record<HeadingLevelTags, string> = {\n    h1: '2em',\n    h2: '1.5em',\n    h3: '1.17em',\n    h4: '1em',\n    h5: '0.83em',\n    h6: '0.67em',\n};\n\n/**\n * Set heading level of selected paragraphs\n * @param editor The editor to set heading level to\n * @param headingLevel Level of heading, from 1 to 6. Set to 0 means set it back to a regular paragraph\n */\nexport function setHeadingLevel(editor: IEditor, headingLevel: 0 | 1 | 2 | 3 | 4 | 5 | 6) {\n    editor.focus();\n\n    formatParagraphWithContentModel(editor, 'setHeadingLevel', para => {\n        const tagName =\n            headingLevel > 0\n                ? (('h' + headingLevel) as HeadingLevelTags | null)\n                : getExistingHeadingTag(para.decorator);\n\n        if (headingLevel > 0) {\n            para.decorator = {\n                tagName: tagName!,\n                format: tagName\n                    ? {\n                          fontWeight: 'bold',\n                          fontSize: HeaderFontSizes[tagName],\n                      }\n                    : {},\n            };\n\n            // Remove existing formats since tags have default font size and weight\n            para.segments.forEach(segment => {\n                delete segment.format.fontSize;\n                delete segment.format.fontWeight;\n            });\n        } else if (tagName) {\n            delete para.decorator;\n        }\n    });\n}\n\nfunction getExistingHeadingTag(\n    decorator?: ContentModelParagraphDecorator\n): HeadingLevelTags | null {\n    const tag = decorator?.tagName || '';\n    const level = parseInt(tag.substring(1));\n\n    return level >= 1 && level <= 6 ? (tag as HeadingLevelTags) : null;\n}\n","import { normalizeContentModel } from 'roosterjs-content-model-dom';\nimport { setModelIndentation } from '../../modelApi/block/setModelIndentation';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Indent or outdent to selected paragraphs\n * @param editor The editor to operate on\n * @param indentation Whether indent or outdent\n * @param length The length of pixel to indent/outdent @default 40\n */\nexport function setIndentation(\n    editor: IEditor,\n    indentation: 'indent' | 'outdent',\n    length?: number\n) {\n    editor.focus();\n\n    editor.formatContentModel(\n        (model, context) => {\n            const result = setModelIndentation(model, indentation, length);\n\n            if (result) {\n                normalizeContentModel(model);\n            }\n\n            context.newPendingFormat = 'preserve';\n\n            return result;\n        },\n        {\n            apiName: 'setIndentation',\n        }\n    );\n}\n","import { createParagraphDecorator } from 'roosterjs-content-model-dom';\nimport { formatParagraphWithContentModel } from '../utils/formatParagraphWithContentModel';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Toggles the current block(s) margin properties.\n * null deletes any existing value, undefined is ignored\n * @param editor The editor to operate on\n * @param marginTop value for top margin\n * @param marginBottom value for bottom margin\n */\nexport function setParagraphMargin(\n    editor: IEditor,\n    marginTop?: string | null,\n    marginBottom?: string | null\n) {\n    editor.focus();\n\n    formatParagraphWithContentModel(editor, 'setParagraphMargin', para => {\n        if (!para.decorator) {\n            para.decorator = createParagraphDecorator('p');\n        }\n\n        if (marginTop) {\n            para.format.marginTop = marginTop;\n        } else if (marginTop === null) {\n            delete para.format.marginTop;\n        }\n\n        if (marginBottom) {\n            para.format.marginBottom = marginBottom;\n        } else if (marginBottom === null) {\n            delete para.format.marginBottom;\n        }\n    });\n}\n","import { formatParagraphWithContentModel } from '../utils/formatParagraphWithContentModel';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Sets current selected block(s) line-height property and wipes such property from child segments\n * @param editor The editor to operate on\n * @param spacing Unitless/px value to set line height\n */\nexport function setSpacing(editor: IEditor, spacing: number | string) {\n    editor.focus();\n\n    formatParagraphWithContentModel(editor, 'setSpacing', paragraph => {\n        paragraph.format.lineHeight = spacing.toString();\n        paragraph.segments.forEach(segment => {\n            if (segment.format.lineHeight) {\n                delete segment.format.lineHeight;\n            }\n        });\n    });\n}\n","import { toggleModelBlockQuote } from '../../modelApi/block/toggleModelBlockQuote';\nimport type { ContentModelFormatContainerFormat, IEditor } from 'roosterjs-content-model-types';\n\nconst DefaultQuoteFormatLtr: ContentModelFormatContainerFormat = {\n    borderLeft: '3px solid rgb(200, 200, 200)',\n    textColor: 'rgb(102, 102, 102)',\n};\nconst DefaultQuoteFormatRtl: ContentModelFormatContainerFormat = {\n    borderRight: '3px solid rgb(200, 200, 200)',\n    textColor: 'rgb(102, 102, 102)',\n};\nconst BuildInQuoteFormat: ContentModelFormatContainerFormat = {\n    marginTop: '1em',\n    marginBottom: '1em',\n    marginLeft: '40px',\n    marginRight: '40px',\n};\n\n/**\n * Toggle BLOCKQUOTE state of selected paragraphs.\n * If any selected paragraph is not under a BLOCKQUOTE, wrap them into a BLOCKQUOTE.\n * Otherwise, unwrap all related BLOCKQUOTEs.\n * @param editor The editor object to toggle BLOCKQUOTE onto\n * @param quoteFormat @optional Block format for the new quote object\n */\nexport function toggleBlockQuote(\n    editor: IEditor,\n    quoteFormat?: ContentModelFormatContainerFormat,\n    quoteFormatRtl?: ContentModelFormatContainerFormat\n) {\n    const fullQuoteFormatLtr: ContentModelFormatContainerFormat = {\n        ...BuildInQuoteFormat,\n        paddingLeft: '10px',\n        ...(quoteFormat ?? DefaultQuoteFormatLtr),\n    };\n    const fullQuoteFormatRtl: ContentModelFormatContainerFormat = {\n        ...BuildInQuoteFormat,\n        paddingRight: '10px',\n        direction: 'rtl',\n        ...(quoteFormatRtl ?? quoteFormat ?? DefaultQuoteFormatRtl),\n    };\n\n    editor.focus();\n\n    editor.formatContentModel(\n        (model, context) => {\n            context.newPendingFormat = 'preserve';\n\n            return toggleModelBlockQuote(model, fullQuoteFormatLtr, fullQuoteFormatRtl);\n        },\n        {\n            apiName: 'toggleBlockQuote',\n        }\n    );\n}\n","import { ChangeSource } from 'roosterjs-content-model-core';\nimport { insertEntityModel } from '../../modelApi/entity/insertEntityModel';\nimport {\n    createEntity,\n    normalizeContentModel,\n    parseEntityFormat,\n} from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelEntity,\n    DOMSelection,\n    InsertEntityPosition,\n    InsertEntityOptions,\n    IEditor,\n    EntityState,\n} from 'roosterjs-content-model-types';\n\nconst BlockEntityTag = 'div';\nconst InlineEntityTag = 'span';\n\n/**\n * Insert an entity into editor\n * @param editor The editor object\n * @param type Type of entity\n * @param isBlock True to insert a block entity, false to insert an inline entity\n * @param position Position of the entity to insert. It can be\n * Value of InsertEntityPosition: see InsertEntityPosition\n * selectionRangeEx: Use this range instead of current focus position to insert. After insert, focus will be moved to\n * the beginning of this range (when focusAfterEntity is not set to true) or after the new entity (when focusAfterEntity is set to true)\n * @param options Move options to insert. See InsertEntityOptions\n */\nexport function insertEntity(\n    editor: IEditor,\n    type: string,\n    isBlock: boolean,\n    position: 'focus' | 'begin' | 'end' | DOMSelection,\n    options?: InsertEntityOptions\n): ContentModelEntity | null;\n\n/**\n * Insert a block entity into editor\n * @param editor The editor object\n * @param type Type of entity\n * @param isBlock Must be true for a block entity\n * @param position Position of the entity to insert. It can be\n * Value of InsertEntityPosition: see InsertEntityPosition\n * selectionRangeEx: Use this range instead of current focus position to insert. After insert, focus will be moved to\n * the beginning of this range (when focusAfterEntity is not set to true) or after the new entity (when focusAfterEntity is set to true)\n * @param options Move options to insert. See InsertEntityOptions\n */\nexport function insertEntity(\n    editor: IEditor,\n    type: string,\n    isBlock: true,\n    position: InsertEntityPosition | DOMSelection,\n    options?: InsertEntityOptions\n): ContentModelEntity | null;\n\nexport function insertEntity(\n    editor: IEditor,\n    type: string,\n    isBlock: boolean,\n    position?: InsertEntityPosition | DOMSelection,\n    options?: InsertEntityOptions\n): ContentModelEntity | null {\n    const { contentNode, focusAfterEntity, wrapperDisplay, skipUndoSnapshot, initialEntityState } =\n        options || {};\n    const document = editor.getDocument();\n    const wrapper = document.createElement(isBlock ? BlockEntityTag : InlineEntityTag);\n    const display = wrapperDisplay ?? (isBlock ? undefined : 'inline-block');\n\n    wrapper.style.setProperty('display', display || null);\n\n    if (display == undefined && isBlock) {\n        wrapper.style.setProperty('width', '100%');\n        wrapper.style.setProperty('display', 'inline-block');\n    }\n\n    if (contentNode) {\n        wrapper.appendChild(contentNode);\n    }\n\n    const entityModel = createEntity(wrapper, true /* isReadonly */, undefined /*format*/, type);\n\n    if (!skipUndoSnapshot) {\n        editor.takeSnapshot();\n    }\n\n    editor.formatContentModel(\n        (model, context) => {\n            insertEntityModel(\n                model,\n                entityModel,\n                typeof position == 'string' ? position : 'focus',\n                isBlock,\n                focusAfterEntity,\n                context\n            );\n\n            normalizeContentModel(model);\n\n            context.skipUndoSnapshot = true;\n            context.newEntities.push(entityModel);\n\n            return true;\n        },\n        {\n            selectionOverride: typeof position === 'object' ? position : undefined,\n            changeSource: ChangeSource.InsertEntity,\n            getChangeData: () => ({\n                wrapper,\n                type,\n                id: '',\n                isReadonly: true,\n            }),\n            apiName: 'insertEntity',\n        }\n    );\n\n    if (!skipUndoSnapshot) {\n        let entityState: EntityState | undefined;\n\n        if (initialEntityState) {\n            const format = parseEntityFormat(wrapper);\n            const { id, entityType } = format;\n\n            entityState =\n                id && entityType\n                    ? {\n                          id: id,\n                          type: entityType,\n                          state: initialEntityState,\n                      }\n                    : undefined;\n        }\n\n        editor.takeSnapshot(entityState);\n    }\n\n    return entityModel;\n}\n","import { clearModelFormat } from '../../modelApi/common/clearModelFormat';\nimport { normalizeContentModel } from 'roosterjs-content-model-dom';\nimport type {\n    IEditor,\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelSegment,\n    ContentModelTable,\n} from 'roosterjs-content-model-types';\n\n/**\n * Clear format of selection\n * @param editor The editor to clear format from\n */\nexport function clearFormat(editor: IEditor) {\n    editor.focus();\n\n    editor.formatContentModel(\n        model => {\n            const blocksToClear: [ContentModelBlockGroup[], ContentModelBlock][] = [];\n            const segmentsToClear: ContentModelSegment[] = [];\n            const tablesToClear: [ContentModelTable, boolean][] = [];\n\n            clearModelFormat(model, blocksToClear, segmentsToClear, tablesToClear);\n\n            normalizeContentModel(model);\n\n            return (\n                blocksToClear.length > 0 || segmentsToClear.length > 0 || tablesToClear.length > 0\n            );\n        },\n        {\n            apiName: 'clearFormat',\n        }\n    );\n}\n","import { retrieveModelFormatState } from 'roosterjs-content-model-core';\nimport type { IEditor, ContentModelFormatState } from 'roosterjs-content-model-types';\n\n/**\n * Get current format state\n * @param editor The editor to get format from\n */\nexport function getFormatState(editor: IEditor): ContentModelFormatState {\n    const pendingFormat = editor.getPendingFormat();\n    const model = editor.getContentModelCopy('reduced');\n    const manager = editor.getSnapshotsManager();\n    const result: ContentModelFormatState = {\n        canUndo: manager.hasNewContent || manager.canMove(-1),\n        canRedo: manager.canMove(1),\n        isDarkMode: editor.isDarkMode(),\n    };\n\n    retrieveModelFormatState(model, pendingFormat, result);\n\n    return result;\n}\n","import { adjustSegmentSelection } from '../../modelApi/selection/adjustSegmentSelection';\nimport type { ContentModelImage, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Adjust selection to make sure select an image if any\n * @return Content Model Image object if an image is select, or null\n */\nexport function adjustImageSelection(editor: IEditor): ContentModelImage | null {\n    let image: ContentModelImage | null = null;\n\n    editor.formatContentModel(\n        model =>\n            adjustSegmentSelection(\n                model,\n                target => {\n                    if (target.isSelected && target.segmentType == 'Image') {\n                        image = target;\n                        return true;\n                    } else {\n                        return false;\n                    }\n                },\n                (target, ref) => target == ref\n            ),\n        {\n            apiName: 'adjustImageSelection',\n        }\n    );\n\n    return image;\n}\n","import { formatImageWithContentModel } from '../utils/formatImageWithContentModel';\nimport { readFile, updateImageMetadata } from 'roosterjs-content-model-core';\nimport type { ContentModelImage, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Change the selected image src\n * @param editor The editor instance\n * @param file The image file\n */\nexport function changeImage(editor: IEditor, file: File) {\n    editor.focus();\n\n    const selection = editor.getDOMSelection();\n    readFile(file, dataUrl => {\n        if (dataUrl && !editor.isDisposed() && selection?.type === 'image') {\n            formatImageWithContentModel(editor, 'changeImage', (image: ContentModelImage) => {\n                const originalSrc = updateImageMetadata(image)?.src ?? '';\n                const previousSrc = image.src;\n\n                image.src = dataUrl;\n                image.dataset = {};\n                image.format.width = '';\n                image.format.height = '';\n                image.alt = '';\n\n                editor.triggerEvent('editImage', {\n                    image: selection.image,\n                    previousSrc,\n                    newSrc: dataUrl,\n                    originalSrc,\n                });\n            });\n        }\n    });\n}\n","import { addSegment, createContentModelDocument, createImage } from 'roosterjs-content-model-dom';\nimport { mergeModel, readFile } from 'roosterjs-content-model-core';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Insert an image into current selected position\n * @param editor The editor to operate on\n * @param file Image Blob file or source string\n */\nexport function insertImage(editor: IEditor, imageFileOrSrc: File | string) {\n    editor.focus();\n\n    if (typeof imageFileOrSrc == 'string') {\n        insertImageWithSrc(editor, imageFileOrSrc);\n    } else {\n        readFile(imageFileOrSrc, dataUrl => {\n            if (dataUrl && !editor.isDisposed()) {\n                insertImageWithSrc(editor, dataUrl);\n            }\n        });\n    }\n}\n\nfunction insertImageWithSrc(editor: IEditor, src: string) {\n    editor.formatContentModel(\n        (model, context) => {\n            const image = createImage(src, { backgroundColor: '' });\n            const doc = createContentModelDocument();\n\n            addSegment(doc, image);\n            mergeModel(model, doc, context, {\n                mergeFormat: 'mergeAll',\n            });\n\n            return true;\n        },\n        {\n            apiName: 'insertImage',\n        }\n    );\n}\n","import { formatImageWithContentModel } from '../utils/formatImageWithContentModel';\nimport type { ContentModelImage, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Set image alt text for all selected images at selection. If no images is contained\n * in selection, do nothing.\n * @param editor The editor instance\n * @param altText The image alt text\n */\nexport function setImageAltText(editor: IEditor, altText: string) {\n    editor.focus();\n\n    formatImageWithContentModel(editor, 'setImageAltText', (image: ContentModelImage) => {\n        image.alt = altText;\n    });\n}\n","import { applyImageBorderFormat } from '../../modelApi/image/applyImageBorderFormat';\nimport { formatImageWithContentModel } from '../utils/formatImageWithContentModel';\nimport type { Border, ContentModelImage, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Set image border style for all selected images at selection.\n * @param editor The editor instance\n * @param border the border format object. Ex: { color: 'red', width: '10px', style: 'solid'}, if one of the value in object is undefined\n * its value will not be changed. Passing null instead of an object will remove the border\n * @param borderRadius the border radius value, if undefined, the border radius will keep the actual value\n */\nexport function setImageBorder(editor: IEditor, border: Border | null, borderRadius?: string) {\n    editor.focus();\n\n    formatImageWithContentModel(editor, 'setImageBorder', (image: ContentModelImage) => {\n        applyImageBorderFormat(image, border, borderRadius);\n    });\n}\n","import { formatImageWithContentModel } from '../utils/formatImageWithContentModel';\nimport type { ContentModelImage, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Set image box shadow for all selected images at selection.\n * @param editor The editor instance\n * @param boxShadow The image box boxShadow\n * @param margin The image margin for all sides (eg. \"4px\"), null to remove margin\n */\nexport function setImageBoxShadow(editor: IEditor, boxShadow: string, margin?: string | null) {\n    editor.focus();\n\n    formatImageWithContentModel(editor, 'setImageBoxShadow', (image: ContentModelImage) => {\n        image.format.boxShadow = boxShadow;\n        if (margin) {\n            image.format.marginBottom = margin;\n            image.format.marginLeft = margin;\n            image.format.marginRight = margin;\n            image.format.marginTop = margin;\n        } else if (margin === null) {\n            delete image.format.marginBottom;\n            delete image.format.marginLeft;\n            delete image.format.marginRight;\n            delete image.format.marginTop;\n        }\n    });\n}\n","import { adjustSegmentSelection } from '../../modelApi/selection/adjustSegmentSelection';\nimport { adjustWordSelection } from '../../modelApi/selection/adjustWordSelection';\nimport { getSelectedSegments, setSelection } from 'roosterjs-content-model-core';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Adjust selection to make sure select a hyperlink if any, or a word if original selection is collapsed\n * @return A combination of existing link display text and url if any. If there is no existing link, return selected text and null\n */\nexport function adjustLinkSelection(editor: IEditor): [string, string | null] {\n    let text = '';\n    let url: string | null = null;\n\n    editor.formatContentModel(\n        model => {\n            let changed = adjustSegmentSelection(\n                model,\n                target => !!target.isSelected && !!target.link,\n                (target, ref) => !!target.link && target.link.format.href == ref.link!.format.href\n            );\n            let segments = getSelectedSegments(model, false /*includingFormatHolder*/);\n            const firstSegment = segments[0];\n\n            if (segments.length == 1 && firstSegment.segmentType == 'SelectionMarker') {\n                segments = adjustWordSelection(model, firstSegment);\n\n                if (segments.length > 1) {\n                    changed = true;\n                    setSelection(model, segments[0], segments[segments.length - 1]);\n                }\n            }\n\n            text = segments.map(x => (x.segmentType == 'Text' ? x.text : '')).join('');\n            url = segments[0]?.link?.format.href || null;\n\n            return changed;\n        },\n        {\n            apiName: 'adjustLinkSelection',\n        }\n    );\n\n    return [text, url];\n}\n","import { adjustTrailingSpaceSelection } from '../../modelApi/selection/adjustTrailingSpaceSelection';\nimport { ChangeSource, getSelectedSegments, mergeModel } from 'roosterjs-content-model-core';\nimport { matchLink } from '../../modelApi/link/matchLink';\nimport type { ContentModelLink, IEditor } from 'roosterjs-content-model-types';\nimport {\n    addLink,\n    addSegment,\n    createContentModelDocument,\n    createText,\n} from 'roosterjs-content-model-dom';\n\n// Regex matching Uri scheme\nconst URI_REGEX = /^[a-zA-Z]+:/i;\n// Regex matching begin of email address\nconst MAILTO_REGEX = /^[\\w.%+-]+@/i;\n// Regex matching begin of ftp, i.e. ftp.microsoft.com\nconst FTP_REGEX = /^ftp\\./i;\n\n/**\n * Insert a hyperlink at cursor.\n * When there is a selection, hyperlink will be applied to the selection,\n * otherwise a hyperlink will be inserted to the cursor position.\n * @param editor Editor object\n * @param link Link address, can be http(s), mailto, notes, file, unc, ftp, news, telnet, gopher, wais.\n * When protocol is not specified, a best matched protocol will be predicted.\n * @param anchorTitle Optional alt text of the link, will be shown when hover on the link\n * @param displayText Optional display text for the link.\n * @param target Optional display target for the link (\"_blank\"|\"_self\"|\"_parent\"|\"_top\"|\"{framename}\")\n * If specified, the display text of link will be replaced with this text.\n * If not specified and there wasn't a link, the link url will be used as display text.\n */\nexport function insertLink(\n    editor: IEditor,\n    link: string,\n    anchorTitle?: string,\n    displayText?: string,\n    target?: string\n) {\n    editor.focus();\n\n    const url = (checkXss(link) || '').trim();\n    if (url) {\n        const linkData = matchLink(url);\n        const linkUrl = linkData ? linkData.normalizedUrl : applyLinkPrefix(url);\n        const links: ContentModelLink[] = [];\n        let anchorNode: Node | undefined;\n\n        editor.formatContentModel(\n            (model, context) => {\n                const segments = getSelectedSegments(model, false /*includingFormatHolder*/);\n                const originalText = segments\n                    .map(x => (x.segmentType == 'Text' ? x.text : ''))\n                    .join('');\n                const text = displayText || originalText || '';\n\n                if (\n                    segments.some(x => x.segmentType != 'SelectionMarker') &&\n                    originalText == text\n                ) {\n                    segments.forEach(x => {\n                        const link = createLink(\n                            linkUrl,\n                            anchorTitle,\n                            target,\n                            x.segmentType == 'Text'\n                        );\n                        addLink(x, link);\n                        if (x.link) {\n                            links.push(x.link);\n                        }\n                    });\n                } else if (\n                    segments.every(x => x.segmentType == 'SelectionMarker') ||\n                    (!!text && text != originalText)\n                ) {\n                    const segment = createText(text || (linkData ? linkData.originalUrl : url), {\n                        ...segments[0]?.format,\n                        ...editor.getPendingFormat(),\n                    });\n                    const doc = createContentModelDocument();\n                    const link = createLink(linkUrl, anchorTitle, target);\n\n                    addLink(segment, link);\n                    addSegment(doc, segment);\n\n                    if (segment.link) {\n                        links.push(segment.link);\n                    }\n\n                    mergeModel(model, doc, context, {\n                        mergeFormat: 'mergeAll',\n                    });\n                }\n\n                adjustTrailingSpaceSelection(model);\n                return segments.length > 0;\n            },\n            {\n                changeSource: ChangeSource.CreateLink,\n                onNodeCreated: (modelElement, node) => {\n                    if (!anchorNode && links.indexOf(modelElement as ContentModelLink) >= 0) {\n                        anchorNode = node;\n                    }\n                },\n                getChangeData: () => anchorNode,\n                apiName: 'insertLink',\n            }\n        );\n    }\n}\n\nconst createLink = (\n    url: string,\n    anchorTitle?: string,\n    target?: string,\n    underline: boolean = true\n): ContentModelLink => {\n    return {\n        dataset: {},\n        format: {\n            href: url,\n            anchorTitle,\n            target,\n            underline: underline,\n        },\n    };\n};\n\nfunction applyLinkPrefix(url: string): string {\n    if (!url) {\n        return url;\n    }\n\n    // Add link prefix per rule:\n    // (a) if the url always starts with a URI scheme, leave it as it is\n    // (b) if the url is an email address, xxx@... add mailto: prefix\n    // (c) if the url starts with ftp., add ftp:// prefix\n    // (d) rest, add http:// prefix\n    let prefix = '';\n    if (url.search(URI_REGEX) < 0) {\n        if (url.search(MAILTO_REGEX) == 0) {\n            prefix = 'mailto:';\n        } else if (url.search(FTP_REGEX) == 0) {\n            prefix = 'ftp://';\n        } else {\n            // fallback to http://\n            prefix = 'http://';\n        }\n    }\n\n    return prefix + url;\n}\n\nfunction checkXss(link: string): string {\n    return link.match(/s\\n*c\\n*r\\n*i\\n*p\\n*t\\n*:/i) ? '' : link;\n}\n","import { adjustSegmentSelection } from '../../modelApi/selection/adjustSegmentSelection';\nimport { getSelectedSegments } from 'roosterjs-content-model-core';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Remove link at selection. If no links at selection, do nothing.\n * If selection contains multiple links, all of the link styles will be removed.\n * If only part of a link is selected, the whole link style will be removed.\n * @param editor The editor instance\n */\nexport function removeLink(editor: IEditor) {\n    editor.focus();\n\n    editor.formatContentModel(\n        model => {\n            adjustSegmentSelection(\n                model,\n                target => !!target.isSelected && !!target.link,\n                (target, ref) =>\n                    target.isSelected || // Expand the selection to any link that is involved. So we can remove multiple links together\n                    (!!target.link && target.link.format.href == ref.link!.format.href)\n            );\n\n            const segments = getSelectedSegments(model, false /*includingFormatHolder*/);\n            let isChanged = false;\n\n            segments.forEach(segment => {\n                if (segment.link) {\n                    isChanged = true;\n\n                    delete segment.link;\n                }\n            });\n\n            return isChanged;\n        },\n        {\n            apiName: 'removeLink',\n        }\n    );\n}\n","import { getFirstSelectedListItem } from 'roosterjs-content-model-core';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Set start number of a list item\n * @param editor The editor to operate on\n * @param value The number to set to, must be equal or greater than 1\n */\nexport function setListStartNumber(editor: IEditor, value: number) {\n    editor.focus();\n\n    editor.formatContentModel(\n        model => {\n            const listItem = getFirstSelectedListItem(model);\n            const level = listItem?.levels[listItem?.levels.length - 1];\n\n            if (level) {\n                level.format.startNumberOverride = value;\n\n                return true;\n            } else {\n                return false;\n            }\n        },\n        {\n            apiName: 'setListStartNumber',\n        }\n    );\n}\n","import { findListItemsInSameThread } from '../../modelApi/list/findListItemsInSameThread';\nimport { getFirstSelectedListItem, updateListMetadata } from 'roosterjs-content-model-core';\nimport type { IEditor, ListMetadataFormat } from 'roosterjs-content-model-types';\n\n/**\n * Set style of list items with in same thread of current item\n * @param editor The editor to operate on\n * @param style The target list item style to set\n */\nexport function setListStyle(editor: IEditor, style: ListMetadataFormat) {\n    editor.focus();\n\n    editor.formatContentModel(\n        model => {\n            const listItem = getFirstSelectedListItem(model);\n\n            if (listItem) {\n                const listItems = findListItemsInSameThread(model, listItem);\n                const levelIndex = listItem.levels.length - 1;\n\n                listItems.forEach(listItem => {\n                    const level = listItem.levels[levelIndex];\n\n                    if (level) {\n                        updateListMetadata(level, metadata => Object.assign({}, metadata, style));\n                    }\n                });\n\n                return true;\n            } else {\n                return false;\n            }\n        },\n        {\n            apiName: 'setListStyle',\n        }\n    );\n}\n","import { setListType } from '../../modelApi/list/setListType';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Toggle bullet list type\n * - When there are some blocks not in bullet list, set all blocks to the given type\n * - When all blocks are already in bullet list, turn off / outdent there list type\n * @param editor The editor to operate on\n * @param removeMargins true to remove margins, false to keep margins @default false\n */\nexport function toggleBullet(editor: IEditor, removeMargins: boolean = false) {\n    editor.focus();\n\n    editor.formatContentModel(\n        (model, context) => {\n            context.newPendingFormat = 'preserve';\n\n            return setListType(model, 'UL', removeMargins);\n        },\n        {\n            apiName: 'toggleBullet',\n        }\n    );\n}\n","import { setListType } from '../../modelApi/list/setListType';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Toggle numbering list type\n * - When there are some blocks not in numbering list, set all blocks to the given type\n * - When all blocks are already in numbering list, turn off / outdent there list type\n * @param editor The editor to operate on\n * @param removeMargins true to remove margins, false to keep margins @default false\n */\nexport function toggleNumbering(editor: IEditor, removeMargins: boolean = false) {\n    editor.focus();\n\n    editor.formatContentModel(\n        (model, context) => {\n            context.newPendingFormat = 'preserve';\n\n            return setListType(model, 'OL', removeMargins);\n        },\n        {\n            apiName: 'toggleNumbering',\n        }\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { ContentModelSegmentFormat, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Bulk apply segment format to all selected content. This is usually used for format painter.\n * @param editor The editor to operate on\n * @param newFormat The segment format to apply\n */\nexport function applySegmentFormat(editor: IEditor, newFormat: ContentModelSegmentFormat) {\n    formatSegmentWithContentModel(\n        editor,\n        'applySegmentFormat',\n        format => {\n            format.backgroundColor = newFormat.backgroundColor;\n            format.fontFamily = newFormat.fontFamily;\n            format.fontSize = newFormat.fontSize;\n            format.fontWeight = newFormat.fontWeight;\n            format.italic = newFormat.italic;\n            format.strikethrough = newFormat.strikethrough;\n            format.superOrSubScriptSequence = newFormat.superOrSubScriptSequence;\n            format.textColor = newFormat.textColor;\n            format.underline = newFormat.underline;\n        },\n        undefined /* segmentHasStyleCallback*/,\n        true /*includingFormatHandler*/\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Change the capitalization of text in the selection\n * @param editor The editor instance\n * @param capitalization The case option\n * @param language Optional parameter for language string that should comply to \"IETF BCP 47 Tags for\n * Identifying Languages\". For example: 'en' or 'en-US' for English, 'tr' for Turkish.\n * Default is the host environments current locale.\n */\nexport function changeCapitalization(\n    editor: IEditor,\n    capitalization: 'sentence' | 'lowerCase' | 'upperCase' | 'capitalize',\n    language?: string\n) {\n    editor.focus();\n\n    formatSegmentWithContentModel(editor, 'changeCapitalization', (_, __, segment) => {\n        if (segment?.segmentType == 'Text') {\n            switch (capitalization) {\n                case 'lowerCase':\n                    segment.text = segment.text.toLocaleLowerCase(language);\n                    break;\n\n                case 'upperCase':\n                    segment.text = segment.text.toLocaleUpperCase(language);\n                    break;\n\n                case 'capitalize':\n                    const wordArray = segment.text.toLocaleLowerCase(language).split(' ');\n\n                    for (let i = 0; i < wordArray.length; i++) {\n                        wordArray[i] =\n                            wordArray[i].charAt(0).toLocaleUpperCase(language) +\n                            wordArray[i].slice(1);\n                    }\n\n                    segment.text = wordArray.join(' ');\n                    break;\n\n                case 'sentence':\n                    const punctuationMarks = '[\\\\.\\\\!\\\\?]';\n                    // Find a match of a word character either:\n                    // - At the beginning of a string with or without preceding whitespace, for\n                    // example: '  hello world' and 'hello world' strings would both match 'h'.\n                    // - Or preceded by a punctuation mark and at least one whitespace, for\n                    // example 'yes. hello world' would match 'y' and 'h'.\n                    const regex = new RegExp('^\\\\s*\\\\w|' + punctuationMarks + '\\\\s+\\\\w', 'g');\n\n                    segment.text = segment.text\n                        .toLocaleLowerCase(language)\n                        .replace(regex, match => match.toLocaleUpperCase(language));\n                    break;\n            }\n        }\n    });\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport { parseValueWithUnit } from 'roosterjs-content-model-dom';\nimport { setFontSizeInternal } from './setFontSize';\nimport type {\n    ContentModelParagraph,\n    ContentModelSegmentFormat,\n    IEditor,\n} from 'roosterjs-content-model-types';\n\n/**\n * Default font size sequence, in pt. Suggest editor UI use this sequence as your font size list,\n * So that when increase/decrease font size, the font size can match the sequence of your font size picker\n */\nconst FONT_SIZES = [8, 9, 10, 11, 12, 14, 16, 18, 20, 22, 24, 26, 28, 36, 48, 72];\nconst MIN_FONT_SIZE = 1;\nconst MAX_FONT_SIZE = 1000;\n\n/**\n * Increase or decrease font size in selection\n * @param editor The editor instance\n * @param change Whether increase or decrease font size\n * @param fontSizes A sorted font size array, in pt. Default value is FONT_SIZES\n */\nexport function changeFontSize(editor: IEditor, change: 'increase' | 'decrease') {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'changeFontSize',\n        (format, _, __, paragraph) => changeFontSizeInternal(change, format, paragraph),\n        undefined /* segmentHasStyleCallback*/,\n        true /*includingFormatHandler*/\n    );\n}\n\nfunction changeFontSizeInternal(\n    change: 'increase' | 'decrease',\n    format: ContentModelSegmentFormat,\n    paragraph: ContentModelParagraph | null\n) {\n    if (format.fontSize) {\n        const sizeInPt = parseValueWithUnit(format.fontSize, undefined /*element*/, 'pt');\n\n        if (sizeInPt > 0) {\n            const newSize = getNewFontSize(sizeInPt, change == 'increase' ? 1 : -1, FONT_SIZES);\n\n            setFontSizeInternal(newSize + 'pt', format, paragraph);\n        }\n    }\n}\n\nfunction getNewFontSize(pt: number, changeBase: 1 | -1, fontSizes: number[]): number {\n    pt = changeBase == 1 ? Math.floor(pt) : Math.ceil(pt);\n    const last = fontSizes[fontSizes.length - 1];\n    if (pt <= fontSizes[0]) {\n        pt = Math.max(pt + changeBase, MIN_FONT_SIZE);\n    } else if (pt > last || (pt == last && changeBase == 1)) {\n        pt = pt / 10;\n        pt = changeBase == 1 ? Math.floor(pt) : Math.ceil(pt);\n        pt = Math.min(Math.max((pt + changeBase) * 10, last), MAX_FONT_SIZE);\n    } else if (changeBase == 1) {\n        for (let i = 0; i < fontSizes.length; i++) {\n            if (pt < fontSizes[i]) {\n                pt = fontSizes[i];\n                break;\n            }\n        }\n    } else {\n        for (let i = fontSizes.length - 1; i >= 0; i--) {\n            if (pt > fontSizes[i]) {\n                pt = fontSizes[i];\n                break;\n            }\n        }\n    }\n    return pt;\n}\n","import { createSelectionMarker } from 'roosterjs-content-model-dom';\nimport { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport { setSelection } from 'roosterjs-content-model-core';\nimport type { ContentModelParagraph, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Set background color\n * @param editor The editor to operate on\n * @param backgroundColor The color to set. Pass null to remove existing color.\n */\nexport function setBackgroundColor(editor: IEditor, backgroundColor: string | null) {\n    editor.focus();\n\n    let lastParagraph: ContentModelParagraph | null = null;\n    let lastSegmentIndex: number = -1;\n\n    formatSegmentWithContentModel(\n        editor,\n        'setBackgroundColor',\n        (format, _, segment, paragraph) => {\n            if (backgroundColor === null) {\n                delete format.backgroundColor;\n            } else {\n                format.backgroundColor = backgroundColor;\n            }\n\n            if (segment && paragraph && segment.segmentType != 'SelectionMarker') {\n                lastParagraph = paragraph;\n                lastSegmentIndex = lastParagraph.segments.indexOf(segment);\n            }\n        },\n        undefined /*segmentHasStyleCallback*/,\n        undefined /*includingFormatHolder*/,\n        model => {\n            if (lastParagraph && lastSegmentIndex >= 0) {\n                const marker = createSelectionMarker(\n                    lastParagraph.segments[lastSegmentIndex]?.format\n                );\n\n                lastParagraph.segments.splice(lastSegmentIndex + 1, 0, marker);\n                setSelection(model, marker, marker);\n            }\n        }\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Set font name\n * @param editor The editor to operate on\n * @param fontName The font name to set\n */\nexport function setFontName(editor: IEditor, fontName: string) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'setFontName',\n        (format, _, segment) => {\n            format.fontFamily = fontName;\n\n            if (segment?.code) {\n                segment.code.format.fontFamily = fontName;\n            }\n        },\n        undefined /* segmentHasStyleCallback*/,\n        true /*includingFormatHandler*/\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type {\n    ContentModelParagraph,\n    ContentModelSegmentFormat,\n    IEditor,\n} from 'roosterjs-content-model-types';\n\n/**\n * Set font size\n * @param editor The editor to operate on\n * @param fontSize The font size to set\n */\nexport function setFontSize(editor: IEditor, fontSize: string) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'setFontSize',\n        (format, _, __, paragraph) => setFontSizeInternal(fontSize, format, paragraph),\n        undefined /* segmentHasStyleCallback*/,\n        true /*includingFormatHandler*/\n    );\n}\n\n/**\n * @internal\n * Internal set font function shared by setFontSize and changeFontSize\n */\nexport function setFontSizeInternal(\n    fontSize: string,\n    format: ContentModelSegmentFormat,\n    paragraph: ContentModelParagraph | null\n) {\n    format.fontSize = fontSize;\n\n    // Since we have set font size to segment, it can be smaller than the one in paragraph format, so delete font size from paragraph\n    if (paragraph?.segmentFormat?.fontSize) {\n        const size = paragraph.segmentFormat.fontSize;\n\n        paragraph.segments.forEach(segment => {\n            if (!segment.format.fontSize) {\n                segment.format.fontSize = size;\n            }\n        });\n\n        delete paragraph.segmentFormat.fontSize;\n    }\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Set text color\n * @param editor The editor to operate on\n * @param textColor The text color to set. Pass null to remove existing color.\n */\nexport function setTextColor(editor: IEditor, textColor: string | null) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'setTextColor',\n        textColor === null\n            ? (format, _, segment) => {\n                  delete format.textColor;\n\n                  if (segment?.link) {\n                      delete segment.link.format.textColor;\n                  }\n              }\n            : (format, _, segment) => {\n                  format.textColor = textColor;\n\n                  if (segment?.link) {\n                      segment.link.format.textColor = textColor;\n                  }\n              },\n        undefined /* segmentHasStyleCallback*/,\n        true /*includingFormatHandler*/\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport { isBold } from 'roosterjs-content-model-core';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Toggle bold style\n * @param editor The editor to operate on\n */\nexport function toggleBold(editor: IEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleBold',\n        (format, isTurningOn) => {\n            format.fontWeight = isTurningOn ? 'bold' : 'normal';\n        },\n        (format, _, paragraph) =>\n            isBold(\n                typeof format.fontWeight == 'undefined'\n                    ? paragraph?.decorator?.format.fontWeight\n                    : format.fontWeight\n            )\n    );\n}\n","import { addCode } from 'roosterjs-content-model-dom';\nimport { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { ContentModelCode, IEditor } from 'roosterjs-content-model-types';\n\nconst DefaultCode: ContentModelCode = {\n    format: {\n        fontFamily: 'monospace',\n    },\n};\n\n/**\n * Toggle italic style\n * @param editor The editor to operate on\n */\nexport function toggleCode(editor: IEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleCode',\n        (_, isTurningOn, segment) => {\n            if (segment) {\n                if (isTurningOn) {\n                    addCode(segment, DefaultCode);\n                } else {\n                    delete segment.code;\n                }\n            }\n        },\n        (_, segment) => !!segment?.code\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Toggle italic style\n * @param editor The editor to operate on\n */\nexport function toggleItalic(editor: IEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleItalic',\n        (format, isTurningOn) => {\n            format.italic = !!isTurningOn;\n        },\n        format => !!format.italic\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Toggle strikethrough style\n * @param editor The editor to operate on\n */\nexport function toggleStrikethrough(editor: IEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleStrikethrough',\n        (format, isTurningOn) => {\n            format.strikethrough = !!isTurningOn;\n        },\n        format => !!format.strikethrough\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Toggle subscript style\n * @param editor The editor to operate on\n */\nexport function toggleSubscript(editor: IEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleSubscript',\n        (format, isTurningOn) => {\n            format.superOrSubScriptSequence = isTurningOn ? 'sub' : '';\n        },\n        format => format.superOrSubScriptSequence?.split(' ').pop() == 'sub'\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Toggle superscript style\n * @param editor The editor to operate on\n */\nexport function toggleSuperscript(editor: IEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleSuperscript',\n        (format, isTurningOn) => {\n            format.superOrSubScriptSequence = isTurningOn ? 'super' : '';\n        },\n        format => format.superOrSubScriptSequence?.split(' ').pop() == 'super'\n    );\n}\n","import { adjustTrailingSpaceSelection } from '../../modelApi/selection/adjustTrailingSpaceSelection';\nimport { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Toggle underline style\n * @param editor The editor to operate on\n */\nexport function toggleUnderline(editor: IEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleUnderline',\n        (format, isTurningOn, segment) => {\n            format.underline = !!isTurningOn;\n\n            if (segment?.link) {\n                segment.link.format.underline = !!isTurningOn;\n            }\n        },\n        (format, segment) => !!format.underline || !!segment?.link?.format?.underline,\n        false /*includingFormatHolder*/,\n        adjustTrailingSpaceSelection\n    );\n}\n","import { parseValueWithUnit } from 'roosterjs-content-model-dom';\nimport {\n    extractBorderValues,\n    getFirstSelectedTable,\n    getSelectedCells,\n    updateTableCellMetadata,\n} from 'roosterjs-content-model-core';\nimport type {\n    IEditor,\n    Border,\n    ContentModelTable,\n    ContentModelTableCell,\n    BorderOperations,\n    TableSelectionCoordinates,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Border positions\n */\ntype BorderPositions = 'borderTop' | 'borderBottom' | 'borderLeft' | 'borderRight';\n\n/**\n * @internal\n * Perimeter of the table selection\n * Used to determine where to apply border to the cells adjacent to the selection.\n */\ntype Perimeter = {\n    Top: boolean;\n    Bottom: boolean;\n    Left: boolean;\n    Right: boolean;\n};\n\n/**\n * Operations to apply border\n * @param editor The editor instance\n * @param border The border to apply\n * @param operation The operation to apply\n */\nexport function applyTableBorderFormat(\n    editor: IEditor,\n    border: Border,\n    operation: BorderOperations\n) {\n    editor.formatContentModel(\n        model => {\n            const [tableModel] = getFirstSelectedTable(model);\n\n            if (tableModel) {\n                const sel = getSelectedCells(tableModel);\n                const perimeter: Perimeter = {\n                    Top: false,\n                    Bottom: false,\n                    Left: false,\n                    Right: false,\n                };\n\n                // Create border format with table format as backup\n                let borderFormat = '';\n                const format = tableModel.format;\n                const { width, style, color } = border;\n                const extractedBorder = extractBorderValues(format.borderTop);\n                const borderColor = extractedBorder.color;\n                const borderWidth = extractedBorder.width;\n                const borderStyle = extractedBorder.style;\n\n                if (width) {\n                    borderFormat = parseValueWithUnit(width) + 'px';\n                } else if (borderWidth) {\n                    borderFormat = borderWidth;\n                } else {\n                    borderFormat = '1px';\n                }\n\n                if (style) {\n                    borderFormat = `${borderFormat} ${style}`;\n                } else if (borderStyle) {\n                    borderFormat = `${borderFormat} ${borderStyle}`;\n                } else {\n                    borderFormat = `${borderFormat} solid`;\n                }\n\n                if (color) {\n                    borderFormat = `${borderFormat} ${color}`;\n                } else if (borderColor) {\n                    borderFormat = `${borderFormat} ${borderColor}`;\n                }\n\n                // undefined is treated as Left to Right\n                const isRtl = tableModel.format.direction == 'rtl';\n\n                if (sel) {\n                    const operations: BorderOperations[] = [operation];\n                    while (operations.length) {\n                        switch (operations.pop()) {\n                            case 'noBorders':\n                                // Do All borders but with empty border format\n                                borderFormat = '';\n                                operations.push('allBorders');\n                                break;\n                            case 'allBorders':\n                                const allBorders: BorderPositions[] = [\n                                    'borderTop',\n                                    'borderBottom',\n                                    'borderLeft',\n                                    'borderRight',\n                                ];\n                                for (\n                                    let rowIndex = sel.firstRow;\n                                    rowIndex <= sel.lastRow;\n                                    rowIndex++\n                                ) {\n                                    for (\n                                        let colIndex = sel.firstColumn;\n                                        colIndex <= sel.lastColumn;\n                                        colIndex++\n                                    ) {\n                                        const cell = tableModel.rows[rowIndex].cells[colIndex];\n                                        // Format cells - All borders\n                                        applyBorderFormat(cell, borderFormat, allBorders);\n                                    }\n                                }\n\n                                // Format perimeter\n                                perimeter.Top = true;\n                                perimeter.Bottom = true;\n                                perimeter.Left = true;\n                                perimeter.Right = true;\n                                break;\n                            case 'leftBorders':\n                                const leftBorder: BorderPositions[] = ['borderLeft'];\n                                for (\n                                    let rowIndex = sel.firstRow;\n                                    rowIndex <= sel.lastRow;\n                                    rowIndex++\n                                ) {\n                                    const cell =\n                                        tableModel.rows[rowIndex].cells[\n                                            isRtl ? sel.lastColumn : sel.firstColumn\n                                        ];\n                                    // Format cells - Left border\n                                    applyBorderFormat(cell, borderFormat, leftBorder);\n                                }\n\n                                // Format perimeter\n                                isRtl ? (perimeter.Right = true) : (perimeter.Left = true);\n                                break;\n                            case 'rightBorders':\n                                const rightBorder: BorderPositions[] = ['borderRight'];\n                                for (\n                                    let rowIndex = sel.firstRow;\n                                    rowIndex <= sel.lastRow;\n                                    rowIndex++\n                                ) {\n                                    const cell =\n                                        tableModel.rows[rowIndex].cells[\n                                            isRtl ? sel.firstColumn : sel.lastColumn\n                                        ];\n                                    // Format cells - Right border\n                                    applyBorderFormat(cell, borderFormat, rightBorder);\n                                }\n\n                                // Format perimeter\n                                isRtl ? (perimeter.Left = true) : (perimeter.Right = true);\n                                break;\n                            case 'topBorders':\n                                const topBorder: BorderPositions[] = ['borderTop'];\n                                for (\n                                    let colIndex = sel.firstColumn;\n                                    colIndex <= sel.lastColumn;\n                                    colIndex++\n                                ) {\n                                    const cell = tableModel.rows[sel.firstRow].cells[colIndex];\n                                    // Format cells - Top border\n                                    applyBorderFormat(cell, borderFormat, topBorder);\n                                }\n\n                                // Format perimeter\n                                perimeter.Top = true;\n                                break;\n                            case 'bottomBorders':\n                                const bottomBorder: BorderPositions[] = ['borderBottom'];\n                                for (\n                                    let colIndex = sel.firstColumn;\n                                    colIndex <= sel.lastColumn;\n                                    colIndex++\n                                ) {\n                                    const cell = tableModel.rows[sel.lastRow].cells[colIndex];\n                                    // Format cells - Bottom border\n                                    applyBorderFormat(cell, borderFormat, bottomBorder);\n                                }\n\n                                // Format perimeter\n                                perimeter.Bottom = true;\n                                break;\n                            case 'insideBorders':\n                                // Format cells - Inside borders\n                                const singleCol = sel.lastColumn == sel.firstColumn;\n                                const singleRow = sel.lastRow == sel.firstRow;\n                                // Single cell selection\n                                if (singleCol && singleRow) {\n                                    break;\n                                }\n                                // Single column selection\n                                if (singleCol) {\n                                    applyBorderFormat(\n                                        tableModel.rows[sel.firstRow].cells[sel.firstColumn],\n                                        borderFormat,\n                                        ['borderBottom']\n                                    );\n                                    for (\n                                        let rowIndex = sel.firstRow + 1;\n                                        rowIndex <= sel.lastRow - 1;\n                                        rowIndex++\n                                    ) {\n                                        const cell =\n                                            tableModel.rows[rowIndex].cells[sel.firstColumn];\n                                        applyBorderFormat(cell, borderFormat, [\n                                            'borderTop',\n                                            'borderBottom',\n                                        ]);\n                                    }\n                                    applyBorderFormat(\n                                        tableModel.rows[sel.lastRow].cells[sel.firstColumn],\n                                        borderFormat,\n                                        ['borderTop']\n                                    );\n                                    break;\n                                }\n                                // Single row selection\n                                if (singleRow) {\n                                    applyBorderFormat(\n                                        tableModel.rows[sel.firstRow].cells[\n                                            isRtl ? sel.lastColumn : sel.firstColumn\n                                        ],\n                                        borderFormat,\n                                        ['borderRight']\n                                    );\n                                    for (\n                                        let colIndex = sel.firstColumn + 1;\n                                        colIndex <= sel.lastColumn - 1;\n                                        colIndex++\n                                    ) {\n                                        const cell = tableModel.rows[sel.firstRow].cells[colIndex];\n                                        applyBorderFormat(cell, borderFormat, [\n                                            'borderLeft',\n                                            'borderRight',\n                                        ]);\n                                    }\n                                    applyBorderFormat(\n                                        tableModel.rows[sel.firstRow].cells[\n                                            isRtl ? sel.firstColumn : sel.lastColumn\n                                        ],\n                                        borderFormat,\n                                        ['borderLeft']\n                                    );\n                                    break;\n                                }\n\n                                // For multiple rows and columns selections\n                                // Top left cell\n                                applyBorderFormat(\n                                    tableModel.rows[sel.firstRow].cells[\n                                        isRtl ? sel.lastColumn : sel.firstColumn\n                                    ],\n                                    borderFormat,\n                                    ['borderBottom', 'borderRight']\n                                );\n                                // Top right cell\n                                applyBorderFormat(\n                                    tableModel.rows[sel.firstRow].cells[\n                                        isRtl ? sel.firstColumn : sel.lastColumn\n                                    ],\n                                    borderFormat,\n                                    ['borderBottom', 'borderLeft']\n                                );\n                                // Bottom left cell\n                                applyBorderFormat(\n                                    tableModel.rows[sel.lastRow].cells[\n                                        isRtl ? sel.lastColumn : sel.firstColumn\n                                    ],\n                                    borderFormat,\n                                    ['borderTop', 'borderRight']\n                                );\n                                // Bottom right cell\n                                applyBorderFormat(\n                                    tableModel.rows[sel.lastRow].cells[\n                                        isRtl ? sel.firstColumn : sel.lastColumn\n                                    ],\n                                    borderFormat,\n                                    ['borderTop', 'borderLeft']\n                                );\n                                // First row\n                                for (\n                                    let colIndex = sel.firstColumn + 1;\n                                    colIndex < sel.lastColumn;\n                                    colIndex++\n                                ) {\n                                    const cell = tableModel.rows[sel.firstRow].cells[colIndex];\n                                    applyBorderFormat(cell, borderFormat, [\n                                        'borderBottom',\n                                        'borderLeft',\n                                        'borderRight',\n                                    ]);\n                                }\n                                // Last row\n                                for (\n                                    let colIndex = sel.firstColumn + 1;\n                                    colIndex < sel.lastColumn;\n                                    colIndex++\n                                ) {\n                                    const cell = tableModel.rows[sel.lastRow].cells[colIndex];\n                                    applyBorderFormat(cell, borderFormat, [\n                                        'borderTop',\n                                        'borderLeft',\n                                        'borderRight',\n                                    ]);\n                                }\n                                // First column\n                                for (\n                                    let rowIndex = sel.firstRow + 1;\n                                    rowIndex < sel.lastRow;\n                                    rowIndex++\n                                ) {\n                                    const cell = tableModel.rows[rowIndex].cells[sel.firstColumn];\n                                    applyBorderFormat(cell, borderFormat, [\n                                        'borderTop',\n                                        'borderBottom',\n                                        isRtl ? 'borderLeft' : 'borderRight',\n                                    ]);\n                                }\n                                // Last column\n                                for (\n                                    let rowIndex = sel.firstRow + 1;\n                                    rowIndex < sel.lastRow;\n                                    rowIndex++\n                                ) {\n                                    const cell = tableModel.rows[rowIndex].cells[sel.lastColumn];\n                                    applyBorderFormat(cell, borderFormat, [\n                                        'borderTop',\n                                        'borderBottom',\n                                        isRtl ? 'borderRight' : 'borderLeft',\n                                    ]);\n                                }\n                                // Inner cells\n                                sel.firstColumn++;\n                                sel.firstRow++;\n                                sel.lastColumn--;\n                                sel.lastRow--;\n                                operations.push('allBorders');\n                                break;\n                            case 'outsideBorders':\n                                // Format cells - Outside borders\n                                operations.push('topBorders');\n                                operations.push('bottomBorders');\n                                operations.push('leftBorders');\n                                operations.push('rightBorders');\n                                break;\n                            default:\n                                break;\n                        }\n                    }\n\n                    //Format perimeter if necessary or possible\n                    modifyPerimeter(tableModel, sel, borderFormat, perimeter, isRtl);\n                }\n\n                return true;\n            } else {\n                return false;\n            }\n        },\n        {\n            apiName: 'tableBorder',\n        }\n    );\n}\n\n/**\n * @internal\n * Apply border format to a cell\n * @param cell The cell to apply border format\n * @param borderFormat The border format to apply\n * @param positions The positions to apply\n */\nfunction applyBorderFormat(\n    cell: ContentModelTableCell,\n    borderFormat: string,\n    positions: BorderPositions[]\n) {\n    positions.forEach(pos => {\n        cell.format[pos] = borderFormat;\n    });\n\n    updateTableCellMetadata(cell, metadata => {\n        metadata = metadata || {};\n        metadata.borderOverride = true;\n        return metadata;\n    });\n\n    // Cell was modified, so delete cached element\n    delete cell.cachedElement;\n}\n\n/**\n * @internal\n * Modify the perimeter of the table selection\n * @param tableModel The table model\n * @param sel The table selection\n * @param borderFormat The border format to apply\n * If borderFormat is empty, the border will be removed\n * @param perimeter Where in the perimeter to apply\n */\nfunction modifyPerimeter(\n    tableModel: ContentModelTable,\n    sel: TableSelectionCoordinates,\n    borderFormat: string,\n    perimeter: Perimeter,\n    isRtl: boolean\n) {\n    // Top of selection\n    if (perimeter.Top && sel.firstRow - 1 >= 0) {\n        for (let colIndex = sel.firstColumn; colIndex <= sel.lastColumn; colIndex++) {\n            const cell = tableModel.rows[sel.firstRow - 1].cells[colIndex];\n            applyBorderFormat(cell, borderFormat, ['borderBottom']);\n        }\n    }\n    // Bottom of selection\n    if (perimeter.Bottom && sel.lastRow + 1 < tableModel.rows.length) {\n        for (let colIndex = sel.firstColumn; colIndex <= sel.lastColumn; colIndex++) {\n            const cell = tableModel.rows[sel.lastRow + 1].cells[colIndex];\n            applyBorderFormat(cell, borderFormat, ['borderTop']);\n        }\n    }\n    // Left of selection\n    if (perimeter.Left && sel.firstColumn - 1 >= 0) {\n        for (let rowIndex = sel.firstRow; rowIndex <= sel.lastRow; rowIndex++) {\n            const cell = tableModel.rows[rowIndex].cells[sel.firstColumn - 1];\n            applyBorderFormat(cell, borderFormat, [isRtl ? 'borderLeft' : 'borderRight']);\n        }\n    }\n    // Right of selection\n    if (perimeter.Right && sel.lastColumn + 1 < tableModel.rows[0].cells.length) {\n        for (let rowIndex = sel.firstRow; rowIndex <= sel.lastRow; rowIndex++) {\n            const cell = tableModel.rows[rowIndex].cells[sel.lastColumn + 1];\n            applyBorderFormat(cell, borderFormat, [isRtl ? 'borderRight' : 'borderLeft']);\n        }\n    }\n}\n","import { alignTable } from '../../modelApi/table/alignTable';\nimport { deleteTable } from '../../modelApi/table/deleteTable';\nimport { deleteTableColumn } from '../../modelApi/table/deleteTableColumn';\nimport { deleteTableRow } from '../../modelApi/table/deleteTableRow';\nimport { formatTableWithContentModel } from '../utils/formatTableWithContentModel';\nimport { insertTableColumn } from '../../modelApi/table/insertTableColumn';\nimport { insertTableRow } from '../../modelApi/table/insertTableRow';\nimport { mergeTableCells } from '../../modelApi/table/mergeTableCells';\nimport { mergeTableColumn } from '../../modelApi/table/mergeTableColumn';\nimport { mergeTableRow } from '../../modelApi/table/mergeTableRow';\nimport { splitTableCellHorizontally } from '../../modelApi/table/splitTableCellHorizontally';\nimport { splitTableCellVertically } from '../../modelApi/table/splitTableCellVertically';\nimport type { TableOperation, IEditor } from 'roosterjs-content-model-types';\nimport {\n    alignTableCellHorizontally,\n    alignTableCellVertically,\n} from '../../modelApi/table/alignTableCell';\n\n/**\n * Format current focused table with the given format\n * @param editor The editor instance\n * @param operation The table operation to apply\n */\nexport function editTable(editor: IEditor, operation: TableOperation) {\n    editor.focus();\n\n    formatTableWithContentModel(editor, 'editTable', tableModel => {\n        switch (operation) {\n            case 'alignCellLeft':\n            case 'alignCellCenter':\n            case 'alignCellRight':\n                alignTableCellHorizontally(tableModel, operation);\n                break;\n            case 'alignCellTop':\n            case 'alignCellMiddle':\n            case 'alignCellBottom':\n                alignTableCellVertically(tableModel, operation);\n                break;\n            case 'alignCenter':\n            case 'alignLeft':\n            case 'alignRight':\n                alignTable(tableModel, operation);\n                break;\n\n            case 'deleteColumn':\n                deleteTableColumn(tableModel);\n                break;\n\n            case 'deleteRow':\n                deleteTableRow(tableModel);\n                break;\n\n            case 'deleteTable':\n                deleteTable(tableModel);\n                break;\n\n            case 'insertAbove':\n            case 'insertBelow':\n                insertTableRow(tableModel, operation);\n                break;\n\n            case 'insertLeft':\n            case 'insertRight':\n                insertTableColumn(tableModel, operation);\n                break;\n\n            case 'mergeAbove':\n            case 'mergeBelow':\n                mergeTableRow(tableModel, operation);\n                break;\n\n            case 'mergeCells':\n                mergeTableCells(tableModel);\n                break;\n\n            case 'mergeLeft':\n            case 'mergeRight':\n                mergeTableColumn(tableModel, operation);\n                break;\n\n            case 'splitHorizontally':\n                splitTableCellHorizontally(tableModel);\n                break;\n\n            case 'splitVertically':\n                splitTableCellVertically(tableModel);\n                break;\n        }\n    });\n}\n","import {\n    applyTableFormat,\n    getFirstSelectedTable,\n    updateTableCellMetadata,\n} from 'roosterjs-content-model-core';\nimport type { IEditor, TableMetadataFormat } from 'roosterjs-content-model-types';\n\n/**\n * Format current focused table with the given format\n * @param editor The editor instance\n * @param format The table format to apply\n * @param keepCellShade Whether keep existing shade color when apply format if there is a manually set shade color\n */\nexport function formatTable(editor: IEditor, format: TableMetadataFormat, keepCellShade?: boolean) {\n    editor.focus();\n\n    editor.formatContentModel(\n        model => {\n            const [tableModel] = getFirstSelectedTable(model);\n\n            if (tableModel) {\n                // Wipe border metadata\n                tableModel.rows.forEach(row => {\n                    row.cells.forEach(cell => {\n                        updateTableCellMetadata(cell, metadata => {\n                            if (metadata) {\n                                delete metadata.borderOverride;\n                            }\n                            return metadata;\n                        });\n                    });\n                });\n                applyTableFormat(tableModel, format, keepCellShade);\n                return true;\n            } else {\n                return false;\n            }\n        },\n        {\n            apiName: 'formatTable',\n        }\n    );\n}\n","import { createContentModelDocument, createSelectionMarker } from 'roosterjs-content-model-dom';\nimport { createTableStructure } from '../../modelApi/table/createTableStructure';\nimport {\n    applyTableFormat,\n    deleteSelection,\n    mergeModel,\n    normalizeTable,\n    setSelection,\n} from 'roosterjs-content-model-core';\nimport type { IEditor, TableMetadataFormat } from 'roosterjs-content-model-types';\n\n/**\n * Insert table into editor at current selection\n * @param editor The editor instance\n * @param columns Number of columns in table, it also controls the default table cell width:\n * if columns &lt;= 4, width = 120px; if columns &lt;= 6, width = 100px; else width = 70px\n * @param rows Number of rows in table\n * @param format (Optional) The table format. If not passed, the default format will be applied:\n * background color: #FFF; border color: #ABABAB\n */\nexport function insertTable(\n    editor: IEditor,\n    columns: number,\n    rows: number,\n    format?: Partial<TableMetadataFormat>\n) {\n    editor.focus();\n\n    editor.formatContentModel(\n        (model, context) => {\n            const insertPosition = deleteSelection(model, [], context).insertPoint;\n\n            if (insertPosition) {\n                const doc = createContentModelDocument();\n                const table = createTableStructure(doc, columns, rows);\n\n                normalizeTable(table, editor.getPendingFormat() || insertPosition.marker.format);\n                // Assign default vertical align\n                format = format || { verticalAlign: 'top' };\n                applyTableFormat(table, format);\n                mergeModel(model, doc, context, {\n                    insertPosition,\n                    mergeFormat: 'mergeAll',\n                });\n\n                const firstBlock = table.rows[0]?.cells[0]?.blocks[0];\n\n                if (firstBlock?.blockType == 'Paragraph') {\n                    const marker = createSelectionMarker(firstBlock.segments[0]?.format);\n                    firstBlock.segments.unshift(marker);\n                    setSelection(model, marker);\n                }\n\n                return true;\n            } else {\n                return false;\n            }\n        },\n        {\n            apiName: 'insertTable',\n        }\n    );\n}\n","import {\n    hasSelectionInBlockGroup,\n    getFirstSelectedTable,\n    normalizeTable,\n    setTableCellBackgroundColor,\n} from 'roosterjs-content-model-core';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Set table cell shade color\n * @param editor The editor instance\n * @param color The color to set. Pass null to remove existing shade color\n */\nexport function setTableCellShade(editor: IEditor, color: string | null) {\n    editor.focus();\n\n    editor.formatContentModel(\n        model => {\n            const [table] = getFirstSelectedTable(model);\n\n            if (table) {\n                normalizeTable(table);\n\n                table.rows.forEach(row =>\n                    row.cells.forEach(cell => {\n                        if (hasSelectionInBlockGroup(cell)) {\n                            setTableCellBackgroundColor(cell, color, true /*isColorOverride*/);\n                        }\n                    })\n                );\n\n                return true;\n            } else {\n                return false;\n            }\n        },\n        {\n            apiName: 'setTableCellShade',\n        }\n    );\n}\n","import { formatSegmentWithContentModel } from './formatSegmentWithContentModel';\nimport type { ContentModelImage, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Invoke a callback to format the selected image using Content Model\n * @param editor The editor object\n * @param apiName Name of API this calling this function. This is mostly for logging.\n * @param callback The callback to format the image. It will be called with current selected table. If no table is selected, it will not be called.\n */\nexport function formatImageWithContentModel(\n    editor: IEditor,\n    apiName: string,\n    callback: (segment: ContentModelImage) => void\n) {\n    formatSegmentWithContentModel(\n        editor,\n        apiName,\n        (_, __, segment) => {\n            if (segment?.segmentType == 'Image') {\n                callback(segment);\n            }\n        },\n        undefined /** segmentHasStyleCallback **/,\n        undefined /** includingFormatHolder */\n    );\n}\n","import { getSelectedParagraphs } from 'roosterjs-content-model-core';\nimport type { ContentModelParagraph, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Invoke a callback to format the selected paragraph using Content Model\n * @param editor The editor object\n * @param apiName Name of API this calling this function. This is mostly for logging.\n * @param setStyleCallback The callback to format the paragraph. It will be called with current selected table. If no table is selected, it will not be called.\n */\nexport function formatParagraphWithContentModel(\n    editor: IEditor,\n    apiName: string,\n    setStyleCallback: (paragraph: ContentModelParagraph) => void\n) {\n    editor.formatContentModel(\n        (model, context) => {\n            const paragraphs = getSelectedParagraphs(model);\n\n            paragraphs.forEach(setStyleCallback);\n            context.newPendingFormat = 'preserve';\n\n            return paragraphs.length > 0;\n        },\n        {\n            apiName,\n        }\n    );\n}\n","import { adjustWordSelection } from '../../modelApi/selection/adjustWordSelection';\nimport { getSelectedSegmentsAndParagraphs } from 'roosterjs-content-model-core';\nimport type {\n    ContentModelDocument,\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelSegmentFormat,\n    IEditor,\n} from 'roosterjs-content-model-types';\n\n/**\n * Invoke a callback to format the selected segment using Content Model\n * @param editor The editor object\n * @param apiName Name of API this calling this function. This is mostly for logging.\n * @param toggleStyleCallback The callback to format the segment. It will be called with current selected table. If no table is selected, it will not be called.\n * @param segmentHasStyleCallback The callback used for checking if the given segment already has required format\n * @param includingFormatHolder True to also include format holder of list item when search selected segments\n * @param afterFormatCallback A callback to invoke after format is applied to all selected segments and before the change is applied to DOM tree\n */\nexport function formatSegmentWithContentModel(\n    editor: IEditor,\n    apiName: string,\n    toggleStyleCallback: (\n        format: ContentModelSegmentFormat,\n        isTuringOn: boolean,\n        segment: ContentModelSegment | null,\n        paragraph: ContentModelParagraph | null\n    ) => void,\n    segmentHasStyleCallback?: (\n        format: ContentModelSegmentFormat,\n        segment: ContentModelSegment | null,\n        paragraph: ContentModelParagraph | null\n    ) => boolean,\n    includingFormatHolder?: boolean,\n    afterFormatCallback?: (model: ContentModelDocument) => void\n) {\n    editor.formatContentModel(\n        (model, context) => {\n            let segmentAndParagraphs = getSelectedSegmentsAndParagraphs(\n                model,\n                !!includingFormatHolder\n            );\n            let isCollapsedSelection =\n                segmentAndParagraphs.length == 1 &&\n                segmentAndParagraphs[0][0].segmentType == 'SelectionMarker';\n\n            if (isCollapsedSelection) {\n                const para = segmentAndParagraphs[0][1];\n\n                segmentAndParagraphs = adjustWordSelection(\n                    model,\n                    segmentAndParagraphs[0][0]\n                ).map(x => [x, para]);\n\n                if (segmentAndParagraphs.length > 1) {\n                    isCollapsedSelection = false;\n                }\n            }\n\n            const formatsAndSegments: [\n                ContentModelSegmentFormat,\n                ContentModelSegment | null,\n                ContentModelParagraph | null\n            ][] = segmentAndParagraphs.map(item => [item[0].format, item[0], item[1]]);\n\n            const isTurningOff = segmentHasStyleCallback\n                ? formatsAndSegments.every(([format, segment, paragraph]) =>\n                      segmentHasStyleCallback(format, segment, paragraph)\n                  )\n                : false;\n\n            formatsAndSegments.forEach(([format, segment, paragraph]) =>\n                toggleStyleCallback(format, !isTurningOff, segment, paragraph)\n            );\n\n            afterFormatCallback?.(model);\n\n            if (isCollapsedSelection) {\n                context.newPendingFormat = segmentAndParagraphs[0][0].format;\n                editor.focus();\n                return false;\n            } else {\n                return formatsAndSegments.length > 0;\n            }\n        },\n        {\n            apiName,\n        }\n    );\n}\n","import { ensureFocusableParagraphForTable } from '../../modelApi/table/ensureFocusableParagraphForTable';\nimport {\n    createSelectionMarker,\n    hasMetadata,\n    setParagraphNotImplicit,\n} from 'roosterjs-content-model-dom';\nimport {\n    hasSelectionInBlock,\n    applyTableFormat,\n    getFirstSelectedTable,\n    normalizeTable,\n    setSelection,\n} from 'roosterjs-content-model-core';\nimport type { ContentModelTable, IEditor, TableSelection } from 'roosterjs-content-model-types';\n\n/**\n * Invoke a callback to format the selected table using Content Model\n * @param editor The editor object\n * @param apiName Name of API this calling this function. This is mostly for logging.\n * @param callback The callback to format the table. It will be called with current selected table. If no table is selected, it will not be called.\n * @param selectionOverride Override the current selection. If we want to format a table even currently it is not selected, we can use this parameter to override current selection\n */\nexport function formatTableWithContentModel(\n    editor: IEditor,\n    apiName: string,\n    callback: (tableModel: ContentModelTable) => void,\n    selectionOverride?: TableSelection\n) {\n    editor.formatContentModel(\n        model => {\n            const [tableModel, path] = getFirstSelectedTable(model);\n\n            if (tableModel) {\n                callback(tableModel);\n\n                if (!hasSelectionInBlock(tableModel)) {\n                    const paragraph = ensureFocusableParagraphForTable(model, path, tableModel);\n\n                    if (paragraph) {\n                        const marker = createSelectionMarker(model.format);\n\n                        paragraph.segments.unshift(marker);\n                        setParagraphNotImplicit(paragraph);\n                        setSelection(model, marker);\n                    }\n                }\n\n                normalizeTable(tableModel, model.format);\n\n                if (hasMetadata(tableModel)) {\n                    applyTableFormat(tableModel, undefined /*newFormat*/, true /*keepCellShade*/);\n                }\n\n                return true;\n            } else {\n                return false;\n            }\n        },\n        {\n            apiName,\n            selectionOverride,\n        }\n    );\n}\n","/**\n *  Enum used to control the different types of bullet list\n */\nexport const BulletListType = {\n    /**\n     * Minimum value of the enum\n     */\n    Min: 1,\n    /**\n     * Bullet triggered by *\n     */\n    Disc: 1,\n    /**\n     * Bullet triggered by -\n     */\n    Dash: 2,\n    /**\n     * Bullet triggered by --\n     */\n    Square: 3,\n    /**\n     * Bullet triggered by >\n     */\n    ShortArrow: 4,\n    /**\n     * Bullet triggered by ->\n     */\n    LongArrow: 5,\n    /**\n     * Bullet triggered by =>\n     */\n    UnfilledArrow: 6,\n    /**\n     * Bullet triggered by \n     */\n    Hyphen: 7,\n    /**\n     * Bullet triggered by -->\n     */\n    DoubleLongArrow: 8,\n    /**\n     * Bullet type circle\n     */\n    Circle: 9,\n    /**\n     * Maximum value of the enum\n     */\n    Max: 9,\n};\n","/**\n * Possible change sources. Here are the predefined sources.\n * It can also be other string if the change source can't fall into these sources.\n */\nexport const ChangeSource = {\n    /**\n     * Content changed by auto link\n     */\n    AutoLink: 'AutoLink',\n    /**\n     * Content changed by create link\n     */\n    CreateLink: 'CreateLink',\n    /**\n     * Content changed by format\n     */\n    Format: 'Format',\n    /**\n     * Content changed by image resize\n     */\n    ImageResize: 'ImageResize',\n    /**\n     * Content changed by paste\n     */\n    Paste: 'Paste',\n    /**\n     * Content changed by setContent API\n     */\n    SetContent: 'SetContent',\n    /**\n     * Content changed by cut operation\n     */\n    Cut: 'Cut',\n    /**\n     * Content changed by drag & drop operation\n     */\n    Drop: 'Drop',\n    /**\n     * Insert a new entity into editor\n     */\n    InsertEntity: 'InsertEntity',\n    /**\n     * Editor is switched to dark mode, content color is changed\n     */\n    SwitchToDarkMode: 'SwitchToDarkMode',\n    /**\n     * Editor is switched to light mode, content color is changed\n     */\n    SwitchToLightMode: 'SwitchToLightMode',\n    /**\n     * List chain reorganized numbers of lists\n     */\n    ListChain: 'ListChain',\n    /**\n     * Keyboard event, used by Content Model.\n     * Data of this event will be the key code number\n     */\n    Keyboard: 'Keyboard',\n};\n","/**\n *  Enum used to control the different types of numbering list\n */\nexport const NumberingListType = {\n    /**\n     * Minimum value of the enum\n     */\n    Min: 1,\n    /**\n     * Numbering triggered by 1.\n     */\n    Decimal: 1,\n    /**\n     * Numbering triggered by 1-\n     */\n    DecimalDash: 2,\n    /**\n     * Numbering triggered by 1)\n     */\n    DecimalParenthesis: 3,\n    /**\n     * Numbering triggered by (1)\n     */\n    DecimalDoubleParenthesis: 4,\n    /**\n     * Numbering triggered by a.\n     */\n    LowerAlpha: 5,\n    /**\n     * Numbering triggered by a)\n     */\n    LowerAlphaParenthesis: 6,\n    /**\n     * Numbering triggered by (a)\n     */\n    LowerAlphaDoubleParenthesis: 7,\n    /**\n     * Numbering triggered by a-\n     */\n    LowerAlphaDash: 8,\n    /**\n     * Numbering triggered by A.\n     */\n    UpperAlpha: 9,\n    /**\n     * Numbering triggered by A)\n     */\n    UpperAlphaParenthesis: 10,\n    /**\n     * Numbering triggered by (A)\n     */\n    UpperAlphaDoubleParenthesis: 11,\n    /**\n     * Numbering triggered by A-\n     */\n    UpperAlphaDash: 12,\n    /**\n     * Numbering triggered by i.\n     */\n    LowerRoman: 13,\n    /**\n     * Numbering triggered by i)\n     */\n    LowerRomanParenthesis: 14,\n    /**\n     * Numbering triggered by (i)\n     */\n    LowerRomanDoubleParenthesis: 15,\n    /**\n     * Numbering triggered by i-\n     */\n    LowerRomanDash: 16,\n    /**\n     * Numbering triggered by I.\n     */\n    UpperRoman: 17,\n    /**\n     * Numbering triggered by I)\n     */\n    UpperRomanParenthesis: 18,\n    /**\n     * Numbering triggered by (I)\n     */\n    UpperRomanDoubleParenthesis: 19,\n    /**\n     * Numbering triggered by I-\n     */\n    UpperRomanDash: 20,\n    /**\n     * Maximum value of the enum\n     */\n    Max: 20,\n};\n","/**\n * Table format border\n */\nexport const TableBorderFormat = {\n    /**\n     * Minimum value\n     */\n    Min: 0,\n\n    /**\n     * All border of the table are displayed\n     *  __ __ __\n     * |__|__|__|\n     * |__|__|__|\n     * |__|__|__|\n     */\n    Default: 0,\n\n    /**\n     * Middle vertical border are not displayed\n     *  __ __ __\n     * |__ __ __|\n     * |__ __ __|\n     * |__ __ __|\n     */\n    ListWithSideBorders: 1,\n\n    /**\n     * All borders except header rows borders are displayed\n     *  __ __ __\n     *  __|__|__\n     *  __|__|__\n     */\n    NoHeaderBorders: 2,\n\n    /**\n     * The left and right border of the table are not displayed\n     *  __ __ __\n     *  __|__|__\n     *  __|__|__\n     *  __|__|__\n     */\n    NoSideBorders: 3,\n\n    /**\n     * Only the borders that divides the header row, first column and externals are displayed\n     *  __ __ __\n     * |__ __ __|\n     * |  |     |\n     * |__|__ __|\n     */\n    FirstColumnHeaderExternal: 4,\n\n    /**\n     * The header row has no vertical border, except for the first one\n     * The first column has no horizontal border, except for the first one\n     *  __ __ __\n     * |__ __ __\n     * |  |__|__|\n     * |  |__|__|\n     */\n    EspecialType1: 5,\n\n    /**\n     * The header row has no vertical border, except for the first one\n     * The only horizontal border of the table is the top and bottom of header row\n     *  __ __ __\n     * |__ __ __\n     * |  |     |\n     * |  |     |\n     */\n    EspecialType2: 6,\n\n    /**\n     * The only borders are the bottom of header row and the right border of first column\n     *  __ __ __\n     *    |\n     *    |\n     */\n    EspecialType3: 7,\n\n    /**\n     * No border\n     */\n    Clear: 8,\n\n    /**\n     * Maximum value\n     */\n    Max: 8,\n};\n","import { createSnapshotSelection } from '../utils/createSnapshotSelection';\nimport type { AddUndoSnapshot, Snapshot } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Add an undo snapshot to current undo snapshot stack\n * @param core The EditorCore object\n * @param canUndoByBackspace True if this action can be undone when user press Backspace key (aka Auto Complete).\n * @param entityStates @optional Entity states related to this snapshot.\n * Each entity state will cause an EntityOperation event with operation = EntityOperation.UpdateEntityState\n * when undo/redo to this snapshot\n */\nexport const addUndoSnapshot: AddUndoSnapshot = (core, canUndoByBackspace, entityStates) => {\n    const { lifecycle, physicalRoot, undo } = core;\n    let snapshot: Snapshot | null = null;\n\n    if (!lifecycle.shadowEditFragment) {\n        // Need to create snapshot selection before retrieve innerHTML since HTML can be changed during creating selection when normalize table\n        const selection = createSnapshotSelection(core);\n        const html = physicalRoot.innerHTML;\n\n        snapshot = {\n            html,\n            entityStates,\n            isDarkMode: !!lifecycle.isDarkMode,\n            selection,\n        };\n\n        undo.snapshotsManager.addSnapshot(snapshot, !!canUndoByBackspace);\n        undo.snapshotsManager.hasNewContent = false;\n    }\n\n    return snapshot;\n};\n","import { getObjectKeys } from 'roosterjs-content-model-dom';\nimport type { AttachDomEvent, PluginEvent } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Attach a DOM event to the editor content DIV\n * @param core The EditorCore object\n * @param eventName The DOM event name\n * @param pluginEventType Optional event type. When specified, editor will trigger a plugin event with this name when the DOM event is triggered\n * @param beforeDispatch Optional callback function to be invoked when the DOM event is triggered before trigger plugin event\n */\nexport const attachDomEvent: AttachDomEvent = (core, eventMap) => {\n    const disposers = getObjectKeys(eventMap || {}).map(key => {\n        const { pluginEventType, beforeDispatch } = eventMap[key];\n        const eventName = key as keyof HTMLElementEventMap;\n        const onEvent = (event: HTMLElementEventMap[typeof eventName]) => {\n            if (beforeDispatch) {\n                beforeDispatch(event);\n            }\n\n            if (pluginEventType != null) {\n                core.api.triggerEvent(\n                    core,\n                    <PluginEvent>{\n                        eventType: pluginEventType,\n                        rawEvent: event,\n                    },\n                    false /*broadcast*/\n                );\n            }\n        };\n\n        core.logicalRoot.addEventListener(eventName, onEvent);\n\n        return () => {\n            core.logicalRoot.removeEventListener(eventName, onEvent);\n        };\n    });\n\n    return () => disposers.forEach(disposers => disposers());\n};\n","import { cloneModel } from '../publicApi/model/cloneModel';\nimport {\n    createDomToModelContext,\n    createDomToModelContextWithConfig,\n    domToContentModel,\n} from 'roosterjs-content-model-dom';\nimport type { CreateContentModel } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Create Content Model from DOM tree in this editor\n * @param core The editor core object\n * @param option The option to customize the behavior of DOM to Content Model conversion\n * @param selectionOverride When passed, use this selection range instead of current selection in editor\n */\nexport const createContentModel: CreateContentModel = (core, option, selectionOverride) => {\n    // Flush all mutations if any, so that we can get an up-to-date Content Model\n    core.cache.textMutationObserver?.flushMutations();\n\n    let cachedModel = selectionOverride ? null : core.cache.cachedModel;\n\n    if (cachedModel && core.lifecycle.shadowEditFragment) {\n        // When in shadow edit, use a cloned model so we won't pollute the cached one\n        cachedModel = cloneModel(cachedModel, { includeCachedElement: true });\n    }\n\n    if (cachedModel) {\n        return cachedModel;\n    } else {\n        const selection =\n            selectionOverride == 'none'\n                ? undefined\n                : selectionOverride || core.api.getDOMSelection(core) || undefined;\n        const saveIndex = !option && !selectionOverride;\n        const editorContext = core.api.createEditorContext(core, saveIndex);\n        const settings = core.environment.domToModelSettings;\n        const domToModelContext = option\n            ? createDomToModelContext(editorContext, settings.builtIn, settings.customized, option)\n            : createDomToModelContextWithConfig(settings.calculated, editorContext);\n\n        const model = domToContentModel(core.logicalRoot, domToModelContext, selection);\n\n        if (saveIndex) {\n            core.cache.cachedModel = model;\n            core.cache.cachedSelection = selection;\n        }\n\n        return model;\n    }\n};\n","import { getRootComputedStyleForContext } from '../utils/getRootComputedStyleForContext';\nimport type { EditorContext, CreateEditorContext } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Create a EditorContext object used by ContentModel API\n */\nexport const createEditorContext: CreateEditorContext = (core, saveIndex) => {\n    const { lifecycle, format, darkColorHandler, logicalRoot, cache, domHelper } = core;\n\n    const context: EditorContext = {\n        isDarkMode: lifecycle.isDarkMode,\n        defaultFormat: format.defaultFormat,\n        pendingFormat: format.pendingFormat ?? undefined,\n        darkColorHandler: darkColorHandler,\n        addDelimiterForEntity: true,\n        allowCacheElement: true,\n        domIndexer: saveIndex ? cache.domIndexer : undefined,\n        zoomScale: domHelper.calculateZoomScale(),\n        ...getRootComputedStyleForContext(logicalRoot.ownerDocument),\n    };\n\n    checkRootRtl(logicalRoot, context);\n\n    return context;\n};\n\nfunction checkRootRtl(element: HTMLElement, context: EditorContext) {\n    const style = element?.ownerDocument.defaultView?.getComputedStyle(element);\n\n    if (style?.direction == 'rtl') {\n        context.isRootRtl = true;\n    }\n}\n","import type { Focus } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Focus to editor. If there is a cached selection range, use it as current selection\n * @param core The EditorCore object\n */\nexport const focus: Focus = core => {\n    if (!core.lifecycle.shadowEditFragment) {\n        const { api, domHelper, selection } = core;\n\n        if (!domHelper.hasFocus() && selection.selection?.type == 'range') {\n            api.setDOMSelection(core, selection.selection, true /*skipSelectionChangedEvent*/);\n        }\n\n        // fallback, in case editor still have no focus\n        if (!domHelper.hasFocus()) {\n            core.logicalRoot.focus();\n        }\n    }\n};\n","import { ChangeSource } from '../constants/ChangeSource';\nimport type {\n    ChangedEntity,\n    ContentChangedEvent,\n    DOMSelection,\n    FormatContentModel,\n    FormatContentModelContext,\n    EditorCore,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * The general API to do format change with Content Model\n * It will grab a Content Model for current editor content, and invoke a callback function\n * to do format change. Then according to the return value, write back the modified content model into editor.\n * If there is cached model, it will be used and updated.\n * @param core The EditorCore object\n * @param formatter Formatter function, see ContentModelFormatter\n * @param options More options, see FormatContentModelOptions\n */\nexport const formatContentModel: FormatContentModel = (core, formatter, options) => {\n    const { apiName, onNodeCreated, getChangeData, changeSource, rawEvent, selectionOverride } =\n        options || {};\n    const model = core.api.createContentModel(core, undefined /*option*/, selectionOverride);\n    const context: FormatContentModelContext = {\n        newEntities: [],\n        deletedEntities: [],\n        rawEvent,\n        newImages: [],\n    };\n\n    const hasFocus = core.domHelper.hasFocus();\n\n    const changed = formatter(model, context);\n    const { skipUndoSnapshot, clearModelCache, entityStates, canUndoByBackspace } = context;\n\n    if (changed) {\n        const isNested = core.undo.isNested;\n        const shouldAddSnapshot = !skipUndoSnapshot && !isNested;\n        let selection: DOMSelection | undefined;\n\n        if (shouldAddSnapshot) {\n            core.undo.isNested = true;\n\n            core.api.addUndoSnapshot(core, !!canUndoByBackspace, entityStates);\n        }\n\n        try {\n            handleImages(core, context);\n\n            selection =\n                core.api.setContentModel(\n                    core,\n                    model,\n                    hasFocus ? undefined : { ignoreSelection: true }, // If editor did not have focus before format, do not set focus after format\n                    onNodeCreated\n                ) ?? undefined;\n\n            handlePendingFormat(core, context, selection);\n\n            const eventData: ContentChangedEvent = {\n                eventType: 'contentChanged',\n                contentModel: clearModelCache ? undefined : model,\n                selection: clearModelCache ? undefined : selection,\n                source: changeSource || ChangeSource.Format,\n                data: getChangeData?.(),\n                formatApiName: apiName,\n                changedEntities: getChangedEntities(context, rawEvent),\n            };\n\n            core.api.triggerEvent(core, eventData, true /*broadcast*/);\n\n            if (canUndoByBackspace && selection?.type == 'range') {\n                core.undo.posContainer = selection.range.startContainer;\n                core.undo.posOffset = selection.range.startOffset;\n            }\n\n            if (shouldAddSnapshot) {\n                core.api.addUndoSnapshot(core, !!canUndoByBackspace, entityStates);\n            } else {\n                core.undo.snapshotsManager.hasNewContent = true;\n            }\n        } finally {\n            if (!isNested) {\n                core.undo.isNested = false;\n            }\n        }\n    } else {\n        if (clearModelCache) {\n            core.cache.cachedModel = undefined;\n            core.cache.cachedSelection = undefined;\n        }\n\n        handlePendingFormat(core, context, core.api.getDOMSelection(core));\n    }\n};\n\nfunction handleImages(core: EditorCore, context: FormatContentModelContext) {\n    if (context.newImages.length > 0) {\n        const viewport = core.api.getVisibleViewport(core);\n\n        if (viewport) {\n            const { left, right } = viewport;\n            const minMaxImageSize = 10;\n            const maxWidth = Math.max(right - left, minMaxImageSize);\n            context.newImages.forEach(image => {\n                image.format.maxWidth = `${maxWidth}px`;\n            });\n        }\n    }\n}\n\nfunction handlePendingFormat(\n    core: EditorCore,\n    context: FormatContentModelContext,\n    selection?: DOMSelection | null\n) {\n    const pendingFormat =\n        context.newPendingFormat == 'preserve'\n            ? core.format.pendingFormat?.format\n            : context.newPendingFormat;\n\n    if (pendingFormat && selection?.type == 'range' && selection.range.collapsed) {\n        core.format.pendingFormat = {\n            format: { ...pendingFormat },\n            posContainer: selection.range.startContainer,\n            posOffset: selection.range.startOffset,\n        };\n    }\n}\n\nfunction getChangedEntities(context: FormatContentModelContext, rawEvent?: Event): ChangedEntity[] {\n    return context.newEntities\n        .map(\n            (entity): ChangedEntity => ({\n                entity,\n                operation: 'newEntity',\n                rawEvent,\n            })\n        )\n        .concat(\n            context.deletedEntities.map(entry => ({\n                entity: entry.entity,\n                operation: entry.operation,\n                rawEvent,\n            }))\n        );\n}\n","import type { DOMSelection, GetDOMSelection, EditorCore } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const getDOMSelection: GetDOMSelection = core => {\n    if (core.lifecycle.shadowEditFragment) {\n        return null;\n    } else {\n        const selection = core.selection.selection;\n\n        return selection && (selection.type != 'range' || !core.domHelper.hasFocus())\n            ? selection\n            : getNewSelection(core);\n    }\n};\n\nfunction getNewSelection(core: EditorCore): DOMSelection | null {\n    const selection = core.logicalRoot.ownerDocument.defaultView?.getSelection();\n    const range = selection && selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n\n    return range && core.logicalRoot.contains(range.commonAncestorContainer)\n        ? {\n              type: 'range',\n              range,\n              isReverted: isSelectionReverted(selection),\n          }\n        : null;\n}\n\nfunction isSelectionReverted(selection: Selection | null | undefined): boolean {\n    if (selection && selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        return (\n            !range.collapsed &&\n            selection.focusNode != range.endContainer &&\n            selection.focusOffset != range.endOffset\n        );\n    }\n\n    return false;\n}\n","import { normalizeRect } from 'roosterjs-content-model-dom';\nimport type { GetVisibleViewport, Rect } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Retrieves the rect of the visible viewport of the editor.\n * @param core The EditorCore object\n */\nexport const getVisibleViewport: GetVisibleViewport = core => {\n    const scrollContainer = core.domEvent.scrollContainer;\n\n    return getIntersectedRect(\n        scrollContainer == core.physicalRoot\n            ? [scrollContainer]\n            : [scrollContainer, core.physicalRoot]\n    );\n};\n\n/**\n * Get the intersected Rect of elements provided\n *\n * @example\n * The result of the following Elements Rects would be:\n    {\n        top: Element2.top,\n        bottom: Element1.bottom,\n        left: Element2.left,\n        right: Element2.right\n    }\n    +-------------------------+\n    | Element 1               |\n    |   +-----------------+   |\n    |   | Element2        |   |\n    |   |                 |   |\n    |   |                 |   |\n    +-------------------------+\n        |                 |\n        +-----------------+\n\n * @param elements Elements to use.\n * @param additionalRects additional rects to use\n * @returns If the Rect is valid return the rect, if not, return null.\n */\nfunction getIntersectedRect(elements: HTMLElement[], additionalRects: Rect[] = []): Rect | null {\n    const rects = elements\n        .map(element => normalizeRect(element.getBoundingClientRect()))\n        .concat(additionalRects)\n        .filter((rect: Rect | null): rect is Rect => !!rect);\n\n    const result: Rect = {\n        top: Math.max(...rects.map(r => r.top)),\n        bottom: Math.min(...rects.map(r => r.bottom)),\n        left: Math.max(...rects.map(r => r.left)),\n        right: Math.min(...rects.map(r => r.right)),\n    };\n\n    return result.top < result.bottom && result.left < result.right ? result : null;\n}\n","import { ChangeSource } from '../constants/ChangeSource';\nimport { restoreSnapshotColors } from '../utils/restoreSnapshotColors';\nimport { restoreSnapshotHTML } from '../utils/restoreSnapshotHTML';\nimport { restoreSnapshotSelection } from '../utils/restoreSnapshotSelection';\nimport type { ContentChangedEvent, RestoreUndoSnapshot } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Restore an undo snapshot into editor\n * @param core The editor core object\n * @param step Steps to move, can be 0, positive or negative\n */\nexport const restoreUndoSnapshot: RestoreUndoSnapshot = (core, snapshot) => {\n    core.api.triggerEvent(\n        core,\n        {\n            eventType: 'beforeSetContent',\n            newContent: snapshot.html,\n        },\n        true /*broadcast*/\n    );\n\n    try {\n        core.undo.isRestoring = true;\n\n        restoreSnapshotHTML(core, snapshot);\n        restoreSnapshotSelection(core, snapshot);\n        restoreSnapshotColors(core, snapshot);\n\n        const event: ContentChangedEvent = {\n            eventType: 'contentChanged',\n            entityStates: snapshot.entityStates,\n            source: ChangeSource.SetContent,\n        };\n\n        core.api.triggerEvent(core, event, false /*broadcast*/);\n    } finally {\n        core.undo.isRestoring = false;\n    }\n};\n","import {\n    contentModelToDom,\n    createModelToDomContext,\n    createModelToDomContextWithConfig,\n} from 'roosterjs-content-model-dom';\nimport type { SetContentModel } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Set content with content model\n * @param core The editor core object\n * @param model The content model to set\n * @param option Additional options to customize the behavior of Content Model to DOM conversion\n */\nexport const setContentModel: SetContentModel = (core, model, option, onNodeCreated) => {\n    const editorContext = core.api.createEditorContext(core, true /*saveIndex*/);\n    const modelToDomContext = option\n        ? createModelToDomContext(\n              editorContext,\n              core.environment.modelToDomSettings.builtIn,\n              core.environment.modelToDomSettings.customized,\n              option\n          )\n        : createModelToDomContextWithConfig(\n              core.environment.modelToDomSettings.calculated,\n              editorContext\n          );\n\n    modelToDomContext.onNodeCreated = onNodeCreated;\n\n    const selection = contentModelToDom(\n        core.logicalRoot.ownerDocument,\n        core.logicalRoot,\n        model,\n        modelToDomContext\n    );\n\n    if (!core.lifecycle.shadowEditFragment) {\n        core.cache.cachedSelection = selection || undefined;\n\n        if (!option?.ignoreSelection && selection) {\n            core.api.setDOMSelection(core, selection);\n        } else {\n            core.selection.selection = selection;\n        }\n\n        // Clear pending mutations since we will use our latest model object to replace existing cache\n        core.cache.textMutationObserver?.flushMutations();\n        core.cache.cachedModel = model;\n    }\n\n    return selection;\n};\n","import { addRangeToSelection } from '../corePlugin/utils/addRangeToSelection';\nimport { ensureUniqueId } from './setEditorStyle/ensureUniqueId';\nimport { isNodeOfType, toArray } from 'roosterjs-content-model-dom';\nimport { parseTableCells } from '../publicApi/domUtils/tableCellUtils';\nimport type {\n    SelectionChangedEvent,\n    SetDOMSelection,\n    TableSelection,\n} from 'roosterjs-content-model-types';\n\nconst DOM_SELECTION_CSS_KEY = '_DOMSelection';\nconst HIDE_CURSOR_CSS_KEY = '_DOMSelectionHideCursor';\nconst IMAGE_ID = 'image';\nconst TABLE_ID = 'table';\nconst DEFAULT_SELECTION_BORDER_COLOR = '#DB626C';\nconst TABLE_CSS_RULE = 'background-color:#C6C6C6!important;';\nconst CARET_CSS_RULE = 'caret-color: transparent';\n\n/**\n * @internal\n */\nexport const setDOMSelection: SetDOMSelection = (core, selection, skipSelectionChangedEvent) => {\n    // We are applying a new selection, so we don't need to apply cached selection in DOMEventPlugin.\n    // Set skipReselectOnFocus to skip this behavior\n    const skipReselectOnFocus = core.selection.skipReselectOnFocus;\n\n    const doc = core.physicalRoot.ownerDocument;\n\n    core.selection.skipReselectOnFocus = true;\n    core.api.setEditorStyle(core, DOM_SELECTION_CSS_KEY, null /*cssRule*/);\n    core.api.setEditorStyle(core, HIDE_CURSOR_CSS_KEY, null /*cssRule*/);\n\n    try {\n        switch (selection?.type) {\n            case 'image':\n                const image = selection.image;\n\n                core.selection.selection = selection;\n                core.api.setEditorStyle(\n                    core,\n                    DOM_SELECTION_CSS_KEY,\n                    `outline-style:auto!important; outline-color:${\n                        core.selection.imageSelectionBorderColor || DEFAULT_SELECTION_BORDER_COLOR\n                    }!important;`,\n                    [`#${ensureUniqueId(image, IMAGE_ID)}`]\n                );\n                core.api.setEditorStyle(core, HIDE_CURSOR_CSS_KEY, CARET_CSS_RULE);\n\n                setRangeSelection(doc, image);\n                break;\n            case 'table':\n                const { table, firstColumn, firstRow } = selection;\n                const tableSelectors = buildTableSelectors(\n                    ensureUniqueId(table, TABLE_ID),\n                    selection\n                );\n\n                core.selection.selection = selection;\n                core.api.setEditorStyle(\n                    core,\n                    DOM_SELECTION_CSS_KEY,\n                    TABLE_CSS_RULE,\n                    tableSelectors\n                );\n                core.api.setEditorStyle(core, HIDE_CURSOR_CSS_KEY, CARET_CSS_RULE);\n\n                setRangeSelection(doc, table.rows[firstRow]?.cells[firstColumn]);\n                break;\n            case 'range':\n                addRangeToSelection(doc, selection.range, selection.isReverted);\n\n                core.selection.selection = core.domHelper.hasFocus() ? null : selection;\n                break;\n\n            default:\n                core.selection.selection = null;\n                break;\n        }\n    } finally {\n        core.selection.skipReselectOnFocus = skipReselectOnFocus;\n    }\n\n    if (!skipSelectionChangedEvent) {\n        const eventData: SelectionChangedEvent = {\n            eventType: 'selectionChanged',\n            newSelection: selection,\n        };\n\n        core.api.triggerEvent(core, eventData, true /*broadcast*/);\n    }\n};\n\nfunction buildTableSelectors(tableId: string, selection: TableSelection): string[] {\n    const { firstColumn, firstRow, lastColumn, lastRow } = selection;\n    const cells = parseTableCells(selection.table);\n    const isAllTableSelected =\n        firstRow == 0 &&\n        firstColumn == 0 &&\n        lastRow == cells.length - 1 &&\n        lastColumn == (cells[lastRow]?.length ?? 0) - 1;\n    return isAllTableSelected\n        ? [`#${tableId}`, `#${tableId} *`]\n        : handleTableSelected(tableId, selection, cells);\n}\n\nfunction handleTableSelected(\n    tableId: string,\n    selection: TableSelection,\n    cells: (HTMLTableCellElement | null)[][]\n) {\n    const { firstRow, firstColumn, lastRow, lastColumn, table } = selection;\n    const selectors: string[] = [];\n\n    // Get whether table has thead, tbody or tfoot, then Set the start and end of each of the table children,\n    // so we can build the selector according the element between the table and the row.\n    let cont = 0;\n    const indexes = toArray(table.childNodes)\n        .filter(\n            (node): node is HTMLTableSectionElement =>\n                ['THEAD', 'TBODY', 'TFOOT'].indexOf(\n                    isNodeOfType(node, 'ELEMENT_NODE') ? node.tagName : ''\n                ) > -1\n        )\n        .map(node => {\n            const result = {\n                el: node.tagName,\n                start: cont,\n                end: node.childNodes.length + cont,\n            };\n\n            cont = result.end;\n            return result;\n        });\n\n    cells.forEach((row, rowIndex) => {\n        let tdCount = 0;\n\n        //Get current TBODY/THEAD/TFOOT\n        const midElement = indexes.filter(ind => ind.start <= rowIndex && ind.end > rowIndex)[0];\n        const middleElSelector = midElement ? '>' + midElement.el + '>' : '>';\n        const currentRow =\n            midElement && rowIndex + 1 >= midElement.start\n                ? rowIndex + 1 - midElement.start\n                : rowIndex + 1;\n\n        for (let cellIndex = 0; cellIndex < row.length; cellIndex++) {\n            const cell = row[cellIndex];\n\n            if (cell) {\n                tdCount++;\n\n                if (\n                    rowIndex >= firstRow &&\n                    rowIndex <= lastRow &&\n                    cellIndex >= firstColumn &&\n                    cellIndex <= lastColumn\n                ) {\n                    const selector = `#${tableId}${middleElSelector} tr:nth-child(${currentRow})>${cell.tagName}:nth-child(${tdCount})`;\n\n                    selectors.push(selector, selector + ' *');\n                }\n            }\n        }\n    });\n\n    return selectors;\n}\n\nfunction setRangeSelection(doc: Document, element: HTMLElement | undefined) {\n    if (element && doc.contains(element)) {\n        const range = doc.createRange();\n\n        range.selectNode(element);\n        range.collapse();\n\n        addRangeToSelection(doc, range);\n    }\n}\n","/**\n * @internal\n */\nexport function ensureUniqueId(element: HTMLElement, idPrefix: string): string {\n    idPrefix = element.id || idPrefix;\n\n    const doc = element.ownerDocument;\n    let i = 0;\n\n    while (!element.id || doc.querySelectorAll('#' + element.id).length > 1) {\n        element.id = idPrefix + '_' + i++;\n    }\n\n    return element.id;\n}\n","import { ensureUniqueId } from './ensureUniqueId';\nimport type { SetEditorStyle } from 'roosterjs-content-model-types';\n\nconst MAX_RULE_SELECTOR_LENGTH = 9000;\nconst CONTENT_DIV_ID = 'contentDiv';\n\n/**\n * @internal\n */\nexport const setEditorStyle: SetEditorStyle = (\n    core,\n    key,\n    cssRule,\n    subSelectors,\n    maxRuleLength = MAX_RULE_SELECTOR_LENGTH\n) => {\n    let styleElement = core.lifecycle.styleElements[key];\n\n    if (!styleElement && cssRule) {\n        const doc = core.physicalRoot.ownerDocument;\n\n        styleElement = doc.createElement('style');\n        doc.head.appendChild(styleElement);\n\n        styleElement.dataset.roosterjsStyleKey = key;\n        core.lifecycle.styleElements[key] = styleElement;\n    }\n\n    const sheet = styleElement?.sheet;\n\n    if (sheet) {\n        for (let i = sheet.cssRules.length - 1; i >= 0; i--) {\n            sheet.deleteRule(i);\n        }\n\n        if (cssRule) {\n            const rootSelector = '#' + ensureUniqueId(core.physicalRoot, CONTENT_DIV_ID);\n            const selectors = !subSelectors\n                ? [rootSelector]\n                : typeof subSelectors === 'string'\n                ? [`${rootSelector}::${subSelectors}`]\n                : buildSelectors(\n                      rootSelector,\n                      subSelectors,\n                      maxRuleLength - cssRule.length - 3 // minus 3 for \" {}\"\n                  );\n\n            selectors.forEach(selector => {\n                sheet.insertRule(`${selector} {${cssRule}}`);\n            });\n        }\n    }\n};\n\nfunction buildSelectors(rootSelector: string, subSelectors: string[], maxLen: number): string[] {\n    const result: string[] = [];\n\n    let stringBuilder: string[] = [];\n    let len = 0;\n\n    subSelectors.forEach(subSelector => {\n        if (len >= maxLen) {\n            result.push(stringBuilder.join(','));\n            stringBuilder = [];\n            len = 0;\n        }\n\n        const selector = `${rootSelector} ${subSelector}`;\n\n        len += selector.length + 1; // Add 1 for potential \",\" between selectors\n        stringBuilder.push(selector);\n    });\n\n    result.push(stringBuilder.join(','));\n\n    return result;\n}\n","import { iterateSelections } from '../publicApi/selection/iterateSelections';\nimport { moveChildNodes } from 'roosterjs-content-model-dom';\nimport type { SwitchShadowEdit } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Switch the Shadow Edit mode of editor On/Off\n * @param editorCore The EditorCore object\n * @param isOn True to switch On, False to switch Off\n */\nexport const switchShadowEdit: SwitchShadowEdit = (editorCore, isOn): void => {\n    const core = editorCore;\n\n    if (isOn != !!core.lifecycle.shadowEditFragment) {\n        if (isOn) {\n            const model = !core.cache.cachedModel ? core.api.createContentModel(core) : null;\n            const fragment = core.logicalRoot.ownerDocument.createDocumentFragment();\n            const clonedRoot = core.logicalRoot.cloneNode(true /*deep*/);\n\n            moveChildNodes(fragment, clonedRoot);\n\n            core.api.triggerEvent(\n                core,\n                {\n                    eventType: 'enteredShadowEdit',\n                },\n                false /*broadcast*/\n            );\n\n            // This need to be done after EnteredShadowEdit event is triggered since EnteredShadowEdit event will cause a SelectionChanged event\n            // if current selection is table selection or image selection\n            if (!core.cache.cachedModel && model) {\n                core.cache.cachedModel = model;\n            }\n\n            core.lifecycle.shadowEditFragment = fragment;\n        } else {\n            core.lifecycle.shadowEditFragment = null;\n\n            core.api.triggerEvent(\n                core,\n                {\n                    eventType: 'leavingShadowEdit',\n                },\n                false /*broadcast*/\n            );\n\n            if (core.cache.cachedModel) {\n                // Force clear cached element from selected block\n                iterateSelections(core.cache.cachedModel, () => {});\n\n                core.api.setContentModel(core, core.cache.cachedModel, {\n                    ignoreSelection: true, // Do not set focus and selection when quit shadow edit, focus may remain in UI control (picker, ...)\n                });\n            }\n        }\n    }\n};\n","import type {\n    EditorPlugin,\n    PluginEvent,\n    PluginEventType,\n    TriggerEvent,\n} from 'roosterjs-content-model-types';\n\nconst allowedEventsInShadowEdit: PluginEventType[] = [\n    'editorReady',\n    'beforeDispose',\n    'extractContentWithDom',\n    'zoomChanged',\n];\n\n/**\n * @internal\n * Trigger a plugin event\n * @param core The EditorCore object\n * @param pluginEvent The event object to trigger\n * @param broadcast Set to true to skip the shouldHandleEventExclusively check\n */\nexport const triggerEvent: TriggerEvent = (core, pluginEvent, broadcast) => {\n    if (\n        (!core.lifecycle.shadowEditFragment ||\n            allowedEventsInShadowEdit.indexOf(pluginEvent.eventType as PluginEventType) >= 0) &&\n        (broadcast || !core.plugins.some(plugin => handledExclusively(pluginEvent, plugin)))\n    ) {\n        core.plugins.forEach(plugin => {\n            if (plugin.onPluginEvent) {\n                plugin.onPluginEvent(pluginEvent);\n            }\n        });\n    }\n};\n\nfunction handledExclusively(event: PluginEvent, plugin: EditorPlugin): boolean {\n    if (plugin.onPluginEvent && plugin.willHandleEventExclusively?.(event)) {\n        plugin.onPluginEvent(event);\n        return true;\n    }\n\n    return false;\n}\n","import { areSameSelection } from './utils/areSameSelection';\nimport { createTextMutationObserver } from './utils/textMutationObserver';\nimport { domIndexerImpl } from './utils/domIndexerImpl';\nimport type {\n    CachePluginState,\n    IEditor,\n    PluginEvent,\n    PluginWithState,\n    EditorOptions,\n} from 'roosterjs-content-model-types';\n\n/**\n * ContentModel cache plugin manages cached Content Model, and refresh the cache when necessary\n */\nclass CachePlugin implements PluginWithState<CachePluginState> {\n    private editor: IEditor | null = null;\n    private state: CachePluginState;\n\n    /**\n     * Construct a new instance of CachePlugin class\n     * @param option The editor option\n     * @param contentDiv The editor content DIV\n     */\n    constructor(option: EditorOptions, contentDiv: HTMLDivElement) {\n        this.state = option.disableCache\n            ? {}\n            : {\n                  domIndexer: domIndexerImpl,\n                  textMutationObserver: createTextMutationObserver(contentDiv, this.onMutation),\n              };\n    }\n\n    /**\n     * Get name of this plugin\n     */\n    getName() {\n        return 'Cache';\n    }\n\n    /**\n     * The first method that editor will call to a plugin when editor is initializing.\n     * It will pass in the editor instance, plugin should take this chance to save the\n     * editor reference so that it can call to any editor method or format API later.\n     * @param editor The editor object\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n        this.editor.getDocument().addEventListener('selectionchange', this.onNativeSelectionChange);\n\n        this.state.textMutationObserver?.startObserving();\n    }\n\n    /**\n     * The last method that editor will call to a plugin before it is disposed.\n     * Plugin can take this chance to clear the reference to editor. After this method is\n     * called, plugin should not call to any editor method since it will result in error.\n     */\n    dispose() {\n        this.state.textMutationObserver?.stopObserving();\n\n        if (this.editor) {\n            this.editor\n                .getDocument()\n                .removeEventListener('selectionchange', this.onNativeSelectionChange);\n            this.editor = null;\n        }\n    }\n\n    /**\n     * Get plugin state object\n     */\n    getState(): CachePluginState {\n        return this.state;\n    }\n\n    /**\n     * Core method for a plugin. Once an event happens in editor, editor will call this\n     * method of each plugin to handle the event as long as the event is not handled\n     * exclusively by another plugin.\n     * @param event The event to handle:\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (!this.editor) {\n            return;\n        }\n\n        switch (event.eventType) {\n            case 'keyDown':\n            case 'input':\n                if (!this.state.textMutationObserver) {\n                    // When updating cache is not enabled, need to clear the cache to make sure other plugins can get an up-to-date content model\n                    this.invalidateCache();\n                }\n                break;\n\n            case 'selectionChanged':\n                this.updateCachedModel(this.editor);\n                break;\n\n            case 'contentChanged':\n                const { contentModel, selection } = event;\n\n                if (contentModel && this.state.domIndexer) {\n                    this.state.cachedModel = contentModel;\n                    this.state.cachedSelection = selection;\n                } else {\n                    this.invalidateCache();\n                }\n\n                break;\n        }\n    }\n\n    private onMutation = (isTextChangeOnly: boolean) => {\n        if (this.editor) {\n            if (isTextChangeOnly) {\n                this.updateCachedModel(this.editor, true /*forceUpdate*/);\n            } else {\n                this.invalidateCache();\n            }\n        }\n    };\n\n    private onNativeSelectionChange = () => {\n        if (this.editor?.hasFocus()) {\n            this.updateCachedModel(this.editor);\n        }\n    };\n\n    private invalidateCache() {\n        if (!this.editor?.isInShadowEdit()) {\n            this.state.cachedModel = undefined;\n            this.state.cachedSelection = undefined;\n        }\n    }\n\n    private updateCachedModel(editor: IEditor, forceUpdate?: boolean) {\n        const cachedSelection = this.state.cachedSelection;\n        this.state.cachedSelection = undefined; // Clear it to force getDOMSelection() retrieve the latest selection range\n\n        const newRangeEx = editor.getDOMSelection() || undefined;\n        const model = this.state.cachedModel;\n        const isSelectionChanged =\n            forceUpdate ||\n            !cachedSelection ||\n            !newRangeEx ||\n            !areSameSelection(newRangeEx, cachedSelection);\n\n        if (isSelectionChanged) {\n            if (\n                !model ||\n                !newRangeEx ||\n                !this.state.domIndexer?.reconcileSelection(model, newRangeEx, cachedSelection)\n            ) {\n                this.invalidateCache();\n            } else {\n                this.state.cachedSelection = newRangeEx;\n            }\n        } else {\n            this.state.cachedSelection = cachedSelection;\n        }\n    }\n}\n\n/**\n * @internal\n * Create a new instance of CachePlugin class.\n * @param option The editor option\n * @param contentDiv The editor content DIV\n */\nexport function createCachePlugin(\n    option: EditorOptions,\n    contentDiv: HTMLDivElement\n): PluginWithState<CachePluginState> {\n    return new CachePlugin(option, contentDiv);\n}\n","import { getSelectionRootNode } from '../publicApi/selection/getSelectionRootNode';\nimport type {\n    ContextMenuPluginState,\n    ContextMenuProvider,\n    IEditor,\n    PluginWithState,\n    EditorOptions,\n} from 'roosterjs-content-model-types';\n\nconst ContextMenuButton = 2;\n\n/**\n * Edit Component helps handle Content edit features\n */\nclass ContextMenuPlugin implements PluginWithState<ContextMenuPluginState> {\n    private editor: IEditor | null = null;\n    private state: ContextMenuPluginState;\n    private disposer: (() => void) | null = null;\n\n    /**\n     * Construct a new instance of EditPlugin\n     * @param options The editor options\n     */\n    constructor(options: EditorOptions) {\n        this.state = {\n            contextMenuProviders:\n                options.plugins?.filter<ContextMenuProvider<any>>(isContextMenuProvider) || [],\n        };\n    }\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'ContextMenu';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n        this.disposer = this.editor.attachDomEvent({\n            contextmenu: {\n                beforeDispatch: this.onContextMenuEvent,\n            },\n        });\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.disposer?.();\n        this.disposer = null;\n        this.editor = null;\n    }\n\n    /**\n     * Get plugin state object\n     */\n    getState() {\n        return this.state;\n    }\n\n    private onContextMenuEvent = (e: Event) => {\n        if (this.editor) {\n            const allItems: any[] = [];\n            const mouseEvent = e as MouseEvent;\n\n            // ContextMenu event can be triggered from mouse right click or keyboard (e.g. Shift+F10 on Windows)\n            // Need to check if this is from keyboard, we need to get target node from selection because in that case\n            // event.target is always the element that attached context menu event, here it will be editor content div.\n            const targetNode =\n                mouseEvent.button == ContextMenuButton\n                    ? (mouseEvent.target as Node)\n                    : this.getFocusedNode(this.editor);\n\n            if (targetNode) {\n                this.state.contextMenuProviders.forEach(provider => {\n                    const items = provider.getContextMenuItems(targetNode) ?? [];\n                    if (items?.length > 0) {\n                        if (allItems.length > 0) {\n                            allItems.push(null);\n                        }\n\n                        allItems.push(...items);\n                    }\n                });\n            }\n\n            this.editor?.triggerEvent('contextMenu', {\n                rawEvent: mouseEvent,\n                items: allItems,\n            });\n        }\n    };\n\n    private getFocusedNode(editor: IEditor) {\n        const selection = editor.getDOMSelection();\n\n        if (selection) {\n            if (selection.type == 'range') {\n                selection.range.collapse(true /*toStart*/);\n            }\n\n            return getSelectionRootNode(selection) || null;\n        } else {\n            return null;\n        }\n    }\n}\n\nfunction isContextMenuProvider(source: unknown): source is ContextMenuProvider<any> {\n    return !!(<ContextMenuProvider<any>>source)?.getContextMenuItems;\n}\n\n/**\n * @internal\n * Create a new instance of EditPlugin.\n */\nexport function createContextMenuPlugin(\n    options: EditorOptions\n): PluginWithState<ContextMenuPluginState> {\n    return new ContextMenuPlugin(options);\n}\n","import { addRangeToSelection } from './utils/addRangeToSelection';\nimport { ChangeSource } from '../constants/ChangeSource';\nimport { deleteEmptyList } from './utils/deleteEmptyList';\nimport { deleteSelection } from '../publicApi/selection/deleteSelection';\nimport { extractClipboardItems } from '../utils/extractClipboardItems';\nimport { getSelectedCells } from '../publicApi/table/getSelectedCells';\nimport { iterateSelections } from '../publicApi/selection/iterateSelections';\nimport { onCreateCopyEntityNode } from '../override/pasteCopyBlockEntityParser';\nimport { paste } from '../publicApi/paste/paste';\n\nimport {\n    contentModelToDom,\n    createModelToDomContext,\n    isElementOfType,\n    isNodeOfType,\n    moveChildNodes,\n    normalizeContentModel,\n    toArray,\n    wrap,\n} from 'roosterjs-content-model-dom';\nimport type {\n    ClipboardData,\n    CopyPastePluginState,\n    ContentModelTable,\n    DOMSelection,\n    IEditor,\n    OnNodeCreated,\n    EditorOptions,\n    PluginWithState,\n    ContentModelDocument,\n    ContentModelParagraph,\n    TableSelectionContext,\n    ContentModelSegment,\n} from 'roosterjs-content-model-types';\n\n/**\n * Copy and paste plugin for handling onCopy and onPaste event\n */\nclass CopyPastePlugin implements PluginWithState<CopyPastePluginState> {\n    private editor: IEditor | null = null;\n    private disposer: (() => void) | null = null;\n    private state: CopyPastePluginState;\n\n    /**\n     * Construct a new instance of CopyPastePlugin\n     * @param option The editor option\n     */\n    constructor(option: EditorOptions) {\n        this.state = {\n            allowedCustomPasteType: option.allowedCustomPasteType || [],\n            tempDiv: null,\n            defaultPasteType: option.defaultPasteType,\n        };\n    }\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'CopyPaste';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n        this.disposer = this.editor.attachDomEvent({\n            paste: {\n                beforeDispatch: e => this.onPaste(e),\n            },\n            copy: {\n                beforeDispatch: e => this.onCutCopy(e, false /*isCut*/),\n            },\n            cut: {\n                beforeDispatch: e => this.onCutCopy(e, true /*isCut*/),\n            },\n        });\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        if (this.state.tempDiv) {\n            this.state.tempDiv.parentNode?.removeChild(this.state.tempDiv);\n            this.state.tempDiv = null;\n        }\n\n        if (this.disposer) {\n            this.disposer();\n        }\n        this.disposer = null;\n        this.editor = null;\n    }\n\n    /**\n     * Get plugin state object\n     */\n    getState() {\n        return this.state;\n    }\n\n    private onCutCopy(event: Event, isCut: boolean) {\n        if (!this.editor) {\n            return;\n        }\n\n        const doc = this.editor.getDocument();\n        const selection = this.editor.getDOMSelection();\n\n        if (selection && (selection.type != 'range' || !selection.range.collapsed)) {\n            const pasteModel = this.editor.getContentModelCopy('disconnected');\n\n            if (selection.type === 'table') {\n                iterateSelections(pasteModel, (_, tableContext) => {\n                    if (tableContext?.table) {\n                        preprocessTable(tableContext.table);\n\n                        return true;\n                    }\n                    return false;\n                });\n            } else if (selection.type === 'range') {\n                adjustSelectionForCopyCut(pasteModel);\n            }\n\n            const tempDiv = this.getTempDiv(this.editor.getDocument());\n            const context = createModelToDomContext();\n\n            context.onNodeCreated = onNodeCreated;\n\n            const selectionForCopy = contentModelToDom(\n                tempDiv.ownerDocument,\n                tempDiv,\n                pasteModel,\n                context\n            );\n\n            let newRange: Range | null = selectionForCopy\n                ? domSelectionToRange(doc, selectionForCopy)\n                : null;\n\n            if (newRange) {\n                newRange = this.editor.triggerEvent('beforeCutCopy', {\n                    clonedRoot: tempDiv,\n                    range: newRange,\n                    rawEvent: event as ClipboardEvent,\n                    isCut,\n                }).range;\n\n                if (newRange) {\n                    addRangeToSelection(doc, newRange);\n                }\n\n                doc.defaultView?.requestAnimationFrame(() => {\n                    if (!this.editor) {\n                        return;\n                    }\n\n                    cleanUpAndRestoreSelection(tempDiv);\n                    this.editor.focus();\n                    this.editor.setDOMSelection(selection);\n\n                    if (isCut) {\n                        this.editor.formatContentModel(\n                            (model, context) => {\n                                if (\n                                    deleteSelection(model, [deleteEmptyList], context)\n                                        .deleteResult == 'range'\n                                ) {\n                                    normalizeContentModel(model);\n                                }\n\n                                return true;\n                            },\n                            {\n                                apiName: 'cut',\n                                changeSource: ChangeSource.Cut,\n                            }\n                        );\n                    }\n                });\n            } else {\n                cleanUpAndRestoreSelection(tempDiv);\n            }\n        }\n    }\n\n    private onPaste = (event: Event) => {\n        if (this.editor && isClipboardEvent(event)) {\n            const editor = this.editor;\n\n            const dataTransfer = event.clipboardData;\n\n            if (dataTransfer?.items) {\n                event.preventDefault();\n                extractClipboardItems(\n                    toArray(dataTransfer.items),\n                    this.state.allowedCustomPasteType\n                ).then((clipboardData: ClipboardData) => {\n                    if (!editor.isDisposed()) {\n                        paste(editor, clipboardData, this.state.defaultPasteType);\n                    }\n                });\n            }\n        }\n    };\n\n    private getTempDiv(doc: Document) {\n        if (!this.state.tempDiv) {\n            const tempDiv = doc.createElement('div');\n\n            tempDiv.style.width = '600px';\n            tempDiv.style.height = '1px';\n            tempDiv.style.overflow = 'hidden';\n            tempDiv.style.position = 'fixed';\n            tempDiv.style.top = '0';\n            tempDiv.style.left = '0';\n            tempDiv.style.userSelect = 'text';\n            tempDiv.contentEditable = 'true';\n\n            doc.body.appendChild(tempDiv);\n\n            this.state.tempDiv = tempDiv;\n        }\n\n        const div = this.state.tempDiv;\n\n        div.style.backgroundColor = 'white';\n        div.style.color = 'black';\n        div.childNodes.forEach(node => div.removeChild(node));\n\n        div.style.display = '';\n        div.focus();\n\n        return div;\n    }\n}\n\n/**\n * @internal\n * Exported only for unit testing\n */\nexport function adjustSelectionForCopyCut(pasteModel: ContentModelDocument) {\n    let selectionMarker: ContentModelSegment | undefined;\n    let firstBlock: ContentModelParagraph | undefined;\n    let tableContext: TableSelectionContext | undefined;\n\n    iterateSelections(pasteModel, (_, tableCtxt, block, segments) => {\n        if (selectionMarker) {\n            if (tableCtxt != tableContext && firstBlock?.segments.includes(selectionMarker)) {\n                firstBlock.segments.splice(firstBlock.segments.indexOf(selectionMarker), 1);\n            }\n            return true;\n        }\n\n        const marker = segments?.find(segment => segment.segmentType == 'SelectionMarker');\n        if (!selectionMarker && marker) {\n            tableContext = tableCtxt;\n            firstBlock = block?.blockType == 'Paragraph' ? block : undefined;\n            selectionMarker = marker;\n        }\n\n        return false;\n    });\n}\n\nfunction cleanUpAndRestoreSelection(tempDiv: HTMLDivElement) {\n    tempDiv.style.backgroundColor = '';\n    tempDiv.style.color = '';\n    tempDiv.style.display = 'none';\n    moveChildNodes(tempDiv);\n}\n\nfunction isClipboardEvent(event: Event): event is ClipboardEvent {\n    return !!(event as ClipboardEvent).clipboardData;\n}\n\nfunction domSelectionToRange(doc: Document, selection: DOMSelection): Range | null {\n    let newRange: Range | null = null;\n\n    if (selection.type === 'table') {\n        const table = selection.table;\n        const elementToSelect =\n            table.parentElement?.childElementCount == 1 ? table.parentElement : table;\n\n        newRange = doc.createRange();\n        newRange.selectNode(elementToSelect);\n    } else if (selection.type === 'image') {\n        newRange = doc.createRange();\n        newRange.selectNode(selection.image);\n    } else {\n        newRange = selection.range;\n    }\n\n    return newRange;\n}\n\n/**\n * @internal\n * Exported only for unit testing\n */\nexport const onNodeCreated: OnNodeCreated = (modelElement, node): void => {\n    if (isNodeOfType(node, 'ELEMENT_NODE') && isElementOfType(node, 'table')) {\n        wrap(node.ownerDocument, node, 'div');\n    }\n    if (isNodeOfType(node, 'ELEMENT_NODE') && !node.isContentEditable) {\n        node.removeAttribute('contenteditable');\n    }\n    onCreateCopyEntityNode(modelElement, node);\n};\n\n/**\n * @internal\n * Exported only for unit testing\n */\nexport function preprocessTable(table: ContentModelTable) {\n    const sel = getSelectedCells(table);\n    table.rows = table.rows\n        .map(row => {\n            return {\n                ...row,\n                cells: row.cells.filter(cell => cell.isSelected),\n            };\n        })\n        .filter(row => row.cells.length > 0);\n\n    delete table.format.width;\n\n    table.widths = sel\n        ? table.widths.filter((_, index) => index >= sel?.firstColumn && index <= sel?.lastColumn)\n        : [];\n}\n\n/**\n * @internal\n * Create a new instance of CopyPastePlugin\n * @param option The editor option\n */\nexport function createCopyPastePlugin(\n    option: EditorOptions\n): PluginWithState<CopyPastePluginState> {\n    return new CopyPastePlugin(option);\n}\n","import { ChangeSource } from '../constants/ChangeSource';\nimport { isCharacterValue, isCursorMovingKey } from '../publicApi/domUtils/eventUtils';\nimport { isNodeOfType } from 'roosterjs-content-model-dom';\nimport type {\n    DOMEventPluginState,\n    IEditor,\n    DOMEventRecord,\n    EditorOptions,\n    PluginWithState,\n} from 'roosterjs-content-model-types';\n\nconst EventTypeMap: Record<string, 'keyDown' | 'keyUp' | 'keyPress'> = {\n    keydown: 'keyDown',\n    keyup: 'keyUp',\n    keypress: 'keyPress',\n};\n\n/**\n * DOMEventPlugin handles customized DOM events, including:\n * 1. Keyboard event\n * 2. Mouse event\n * 3. IME state\n * 4. Drop event\n * 5. Focus and blur event\n * 6. Input event\n * 7. Scroll event\n * It contains special handling for Safari since Safari cannot get correct selection when onBlur event is triggered in editor.\n */\nclass DOMEventPlugin implements PluginWithState<DOMEventPluginState> {\n    private editor: IEditor | null = null;\n    private disposer: (() => void) | null = null;\n    private state: DOMEventPluginState;\n\n    /**\n     * Construct a new instance of DOMEventPlugin\n     * @param options The editor options\n     * @param contentDiv The editor content DIV\n     */\n    constructor(options: EditorOptions, contentDiv: HTMLDivElement) {\n        this.state = {\n            isInIME: false,\n            scrollContainer: options.scrollContainer || contentDiv,\n            mouseDownX: null,\n            mouseDownY: null,\n            mouseUpEventListerAdded: false,\n        };\n    }\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'DOMEvent';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n\n        const document = this.editor.getDocument();\n        const eventHandlers: Partial<\n            { [P in keyof HTMLElementEventMap]: DOMEventRecord<HTMLElementEventMap[P]> }\n        > = {\n            // 1. Keyboard event\n            keypress: this.keyboardEventHandler,\n            keydown: this.keyboardEventHandler,\n            keyup: this.keyboardEventHandler,\n            input: this.inputEventHandler,\n\n            // 2. Mouse event\n            mousedown: { beforeDispatch: this.onMouseDown },\n\n            // 3. IME state management\n            compositionstart: { beforeDispatch: this.onCompositionStart },\n            compositionend: { beforeDispatch: this.onCompositionEnd },\n\n            // 4. Drag and Drop event\n            dragstart: { beforeDispatch: this.onDragStart },\n            drop: { beforeDispatch: this.onDrop },\n        };\n\n        this.disposer = this.editor.attachDomEvent(<Record<string, DOMEventRecord>>eventHandlers);\n\n        // 7. Scroll event\n        this.state.scrollContainer.addEventListener('scroll', this.onScroll);\n        document.defaultView?.addEventListener('scroll', this.onScroll);\n        document.defaultView?.addEventListener('resize', this.onScroll);\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.removeMouseUpEventListener();\n\n        const document = this.editor?.getDocument();\n\n        document?.defaultView?.removeEventListener('resize', this.onScroll);\n        document?.defaultView?.removeEventListener('scroll', this.onScroll);\n        this.state.scrollContainer.removeEventListener('scroll', this.onScroll);\n        this.disposer?.();\n        this.disposer = null;\n        this.editor = null;\n    }\n\n    /**\n     * Get plugin state object\n     */\n    getState() {\n        return this.state;\n    }\n\n    private onDragStart = (e: Event) => {\n        const dragEvent = e as DragEvent;\n        const node = dragEvent.target as Node;\n        const element = isNodeOfType(node, 'ELEMENT_NODE') ? node : node.parentElement;\n\n        if (element && !element.isContentEditable) {\n            dragEvent.preventDefault();\n        }\n    };\n\n    private onDrop = () => {\n        const doc = this.editor?.getDocument();\n\n        doc?.defaultView?.requestAnimationFrame(() => {\n            if (this.editor) {\n                this.editor.takeSnapshot();\n                this.editor.triggerEvent('contentChanged', {\n                    source: ChangeSource.Drop,\n                });\n            }\n        });\n    };\n\n    private onScroll = (e: Event) => {\n        this.editor?.triggerEvent('scroll', {\n            rawEvent: e,\n            scrollContainer: this.state.scrollContainer,\n        });\n    };\n\n    private keyboardEventHandler: DOMEventRecord<KeyboardEvent> = {\n        beforeDispatch: event => {\n            const eventType = EventTypeMap[event.type];\n\n            if (isCharacterValue(event) || isCursorMovingKey(event)) {\n                // Stop propagation for Character keys and Up/Down/Left/Right/Home/End/PageUp/PageDown\n                // since editor already handles these keys and no need to propagate to parents\n                event.stopPropagation();\n            }\n\n            if (this.editor && eventType && !event.isComposing && !this.state.isInIME) {\n                this.editor.triggerEvent(eventType, {\n                    rawEvent: event,\n                });\n            }\n        },\n    };\n\n    private inputEventHandler: DOMEventRecord<Event> = {\n        beforeDispatch: event => {\n            event.stopPropagation();\n\n            if (this.editor && !(event as InputEvent).isComposing && !this.state.isInIME) {\n                this.editor.triggerEvent('input', {\n                    rawEvent: event as InputEvent,\n                });\n            }\n        },\n    };\n\n    private onMouseDown = (event: MouseEvent) => {\n        if (this.editor) {\n            if (!this.state.mouseUpEventListerAdded) {\n                this.editor\n                    .getDocument()\n                    .addEventListener('mouseup', this.onMouseUp, true /*setCapture*/);\n                this.state.mouseUpEventListerAdded = true;\n                this.state.mouseDownX = event.pageX;\n                this.state.mouseDownY = event.pageY;\n            }\n\n            this.editor.triggerEvent('mouseDown', {\n                rawEvent: event,\n            });\n        }\n    };\n\n    private onMouseUp = (rawEvent: MouseEvent) => {\n        if (this.editor) {\n            this.removeMouseUpEventListener();\n            this.editor.triggerEvent('mouseUp', {\n                rawEvent,\n                isClicking:\n                    this.state.mouseDownX == rawEvent.pageX &&\n                    this.state.mouseDownY == rawEvent.pageY,\n            });\n        }\n    };\n\n    private onCompositionStart = () => {\n        this.state.isInIME = true;\n    };\n\n    private onCompositionEnd = (rawEvent: CompositionEvent) => {\n        this.state.isInIME = false;\n        this.editor?.triggerEvent('compositionEnd', {\n            rawEvent,\n        });\n    };\n\n    private removeMouseUpEventListener() {\n        if (this.editor && this.state.mouseUpEventListerAdded) {\n            this.state.mouseUpEventListerAdded = false;\n            this.editor.getDocument().removeEventListener('mouseup', this.onMouseUp, true);\n        }\n    }\n}\n\n/**\n * @internal\n * Create a new instance of DOMEventPlugin.\n * @param option The editor option\n * @param contentDiv The editor content DIV element\n */\nexport function createDOMEventPlugin(\n    option: EditorOptions,\n    contentDiv: HTMLDivElement\n): PluginWithState<DOMEventPluginState> {\n    return new DOMEventPlugin(option, contentDiv);\n}\n","import { findAllEntities } from './utils/findAllEntities';\nimport { transformColor } from '../publicApi/color/transformColor';\nimport {\n    handleCompositionEndEvent,\n    handleDelimiterContentChangedEvent,\n    handleDelimiterKeyDownEvent,\n} from './utils/entityDelimiterUtils';\nimport {\n    createEntity,\n    generateEntityClassNames,\n    getAllEntityWrappers,\n    getObjectKeys,\n    isEntityElement,\n    parseEntityFormat,\n} from 'roosterjs-content-model-dom';\nimport type {\n    ChangedEntity,\n    ContentChangedEvent,\n    EntityOperation,\n    EntityPluginState,\n    IEditor,\n    MouseUpEvent,\n    PluginEvent,\n    PluginWithState,\n} from 'roosterjs-content-model-types';\n\nconst ENTITY_ID_REGEX = /_(\\d{1,8})$/;\n\n/**\n * Entity Plugin helps handle all operations related to an entity and generate entity specified events\n */\nclass EntityPlugin implements PluginWithState<EntityPluginState> {\n    private editor: IEditor | null = null;\n    private state: EntityPluginState;\n\n    /**\n     * Construct a new instance of EntityPlugin\n     */\n    constructor() {\n        this.state = {\n            entityMap: {},\n        };\n    }\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'Entity';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.editor = null;\n        this.state.entityMap = {};\n    }\n\n    /**\n     * Get plugin state object\n     */\n    getState() {\n        return this.state;\n    }\n\n    /**\n     * Handle events triggered from editor\n     * @param event PluginEvent object\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (this.editor) {\n            switch (event.eventType) {\n                case 'mouseUp':\n                    this.handleMouseUpEvent(this.editor, event);\n                    break;\n                case 'contentChanged':\n                    this.handleContentChangedEvent(this.editor, event);\n                    break;\n                case 'keyDown':\n                    handleDelimiterKeyDownEvent(this.editor, event);\n                    break;\n                case 'compositionEnd':\n                    handleCompositionEndEvent(this.editor, event);\n                    break;\n                case 'editorReady':\n                    this.handleContentChangedEvent(this.editor);\n                    break;\n                case 'extractContentWithDom':\n                    this.handleExtractContentWithDomEvent(this.editor, event.clonedRoot);\n                    break;\n            }\n        }\n    }\n\n    private handleMouseUpEvent(editor: IEditor, event: MouseUpEvent) {\n        const { rawEvent, isClicking } = event;\n        let node: Node | null = rawEvent.target as Node;\n\n        if (isClicking && this.editor) {\n            while (node && this.editor.getDOMHelper().isNodeInEditor(node)) {\n                if (isEntityElement(node)) {\n                    this.triggerEvent(editor, node as HTMLElement, 'click', rawEvent);\n                    break;\n                } else {\n                    node = node.parentNode;\n                }\n            }\n        }\n    }\n\n    private handleContentChangedEvent(editor: IEditor, event?: ContentChangedEvent) {\n        const modifiedEntities: ChangedEntity[] =\n            event?.changedEntities ?? this.getChangedEntities(editor);\n        const entityStates = event?.entityStates;\n\n        modifiedEntities.forEach(entry => {\n            const { entity, operation, rawEvent } = entry;\n            const {\n                entityFormat: { id, entityType, isFakeEntity },\n                wrapper,\n            } = entity;\n\n            if (entityType && !isFakeEntity) {\n                if (operation == 'newEntity') {\n                    entity.entityFormat.id = this.ensureUniqueId(entityType, id ?? '', wrapper);\n                    wrapper.className = generateEntityClassNames(entity.entityFormat);\n\n                    if (entity.entityFormat.isReadonly) {\n                        wrapper.contentEditable = 'false';\n                    }\n\n                    const eventResult = this.triggerEvent(editor, wrapper, operation, rawEvent);\n\n                    this.state.entityMap[entity.entityFormat.id] = {\n                        element: wrapper,\n                        canPersist: eventResult?.shouldPersist,\n                    };\n\n                    if (editor.isDarkMode()) {\n                        transformColor(\n                            wrapper,\n                            true /*includeSelf*/,\n                            'lightToDark',\n                            editor.getColorManager()\n                        );\n                    }\n                } else if (id) {\n                    const mapEntry = this.state.entityMap[id];\n\n                    if (mapEntry) {\n                        mapEntry.isDeleted = true;\n                    }\n\n                    this.triggerEvent(editor, wrapper, operation, rawEvent);\n                }\n            }\n        });\n\n        entityStates?.forEach(entityState => {\n            const { id, state } = entityState;\n            const wrapper = this.state.entityMap[id]?.element;\n\n            if (wrapper) {\n                this.triggerEvent(\n                    editor,\n                    wrapper,\n                    'updateEntityState',\n                    undefined /*rawEvent*/,\n                    state\n                );\n            }\n        });\n\n        handleDelimiterContentChangedEvent(editor);\n    }\n\n    private getChangedEntities(editor: IEditor): ChangedEntity[] {\n        const result: ChangedEntity[] = [];\n\n        editor.formatContentModel(model => {\n            findAllEntities(model, result);\n            return false;\n        });\n\n        getObjectKeys(this.state.entityMap).forEach(id => {\n            const entry = this.state.entityMap[id];\n\n            if (!entry.isDeleted) {\n                const index = result.findIndex(\n                    x =>\n                        x.operation == 'newEntity' &&\n                        x.entity.entityFormat.id == id &&\n                        x.entity.wrapper == entry.element\n                );\n\n                if (index >= 0) {\n                    // Found matched entity in editor, so there is no change to this entity,\n                    // we can safely remove it from the new entity array\n                    result.splice(index, 1);\n                } else {\n                    // Entity is not in editor, which means it is deleted, use a temporary entity here to represent this entity\n                    const format = parseEntityFormat(entry.element);\n\n                    if (!format.isFakeEntity) {\n                        const entity = createEntity(\n                            entry.element,\n                            format.isReadonly,\n                            {},\n                            format.entityType,\n                            format.id\n                        );\n\n                        result.push({\n                            entity: entity,\n                            operation: 'overwrite',\n                        });\n                    }\n                }\n            }\n        });\n\n        return result;\n    }\n\n    private handleExtractContentWithDomEvent(editor: IEditor, root: HTMLElement) {\n        getAllEntityWrappers(root).forEach(element => {\n            element.removeAttribute('contentEditable');\n\n            this.triggerEvent(editor, element, 'replaceTemporaryContent');\n        });\n    }\n\n    private triggerEvent(\n        editor: IEditor,\n        wrapper: HTMLElement,\n        operation: EntityOperation,\n        rawEvent?: Event,\n        state?: string\n    ) {\n        const format = parseEntityFormat(wrapper);\n\n        return format.id && format.entityType && !format.isFakeEntity\n            ? editor.triggerEvent('entityOperation', {\n                  operation: operation,\n                  rawEvent,\n                  entity: {\n                      id: format.id,\n                      type: format.entityType,\n                      isReadonly: !!format.isReadonly,\n                      wrapper,\n                  },\n                  state: operation == 'updateEntityState' ? state : undefined,\n                  shouldPersist: operation == 'newEntity' ? true : undefined, // By default, we always persist entity now\n              })\n            : null;\n    }\n\n    private ensureUniqueId(type: string, id: string, wrapper: HTMLElement): string {\n        const match = ENTITY_ID_REGEX.exec(id);\n        const baseId = (match ? id.substr(0, id.length - match[0].length) : id) || type;\n\n        // Make sure entity id is unique\n        let newId = '';\n\n        for (let num = (match && parseInt(match[1])) || 0; ; num++) {\n            newId = num > 0 ? `${baseId}_${num}` : baseId;\n\n            const item = this.state.entityMap[newId];\n\n            if (!item || item.element == wrapper) {\n                break;\n            }\n        }\n\n        return newId;\n    }\n}\n\n/**\n * @internal\n * Create a new instance of EntityPlugin.\n */\nexport function createEntityPlugin(): PluginWithState<EntityPluginState> {\n    return new EntityPlugin();\n}\n","import { applyDefaultFormat } from './utils/applyDefaultFormat';\nimport { applyPendingFormat } from './utils/applyPendingFormat';\nimport { getObjectKeys, isBlockElement, isNodeOfType } from 'roosterjs-content-model-dom';\nimport { isCharacterValue, isCursorMovingKey } from '../publicApi/domUtils/eventUtils';\nimport type {\n    BackgroundColorFormat,\n    FontFamilyFormat,\n    FontSizeFormat,\n    FormatPluginState,\n    IEditor,\n    PluginEvent,\n    PluginWithState,\n    EditorOptions,\n    TextColorFormat,\n} from 'roosterjs-content-model-types';\n\n// During IME input, KeyDown event will have \"Process\" as key\nconst ProcessKey = 'Process';\nconst DefaultStyleKeyMap: Record<\n    keyof (FontFamilyFormat & FontSizeFormat & TextColorFormat & BackgroundColorFormat),\n    keyof CSSStyleDeclaration\n> = {\n    backgroundColor: 'backgroundColor',\n    textColor: 'color',\n    fontFamily: 'fontFamily',\n    fontSize: 'fontSize',\n};\n\n/**\n * FormatPlugin plugins helps editor to do formatting on top of content model.\n * This includes:\n * 1. Handle pending format changes when selection is collapsed\n */\nclass FormatPlugin implements PluginWithState<FormatPluginState> {\n    private editor: IEditor | null = null;\n    private defaultFormatKeys: Set<keyof CSSStyleDeclaration>;\n    private state: FormatPluginState;\n    private lastCheckedNode: Node | null = null;\n\n    /**\n     * Construct a new instance of FormatPlugin class\n     * @param option The editor option\n     */\n    constructor(option: EditorOptions) {\n        this.state = {\n            defaultFormat: { ...option.defaultSegmentFormat },\n            pendingFormat: null,\n        };\n\n        this.defaultFormatKeys = new Set<keyof CSSStyleDeclaration>();\n\n        getObjectKeys(DefaultStyleKeyMap).forEach(key => {\n            if (this.state.defaultFormat[key]) {\n                this.defaultFormatKeys.add(DefaultStyleKeyMap[key]);\n            }\n        });\n    }\n\n    /**\n     * Get name of this plugin\n     */\n    getName() {\n        return 'Format';\n    }\n\n    /**\n     * The first method that editor will call to a plugin when editor is initializing.\n     * It will pass in the editor instance, plugin should take this chance to save the\n     * editor reference so that it can call to any editor method or format API later.\n     * @param editor The editor object\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n    }\n\n    /**\n     * The last method that editor will call to a plugin before it is disposed.\n     * Plugin can take this chance to clear the reference to editor. After this method is\n     * called, plugin should not call to any editor method since it will result in error.\n     */\n    dispose() {\n        this.editor = null;\n    }\n\n    /**\n     * Get plugin state object\n     */\n    getState(): FormatPluginState {\n        return this.state;\n    }\n\n    /**\n     * Core method for a plugin. Once an event happens in editor, editor will call this\n     * method of each plugin to handle the event as long as the event is not handled\n     * exclusively by another plugin.\n     * @param event The event to handle:\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (!this.editor) {\n            return;\n        }\n\n        switch (event.eventType) {\n            case 'input':\n                this.checkAndApplyPendingFormat(event.rawEvent.data);\n\n                break;\n\n            case 'compositionEnd':\n                this.checkAndApplyPendingFormat(event.rawEvent.data);\n                break;\n\n            case 'keyDown':\n                if (isCursorMovingKey(event.rawEvent)) {\n                    this.clearPendingFormat();\n                    this.lastCheckedNode = null;\n                } else if (\n                    this.defaultFormatKeys.size > 0 &&\n                    (isCharacterValue(event.rawEvent) || event.rawEvent.key == ProcessKey) &&\n                    this.shouldApplyDefaultFormat(this.editor)\n                ) {\n                    applyDefaultFormat(this.editor, this.state.defaultFormat);\n                }\n\n                break;\n\n            case 'mouseUp':\n            case 'contentChanged':\n                this.lastCheckedNode = null;\n\n                if (!this.canApplyPendingFormat()) {\n                    this.clearPendingFormat();\n                }\n                break;\n        }\n    }\n\n    private checkAndApplyPendingFormat(data: string | null) {\n        if (this.editor && data && this.state.pendingFormat) {\n            applyPendingFormat(this.editor, data, this.state.pendingFormat.format);\n            this.clearPendingFormat();\n        }\n    }\n\n    private clearPendingFormat() {\n        this.state.pendingFormat = null;\n    }\n\n    /**\n     * @internal\n     * Check if this editor can apply pending format\n     * @param editor The editor to get format from\n     */\n    private canApplyPendingFormat(): boolean {\n        let result = false;\n\n        if (this.state.pendingFormat && this.editor) {\n            const selection = this.editor.getDOMSelection();\n            const range =\n                selection?.type == 'range' && selection.range.collapsed ? selection.range : null;\n            const { posContainer, posOffset } = this.state.pendingFormat;\n\n            if (range && range.startContainer == posContainer && range.startOffset == posOffset) {\n                result = true;\n            }\n        }\n\n        return result;\n    }\n\n    private shouldApplyDefaultFormat(editor: IEditor): boolean {\n        const selection = editor.getDOMSelection();\n        const range = selection?.type == 'range' ? selection.range : null;\n        const posContainer = range?.startContainer ?? null;\n\n        if (posContainer && posContainer != this.lastCheckedNode) {\n            // Cache last checked parent node so no need to check it again if user is keep typing under the same node\n            this.lastCheckedNode = posContainer;\n\n            const domHelper = editor.getDOMHelper();\n            let element: HTMLElement | null = isNodeOfType(posContainer, 'ELEMENT_NODE')\n                ? posContainer\n                : posContainer.parentElement;\n            const foundFormatKeys = new Set<keyof CSSStyleDeclaration>();\n\n            while (element?.parentElement && domHelper.isNodeInEditor(element.parentElement)) {\n                if (element.getAttribute?.('style')) {\n                    const style = element.style;\n                    this.defaultFormatKeys.forEach(key => {\n                        if (style[key]) {\n                            foundFormatKeys.add(key);\n                        }\n                    });\n\n                    if (foundFormatKeys.size == this.defaultFormatKeys.size) {\n                        return false;\n                    }\n                }\n\n                if (isBlockElement(element)) {\n                    break;\n                }\n\n                element = element.parentElement;\n            }\n\n            return true;\n        } else {\n            return false;\n        }\n    }\n}\n\n/**\n * @internal\n * Create a new instance of FormatPlugin.\n * @param option The editor option\n */\nexport function createFormatPlugin(option: EditorOptions): PluginWithState<FormatPluginState> {\n    return new FormatPlugin(option);\n}\n","import { ChangeSource } from '../constants/ChangeSource';\nimport { getObjectKeys, setColor } from 'roosterjs-content-model-dom';\nimport type {\n    IEditor,\n    LifecyclePluginState,\n    PluginEvent,\n    PluginWithState,\n    EditorOptions,\n} from 'roosterjs-content-model-types';\n\nconst ContentEditableAttributeName = 'contenteditable';\nconst DefaultTextColor = '#000000';\nconst DefaultBackColor = '#ffffff';\n\n/**\n * Lifecycle plugin handles editor initialization and disposing\n */\nclass LifecyclePlugin implements PluginWithState<LifecyclePluginState> {\n    private editor: IEditor | null = null;\n    private state: LifecyclePluginState;\n    private initializer: (() => void) | null = null;\n    private disposer: (() => void) | null = null;\n    private adjustColor: () => void;\n\n    /**\n     * Construct a new instance of LifecyclePlugin\n     * @param options The editor options\n     * @param contentDiv The editor content DIV\n     */\n    constructor(options: EditorOptions, contentDiv: HTMLDivElement) {\n        // Make the container editable and set its selection styles\n        if (contentDiv.getAttribute(ContentEditableAttributeName) === null) {\n            this.initializer = () => {\n                contentDiv.contentEditable = 'true';\n                contentDiv.style.userSelect = 'text';\n            };\n            this.disposer = () => {\n                contentDiv.style.userSelect = '';\n                contentDiv.removeAttribute(ContentEditableAttributeName);\n            };\n        }\n        this.adjustColor = options.doNotAdjustEditorColor\n            ? () => {}\n            : () => {\n                  this.adjustContainerColor(contentDiv);\n              };\n\n        this.state = {\n            isDarkMode: !!options.inDarkMode,\n            shadowEditFragment: null,\n            styleElements: {},\n        };\n    }\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'Lifecycle';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n\n        // Set content DIV to be editable\n        this.initializer?.();\n\n        // Set editor background color for dark mode\n        this.adjustColor();\n\n        // Let other plugins know that we are ready\n        this.editor.triggerEvent('editorReady', {}, true /*broadcast*/);\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.editor?.triggerEvent('beforeDispose', {}, true /*broadcast*/);\n\n        getObjectKeys(this.state.styleElements).forEach(key => {\n            const element = this.state.styleElements[key];\n\n            element.parentElement?.removeChild(element);\n            delete this.state.styleElements[key];\n        });\n\n        if (this.disposer) {\n            this.disposer();\n            this.disposer = null;\n            this.initializer = null;\n        }\n\n        this.editor = null;\n    }\n\n    /**\n     * Get plugin state object\n     */\n    getState() {\n        return this.state;\n    }\n\n    /**\n     * Handle events triggered from editor\n     * @param event PluginEvent object\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (\n            event.eventType == 'contentChanged' &&\n            (event.source == ChangeSource.SwitchToDarkMode ||\n                event.source == ChangeSource.SwitchToLightMode)\n        ) {\n            this.adjustColor();\n        }\n    }\n\n    private adjustContainerColor(contentDiv: HTMLElement) {\n        if (this.editor) {\n            const { isDarkMode } = this.state;\n            const darkColorHandler = this.editor.getColorManager();\n\n            setColor(\n                contentDiv,\n                DefaultTextColor,\n                false /*isBackground*/,\n                isDarkMode,\n                darkColorHandler\n            );\n            setColor(\n                contentDiv,\n                DefaultBackColor,\n                true /*isBackground*/,\n                isDarkMode,\n                darkColorHandler\n            );\n        }\n    }\n}\n\n/**\n * @internal\n * Create a new instance of LifecyclePlugin.\n * @param option The editor option\n * @param contentDiv The editor content DIV element\n */\nexport function createLifecyclePlugin(\n    option: EditorOptions,\n    contentDiv: HTMLDivElement\n): PluginWithState<LifecyclePluginState> {\n    return new LifecyclePlugin(option, contentDiv);\n}\n","import { isElementOfType, isNodeOfType, toArray } from 'roosterjs-content-model-dom';\nimport { isModifierKey } from '../publicApi/domUtils/eventUtils';\nimport type {\n    DOMSelection,\n    IEditor,\n    PluginEvent,\n    PluginWithState,\n    SelectionPluginState,\n    EditorOptions,\n} from 'roosterjs-content-model-types';\n\nconst MouseMiddleButton = 1;\nconst MouseRightButton = 2;\n\nclass SelectionPlugin implements PluginWithState<SelectionPluginState> {\n    private editor: IEditor | null = null;\n    private state: SelectionPluginState;\n    private disposer: (() => void) | null = null;\n    private isSafari = false;\n    private isMac = false;\n\n    constructor(options: EditorOptions) {\n        this.state = {\n            selection: null,\n            imageSelectionBorderColor: options.imageSelectionBorderColor,\n        };\n    }\n\n    getName() {\n        return 'Selection';\n    }\n\n    initialize(editor: IEditor) {\n        this.editor = editor;\n\n        const env = this.editor.getEnvironment();\n        const document = this.editor.getDocument();\n\n        this.isSafari = !!env.isSafari;\n        this.isMac = !!env.isMac;\n\n        if (this.isSafari) {\n            document.addEventListener('selectionchange', this.onSelectionChangeSafari);\n            this.disposer = this.editor.attachDomEvent({ focus: { beforeDispatch: this.onFocus } });\n        } else {\n            this.disposer = this.editor.attachDomEvent({\n                focus: { beforeDispatch: this.onFocus },\n                blur: { beforeDispatch: this.onBlur },\n            });\n        }\n    }\n\n    dispose() {\n        this.editor\n            ?.getDocument()\n            .removeEventListener('selectionchange', this.onSelectionChangeSafari);\n\n        if (this.disposer) {\n            this.disposer();\n            this.disposer = null;\n        }\n\n        this.editor = null;\n    }\n\n    getState(): SelectionPluginState {\n        return this.state;\n    }\n\n    onPluginEvent(event: PluginEvent) {\n        if (!this.editor) {\n            return;\n        }\n\n        let image: HTMLImageElement | null;\n        let selection: DOMSelection | null;\n\n        switch (event.eventType) {\n            case 'mouseUp':\n                if (\n                    (image = this.getClickingImage(event.rawEvent)) &&\n                    image.isContentEditable &&\n                    event.rawEvent.button != MouseMiddleButton &&\n                    (event.rawEvent.button ==\n                        MouseRightButton /* it's not possible to drag using right click */ ||\n                        event.isClicking)\n                ) {\n                    this.selectImage(this.editor, image);\n                }\n                break;\n\n            case 'mouseDown':\n                selection = this.editor.getDOMSelection();\n                if (\n                    event.rawEvent.button === MouseRightButton &&\n                    (image =\n                        this.getClickingImage(event.rawEvent) ??\n                        this.getContainedTargetImage(event.rawEvent, selection)) &&\n                    image.isContentEditable\n                ) {\n                    this.selectImage(this.editor, image);\n                } else if (\n                    selection?.type == 'image' &&\n                    selection.image !== event.rawEvent.target\n                ) {\n                    this.selectBeforeImage(this.editor, selection.image);\n                }\n                break;\n\n            case 'keyDown':\n                const rawEvent = event.rawEvent;\n                const key = rawEvent.key;\n                selection = this.editor.getDOMSelection();\n\n                if (\n                    !isModifierKey(rawEvent) &&\n                    !rawEvent.shiftKey &&\n                    selection?.type == 'image' &&\n                    selection.image.parentNode\n                ) {\n                    if (key === 'Escape') {\n                        this.selectBeforeImage(this.editor, selection.image);\n                        event.rawEvent.stopPropagation();\n                    } else if (key !== 'Delete' && key !== 'Backspace') {\n                        this.selectBeforeImage(this.editor, selection.image);\n                    }\n                }\n                break;\n        }\n    }\n\n    private selectImage(editor: IEditor, image: HTMLImageElement) {\n        editor.setDOMSelection({\n            type: 'image',\n            image: image,\n        });\n    }\n\n    private selectBeforeImage(editor: IEditor, image: HTMLImageElement) {\n        const doc = editor.getDocument();\n        const parent = image.parentNode;\n        const index = parent && toArray(parent.childNodes).indexOf(image);\n\n        if (parent && index !== null && index >= 0) {\n            const range = doc.createRange();\n            range.setStart(parent, index);\n            range.collapse();\n\n            editor.setDOMSelection({\n                type: 'range',\n                range: range,\n                isReverted: false,\n            });\n        }\n    }\n\n    private getClickingImage(event: UIEvent): HTMLImageElement | null {\n        const target = event.target as Node;\n\n        return isNodeOfType(target, 'ELEMENT_NODE') && isElementOfType(target, 'img')\n            ? target\n            : null;\n    }\n\n    //MacOS will not create a mouseUp event if contextMenu event is not prevent defaulted.\n    //Make sure we capture image target even if image is wrapped\n    private getContainedTargetImage = (\n        event: MouseEvent,\n        previousSelection: DOMSelection | null\n    ): HTMLImageElement | null => {\n        if (!this.isMac || !previousSelection || previousSelection.type !== 'image') {\n            return null;\n        }\n\n        const target = event.target as Node;\n        if (\n            isNodeOfType(target, 'ELEMENT_NODE') &&\n            isElementOfType(target, 'span') &&\n            target.firstChild === previousSelection.image\n        ) {\n            return previousSelection.image;\n        }\n        return null;\n    };\n\n    private onFocus = () => {\n        if (!this.state.skipReselectOnFocus && this.state.selection) {\n            this.editor?.setDOMSelection(this.state.selection);\n        }\n\n        if (this.state.selection?.type == 'range' && !this.isSafari) {\n            // Editor is focused, now we can get live selection. So no need to keep a selection if the selection type is range.\n            this.state.selection = null;\n        }\n    };\n\n    private onBlur = () => {\n        if (!this.state.selection && this.editor) {\n            this.state.selection = this.editor.getDOMSelection();\n        }\n    };\n\n    private onSelectionChangeSafari = () => {\n        if (this.editor?.hasFocus() && !this.editor.isInShadowEdit()) {\n            // Safari has problem to handle onBlur event. When blur, we cannot get the original selection from editor.\n            // So we always save a selection whenever editor has focus. Then after blur, we can still use this cached selection.\n            const newSelection = this.editor.getDOMSelection();\n\n            if (newSelection?.type == 'range') {\n                this.state.selection = newSelection;\n            }\n        }\n    };\n}\n\n/**\n * @internal\n * Create a new instance of SelectionPlugin.\n * @param option The editor option\n */\nexport function createSelectionPlugin(\n    options: EditorOptions\n): PluginWithState<SelectionPluginState> {\n    return new SelectionPlugin(options);\n}\n","import { ChangeSource } from '../constants/ChangeSource';\nimport { createSnapshotsManager } from '../editor/SnapshotsManagerImpl';\nimport { isCursorMovingKey } from '../publicApi/domUtils/eventUtils';\nimport { undo } from '../publicApi/undo/undo';\nimport type {\n    ContentChangedEvent,\n    IEditor,\n    PluginEvent,\n    PluginWithState,\n    EditorOptions,\n    UndoPluginState,\n} from 'roosterjs-content-model-types';\n\nconst Backspace = 'Backspace';\nconst Delete = 'Delete';\nconst Enter = 'Enter';\n\n/**\n * Provides snapshot based undo service for Editor\n */\nclass UndoPlugin implements PluginWithState<UndoPluginState> {\n    private editor: IEditor | null = null;\n    private state: UndoPluginState;\n\n    /**\n     * Construct a new instance of UndoPlugin\n     * @param options The wrapper of the state object\n     */\n    constructor(options: EditorOptions) {\n        this.state = {\n            snapshotsManager: createSnapshotsManager(options.snapshots),\n            isRestoring: false,\n            isNested: false,\n            posContainer: null,\n            posOffset: null,\n            lastKeyPress: null,\n        };\n    }\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'Undo';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor): void {\n        this.editor = editor;\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.editor = null;\n    }\n\n    /**\n     * Get plugin state object\n     */\n    getState() {\n        return this.state;\n    }\n\n    /**\n     * Check if the plugin should handle the given event exclusively.\n     * @param event The event to check\n     */\n    willHandleEventExclusively(event: PluginEvent) {\n        return (\n            !!this.editor &&\n            event.eventType == 'keyDown' &&\n            event.rawEvent.key == Backspace &&\n            !event.rawEvent.ctrlKey &&\n            this.canUndoAutoComplete(this.editor)\n        );\n    }\n\n    /**\n     * Handle events triggered from editor\n     * @param event PluginEvent object\n     */\n    onPluginEvent(event: PluginEvent): void {\n        if (!this.editor) {\n            return;\n        }\n\n        switch (event.eventType) {\n            case 'editorReady':\n                const manager = this.state.snapshotsManager;\n                const canUndo = manager.hasNewContent || manager.canMove(-1);\n                const canRedo = manager.canMove(1);\n\n                if (!canUndo && !canRedo) {\n                    // Only add initial snapshot when there is no existing snapshot\n                    // Otherwise preserved undo/redo state may be ruined\n                    this.addUndoSnapshot();\n                }\n                break;\n            case 'keyDown':\n                this.onKeyDown(this.editor, event.rawEvent);\n                break;\n            case 'keyPress':\n                this.onKeyPress(this.editor, event.rawEvent);\n                break;\n            case 'compositionEnd':\n                this.clearRedoForInput();\n                this.addUndoSnapshot();\n                break;\n            case 'contentChanged':\n                this.onContentChanged(event);\n                break;\n            case 'beforeKeyboardEditing':\n                this.onBeforeKeyboardEditing(event.rawEvent);\n                break;\n        }\n    }\n\n    private onKeyDown(editor: IEditor, evt: KeyboardEvent): void {\n        const { snapshotsManager } = this.state;\n\n        // Handle backspace/delete when there is a selection to take a snapshot\n        // since we want the state prior to deletion restorable\n        // Ignore if keycombo is ALT+BACKSPACE\n        if ((evt.key == Backspace && !evt.altKey) || evt.key == Delete) {\n            if (evt.key == Backspace && !evt.ctrlKey && this.canUndoAutoComplete(editor)) {\n                evt.preventDefault();\n                undo(editor);\n                this.state.posContainer = null;\n                this.state.posOffset = null;\n                this.state.lastKeyPress = evt.key;\n            } else if (!evt.defaultPrevented) {\n                const selection = editor.getDOMSelection();\n\n                // Add snapshot when\n                // 1. Something has been selected (not collapsed), or\n                // 2. It has a different key code from the last keyDown event (to prevent adding too many snapshot when keeping press the same key), or\n                // 3. Ctrl/Meta key is pressed so that a whole word will be deleted\n                if (\n                    selection &&\n                    (selection.type != 'range' ||\n                        !selection.range.collapsed ||\n                        this.state.lastKeyPress != evt.key ||\n                        this.isCtrlOrMetaPressed(editor, evt))\n                ) {\n                    this.addUndoSnapshot();\n                }\n\n                // Since some content is deleted, always set hasNewContent to true so that we will take undo snapshot next time\n                snapshotsManager.hasNewContent = true;\n                this.state.lastKeyPress = evt.key;\n            }\n        } else if (isCursorMovingKey(evt)) {\n            // PageUp, PageDown, Home, End, Left, Right, Up, Down\n            if (snapshotsManager.hasNewContent) {\n                this.addUndoSnapshot();\n            }\n            this.state.lastKeyPress = null;\n        } else if (this.state.lastKeyPress == Backspace || this.state.lastKeyPress == Delete) {\n            if (snapshotsManager.hasNewContent) {\n                this.addUndoSnapshot();\n            }\n        }\n    }\n\n    private onKeyPress(editor: IEditor, evt: KeyboardEvent): void {\n        if (evt.metaKey) {\n            // if metaKey is pressed, simply return since no actual effect will be taken on the editor.\n            // this is to prevent changing hasNewContent to true when meta + v to paste on Safari.\n            return;\n        }\n\n        const selection = editor.getDOMSelection();\n\n        if (\n            (selection && (selection.type != 'range' || !selection.range.collapsed)) ||\n            (evt.key == ' ' && this.state.lastKeyPress != ' ') ||\n            evt.key == Enter\n        ) {\n            this.addUndoSnapshot();\n\n            if (evt.key == Enter) {\n                // Treat ENTER as new content so if there is no input after ENTER and undo,\n                // we restore the snapshot before ENTER\n                this.state.snapshotsManager.hasNewContent = true;\n            }\n        } else {\n            this.clearRedoForInput();\n        }\n\n        this.state.lastKeyPress = evt.key;\n    }\n\n    private onBeforeKeyboardEditing(event: KeyboardEvent) {\n        // For keyboard event (triggered from Content Model), we can get its keycode from event.data\n        // And when user is keep pressing the same key, mark editor with \"hasNewContent\" so that next time user\n        // do some other action or press a different key, we will add undo snapshot\n        if (event.key != this.state.lastKeyPress) {\n            this.addUndoSnapshot();\n        }\n\n        this.state.lastKeyPress = event.key;\n        this.state.snapshotsManager.hasNewContent = true;\n    }\n\n    private onContentChanged(event: ContentChangedEvent) {\n        if (\n            !(\n                this.state.isRestoring ||\n                event.source == ChangeSource.SwitchToDarkMode ||\n                event.source == ChangeSource.SwitchToLightMode ||\n                event.source == ChangeSource.Keyboard\n            )\n        ) {\n            this.clearRedoForInput();\n        }\n    }\n\n    private clearRedoForInput() {\n        this.state.snapshotsManager.clearRedo();\n        this.state.lastKeyPress = null;\n        this.state.snapshotsManager.hasNewContent = true;\n    }\n\n    private canUndoAutoComplete(editor: IEditor) {\n        const selection = editor.getDOMSelection();\n\n        return (\n            this.state.snapshotsManager.canUndoAutoComplete() &&\n            selection?.type == 'range' &&\n            selection.range.collapsed &&\n            selection.range.startContainer == this.state.posContainer &&\n            selection.range.startOffset == this.state.posOffset\n        );\n    }\n\n    private addUndoSnapshot() {\n        this.editor?.takeSnapshot();\n        this.state.posContainer = null;\n        this.state.posOffset = null;\n    }\n\n    private isCtrlOrMetaPressed(editor: IEditor, event: KeyboardEvent) {\n        const env = editor.getEnvironment();\n\n        return env.isMac ? event.metaKey : event.ctrlKey;\n    }\n}\n\n/**\n * @internal\n * Create a new instance of UndoPlugin.\n * @param option The editor option\n */\nexport function createUndoPlugin(option: EditorOptions): PluginWithState<UndoPluginState> {\n    return new UndoPlugin(option);\n}\n","import { createCachePlugin } from './CachePlugin';\nimport { createContextMenuPlugin } from './ContextMenuPlugin';\nimport { createCopyPastePlugin } from './CopyPastePlugin';\nimport { createDOMEventPlugin } from './DOMEventPlugin';\nimport { createEntityPlugin } from './EntityPlugin';\nimport { createFormatPlugin } from './FormatPlugin';\nimport { createLifecyclePlugin } from './LifecyclePlugin';\nimport { createSelectionPlugin } from './SelectionPlugin';\nimport { createUndoPlugin } from './UndoPlugin';\nimport type { EditorCorePlugins, EditorOptions } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Create core plugins for editor\n * @param options Options of editor\n */\nexport function createEditorCorePlugins(\n    options: EditorOptions,\n    contentDiv: HTMLDivElement\n): EditorCorePlugins {\n    return {\n        cache: createCachePlugin(options, contentDiv),\n        format: createFormatPlugin(options),\n        copyPaste: createCopyPastePlugin(options),\n        domEvent: createDOMEventPlugin(options, contentDiv),\n        lifecycle: createLifecyclePlugin(options, contentDiv),\n        entity: createEntityPlugin(),\n        selection: createSelectionPlugin(options),\n        contextMenu: createContextMenuPlugin(options),\n        undo: createUndoPlugin(options),\n    };\n}\n","/**\n * @internal\n */\nexport function addRangeToSelection(doc: Document, range: Range, isReverted: boolean = false) {\n    const selection = doc.defaultView?.getSelection();\n\n    if (selection) {\n        selection.removeAllRanges();\n\n        if (!isReverted) {\n            selection.addRange(range);\n        } else {\n            selection.setBaseAndExtent(\n                range.endContainer,\n                range.endOffset,\n                range.startContainer,\n                range.startOffset\n            );\n        }\n    }\n}\n","import { deleteSelection } from '../../publicApi/selection/deleteSelection';\nimport { normalizeContentModel } from 'roosterjs-content-model-dom';\nimport type { ContentModelSegmentFormat, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * When necessary, set default format as current pending format so it will be applied when Input event is fired\n * @param editor The editor object\n * @param defaultFormat The default segment format to apply\n */\nexport function applyDefaultFormat(editor: IEditor, defaultFormat: ContentModelSegmentFormat) {\n    editor.formatContentModel((model, context) => {\n        const result = deleteSelection(model, [], context);\n\n        if (result.deleteResult == 'range') {\n            normalizeContentModel(model);\n\n            editor.takeSnapshot();\n\n            return true;\n        } else if (result.deleteResult == 'notDeleted' && result.insertPoint) {\n            const { paragraph, path, marker } = result.insertPoint;\n            const blocks = path[0].blocks;\n            const blockCount = blocks.length;\n            const blockIndex = blocks.indexOf(paragraph);\n\n            if (\n                paragraph.isImplicit &&\n                paragraph.segments.length == 1 &&\n                paragraph.segments[0] == marker &&\n                blockCount > 0 &&\n                blockIndex == blockCount - 1\n            ) {\n                // Focus is in the last paragraph which is implicit and there is not other segments.\n                // This can happen when focus is moved after all other content under current block group.\n                // We need to check if browser will merge focus into previous paragraph by checking if\n                // previous block is block. If previous block is paragraph, browser will most likely merge\n                // the input into previous paragraph, then nothing need to do here. Otherwise we need to\n                // apply pending format since this input event will start a new real paragraph.\n                const previousBlock = blocks[blockIndex - 1];\n\n                if (previousBlock?.blockType != 'Paragraph') {\n                    context.newPendingFormat = getNewPendingFormat(\n                        editor,\n                        defaultFormat,\n                        marker.format\n                    );\n                }\n            } else if (paragraph.segments.every(x => x.segmentType != 'Text')) {\n                context.newPendingFormat = getNewPendingFormat(\n                    editor,\n                    defaultFormat,\n                    marker.format\n                );\n            }\n        }\n\n        // We didn't do any change but just apply default format to pending format, so no need to write back\n        return false;\n    });\n}\n\nfunction getNewPendingFormat(\n    editor: IEditor,\n    defaultFormat: ContentModelSegmentFormat,\n    markerFormat: ContentModelSegmentFormat\n): ContentModelSegmentFormat {\n    return {\n        ...defaultFormat,\n        ...editor.getPendingFormat(),\n        ...markerFormat,\n    };\n}\n","import { iterateSelections } from '../../publicApi/selection/iterateSelections';\nimport type { ContentModelSegmentFormat, IEditor } from 'roosterjs-content-model-types';\nimport {\n    createText,\n    normalizeContentModel,\n    setParagraphNotImplicit,\n} from 'roosterjs-content-model-dom';\n\nconst ANSI_SPACE = '\\u0020';\nconst NON_BREAK_SPACE = '\\u00A0';\n\n/**\n * @internal\n * Apply pending format to the text user just input\n * @param editor The editor to get format from\n * @param data The text user just input\n */\nexport function applyPendingFormat(\n    editor: IEditor,\n    data: string,\n    format: ContentModelSegmentFormat\n) {\n    let isChanged = false;\n\n    editor.formatContentModel(\n        (model, context) => {\n            iterateSelections(model, (_, __, block, segments) => {\n                if (\n                    block?.blockType == 'Paragraph' &&\n                    segments?.length == 1 &&\n                    segments[0].segmentType == 'SelectionMarker'\n                ) {\n                    const marker = segments[0];\n                    const index = block.segments.indexOf(marker);\n                    const previousSegment = block.segments[index - 1];\n\n                    if (previousSegment?.segmentType == 'Text') {\n                        const text = previousSegment.text;\n                        const subStr = text.substr(-data.length, data.length);\n\n                        // For space, there can be &#32 (space) or &#160 (&nbsp;), we treat them as the same\n                        if (subStr == data || (data == ANSI_SPACE && subStr == NON_BREAK_SPACE)) {\n                            marker.format = { ...format };\n                            previousSegment.text = text.substring(0, text.length - data.length);\n\n                            const newText = createText(\n                                data == ANSI_SPACE ? NON_BREAK_SPACE : data,\n                                {\n                                    ...previousSegment.format,\n                                    ...format,\n                                }\n                            );\n\n                            block.segments.splice(index, 0, newText);\n                            setParagraphNotImplicit(block);\n                            isChanged = true;\n                        }\n                    }\n                }\n                return true;\n            });\n\n            if (isChanged) {\n                normalizeContentModel(model);\n                context.skipUndoSnapshot = true;\n            }\n\n            return isChanged;\n        },\n        {\n            apiName: 'applyPendingFormat',\n        }\n    );\n}\n","import type { DOMSelection } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Check if the given selections are the same\n */\nexport function areSameSelection(sel1: DOMSelection, sel2: DOMSelection): boolean {\n    if (sel1 == sel2) {\n        return true;\n    }\n\n    switch (sel1.type) {\n        case 'image':\n            return sel2.type == 'image' && sel2.image == sel1.image;\n\n        case 'table':\n            return (\n                sel2.type == 'table' &&\n                sel2.table == sel1.table &&\n                sel2.firstColumn == sel1.firstColumn &&\n                sel2.lastColumn == sel1.lastColumn &&\n                sel2.firstRow == sel1.firstRow &&\n                sel2.lastRow == sel1.lastRow\n            );\n\n        case 'range':\n        default:\n            return sel2.type == 'range' && areSameRanges(sel2.range, sel1.range);\n    }\n}\n\nfunction areSameRanges(r1?: Range, r2?: Range): boolean {\n    return !!(\n        r1 &&\n        r2 &&\n        r1.startContainer == r2.startContainer &&\n        r1.startOffset == r2.startOffset &&\n        r1.endContainer == r2.endContainer &&\n        r1.endOffset == r2.endOffset\n    );\n}\n","import { getClosestAncestorBlockGroupIndex } from '../../publicApi/model/getClosestAncestorBlockGroupIndex';\nimport { hasSelectionInBlock } from '../../publicApi/selection/hasSelectionInBlock';\nimport { hasSelectionInBlockGroup } from '../../publicApi/selection/hasSelectionInBlockGroup';\nimport type {\n    ContentModelBlock,\n    DeleteSelectionContext,\n    DeleteSelectionStep,\n} from 'roosterjs-content-model-types';\n\nfunction isEmptyBlock(block: ContentModelBlock | undefined): boolean {\n    if (block && block.blockType == 'Paragraph') {\n        return block.segments.every(\n            segment => segment.segmentType !== 'SelectionMarker' && segment.segmentType == 'Br'\n        );\n    }\n\n    if (block && block.blockType == 'BlockGroup') {\n        return block.blocks.every(isEmptyBlock);\n    }\n\n    return !!block;\n}\n\n/**\n * @internal\n * If the first item o the list is selected in a expanded selection, we need to remove the list item levels\n * @param context A context object provided by formatContentModel API\n */\nexport const deleteEmptyList: DeleteSelectionStep = (context: DeleteSelectionContext) => {\n    const { insertPoint, deleteResult } = context;\n    if (deleteResult == 'range' && insertPoint?.path) {\n        const index = getClosestAncestorBlockGroupIndex(\n            insertPoint.path,\n            ['ListItem'],\n            ['TableCell']\n        );\n        const item = insertPoint.path[index];\n        if (index >= 0 && item && item.blockGroupType == 'ListItem') {\n            const listItemIndex = insertPoint.path[index + 1].blocks.indexOf(item);\n            const previousBlock =\n                listItemIndex > -1\n                    ? insertPoint.path[index + 1].blocks[listItemIndex - 1]\n                    : undefined;\n            const nextBlock =\n                listItemIndex > -1\n                    ? insertPoint.path[index + 1].blocks[listItemIndex + 1]\n                    : undefined;\n            if (\n                hasSelectionInBlockGroup(item) &&\n                (!previousBlock || hasSelectionInBlock(previousBlock)) &&\n                nextBlock &&\n                isEmptyBlock(nextBlock)\n            ) {\n                item.levels = [];\n            }\n        }\n    }\n};\n","import { createSelectionMarker, createText, isNodeOfType } from 'roosterjs-content-model-dom';\nimport { setSelection } from '../../publicApi/selection/setSelection';\nimport type {\n    ContentModelDocument,\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelSelectionMarker,\n    ContentModelTable,\n    ContentModelTableRow,\n    ContentModelText,\n    DomIndexer,\n    DOMSelection,\n    Selectable,\n} from 'roosterjs-content-model-types';\n\ninterface SegmentItem {\n    paragraph: ContentModelParagraph;\n    segments: ContentModelSegment[];\n}\n\ninterface TableItem {\n    tableRows: ContentModelTableRow[];\n}\n\ninterface IndexedSegmentNode extends Node {\n    __roosterjsContentModel: SegmentItem;\n}\n\ninterface IndexedTableElement extends HTMLTableElement {\n    __roosterjsContentModel: TableItem;\n}\n\nfunction isIndexedSegment(node: Node): node is IndexedSegmentNode {\n    const { paragraph, segments } = (node as IndexedSegmentNode).__roosterjsContentModel ?? {};\n\n    return (\n        paragraph &&\n        paragraph.blockType == 'Paragraph' &&\n        Array.isArray(paragraph.segments) &&\n        Array.isArray(segments)\n    );\n}\n\nfunction onSegment(\n    segmentNode: Node,\n    paragraph: ContentModelParagraph,\n    segment: ContentModelSegment[]\n) {\n    const indexedText = segmentNode as IndexedSegmentNode;\n    indexedText.__roosterjsContentModel = {\n        paragraph,\n        segments: segment,\n    };\n}\n\nfunction onParagraph(paragraphElement: HTMLElement) {\n    let previousText: Text | null = null;\n\n    for (let child = paragraphElement.firstChild; child; child = child.nextSibling) {\n        if (isNodeOfType(child, 'TEXT_NODE')) {\n            if (!previousText) {\n                previousText = child;\n            } else {\n                const item = isIndexedSegment(previousText)\n                    ? previousText.__roosterjsContentModel\n                    : undefined;\n\n                if (item && isIndexedSegment(child)) {\n                    item.segments = item.segments.concat(child.__roosterjsContentModel.segments);\n                    child.__roosterjsContentModel.segments = [];\n                }\n            }\n        } else if (isNodeOfType(child, 'ELEMENT_NODE')) {\n            previousText = null;\n\n            onParagraph(child);\n        } else {\n            previousText = null;\n        }\n    }\n}\n\nfunction onTable(tableElement: HTMLTableElement, table: ContentModelTable) {\n    const indexedTable = tableElement as IndexedTableElement;\n    indexedTable.__roosterjsContentModel = { tableRows: table.rows };\n}\n\nfunction reconcileSelection(\n    model: ContentModelDocument,\n    newSelection: DOMSelection,\n    oldSelection?: DOMSelection\n): boolean {\n    if (oldSelection) {\n        if (\n            oldSelection.type == 'range' &&\n            oldSelection.range.collapsed &&\n            isNodeOfType(oldSelection.range.startContainer, 'TEXT_NODE')\n        ) {\n            if (isIndexedSegment(oldSelection.range.startContainer)) {\n                reconcileTextSelection(oldSelection.range.startContainer);\n            }\n        } else {\n            setSelection(model);\n        }\n    }\n\n    switch (newSelection.type) {\n        case 'image':\n        case 'table':\n            // For image and table selection, we just clear the cached model since during selecting the element id might be changed\n            return false;\n\n        case 'range':\n            const newRange = newSelection.range;\n            if (newRange) {\n                const {\n                    startContainer,\n                    startOffset,\n                    endContainer,\n                    endOffset,\n                    collapsed,\n                } = newRange;\n\n                if (collapsed) {\n                    return !!reconcileNodeSelection(startContainer, startOffset);\n                } else if (\n                    startContainer == endContainer &&\n                    isNodeOfType(startContainer, 'TEXT_NODE')\n                ) {\n                    return (\n                        isIndexedSegment(startContainer) &&\n                        !!reconcileTextSelection(startContainer, startOffset, endOffset)\n                    );\n                } else {\n                    const marker1 = reconcileNodeSelection(startContainer, startOffset);\n                    const marker2 = reconcileNodeSelection(endContainer, endOffset);\n\n                    if (marker1 && marker2) {\n                        setSelection(model, marker1, marker2);\n                        return true;\n                    } else {\n                        return false;\n                    }\n                }\n            }\n\n            break;\n    }\n\n    return false;\n}\n\nfunction reconcileNodeSelection(node: Node, offset: number): Selectable | undefined {\n    if (isNodeOfType(node, 'TEXT_NODE')) {\n        return isIndexedSegment(node) ? reconcileTextSelection(node, offset) : undefined;\n    } else if (offset >= node.childNodes.length) {\n        return insertMarker(node.lastChild, true /*isAfter*/);\n    } else {\n        return insertMarker(node.childNodes[offset], false /*isAfter*/);\n    }\n}\n\nfunction insertMarker(node: Node | null, isAfter: boolean): Selectable | undefined {\n    let marker: ContentModelSelectionMarker | undefined;\n\n    if (node && isIndexedSegment(node)) {\n        const { paragraph, segments } = node.__roosterjsContentModel;\n        const index = paragraph.segments.indexOf(segments[0]);\n\n        if (index >= 0) {\n            const formatSegment =\n                (!isAfter && paragraph.segments[index - 1]) || paragraph.segments[index];\n            marker = createSelectionMarker(formatSegment.format);\n\n            paragraph.segments.splice(isAfter ? index + 1 : index, 0, marker);\n        }\n    }\n\n    return marker;\n}\n\nfunction reconcileTextSelection(\n    textNode: IndexedSegmentNode,\n    startOffset?: number,\n    endOffset?: number\n) {\n    const { paragraph, segments } = textNode.__roosterjsContentModel;\n    const first = segments[0];\n    const last = segments[segments.length - 1];\n    let selectable: Selectable | undefined;\n\n    if (first?.segmentType == 'Text' && last?.segmentType == 'Text') {\n        const newSegments: ContentModelSegment[] = [];\n        const txt = textNode.nodeValue || '';\n        const textSegments: ContentModelText[] = [];\n\n        if (startOffset === undefined) {\n            first.text = txt;\n            newSegments.push(first);\n            textSegments.push(first);\n        } else {\n            if (startOffset > 0) {\n                first.text = txt.substring(0, startOffset);\n                newSegments.push(first);\n                textSegments.push(first);\n            }\n\n            if (endOffset === undefined) {\n                const marker = createSelectionMarker(first.format);\n                newSegments.push(marker);\n\n                selectable = marker;\n                endOffset = startOffset;\n            } else if (endOffset > startOffset) {\n                const middle = createText(\n                    txt.substring(startOffset, endOffset),\n                    first.format,\n                    first.link,\n                    first.code\n                );\n\n                middle.isSelected = true;\n                newSegments.push(middle);\n                textSegments.push(middle);\n                selectable = middle;\n            }\n\n            if (endOffset < txt.length) {\n                const newLast = createText(\n                    txt.substring(endOffset),\n                    first.format,\n                    first.link,\n                    first.code\n                );\n                newSegments.push(newLast);\n                textSegments.push(newLast);\n            }\n        }\n\n        let firstIndex = paragraph.segments.indexOf(first);\n        let lastIndex = paragraph.segments.indexOf(last);\n\n        if (firstIndex >= 0 && lastIndex >= 0) {\n            while (\n                firstIndex > 0 &&\n                paragraph.segments[firstIndex - 1].segmentType == 'SelectionMarker'\n            ) {\n                firstIndex--;\n            }\n\n            while (\n                lastIndex < paragraph.segments.length - 1 &&\n                paragraph.segments[lastIndex + 1].segmentType == 'SelectionMarker'\n            ) {\n                lastIndex++;\n            }\n\n            paragraph.segments.splice(firstIndex, lastIndex - firstIndex + 1, ...newSegments);\n        }\n\n        onSegment(textNode, paragraph, textSegments);\n\n        delete paragraph.cachedElement;\n    }\n\n    return selectable;\n}\n\n/**\n * @internal\n * Implementation of DomIndexer\n */\nexport const domIndexerImpl: DomIndexer = {\n    onSegment,\n    onParagraph,\n    onTable,\n    reconcileSelection,\n};\n","import { isCharacterValue } from '../../publicApi/domUtils/eventUtils';\nimport { iterateSelections } from '../../publicApi/selection/iterateSelections';\nimport type {\n    CompositionEndEvent,\n    ContentModelBlockGroup,\n    ContentModelFormatter,\n    ContentModelParagraph,\n    ContentModelSegmentFormat,\n    IEditor,\n    KeyDownEvent,\n    RangeSelection,\n} from 'roosterjs-content-model-types';\nimport {\n    addDelimiters,\n    createBr,\n    createModelToDomContext,\n    createParagraph,\n    isEntityDelimiter,\n    isEntityElement,\n    isNodeOfType,\n} from 'roosterjs-content-model-dom';\n\nconst DelimiterBefore = 'entityDelimiterBefore';\nconst DelimiterAfter = 'entityDelimiterAfter';\nconst DelimiterSelector = '.' + DelimiterAfter + ',.' + DelimiterBefore;\nconst ZeroWidthSpace = '\\u200B';\nconst EntityInfoName = '_Entity';\nconst InlineEntitySelector = 'span.' + EntityInfoName;\nconst BlockEntityContainer = '_E_EBlockEntityContainer';\nconst BlockEntityContainerSelector = '.' + BlockEntityContainer;\n\n/**\n * @internal exported only for unit test\n */\nexport function preventTypeInDelimiter(node: HTMLElement, editor: IEditor) {\n    const isAfter = node.classList.contains(DelimiterAfter);\n    const entitySibling = isAfter ? node.previousElementSibling : node.nextElementSibling;\n    if (entitySibling && isEntityElement(entitySibling)) {\n        removeInvalidDelimiters(\n            [entitySibling.previousElementSibling, entitySibling.nextElementSibling].filter(\n                element => !!element\n            ) as HTMLElement[]\n        );\n        editor.formatContentModel((model, context) => {\n            iterateSelections(model, (_path, _tableContext, block, _segments) => {\n                if (block?.blockType == 'Paragraph') {\n                    block.segments.forEach(segment => {\n                        if (segment.segmentType == 'Text') {\n                            segment.text = segment.text.replace(ZeroWidthSpace, '');\n                        }\n                    });\n                }\n            });\n\n            context.skipUndoSnapshot = true;\n\n            return true;\n        });\n    }\n}\n\nfunction addDelimitersIfNeeded(\n    nodes: Element[] | NodeListOf<Element>,\n    format: ContentModelSegmentFormat | null\n) {\n    if (nodes.length > 0) {\n        const context = createModelToDomContext();\n        nodes.forEach(node => {\n            if (\n                isNodeOfType(node, 'ELEMENT_NODE') &&\n                isEntityElement(node) &&\n                !node.isContentEditable\n            ) {\n                addDelimiters(node.ownerDocument, node as HTMLElement, format, context);\n            }\n        });\n    }\n}\n\nfunction removeNode(el: Node | undefined | null) {\n    el?.parentElement?.removeChild(el);\n}\n\nfunction removeInvalidDelimiters(nodes: Element[] | NodeListOf<Element>) {\n    nodes.forEach(node => {\n        if (!isNodeOfType(node, 'ELEMENT_NODE')) {\n            return;\n        }\n        if (isEntityDelimiter(node)) {\n            const sibling = node.classList.contains(DelimiterBefore)\n                ? node.nextElementSibling\n                : node.previousElementSibling;\n            if (!(isNodeOfType(sibling, 'ELEMENT_NODE') && isEntityElement(sibling))) {\n                removeNode(node);\n            }\n        } else {\n            removeDelimiterAttr(node);\n        }\n    });\n}\n\nfunction removeDelimiterAttr(node: Element | undefined | null, checkEntity: boolean = true) {\n    if (!node) {\n        return;\n    }\n\n    const isAfter = node.classList.contains(DelimiterAfter);\n    const entitySibling = isAfter ? node.previousElementSibling : node.nextElementSibling;\n    if (checkEntity && entitySibling && isEntityElement(entitySibling)) {\n        return;\n    }\n\n    node.classList.remove(DelimiterAfter, DelimiterBefore);\n\n    node.normalize();\n    node.childNodes.forEach(cn => {\n        const index = cn.textContent?.indexOf(ZeroWidthSpace) ?? -1;\n        if (index >= 0) {\n            const range = new Range();\n            range.setStart(cn, index);\n            range.setEnd(cn, index + 1);\n            range.deleteContents();\n        }\n    });\n}\n\nfunction getFocusedElement(\n    selection: RangeSelection,\n    existingTextInDelimiter?: string\n): HTMLElement | null {\n    const { range, isReverted } = selection;\n    let node: Node | null = isReverted ? range.startContainer : range.endContainer;\n    let offset = isReverted ? range.startOffset : range.endOffset;\n\n    while (node?.lastChild) {\n        if (offset == node.childNodes.length) {\n            node = node.lastChild;\n            offset = node.childNodes.length;\n        } else {\n            node = node.childNodes[offset];\n            offset = 0;\n        }\n    }\n\n    if (!isNodeOfType(node, 'ELEMENT_NODE')) {\n        const textToCheck = existingTextInDelimiter\n            ? ZeroWidthSpace + existingTextInDelimiter\n            : ZeroWidthSpace;\n\n        if (node.textContent != textToCheck && (node.textContent || '').length == offset) {\n            node = node.nextSibling ?? node.parentElement?.closest(DelimiterSelector) ?? null;\n        } else {\n            node = node?.parentElement?.closest(DelimiterSelector) ?? null;\n        }\n    } else {\n        node = node.childNodes.length == offset ? node : node.childNodes.item(offset);\n    }\n    if (node && !node.hasChildNodes()) {\n        node = node.nextSibling;\n    }\n    return isNodeOfType(node, 'ELEMENT_NODE') ? node : null;\n}\n\n/**\n * @internal\n */\nexport function handleDelimiterContentChangedEvent(editor: IEditor) {\n    const helper = editor.getDOMHelper();\n    removeInvalidDelimiters(helper.queryElements(DelimiterSelector));\n    addDelimitersIfNeeded(helper.queryElements(InlineEntitySelector), editor.getPendingFormat());\n}\n\n/**\n * @internal\n */\nexport function handleCompositionEndEvent(editor: IEditor, event: CompositionEndEvent) {\n    const selection = editor.getDOMSelection();\n\n    if (selection?.type == 'range' && selection.range.collapsed) {\n        const node = getFocusedElement(selection, event.rawEvent.data);\n\n        if (\n            node?.firstChild &&\n            isNodeOfType(node.firstChild, 'TEXT_NODE') &&\n            node.matches(DelimiterSelector) &&\n            node.textContent == ZeroWidthSpace + event.rawEvent.data\n        ) {\n            preventTypeInDelimiter(node, editor);\n        }\n    }\n}\n\n/**\n * @internal\n */\nexport function handleDelimiterKeyDownEvent(editor: IEditor, event: KeyDownEvent) {\n    const selection = editor.getDOMSelection();\n\n    const { rawEvent } = event;\n    if (!selection || selection.type != 'range') {\n        return;\n    }\n    const isEnter = rawEvent.key === 'Enter';\n    if (selection.range.collapsed && (isCharacterValue(rawEvent) || isEnter)) {\n        const helper = editor.getDOMHelper();\n        const node = getFocusedElement(selection);\n        if (node && isEntityDelimiter(node) && helper.isNodeInEditor(node)) {\n            const blockEntityContainer = node.closest(BlockEntityContainerSelector);\n            if (blockEntityContainer && helper.isNodeInEditor(blockEntityContainer)) {\n                const isAfter = node.classList.contains(DelimiterAfter);\n\n                if (isAfter) {\n                    selection.range.setStartAfter(blockEntityContainer);\n                } else {\n                    selection.range.setStartBefore(blockEntityContainer);\n                }\n                selection.range.collapse(true /* toStart */);\n\n                if (isEnter) {\n                    event.rawEvent.preventDefault();\n                }\n\n                editor.formatContentModel(handleKeyDownInBlockDelimiter, {\n                    selectionOverride: {\n                        type: 'range',\n                        isReverted: false,\n                        range: selection.range,\n                    },\n                });\n            } else {\n                if (isEnter) {\n                    event.rawEvent.preventDefault();\n                    editor.formatContentModel(handleEnterInlineEntity);\n                } else {\n                    editor.takeSnapshot();\n                    editor\n                        .getDocument()\n                        .defaultView?.requestAnimationFrame(() =>\n                            preventTypeInDelimiter(node, editor)\n                        );\n                }\n            }\n        }\n    }\n}\n\n/**\n * @internal Exported Only for unit test\n * @returns\n */\nexport const handleKeyDownInBlockDelimiter: ContentModelFormatter = (model, context) => {\n    iterateSelections(model, (_path, _tableContext, block) => {\n        if (block?.blockType == 'Paragraph') {\n            delete block.isImplicit;\n            const selectionMarker = block.segments.find(w => w.segmentType == 'SelectionMarker');\n            if (selectionMarker?.segmentType == 'SelectionMarker') {\n                block.segmentFormat = { ...selectionMarker.format };\n                context.newPendingFormat = { ...selectionMarker.format };\n            }\n            block.segments.unshift(createBr());\n        }\n    });\n    return true;\n};\n\n/**\n * @internal Exported Only for unit test\n * @returns\n */\nexport const handleEnterInlineEntity: ContentModelFormatter = model => {\n    let selectionBlock: ContentModelParagraph | undefined;\n    let selectionBlockParent: ContentModelBlockGroup | undefined;\n\n    iterateSelections(model, (path, _tableContext, block) => {\n        if (block?.blockType == 'Paragraph') {\n            selectionBlock = block;\n            selectionBlockParent = path[path.length - 1];\n        }\n    });\n\n    if (selectionBlock && selectionBlockParent) {\n        const selectionMarker = selectionBlock.segments.find(\n            segment => segment.segmentType == 'SelectionMarker'\n        );\n        if (selectionMarker) {\n            const markerIndex = selectionBlock.segments.indexOf(selectionMarker);\n            const segmentsAfterMarker = selectionBlock.segments.splice(markerIndex);\n\n            const newPara = createParagraph(\n                false,\n                selectionBlock.format,\n                selectionBlock.segmentFormat,\n                selectionBlock.decorator\n            );\n            newPara.segments.push(...segmentsAfterMarker);\n\n            const selectionBlockIndex = selectionBlockParent.blocks.indexOf(selectionBlock);\n            if (selectionBlockIndex >= 0) {\n                selectionBlockParent.blocks.splice(selectionBlockIndex + 1, 0, newPara);\n            }\n        }\n    }\n\n    return true;\n};\n","import type { ChangedEntity, ContentModelBlockGroup } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function findAllEntities(group: ContentModelBlockGroup, entities: ChangedEntity[]) {\n    group.blocks.forEach(block => {\n        switch (block.blockType) {\n            case 'BlockGroup':\n                findAllEntities(block, entities);\n                break;\n\n            case 'Entity':\n                entities.push({\n                    entity: block,\n                    operation: 'newEntity',\n                });\n                break;\n\n            case 'Paragraph':\n                block.segments.forEach(segment => {\n                    switch (segment.segmentType) {\n                        case 'Entity':\n                            entities.push({\n                                entity: segment,\n                                operation: 'newEntity',\n                            });\n                            break;\n\n                        case 'General':\n                            findAllEntities(segment, entities);\n                            break;\n                    }\n                });\n                break;\n\n            case 'Table':\n                block.rows.forEach(row =>\n                    row.cells.forEach(cell => findAllEntities(cell, entities))\n                );\n                break;\n        }\n    });\n}\n","import type { TextMutationObserver } from 'roosterjs-content-model-types';\n\nclass TextMutationObserverImpl implements TextMutationObserver {\n    private observer: MutationObserver;\n\n    constructor(\n        private contentDiv: HTMLDivElement,\n        private onMutation: (isTextChangeOnly: boolean) => void\n    ) {\n        this.observer = new MutationObserver(this.onMutationInternal);\n    }\n\n    startObserving() {\n        this.observer.observe(this.contentDiv, {\n            subtree: true,\n            childList: true,\n            attributes: true,\n            characterData: true,\n        });\n    }\n\n    stopObserving() {\n        this.observer.disconnect();\n    }\n\n    flushMutations() {\n        const mutations = this.observer.takeRecords();\n\n        this.onMutationInternal(mutations);\n    }\n\n    private onMutationInternal = (mutations: MutationRecord[]) => {\n        const firstTarget = mutations[0]?.target;\n\n        if (firstTarget) {\n            const isTextChangeOnly = mutations.every(\n                mutation => mutation.type == 'characterData' && mutation.target == firstTarget\n            );\n\n            this.onMutation(isTextChangeOnly);\n        }\n    };\n}\n\n/**\n * @internal\n */\nexport function createTextMutationObserver(\n    contentDiv: HTMLDivElement,\n    onMutation: (isTextChangeOnly: boolean) => void\n): TextMutationObserver {\n    return new TextMutationObserverImpl(contentDiv, onMutation);\n}\n","import { isNodeOfType, toArray } from 'roosterjs-content-model-dom';\nimport type { DOMHelper } from 'roosterjs-content-model-types';\n\nclass DOMHelperImpl implements DOMHelper {\n    constructor(private contentDiv: HTMLElement) {}\n\n    queryElements(selector: string): HTMLElement[] {\n        return toArray(this.contentDiv.querySelectorAll(selector)) as HTMLElement[];\n    }\n\n    getTextContent(): string {\n        return this.contentDiv.textContent || '';\n    }\n\n    isNodeInEditor(node: Node): boolean {\n        return this.contentDiv.contains(node);\n    }\n\n    calculateZoomScale(): number {\n        const originalWidth = this.contentDiv.getBoundingClientRect()?.width || 0;\n        const visualWidth = this.contentDiv.offsetWidth;\n\n        return visualWidth > 0 && originalWidth > 0\n            ? Math.round((originalWidth / visualWidth) * 100) / 100\n            : 1;\n    }\n\n    setDomAttribute(name: string, value: string | null) {\n        if (value === null) {\n            this.contentDiv.removeAttribute(name);\n        } else {\n            this.contentDiv.setAttribute(name, value);\n        }\n    }\n\n    getDomAttribute(name: string): string | null {\n        return this.contentDiv.getAttribute(name);\n    }\n\n    getDomStyle<T extends keyof CSSStyleDeclaration>(style: T): CSSStyleDeclaration[T] {\n        return this.contentDiv.style[style];\n    }\n\n    findClosestElementAncestor(startFrom: Node, selector?: string): HTMLElement | null {\n        const startElement = isNodeOfType(startFrom, 'ELEMENT_NODE')\n            ? startFrom\n            : startFrom.parentElement;\n        const closestElement = selector\n            ? (startElement?.closest(selector) as HTMLElement | null)\n            : startElement;\n\n        return closestElement &&\n            this.isNodeInEditor(closestElement) &&\n            closestElement != this.contentDiv\n            ? closestElement\n            : null;\n    }\n\n    hasFocus(): boolean {\n        const activeElement = this.contentDiv.ownerDocument.activeElement;\n        return !!(activeElement && this.contentDiv.contains(activeElement));\n    }\n}\n\n/**\n * @internal Create new instance of DOMHelper\n */\nexport function createDOMHelper(contentDiv: HTMLElement): DOMHelper {\n    return new DOMHelperImpl(contentDiv);\n}\n","import type {\n    DarkColorHandler,\n    ColorTransformFunction,\n    Colors,\n} from 'roosterjs-content-model-types';\n\nclass DarkColorHandlerImpl implements DarkColorHandler {\n    constructor(\n        private readonly root: HTMLElement,\n        public getDarkColor: ColorTransformFunction,\n        public readonly knownColors: Record<string, Colors>\n    ) {}\n\n    updateKnownColor(isDarkMode: boolean, key?: string, colorPair?: Colors): void {\n        if (key && colorPair) {\n            // Has values to set\n            // When in light mode: Update the value to known values, do not touch container property\n            // When in dark mode: Update the value to known colors, set value to container\n            if (!this.knownColors[key]) {\n                this.knownColors[key] = colorPair;\n            }\n\n            if (isDarkMode) {\n                this.root.style.setProperty(key, colorPair.darkModeColor);\n            }\n        } else {\n            // No value to set\n            // When in light mode: No op\n            // When in dark mode: Set all values to container, do not touch known values\n            if (isDarkMode) {\n                Object.keys(this.knownColors).forEach(key => {\n                    this.root.style.setProperty(key, this.knownColors[key].darkModeColor);\n                });\n            }\n        }\n    }\n\n    reset() {\n        Object.keys(this.knownColors).forEach(key => {\n            this.root.style.removeProperty(key);\n        });\n    }\n}\n\n/**\n * @internal\n */\nexport function createDarkColorHandler(\n    root: HTMLElement,\n    getDarkColor: ColorTransformFunction,\n    knownColors: Record<string, Colors> = {}\n): DarkColorHandler {\n    return new DarkColorHandlerImpl(root, getDarkColor, knownColors);\n}\n","import { ChangeSource } from '../constants/ChangeSource';\nimport { cloneModel } from '../publicApi/model/cloneModel';\nimport { createEditorCore } from './createEditorCore';\nimport { createEmptyModel, tableProcessor } from 'roosterjs-content-model-dom';\nimport { reducedModelChildProcessor } from '../override/reducedModelChildProcessor';\nimport { transformColor } from '../publicApi/color/transformColor';\nimport type {\n    ContentModelDocument,\n    ContentModelFormatter,\n    ContentModelSegmentFormat,\n    DarkColorHandler,\n    DOMEventRecord,\n    DOMHelper,\n    DOMSelection,\n    EditorEnvironment,\n    FormatContentModelOptions,\n    IEditor,\n    PluginEventData,\n    PluginEventFromType,\n    PluginEventType,\n    Snapshot,\n    SnapshotsManager,\n    EditorCore,\n    EditorOptions,\n    TrustedHTMLHandler,\n    Rect,\n    EntityState,\n    CachedElementHandler,\n} from 'roosterjs-content-model-types';\n\n/**\n * The main editor class based on Content Model\n */\nexport class Editor implements IEditor {\n    private core: EditorCore | null = null;\n\n    /**\n     * Creates an instance of Editor\n     * @param contentDiv The DIV HTML element which will be the container element of editor\n     * @param options An optional options object to customize the editor\n     */\n    constructor(contentDiv: HTMLDivElement, options: EditorOptions = {}) {\n        this.core = createEditorCore(contentDiv, options);\n\n        const initialModel = options.initialModel ?? createEmptyModel(options.defaultSegmentFormat);\n\n        this.core.api.setContentModel(this.core, initialModel, { ignoreSelection: true });\n        this.core.plugins.forEach(plugin => plugin.initialize(this));\n    }\n\n    /**\n     * Dispose this editor, dispose all plugins and custom data\n     */\n    dispose() {\n        const core = this.getCore();\n\n        for (let i = core.plugins.length - 1; i >= 0; i--) {\n            const plugin = core.plugins[i];\n\n            try {\n                plugin.dispose();\n            } catch (e) {\n                // Cache the error and pass it out, then keep going since dispose should always succeed\n                core.disposeErrorHandler?.(plugin, e as Error);\n            }\n        }\n\n        core.darkColorHandler.reset();\n\n        this.core = null;\n    }\n\n    /**\n     * Get whether this editor is disposed\n     * @returns True if editor is disposed, otherwise false\n     */\n    isDisposed(): boolean {\n        return !this.core;\n    }\n\n    /**\n     * Create Content Model from DOM tree in this editor\n     * @param mode What kind of Content Model we want. Currently we support the following values:\n     * - connected: Returns a connect Content Model object. \"Connected\" means if there is any entity inside editor, the returned Content Model will\n     * contain the same wrapper element for entity. This option should only be used in some special cases. In most cases we should use \"disconnected\"\n     * to get a fully disconnected Content Model so that any change to the model will not impact editor content.\n     * - disconnected: Returns a disconnected clone of Content Model from editor which you can do any change on it and it won't impact the editor content.\n     * If there is any entity in editor, the returned object will contain cloned copy of entity wrapper element.\n     * If editor is in dark mode, the cloned entity will be converted back to light mode.\n     * - reduced: Returns a reduced Content Model that only contains the model of current selection. If there is already a up-to-date cached model, use it\n     * instead to improve performance. This is mostly used for retrieve current format state.\n     * - clean: Similar with disconnected, this will return a disconnected model, the difference is \"clean\" mode will not include any selection info.\n     * This is usually used for exporting content\n     */\n    getContentModelCopy(\n        mode: 'connected' | 'disconnected' | 'reduced' | 'clean'\n    ): ContentModelDocument {\n        const core = this.getCore();\n\n        switch (mode) {\n            case 'connected':\n                return core.api.createContentModel(core, {\n                    processorOverride: {\n                        table: tableProcessor, // Use the original table processor to create Content Model with real table content but not just an entity\n                    },\n                });\n\n            case 'disconnected':\n            case 'clean':\n                return cloneModel(\n                    core.api.createContentModel(\n                        core,\n                        undefined /*option*/,\n                        mode == 'clean' ? 'none' : undefined /*selectionOverride*/\n                    ),\n                    {\n                        includeCachedElement: this.cloneOptionCallback,\n                    }\n                );\n            case 'reduced':\n                return core.api.createContentModel(core, {\n                    processorOverride: {\n                        child: reducedModelChildProcessor,\n                    },\n                });\n        }\n    }\n\n    /**\n     * Get current running environment, such as if editor is running on Mac\n     */\n    getEnvironment(): EditorEnvironment {\n        return this.getCore().environment;\n    }\n\n    /**\n     * Get current DOM selection\n     */\n    getDOMSelection(): DOMSelection | null {\n        const core = this.getCore();\n\n        return core.api.getDOMSelection(core);\n    }\n\n    /**\n     * Set DOMSelection into editor content.\n     * @param selection The selection to set\n     */\n    setDOMSelection(selection: DOMSelection | null) {\n        const core = this.getCore();\n\n        core.api.setDOMSelection(core, selection);\n    }\n\n    /**\n     * The general API to do format change with Content Model\n     * It will grab a Content Model for current editor content, and invoke a callback function\n     * to do format change. Then according to the return value, write back the modified content model into editor.\n     * If there is cached model, it will be used and updated.\n     * @param formatter Formatter function, see ContentModelFormatter\n     * @param options More options, see FormatContentModelOptions\n     */\n    formatContentModel(\n        formatter: ContentModelFormatter,\n        options?: FormatContentModelOptions\n    ): void {\n        const core = this.getCore();\n\n        core.api.formatContentModel(core, formatter, options);\n    }\n\n    /**\n     * Get pending format of editor if any, or return null\n     */\n    getPendingFormat(): ContentModelSegmentFormat | null {\n        return this.getCore().format.pendingFormat?.format ?? null;\n    }\n\n    /**\n     * Get a DOM Helper object to help access DOM tree in editor\n     */\n    getDOMHelper(): DOMHelper {\n        return this.getCore().domHelper;\n    }\n\n    /**\n     * Add a single undo snapshot to undo stack\n     * @param entityState @optional State for entity if we want to add entity state for this snapshot\n     */\n    takeSnapshot(entityState?: EntityState): Snapshot | null {\n        const core = this.getCore();\n\n        return core.api.addUndoSnapshot(\n            core,\n            false /*canUndoByBackspace*/,\n            entityState ? [entityState] : undefined\n        );\n    }\n\n    /**\n     * Restore an undo snapshot into editor\n     * @param snapshot The snapshot to restore\n     */\n    restoreSnapshot(snapshot: Snapshot): void {\n        const core = this.getCore();\n\n        core.api.restoreUndoSnapshot(core, snapshot);\n    }\n\n    /**\n     * Get document which contains this editor\n     * @returns The HTML document which contains this editor\n     */\n    getDocument(): Document {\n        return this.getCore().physicalRoot.ownerDocument;\n    }\n\n    /**\n     * Focus to this editor, the selection was restored to where it was before, no unexpected scroll.\n     */\n    focus() {\n        const core = this.getCore();\n        core.api.focus(core);\n    }\n\n    /**\n     * Check if focus is in editor now\n     * @returns true if focus is in editor, otherwise false\n     */\n    hasFocus(): boolean {\n        const core = this.getCore();\n        return core.domHelper.hasFocus();\n    }\n\n    /**\n     * Trigger an event to be dispatched to all plugins\n     * @param eventType Type of the event\n     * @param data data of the event with given type, this is the rest part of PluginEvent with the given type\n     * @param broadcast indicates if the event needs to be dispatched to all plugins\n     * True means to all, false means to allow exclusive handling from one plugin unless no one wants that\n     * @returns the event object which is really passed into plugins. Some plugin may modify the event object so\n     * the result of this function provides a chance to read the modified result\n     */\n    triggerEvent<T extends PluginEventType>(\n        eventType: T,\n        data: PluginEventData<T>,\n        broadcast: boolean = false\n    ): PluginEventFromType<T> {\n        const core = this.getCore();\n        const event = ({\n            eventType,\n            ...data,\n        } as any) as PluginEventFromType<T>;\n        core.api.triggerEvent(core, event, broadcast);\n\n        return event;\n    }\n\n    /**\n     * Attach a DOM event to the editor content DIV\n     * @param eventMap A map from event name to its handler\n     */\n    attachDomEvent(eventMap: Record<string, DOMEventRecord>): () => void {\n        const core = this.getCore();\n        return core.api.attachDomEvent(core, eventMap);\n    }\n\n    /**\n     * Get undo snapshots manager\n     */\n    getSnapshotsManager(): SnapshotsManager {\n        const core = this.getCore();\n\n        return core.undo.snapshotsManager;\n    }\n\n    /**\n     * Check if the editor is in dark mode\n     * @returns True if the editor is in dark mode, otherwise false\n     */\n    isDarkMode(): boolean {\n        return this.getCore().lifecycle.isDarkMode;\n    }\n\n    /**\n     * Set the dark mode state and transforms the content to match the new state.\n     * @param isDarkMode The next status of dark mode. True if the editor should be in dark mode, false if not.\n     */\n    setDarkModeState(isDarkMode?: boolean) {\n        const core = this.getCore();\n\n        if (!!isDarkMode != core.lifecycle.isDarkMode) {\n            transformColor(\n                core.physicalRoot,\n                false /*includeSelf*/,\n                isDarkMode ? 'lightToDark' : 'darkToLight',\n                core.darkColorHandler\n            );\n\n            core.lifecycle.isDarkMode = !!isDarkMode;\n\n            core.api.triggerEvent(\n                core,\n                {\n                    eventType: 'contentChanged',\n                    source: isDarkMode\n                        ? ChangeSource.SwitchToDarkMode\n                        : ChangeSource.SwitchToLightMode,\n                },\n                true\n            );\n        }\n    }\n\n    /**\n     * Check if editor is in Shadow Edit mode\n     */\n    isInShadowEdit() {\n        return !!this.getCore().lifecycle.shadowEditFragment;\n    }\n\n    /**\n     * Make the editor in \"Shadow Edit\" mode.\n     * In Shadow Edit mode, all format change will finally be ignored.\n     * This can be used for building a live preview feature for format button, to allow user\n     * see format result without really apply it.\n     * This function can be called repeated. If editor is already in shadow edit mode, we can still\n     * use this function to do more shadow edit operation.\n     */\n    startShadowEdit() {\n        const core = this.getCore();\n        core.api.switchShadowEdit(core, true /*isOn*/);\n    }\n\n    /**\n     * Leave \"Shadow Edit\" mode, all changes made during shadow edit will be discarded\n     */\n    stopShadowEdit() {\n        const core = this.getCore();\n        core.api.switchShadowEdit(core, false /*isOn*/);\n    }\n\n    /**\n     * Get a color manager object for this editor.\n     */\n    getColorManager(): DarkColorHandler {\n        return this.getCore().darkColorHandler;\n    }\n\n    /**\n     * Get a function to convert HTML string to trusted HTML string.\n     * By default it will just return the input HTML directly. To override this behavior,\n     * pass your own trusted HTML handler to EditorOptions.trustedHTMLHandler\n     * See https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/trusted-types\n     */\n    getTrustedHTMLHandler(): TrustedHTMLHandler {\n        return this.getCore().trustedHTMLHandler;\n    }\n\n    /**\n     * Get the scroll container of the editor\n     */\n    getScrollContainer(): HTMLElement {\n        return this.getCore().domEvent.scrollContainer;\n    }\n\n    /**\n     * Retrieves the rect of the visible viewport of the editor.\n     */\n    getVisibleViewport(): Rect | null {\n        return this.getCore().api.getVisibleViewport(this.getCore());\n    }\n\n    /**\n     * Add CSS rules for editor\n     * @param key A string to identify the CSS rule type. When set CSS rules with the same key again, existing rules with the same key will be replaced.\n     * @param cssRule The CSS rule string, must be a valid CSS rule string, or browser may throw exception. Pass null to clear existing rules\n     * @param subSelectors @optional If the rule is used for child element under editor, use this parameter to specify the child elements. Each item will be\n     * combined with root selector together to build a separate rule.\n     */\n    setEditorStyle(\n        key: string,\n        cssRule: string | null,\n        subSelectors?: 'before' | 'after' | string[]\n    ): void {\n        const core = this.getCore();\n\n        core.api.setEditorStyle(core, key, cssRule, subSelectors);\n    }\n\n    /**\n     * @returns the current EditorCore object\n     * @throws a standard Error if there's no core object\n     */\n    protected getCore(): EditorCore {\n        if (!this.core) {\n            throw new Error('Editor is already disposed');\n        }\n        return this.core;\n    }\n\n    private cloneOptionCallback: CachedElementHandler = (node, type) => {\n        if (type == 'cache') {\n            return undefined;\n        }\n\n        const result = node.cloneNode(true /*deep*/) as HTMLElement;\n\n        if (this.isDarkMode()) {\n            const colorHandler = this.getColorManager();\n\n            transformColor(result, true /*includeSelf*/, 'darkToLight', colorHandler);\n\n            result.style.color = result.style.color || 'inherit';\n            result.style.backgroundColor = result.style.backgroundColor || 'inherit';\n        }\n\n        return result;\n    };\n}\n","import type { Snapshot, Snapshots, SnapshotsManager } from 'roosterjs-content-model-types';\n\n// Max stack size that cannot be exceeded. When exceeded, old undo history will be dropped\n// to keep size under limit. This is kept at 10MB\nconst MAX_SIZE_LIMIT = 1e7;\n\nclass SnapshotsManagerImpl implements SnapshotsManager {\n    private snapshots: Snapshots;\n    private hasNewContentValue: boolean = false;\n\n    constructor(snapshots?: Snapshots) {\n        this.snapshots = snapshots ?? {\n            snapshots: [],\n            totalSize: 0,\n            currentIndex: -1,\n            autoCompleteIndex: -1,\n            maxSize: MAX_SIZE_LIMIT,\n        };\n    }\n\n    get hasNewContent(): boolean {\n        return this.hasNewContentValue;\n    }\n\n    set hasNewContent(value: boolean) {\n        this.hasNewContentValue = value;\n    }\n\n    canMove(step: number): boolean {\n        const newIndex = this.snapshots.currentIndex + step;\n        return newIndex >= 0 && newIndex < this.snapshots.snapshots.length;\n    }\n\n    move(step: number): Snapshot | null {\n        let result: Snapshot | null = null;\n\n        if (this.canMove(step)) {\n            this.snapshots.currentIndex += step;\n            this.snapshots.autoCompleteIndex = -1;\n            result = this.snapshots.snapshots[this.snapshots.currentIndex];\n        }\n\n        this.snapshots.onChanged?.('move');\n\n        return result;\n    }\n\n    addSnapshot(snapshot: Snapshot, isAutoCompleteSnapshot: boolean): void {\n        const currentSnapshot = this.snapshots.snapshots[this.snapshots.currentIndex];\n        const isSameSnapshot =\n            currentSnapshot &&\n            currentSnapshot.html == snapshot.html &&\n            !currentSnapshot.entityStates &&\n            !snapshot.entityStates;\n        const addSnapshot = !currentSnapshot || shouldAddSnapshot(currentSnapshot, snapshot);\n\n        if (this.snapshots.currentIndex < 0 || addSnapshot) {\n            this.clearRedo();\n            this.snapshots.snapshots.push(snapshot);\n            this.snapshots.currentIndex++;\n            this.snapshots.totalSize += this.getSnapshotLength(snapshot);\n\n            let removeCount = 0;\n            while (\n                removeCount < this.snapshots.snapshots.length &&\n                this.snapshots.totalSize > this.snapshots.maxSize\n            ) {\n                this.snapshots.totalSize -= this.getSnapshotLength(\n                    this.snapshots.snapshots[removeCount]\n                );\n                removeCount++;\n            }\n\n            if (removeCount > 0) {\n                this.snapshots.snapshots.splice(0, removeCount);\n                this.snapshots.currentIndex -= removeCount;\n\n                if (this.snapshots.autoCompleteIndex >= 0) {\n                    this.snapshots.autoCompleteIndex -= removeCount;\n                }\n            }\n\n            if (isAutoCompleteSnapshot) {\n                this.snapshots.autoCompleteIndex = this.snapshots.currentIndex;\n            }\n        } else if (isSameSnapshot) {\n            // replace the currentSnapshot's metadata so the selection is updated\n            this.snapshots.snapshots.splice(this.snapshots.currentIndex, 1, snapshot);\n        }\n\n        this.snapshots.onChanged?.('add');\n    }\n\n    clearRedo(): void {\n        if (this.canMove(1)) {\n            let removedSize = 0;\n            for (\n                let i = this.snapshots.currentIndex + 1;\n                i < this.snapshots.snapshots.length;\n                i++\n            ) {\n                removedSize += this.getSnapshotLength(this.snapshots.snapshots[i]);\n            }\n\n            this.snapshots.snapshots.splice(this.snapshots.currentIndex + 1);\n            this.snapshots.totalSize -= removedSize;\n            this.snapshots.autoCompleteIndex = -1;\n\n            this.snapshots.onChanged?.('clear');\n        }\n    }\n\n    canUndoAutoComplete(): boolean {\n        return (\n            this.snapshots.autoCompleteIndex >= 0 &&\n            this.snapshots.currentIndex - this.snapshots.autoCompleteIndex == 1\n        );\n    }\n\n    private getSnapshotLength(snapshot: Snapshot) {\n        return snapshot.html?.length ?? 0;\n    }\n}\n\n/**\n * @internal\n * Create a new instance of Undo Snapshots Manager\n * @param snapshots @optional Snapshots object for storing undo snapshots. If not passed, default implementation will be used\n */\nexport function createSnapshotsManager(snapshots?: Snapshots): SnapshotsManager {\n    return new SnapshotsManagerImpl(snapshots);\n}\n\nfunction shouldAddSnapshot(currentSnapshot: Snapshot, snapshot: Snapshot) {\n    return (\n        currentSnapshot.html !== snapshot.html ||\n        (currentSnapshot.entityStates &&\n            snapshot.entityStates &&\n            currentSnapshot.entityStates !== snapshot.entityStates) ||\n        (!currentSnapshot.entityStates && snapshot.entityStates)\n    );\n}\n","import { addUndoSnapshot } from '../coreApi/addUndoSnapshot';\nimport { attachDomEvent } from '../coreApi/attachDomEvent';\nimport { createContentModel } from '../coreApi/createContentModel';\nimport { createEditorContext } from '../coreApi/createEditorContext';\nimport { focus } from '../coreApi/focus';\nimport { formatContentModel } from '../coreApi/formatContentModel';\nimport { getDOMSelection } from '../coreApi/getDOMSelection';\nimport { getVisibleViewport } from '../coreApi/getVisibleViewport';\nimport { restoreUndoSnapshot } from '../coreApi/restoreUndoSnapshot';\nimport { setContentModel } from '../coreApi/setContentModel';\nimport { setDOMSelection } from '../coreApi/setDOMSelection';\nimport { setEditorStyle } from '../coreApi/setEditorStyle/setEditorStyle';\nimport { switchShadowEdit } from '../coreApi/switchShadowEdit';\nimport { triggerEvent } from '../coreApi/triggerEvent';\nimport type { CoreApiMap } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Core API map for Editor\n */\nexport const coreApiMap: CoreApiMap = {\n    createContentModel: createContentModel,\n    createEditorContext: createEditorContext,\n    formatContentModel: formatContentModel,\n    setContentModel: setContentModel,\n\n    getDOMSelection: getDOMSelection,\n    setDOMSelection: setDOMSelection,\n    focus: focus,\n\n    addUndoSnapshot: addUndoSnapshot,\n    restoreUndoSnapshot: restoreUndoSnapshot,\n\n    attachDomEvent: attachDomEvent,\n    triggerEvent: triggerEvent,\n\n    switchShadowEdit: switchShadowEdit,\n    getVisibleViewport: getVisibleViewport,\n    setEditorStyle: setEditorStyle,\n};\n","import { coreApiMap } from './coreApiMap';\nimport { createDarkColorHandler } from './DarkColorHandlerImpl';\nimport { createDOMHelper } from './DOMHelperImpl';\nimport { createDomToModelSettings, createModelToDomSettings } from './createEditorDefaultSettings';\nimport { createEditorCorePlugins } from '../corePlugin/createEditorCorePlugins';\nimport type {\n    EditorEnvironment,\n    PluginState,\n    EditorCore,\n    EditorCorePlugins,\n    EditorOptions,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal Create core object for editor\n * @param contentDiv Editor content DIV\n * @param options Editor options\n */\nexport function createEditorCore(contentDiv: HTMLDivElement, options: EditorOptions): EditorCore {\n    const corePlugins = createEditorCorePlugins(options, contentDiv);\n\n    return {\n        physicalRoot: contentDiv,\n        logicalRoot: contentDiv,\n        api: { ...coreApiMap, ...options.coreApiOverride },\n        originalApi: { ...coreApiMap },\n        plugins: [\n            corePlugins.cache,\n            corePlugins.format,\n            corePlugins.copyPaste,\n            corePlugins.domEvent,\n            corePlugins.selection,\n            corePlugins.entity,\n            ...(options.plugins ?? []).filter(x => !!x),\n            corePlugins.undo,\n            corePlugins.contextMenu,\n            corePlugins.lifecycle,\n        ],\n        environment: createEditorEnvironment(contentDiv, options),\n        darkColorHandler: createDarkColorHandler(\n            contentDiv,\n            options.getDarkColor ?? getDarkColorFallback,\n            options.knownColors\n        ),\n        trustedHTMLHandler: options.trustedHTMLHandler || defaultTrustHtmlHandler,\n        domHelper: createDOMHelper(contentDiv),\n        ...getPluginState(corePlugins),\n        disposeErrorHandler: options.disposeErrorHandler,\n    };\n}\n\nfunction createEditorEnvironment(\n    contentDiv: HTMLElement,\n    options: EditorOptions\n): EditorEnvironment {\n    const navigator = contentDiv.ownerDocument.defaultView?.navigator;\n    const userAgent = navigator?.userAgent ?? '';\n    const appVersion = navigator?.appVersion ?? '';\n\n    return {\n        domToModelSettings: createDomToModelSettings(options),\n        modelToDomSettings: createModelToDomSettings(options),\n        isMac: appVersion.indexOf('Mac') != -1,\n        isAndroid: /android/i.test(userAgent),\n        isSafari:\n            userAgent.indexOf('Safari') >= 0 &&\n            userAgent.indexOf('Chrome') < 0 &&\n            userAgent.indexOf('Android') < 0,\n        isMobileOrTablet: getIsMobileOrTablet(userAgent),\n    };\n}\n\nfunction getIsMobileOrTablet(userAgent: string) {\n    // Reference: http://detectmobilebrowsers.com/\n    // The default regex on the website doesn't consider tablet.\n    // To support tablet, add |android|ipad|playbook|silk to the first regex according to the info in /about page\n    if (\n        /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(\n            userAgent\n        ) ||\n        /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(\n            userAgent.substring(0, 4)\n        )\n    ) {\n        return true;\n    }\n    return false;\n}\n\n/**\n * @internal export for test only\n */\nexport function defaultTrustHtmlHandler(html: string) {\n    return html;\n}\n\nfunction getPluginState(corePlugins: EditorCorePlugins): PluginState {\n    return {\n        domEvent: corePlugins.domEvent.getState(),\n        copyPaste: corePlugins.copyPaste.getState(),\n        cache: corePlugins.cache.getState(),\n        format: corePlugins.format.getState(),\n        lifecycle: corePlugins.lifecycle.getState(),\n        entity: corePlugins.entity.getState(),\n        selection: corePlugins.selection.getState(),\n        contextMenu: corePlugins.contextMenu.getState(),\n        undo: corePlugins.undo.getState(),\n    };\n}\n\n/**\n * @internal Export for test only\n * A fallback function, always return original color\n */\nexport function getDarkColorFallback(color: string) {\n    return color;\n}\n","import { createDomToModelConfig, createModelToDomConfig } from 'roosterjs-content-model-dom';\nimport { listItemMetadataApplier, listLevelMetadataApplier } from '../metadata/updateListMetadata';\nimport { tablePreProcessor } from '../override/tablePreProcessor';\nimport type {\n    ContentModelSettings,\n    DomToModelOption,\n    DomToModelSettings,\n    ModelToDomOption,\n    ModelToDomSettings,\n    EditorOptions,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Create default DOM to Content Model conversion settings for an editor\n * @param options The editor options\n */\nexport function createDomToModelSettings(\n    options: EditorOptions\n): ContentModelSettings<DomToModelOption, DomToModelSettings> {\n    const builtIn: DomToModelOption = {\n        processorOverride: {\n            table: tablePreProcessor,\n        },\n    };\n    const customized: DomToModelOption = options.defaultDomToModelOptions ?? {};\n\n    return {\n        builtIn,\n        customized,\n        calculated: createDomToModelConfig([builtIn, customized]),\n    };\n}\n\n/**\n * @internal\n * Create default Content Model to DOM conversion settings for an editor\n * @param options The editor options\n */\nexport function createModelToDomSettings(\n    options: EditorOptions\n): ContentModelSettings<ModelToDomOption, ModelToDomSettings> {\n    const builtIn: ModelToDomOption = {\n        metadataAppliers: {\n            listItem: listItemMetadataApplier,\n            listLevel: listLevelMetadataApplier,\n        },\n    };\n    const customized: ModelToDomOption = options.defaultModelToDomOptions ?? {};\n\n    return {\n        builtIn,\n        customized,\n        calculated: createModelToDomConfig([builtIn, customized]),\n    };\n}\n","export { cloneModel } from './publicApi/model/cloneModel';\nexport { mergeModel } from './publicApi/model/mergeModel';\nexport { isBlockGroupOfType } from './publicApi/model/isBlockGroupOfType';\nexport { getClosestAncestorBlockGroupIndex } from './publicApi/model/getClosestAncestorBlockGroupIndex';\nexport { isBold } from './publicApi/model/isBold';\nexport { createModelFromHtml } from './publicApi/model/createModelFromHtml';\nexport { exportContent } from './publicApi/model/exportContent';\n\nexport { iterateSelections } from './publicApi/selection/iterateSelections';\nexport { getSelectionRootNode } from './publicApi/selection/getSelectionRootNode';\nexport { deleteSelection } from './publicApi/selection/deleteSelection';\nexport { deleteSegment } from './publicApi/selection/deleteSegment';\nexport { deleteBlock } from './publicApi/selection/deleteBlock';\nexport { hasSelectionInBlock } from './publicApi/selection/hasSelectionInBlock';\nexport { hasSelectionInSegment } from './publicApi/selection/hasSelectionInSegment';\nexport { hasSelectionInBlockGroup } from './publicApi/selection/hasSelectionInBlockGroup';\nexport {\n    getFirstSelectedListItem,\n    getFirstSelectedTable,\n    getOperationalBlocks,\n    getSelectedParagraphs,\n    getSelectedSegments,\n    getSelectedSegmentsAndParagraphs,\n} from './publicApi/selection/collectSelections';\nexport { setSelection } from './publicApi/selection/setSelection';\n\nexport { applyTableFormat } from './publicApi/table/applyTableFormat';\nexport { normalizeTable, MIN_ALLOWED_TABLE_CELL_WIDTH } from './publicApi/table/normalizeTable';\nexport { setTableCellBackgroundColor } from './publicApi/table/setTableCellBackgroundColor';\nexport { getSelectedCells } from './publicApi/table/getSelectedCells';\n\nexport { isCharacterValue, isModifierKey } from './publicApi/domUtils/eventUtils';\nexport { combineBorderValue, extractBorderValues } from './publicApi/domUtils/borderValues';\nexport { isPunctuation, isSpace, normalizeText } from './publicApi/domUtils/stringUtil';\nexport { parseTableCells, createTableRanges } from './publicApi/domUtils/tableCellUtils';\nexport { getSegmentTextFormat } from './publicApi/domUtils/getSegmentTextFormat';\nexport { readFile } from './publicApi/domUtils/readFile';\nexport { cacheGetEventData } from './publicApi/domUtils/cacheGetEventData';\n\nexport { undo } from './publicApi/undo/undo';\nexport { redo } from './publicApi/undo/redo';\nexport { paste } from './publicApi/paste/paste';\nexport { transformColor } from './publicApi/color/transformColor';\n\nexport { retrieveModelFormatState } from './publicApi/format/retrieveModelFormatState';\n\nexport { updateImageMetadata } from './metadata/updateImageMetadata';\nexport { updateTableCellMetadata } from './metadata/updateTableCellMetadata';\nexport { updateTableMetadata } from './metadata/updateTableMetadata';\nexport { updateListMetadata, getListStyleTypeFromString } from './metadata/updateListMetadata';\n\nexport { ChangeSource } from './constants/ChangeSource';\nexport { BulletListType } from './constants/BulletListType';\nexport { NumberingListType } from './constants/NumberingListType';\nexport { TableBorderFormat } from './constants/TableBorderFormat';\n\nexport { extractClipboardItems } from './utils/extractClipboardItems';\n\nexport { Editor } from './editor/Editor';\n","import type {\n    ArrayDefinition,\n    BooleanDefinition,\n    Definition,\n    NumberDefinition,\n    ObjectDefinition,\n    ObjectPropertyDefinition,\n    StringDefinition,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Create a number definition\n * @param isOptional Whether this property is optional\n * @param value Optional value of the number\n * @param minValue Optional minimum value\n * @param maxValue Optional maximum value\n * @param allowNull Allow the property to be null\n * @returns The number definition object\n */\nexport function createNumberDefinition(\n    isOptional?: boolean,\n    value?: number,\n    minValue?: number,\n    maxValue?: number,\n    allowNull?: boolean\n): NumberDefinition {\n    return {\n        type: 'number',\n        isOptional,\n        value,\n        maxValue,\n        minValue,\n        allowNull,\n    };\n}\n\n/**\n * @internal\n * Create a boolean definition\n * @param isOptional  Whether this property is optional\n * @param value Optional expected boolean value\n * @param allowNull Allow the property to be null\n * @returns  The boolean definition object\n */\nexport function createBooleanDefinition(\n    isOptional?: boolean,\n    value?: boolean,\n    allowNull?: boolean\n): BooleanDefinition {\n    return {\n        type: 'boolean',\n        isOptional,\n        value,\n        allowNull,\n    };\n}\n\n/**\n * @internal\n * Create a string definition\n * @param isOptional  Whether this property is optional\n * @param value Optional expected string value\n * @param allowNull Allow the property to be null\n * @returns  The string definition object\n */\nexport function createStringDefinition(\n    isOptional?: boolean,\n    value?: string,\n    allowNull?: boolean\n): StringDefinition {\n    return {\n        type: 'string',\n        isOptional,\n        value,\n        allowNull,\n    };\n}\n\n/**\n * @internal\n * Create an array definition\n * @param itemDef Definition of each item of the related array\n * @param isOptional  Whether this property is optional\n * @param allowNull Allow the property to be null\n * @returns  The array definition object\n */\nexport function createArrayDefinition<T>(\n    itemDef: Definition<T>,\n    isOptional?: boolean,\n    minLength?: number,\n    maxLength?: number,\n    allowNull?: boolean\n): ArrayDefinition<T[]> {\n    return {\n        type: 'array',\n        isOptional,\n        itemDef,\n        minLength,\n        maxLength,\n        allowNull,\n    };\n}\n\n/**\n * @internal\n * Create an object definition\n * @param propertyDef Definition of each property of the related object\n * @param isOptional  Whether this property is optional\n * @param allowNull Allow the property to be null\n * @returns  The object definition object\n */\nexport function createObjectDefinition<T extends Object>(\n    propertyDef: ObjectPropertyDefinition<T>,\n    isOptional?: boolean,\n    allowNull?: boolean\n): ObjectDefinition<T> {\n    return {\n        type: 'object',\n        isOptional,\n        propertyDef,\n        allowNull,\n    };\n}\n","import { updateMetadata } from 'roosterjs-content-model-dom';\nimport {\n    createNumberDefinition,\n    createObjectDefinition,\n    createStringDefinition,\n} from './definitionCreators';\nimport type { ContentModelImage, ImageMetadataFormat } from 'roosterjs-content-model-types';\n\nconst NumberDefinition = createNumberDefinition();\n\nconst ImageMetadataFormatDefinition = createObjectDefinition<Required<ImageMetadataFormat>>({\n    widthPx: NumberDefinition,\n    heightPx: NumberDefinition,\n    leftPercent: NumberDefinition,\n    rightPercent: NumberDefinition,\n    topPercent: NumberDefinition,\n    bottomPercent: NumberDefinition,\n    angleRad: NumberDefinition,\n    src: createStringDefinition(),\n    naturalHeight: NumberDefinition,\n    naturalWidth: NumberDefinition,\n});\n\n/**\n * Update image metadata with a callback\n * @param image The image Content Model\n * @param callback The callback function used for updating metadata\n */\nexport function updateImageMetadata(\n    image: ContentModelImage,\n    callback?: (format: ImageMetadataFormat | null) => ImageMetadataFormat | null\n): ImageMetadataFormat | null {\n    return updateMetadata(image, callback, ImageMetadataFormatDefinition);\n}\n","import { BulletListType } from '../constants/BulletListType';\nimport { getObjectKeys, updateMetadata } from 'roosterjs-content-model-dom';\nimport { NumberingListType } from '../constants/NumberingListType';\nimport {\n    createBooleanDefinition,\n    createNumberDefinition,\n    createObjectDefinition,\n} from './definitionCreators';\nimport type {\n    ContentModelListItemFormat,\n    ContentModelListItemLevelFormat,\n    ContentModelWithDataset,\n    ListMetadataFormat,\n    MetadataApplier,\n} from 'roosterjs-content-model-types';\n\nconst DefaultOrderedListStyles = ['decimal', 'lower-alpha', 'lower-roman'];\nconst DefaultUnorderedListStyles = ['disc', 'circle', 'square'];\nconst OrderedMapPlaceholderRegex = /\\$\\{(\\w+)\\}/;\nconst CharCodeOfA = 65;\nconst RomanValues: Record<string, number> = {\n    M: 1000,\n    CM: 900,\n    D: 500,\n    CD: 400,\n    C: 100,\n    XC: 90,\n    L: 50,\n    XL: 40,\n    X: 10,\n    IX: 9,\n    V: 5,\n    IV: 4,\n    I: 1,\n};\nconst OrderedMap: Record<number, string> = {\n    [NumberingListType.Decimal]: 'decimal',\n    [NumberingListType.DecimalDash]: '\"${Number}- \"',\n    [NumberingListType.DecimalParenthesis]: '\"${Number}) \"',\n    [NumberingListType.DecimalDoubleParenthesis]: '\"(${Number}) \"',\n    [NumberingListType.LowerAlpha]: 'lower-alpha',\n    [NumberingListType.LowerAlphaDash]: '\"${LowerAlpha}- \"',\n    [NumberingListType.LowerAlphaParenthesis]: '\"${LowerAlpha}) \"',\n    [NumberingListType.LowerAlphaDoubleParenthesis]: '\"(${LowerAlpha}) \"',\n    [NumberingListType.UpperAlpha]: 'upper-alpha',\n    [NumberingListType.UpperAlphaDash]: '\"${UpperAlpha}- \"',\n    [NumberingListType.UpperAlphaParenthesis]: '\"${UpperAlpha}) \"',\n    [NumberingListType.UpperAlphaDoubleParenthesis]: '\"(${UpperAlpha}) \"',\n    [NumberingListType.LowerRoman]: 'lower-roman',\n    [NumberingListType.LowerRomanDash]: '\"${LowerRoman}- \"',\n    [NumberingListType.LowerRomanParenthesis]: '\"${LowerRoman}) \"',\n    [NumberingListType.LowerRomanDoubleParenthesis]: '\"(${LowerRoman}) \"',\n    [NumberingListType.UpperRoman]: 'upper-roman',\n    [NumberingListType.UpperRomanDash]: '\"${UpperRoman}- \"',\n    [NumberingListType.UpperRomanParenthesis]: '\"${UpperRoman}) \"',\n    [NumberingListType.UpperRomanDoubleParenthesis]: '\"(${UpperRoman}) \"',\n};\nconst UnorderedMap: Record<number, string> = {\n    [BulletListType.Disc]: 'disc',\n    [BulletListType.Square]: '\" \"',\n    [BulletListType.Circle]: 'circle',\n    [BulletListType.Dash]: '\"- \"',\n    [BulletListType.LongArrow]: '\" \"',\n    [BulletListType.DoubleLongArrow]: '\" \"',\n    [BulletListType.ShortArrow]: '\" \"',\n    [BulletListType.UnfilledArrow]: '\" \"',\n    [BulletListType.Hyphen]: '\" \"',\n};\n\nfunction getOrderedListStyleValue(\n    template: string | undefined,\n    listNumber: number\n): string | undefined {\n    return template\n        ? template.replace(OrderedMapPlaceholderRegex, (_, subStr) => {\n              switch (subStr) {\n                  case 'Number':\n                      return listNumber + '';\n                  case 'LowerAlpha':\n                      return convertDecimalsToAlpha(listNumber, true /*isLowerCase*/);\n                  case 'UpperAlpha':\n                      return convertDecimalsToAlpha(listNumber, false /*isLowerCase*/);\n                  case 'LowerRoman':\n                      return convertDecimalsToRoman(listNumber, true /*isLowerCase*/);\n                  case 'UpperRoman':\n                      return convertDecimalsToRoman(listNumber, false /*isLowerCase*/);\n              }\n\n              return '';\n          })\n        : undefined;\n}\n\nfunction convertDecimalsToAlpha(decimal: number, isLowerCase?: boolean): string {\n    let alpha = '';\n    decimal--;\n\n    while (decimal >= 0) {\n        alpha = String.fromCharCode((decimal % 26) + CharCodeOfA) + alpha;\n        decimal = Math.floor(decimal / 26) - 1;\n    }\n    return isLowerCase ? alpha.toLowerCase() : alpha;\n}\n\nfunction convertDecimalsToRoman(decimal: number, isLowerCase?: boolean) {\n    let romanValue = '';\n\n    for (const i of getObjectKeys(RomanValues)) {\n        const timesRomanCharAppear = Math.floor(decimal / RomanValues[i]);\n        decimal = decimal - timesRomanCharAppear * RomanValues[i];\n        romanValue = romanValue + i.repeat(timesRomanCharAppear);\n    }\n    return isLowerCase ? romanValue.toLocaleLowerCase() : romanValue;\n}\n\nconst listMetadataDefinition = createObjectDefinition<ListMetadataFormat>(\n    {\n        orderedStyleType: createNumberDefinition(\n            true /** isOptional */,\n            undefined /** value **/,\n            NumberingListType.Min,\n            NumberingListType.Max\n        ),\n        unorderedStyleType: createNumberDefinition(\n            true /** isOptional */,\n            undefined /** value **/,\n            BulletListType.Min,\n            BulletListType.Max\n        ),\n        applyListStyleFromLevel: createBooleanDefinition(true /*isOptional*/),\n    },\n    true /** isOptional */,\n    true /** allowNull */\n);\n\nfunction shouldApplyToItem(listStyleType: string) {\n    return listStyleType.indexOf('\"') >= 0;\n}\n\nfunction getRawListStyleType(listType: 'OL' | 'UL', metadata: ListMetadataFormat, depth: number) {\n    const { orderedStyleType, unorderedStyleType, applyListStyleFromLevel } = metadata;\n    if (listType == 'OL') {\n        return typeof orderedStyleType == 'number'\n            ? OrderedMap[orderedStyleType]\n            : applyListStyleFromLevel\n            ? DefaultOrderedListStyles[depth % DefaultOrderedListStyles.length]\n            : undefined;\n    } else {\n        return typeof unorderedStyleType == 'number'\n            ? UnorderedMap[unorderedStyleType]\n            : applyListStyleFromLevel\n            ? DefaultUnorderedListStyles[depth % DefaultUnorderedListStyles.length]\n            : undefined;\n    }\n}\n\n/**\n * Gets the list style type that the bullet is part of, using the Constant record\n * @param listType whether the list is ordered or unordered\n * @param bullet bullet string\n * @returns the number of the style override or undefined if was not found in the Record\n */\nexport function getListStyleTypeFromString(listType: 'OL' | 'UL', bullet: string) {\n    const map = listType == 'OL' ? OrderedMap : UnorderedMap;\n    const keys = getObjectKeys(map);\n    const result = keys.find(key => map[key] == bullet);\n    if (result) {\n        return typeof result == 'string' ? parseInt(result) : result;\n    }\n    return result;\n}\n\n/**\n * @internal\n */\nexport const listItemMetadataApplier: MetadataApplier<\n    ListMetadataFormat,\n    ContentModelListItemFormat\n> = {\n    metadataDefinition: listMetadataDefinition,\n    applierFunction: (metadata, format, context) => {\n        const depth = context.listFormat.nodeStack.length - 2; // Minus two for the parent element and convert length to index\n\n        if (depth >= 0) {\n            const listType = context.listFormat.nodeStack[depth + 1].listType ?? 'OL';\n            const listStyleType = getRawListStyleType(listType, metadata ?? {}, depth);\n\n            if (listStyleType) {\n                if (shouldApplyToItem(listStyleType)) {\n                    format.listStyleType =\n                        listType == 'OL'\n                            ? getOrderedListStyleValue(\n                                  listStyleType,\n                                  context.listFormat.threadItemCounts[depth]\n                              )\n                            : listStyleType;\n                } else {\n                    delete format.listStyleType;\n                }\n            }\n        }\n    },\n};\n\n/**\n * @internal\n */\nexport const listLevelMetadataApplier: MetadataApplier<\n    ListMetadataFormat,\n    ContentModelListItemLevelFormat\n> = {\n    metadataDefinition: listMetadataDefinition,\n    applierFunction: (metadata, format, context) => {\n        const depth = context.listFormat.nodeStack.length - 2; // Minus two for the parent element and convert length to index\n\n        if (depth >= 0) {\n            const listType = context.listFormat.nodeStack[depth + 1].listType ?? 'OL';\n            const listStyleType = getRawListStyleType(listType, metadata ?? {}, depth);\n\n            if (listStyleType) {\n                if (!shouldApplyToItem(listStyleType)) {\n                    format.listStyleType = listStyleType;\n                } else {\n                    delete format.listStyleType;\n                }\n            }\n        }\n    },\n};\n\n/**\n * Update list metadata with a callback\n * @param list The list Content Model (metadata holder)\n * @param callback The callback function used for updating metadata\n */\nexport function updateListMetadata(\n    list: ContentModelWithDataset<ListMetadataFormat>,\n    callback?: (format: ListMetadataFormat | null) => ListMetadataFormat | null\n): ListMetadataFormat | null {\n    return updateMetadata(list, callback, listMetadataDefinition);\n}\n","import { createBooleanDefinition, createObjectDefinition } from './definitionCreators';\nimport { updateMetadata } from 'roosterjs-content-model-dom';\nimport type { ContentModelTableCell, TableCellMetadataFormat } from 'roosterjs-content-model-types';\n\nconst TableCellMetadataFormatDefinition = createObjectDefinition<Required<TableCellMetadataFormat>>(\n    {\n        bgColorOverride: createBooleanDefinition(true /** isOptional */),\n        vAlignOverride: createBooleanDefinition(true /** isOptional */),\n        borderOverride: createBooleanDefinition(true /** isOptional */),\n    },\n    false /* isOptional */,\n    true /** allowNull */\n);\n\n/**\n * Update table cell metadata with a callback\n * @param cell The table cell Content Model\n * @param callback The callback function used for updating metadata\n */\nexport function updateTableCellMetadata(\n    cell: ContentModelTableCell,\n    callback?: (format: TableCellMetadataFormat | null) => TableCellMetadataFormat | null\n): TableCellMetadataFormat | null {\n    return updateMetadata(cell, callback, TableCellMetadataFormatDefinition);\n}\n","import { TableBorderFormat } from '../constants/TableBorderFormat';\nimport { updateMetadata } from 'roosterjs-content-model-dom';\nimport {\n    createBooleanDefinition,\n    createNumberDefinition,\n    createObjectDefinition,\n    createStringDefinition,\n} from './definitionCreators';\nimport type { ContentModelTable, TableMetadataFormat } from 'roosterjs-content-model-types';\n\nconst NullStringDefinition = createStringDefinition(\n    false /** isOptional */,\n    undefined /** value */,\n    true /** allowNull */\n);\n\nconst BooleanDefinition = createBooleanDefinition(false /** isOptional */);\n\nconst TableFormatDefinition = createObjectDefinition<Required<TableMetadataFormat>>(\n    {\n        topBorderColor: NullStringDefinition,\n        bottomBorderColor: NullStringDefinition,\n        verticalBorderColor: NullStringDefinition,\n        hasHeaderRow: BooleanDefinition,\n        headerRowColor: NullStringDefinition,\n        hasFirstColumn: BooleanDefinition,\n        hasBandedColumns: BooleanDefinition,\n        hasBandedRows: BooleanDefinition,\n        bgColorEven: NullStringDefinition,\n        bgColorOdd: NullStringDefinition,\n        tableBorderFormat: createNumberDefinition(\n            false /** isOptional */,\n            undefined /* value */,\n            TableBorderFormat.Min /* first table border format */,\n            TableBorderFormat.Max /* last table border format */\n        ),\n        verticalAlign: NullStringDefinition,\n    },\n    false /* isOptional */,\n    true /** allowNull */\n);\n\n/**\n * Update table metadata with a callback\n * @param table The table Content Model\n * @param callback The callback function used for updating metadata\n */\nexport function updateTableMetadata(\n    table: ContentModelTable,\n    callback?: (format: TableMetadataFormat | null) => TableMetadataFormat | null\n): TableMetadataFormat | null {\n    return updateMetadata(table, callback, TableFormatDefinition);\n}\n","import { deleteBlock } from '../../publicApi/selection/deleteBlock';\nimport { deleteSegment } from '../../publicApi/selection/deleteSegment';\nimport { getSegmentTextFormat } from '../../publicApi/domUtils/getSegmentTextFormat';\nimport { iterateSelections } from '../../publicApi/selection/iterateSelections';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelParagraph,\n    ContentModelSelectionMarker,\n    DeleteSelectionContext,\n    FormatContentModelContext,\n    InsertPoint,\n    IterateSelectionsOption,\n    TableSelectionContext,\n} from 'roosterjs-content-model-types';\nimport {\n    createBr,\n    createParagraph,\n    createSelectionMarker,\n    setParagraphNotImplicit,\n} from 'roosterjs-content-model-dom';\n\nconst DeleteSelectionIteratingOptions: IterateSelectionsOption = {\n    contentUnderSelectedTableCell: 'ignoreForTableOrCell', // When a table cell is selected, we replace all content for this cell, so no need to go into its content\n    contentUnderSelectedGeneralElement: 'generalElementOnly', // When a general element is selected, we replace the whole element so no need to go into its content\n    includeListFormatHolder: 'never',\n};\n\n/**\n * @internal\n * Iterate the model and find all selected content if any, delete them, and keep/create an insert point\n * at the first deleted position so that we know where to put cursor to after delete\n */\nexport function deleteExpandedSelection(\n    model: ContentModelDocument,\n    formatContext?: FormatContentModelContext\n): DeleteSelectionContext {\n    const context: DeleteSelectionContext = {\n        deleteResult: 'notDeleted',\n        insertPoint: null,\n        formatContext,\n    };\n\n    iterateSelections(\n        model,\n        (path, tableContext, block, segments) => {\n            // Set paragraph, format and index for default position where we will put cursor to.\n            // Later we can overwrite these info when process the selections\n            let paragraph = createParagraph(\n                true /*implicit*/,\n                undefined /*blockFormat*/,\n                model.format\n            );\n            let markerFormat = model.format;\n            let insertMarkerIndex = 0;\n\n            if (segments) {\n                // Delete segments inside a paragraph\n                if (segments[0] && block?.blockType == 'Paragraph') {\n                    // Now that we have found a paragraph with selections, we can overwrite the default paragraph with this one\n                    // so we can put cursor here after delete\n                    paragraph = block;\n                    insertMarkerIndex = paragraph.segments.indexOf(segments[0]);\n                    markerFormat = getSegmentTextFormat(segments[0]);\n\n                    context.lastParagraph = paragraph;\n                    context.lastTableContext = tableContext;\n\n                    segments.forEach((segment, i) => {\n                        if (\n                            i == 0 &&\n                            !context.insertPoint &&\n                            segment.segmentType == 'SelectionMarker'\n                        ) {\n                            // First time we hit a selection and it is a selection marker, just mark it and not need to delete\n                            // because this is possible a collapsed selection, then it will be handled later\n                            context.insertPoint = createInsertPoint(\n                                segment,\n                                block,\n                                path,\n                                tableContext\n                            );\n                        } else if (deleteSegment(block, segment, context.formatContext)) {\n                            context.deleteResult = 'range';\n                        }\n                    });\n\n                    // Since we are operating on this paragraph and it possible we delete everything from this paragraph,\n                    // Need to make it \"not implicit\" so that it will always have a container element, so that when we do normalization\n                    // of this paragraph, a BR can be added if need\n                    if (context.deleteResult == 'range') {\n                        setParagraphNotImplicit(block);\n                    }\n                }\n            } else if (block) {\n                // Delete a whole block (divider, table, ...)\n                const blocks = path[0].blocks;\n\n                if (deleteBlock(blocks, block, paragraph, context.formatContext)) {\n                    context.deleteResult = 'range';\n                }\n            } else if (tableContext) {\n                // Delete a whole table cell\n                const { table, colIndex, rowIndex } = tableContext;\n                const row = table.rows[rowIndex];\n                const cell = row.cells[colIndex];\n\n                path = [cell, ...path];\n                paragraph.segments.push(createBr(model.format));\n                cell.blocks = [paragraph];\n\n                delete cell.cachedElement;\n                delete row.cachedElement;\n                context.deleteResult = 'range';\n            }\n\n            if (!context.insertPoint) {\n                // If we have not got a insert point after delete and we have a paragraph to put an insert point in, create insert point now\n                const marker = createSelectionMarker(markerFormat);\n\n                setParagraphNotImplicit(paragraph);\n                paragraph.segments.splice(insertMarkerIndex, 0, marker);\n                context.insertPoint = createInsertPoint(marker, paragraph, path, tableContext);\n            }\n        },\n        DeleteSelectionIteratingOptions\n    );\n\n    return context;\n}\n\nfunction createInsertPoint(\n    marker: ContentModelSelectionMarker,\n    paragraph: ContentModelParagraph,\n    path: ContentModelBlockGroup[],\n    tableContext: TableSelectionContext | undefined\n): InsertPoint {\n    return {\n        marker,\n        paragraph,\n        path,\n        tableContext,\n    };\n}\n","/**\n * @internal\n */\nexport function deleteSingleChar(text: string, isForward: boolean) {\n    // In case of emoji that occupies multiple characters, we need to delete the whole emoji\n    const array = [...text];\n    let deleteLength = 0;\n\n    for (\n        let i = isForward ? 0 : array.length - 1,\n            deleteState: 'notDeleted' | 'waiting' | 'done' = 'notDeleted';\n        i >= 0 && i < array.length && deleteState != 'done';\n        i += isForward ? 1 : -1\n    ) {\n        switch (array[i]) {\n            case '\\u200D': // ZERO WIDTH JOINER\n            case '\\u20E3': // COMBINING ENCLOSING KEYCAP\n            case '\\uFE0E': // VARIATION SELECTOR-15\n            case '\\uFE0F': // VARIATION SELECTOR-16\n                deleteState = 'notDeleted';\n                deleteLength++;\n                break;\n\n            default:\n                if (deleteState == 'notDeleted') {\n                    deleteState = 'waiting';\n                    deleteLength++;\n                } else if (deleteState == 'waiting') {\n                    deleteState = 'done';\n                }\n                break;\n        }\n    }\n\n    array.splice(isForward ? 0 : array.length - deleteLength, deleteLength);\n\n    return array.join('');\n}\n","import type { FormatParser, SizeFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal Do not paste width for Format Containers since it may be generated by browser according to temp div width\n */\nexport const containerSizeFormatParser: FormatParser<SizeFormat> = (format, element) => {\n    // For pasted content, there may be existing width generated by browser from the temp DIV. So we need to remove it.\n    if (element.tagName == 'DIV') {\n        delete format.width;\n        delete format.height;\n    }\n};\n","import { isBlockElement, isElementOfType, isNodeOfType } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelEntity,\n    EntityInfoFormat,\n    FormatParser,\n    OnNodeCreated,\n} from 'roosterjs-content-model-types';\n\nconst BlockEntityClass = '_EBlock';\nconst OneHundredPercent = '100%';\nconst InlineBlock = 'inline-block';\n\n/**\n * @internal\n */\nexport const onCreateCopyEntityNode: OnNodeCreated = (model, node) => {\n    const entityModel = model as ContentModelEntity;\n    if (\n        entityModel &&\n        entityModel.wrapper &&\n        entityModel.blockType == 'Entity' &&\n        isNodeOfType(node, 'ELEMENT_NODE') &&\n        isElementOfType(node, 'div') &&\n        !isBlockElement(entityModel.wrapper) &&\n        entityModel.wrapper.style.display == InlineBlock &&\n        entityModel.wrapper.style.width == OneHundredPercent\n    ) {\n        node.classList.add(BlockEntityClass);\n        node.style.display = 'block';\n        node.style.width = '';\n    }\n};\n\n/**\n * @internal\n */\nexport const pasteBlockEntityParser: FormatParser<EntityInfoFormat> = (_, element) => {\n    if (element.classList.contains(BlockEntityClass)) {\n        element.classList.remove(BlockEntityClass);\n        element.style.display = InlineBlock;\n        element.style.width = OneHundredPercent;\n    }\n};\n","import type { DisplayFormat, FormatParser } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const pasteDisplayFormatParser: FormatParser<DisplayFormat> = (format, element) => {\n    const display = element.style.display;\n\n    if (display && display != 'flex') {\n        format.display = display;\n    }\n};\n","import { AllowedTags, DisallowedTags, sanitizeElement } from '../utils/sanitizeElement';\nimport type {\n    DomToModelOptionForSanitizing,\n    ElementProcessor,\n    ValueSanitizer,\n} from 'roosterjs-content-model-types';\n\nconst DefaultStyleSanitizers: Readonly<Record<string, ValueSanitizer>> = {\n    position: false,\n};\n\n/**\n * @internal\n */\nexport function createPasteEntityProcessor(\n    options: DomToModelOptionForSanitizing\n): ElementProcessor<HTMLElement> {\n    const allowedTags = AllowedTags.concat(options.additionalAllowedTags);\n    const disallowedTags = DisallowedTags.concat(options.additionalDisallowedTags);\n    const styleSanitizers = Object.assign({}, DefaultStyleSanitizers, options.styleSanitizers);\n    const attrSanitizers = options.attributeSanitizers;\n\n    return (group, element, context) => {\n        const sanitizedElement = sanitizeElement(\n            element,\n            allowedTags,\n            disallowedTags,\n            styleSanitizers,\n            attrSanitizers\n        );\n\n        if (sanitizedElement) {\n            context.defaultElementProcessors.entity(group, sanitizedElement, context);\n        }\n    };\n}\n","import { AllowedTags, createSanitizedElement, DisallowedTags } from '../utils/sanitizeElement';\nimport { moveChildNodes } from 'roosterjs-content-model-dom';\nimport type {\n    DomToModelOptionForSanitizing,\n    ElementProcessor,\n    ValueSanitizer,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal Export for test only\n */\nexport const removeDisplayFlex: ValueSanitizer = value => {\n    return value == 'flex' ? null : value;\n};\n\nconst DefaultStyleSanitizers: Readonly<Record<string, ValueSanitizer>> = {\n    position: false,\n    display: removeDisplayFlex,\n};\n\n/**\n * @internal\n */\nexport function createPasteGeneralProcessor(\n    options: DomToModelOptionForSanitizing\n): ElementProcessor<HTMLElement> {\n    const allowedTags = AllowedTags.concat(options.additionalAllowedTags);\n    const disallowedTags = DisallowedTags.concat(options.additionalDisallowedTags);\n    const styleSanitizers = Object.assign({}, DefaultStyleSanitizers, options.styleSanitizers);\n    const attrSanitizers = options.attributeSanitizers;\n\n    return (group, element, context) => {\n        const tag = element.tagName.toLowerCase();\n        const processor: ElementProcessor<HTMLElement> | undefined =\n            allowedTags.indexOf(tag) >= 0\n                ? (group, element, context) => {\n                      const sanitizedElement = createSanitizedElement(\n                          element.ownerDocument,\n                          element.tagName,\n                          element.attributes,\n                          styleSanitizers,\n                          attrSanitizers\n                      );\n\n                      moveChildNodes(sanitizedElement, element);\n                      context.defaultElementProcessors['*']?.(group, sanitizedElement, context);\n                  }\n                : disallowedTags.indexOf(tag) >= 0\n                ? undefined // Ignore those disallowed tags\n                : context.defaultElementProcessors.span; // For other unknown tags, treat them as SPAN\n\n        processor?.(group, element, context);\n    };\n}\n","import { isWhiteSpacePreserved } from 'roosterjs-content-model-dom';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const pasteTextProcessor: ElementProcessor<Text> = (group, text, context) => {\n    const whiteSpace = context.blockFormat.whiteSpace;\n\n    if (isWhiteSpacePreserved(whiteSpace)) {\n        text.nodeValue = text.nodeValue?.replace(/\\u0020\\u0020/g, '\\u0020\\u00A0') ?? '';\n    }\n\n    context.defaultElementProcessors['#text'](group, text, context);\n};\n","import { getSelectionRootNode } from '../publicApi/selection/getSelectionRootNode';\nimport {\n    getRegularSelectionOffsets,\n    handleRegularSelection,\n    isNodeOfType,\n    processChildNode,\n} from 'roosterjs-content-model-dom';\nimport type { ContentModelBlockGroup, DomToModelContext } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\ninterface FormatStateContext extends DomToModelContext {\n    /**\n     * An optional stack of parent elements to process. When provided, the child nodes of current parent element will be ignored,\n     * but use the top element in this stack instead in childProcessor.\n     */\n    nodeStack?: Node[];\n}\n\n/**\n * @internal\n * Export for test only\n * In order to get format, we can still use the regular child processor. However, to improve performance, we don't need to create\n * content model for the whole doc, instead we only need to traverse the tree path that can arrive current selected node.\n * This \"reduced\" child processor will first create a node stack that stores DOM node from root to current common ancestor node of selection,\n * then use this stack as a faked DOM tree to create a reduced content model which we can use to retrieve format state\n */\nexport function reducedModelChildProcessor(\n    group: ContentModelBlockGroup,\n    parent: ParentNode,\n    context: FormatStateContext\n) {\n    if (!context.nodeStack) {\n        const selectionRootNode = getSelectionRootNode(context.selection);\n        context.nodeStack = selectionRootNode ? createNodeStack(parent, selectionRootNode) : [];\n    }\n\n    const stackChild = context.nodeStack.pop();\n\n    if (stackChild) {\n        const [nodeStartOffset, nodeEndOffset] = getRegularSelectionOffsets(context, parent);\n\n        // If selection is not on this node, skip getting node index to save some time since we don't need it here\n        const index =\n            nodeStartOffset >= 0 || nodeEndOffset >= 0 ? getChildIndex(parent, stackChild) : -1;\n\n        if (index >= 0) {\n            handleRegularSelection(index, context, group, nodeStartOffset, nodeEndOffset);\n        }\n\n        processChildNode(group, stackChild, context);\n\n        if (index >= 0) {\n            handleRegularSelection(index + 1, context, group, nodeStartOffset, nodeEndOffset);\n        }\n    } else {\n        // No child node from node stack, that means we have reached the deepest node of selection.\n        // Now we can use default child processor to perform full sub tree scanning for content model,\n        // So that all selected node will be included.\n        context.defaultElementProcessors.child(group, parent, context);\n    }\n}\n\nfunction createNodeStack(root: Node, startNode: Node): Node[] {\n    const result: Node[] = [];\n    let node: Node | null = startNode;\n\n    while (node && root != node && root.contains(node)) {\n        if (isNodeOfType(node, 'ELEMENT_NODE') && node.tagName == 'TABLE') {\n            // For table, we can't do a reduced model creation since we need to handle their cells and indexes,\n            // so clean up whatever we already have, and just put table into the stack\n            result.splice(0, result.length, node);\n        } else {\n            result.push(node);\n        }\n\n        node = node.parentNode;\n    }\n\n    return result;\n}\n\nfunction getChildIndex(parent: ParentNode, stackChild: Node) {\n    let index = 0;\n    let child = parent.firstChild;\n\n    while (child && child != stackChild) {\n        index++;\n        child = child.nextSibling;\n    }\n    return index;\n}\n","import { entityProcessor, hasMetadata, tableProcessor } from 'roosterjs-content-model-dom';\nimport { getSelectionRootNode } from '../publicApi/selection/getSelectionRootNode';\nimport type { DomToModelContext, ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const tablePreProcessor: ElementProcessor<HTMLTableElement> = (group, element, context) => {\n    const processor = shouldUseTableProcessor(element, context) ? tableProcessor : entityProcessor;\n\n    processor(group, element, context);\n};\n\nfunction shouldUseTableProcessor(element: HTMLTableElement, context: DomToModelContext) {\n    const selectionRoot = getSelectionRootNode(context.selection);\n    // Treat table as a real table when:\n    // 1. It is a roosterjs table (has metadata)\n    // 2. Table is in selection\n    // 3. There is selection inside table (or whole table is selected)\n    // Otherwise, we treat the table as entity so we will not change it when write back\n    return (\n        hasMetadata(element) ||\n        context.isInSelection ||\n        (selectionRoot && element.contains(selectionRoot))\n    );\n}\n","import { getColor, setColor } from 'roosterjs-content-model-dom';\nimport type { DarkColorHandler } from 'roosterjs-content-model-types';\n\n/**\n * Edit and transform color of elements between light mode and dark mode\n * @param rootNode The root DOM node to transform\n * @param includeSelf True to transform the root node as well, otherwise false\n * @param direction To specify the transform direction, light to dark, or dark to light\n * @param darkColorHandler The dark color handler object to help do color transformation\n */\nexport function transformColor(\n    rootNode: Node,\n    includeSelf: boolean,\n    direction: 'lightToDark' | 'darkToLight',\n    darkColorHandler?: DarkColorHandler\n) {\n    const toDarkMode = direction == 'lightToDark';\n    const transformer = (element: HTMLElement) => {\n        const textColor = getColor(element, false /*isBackground*/, !toDarkMode, darkColorHandler);\n        const backColor = getColor(element, true /*isBackground*/, !toDarkMode, darkColorHandler);\n\n        setColor(element, textColor, false /*isBackground*/, toDarkMode, darkColorHandler);\n        setColor(element, backColor, true /*isBackground*/, toDarkMode, darkColorHandler);\n    };\n\n    iterateElements(rootNode, transformer, includeSelf);\n}\n\nfunction iterateElements(\n    root: Node,\n    transformer: (element: HTMLElement) => void,\n    includeSelf?: boolean\n) {\n    if (includeSelf && isHTMLElement(root)) {\n        transformer(root);\n    }\n\n    for (let child = root.firstChild; child; child = child.nextSibling) {\n        if (isHTMLElement(child)) {\n            transformer(child);\n        }\n\n        iterateElements(child, transformer);\n    }\n}\n\n// This is not a strict check, we just need to make sure this element has style so that we can set style to it\n// We don't use safeInstanceOf() here since this function will be called very frequently when extract html content\n// in dark mode, so we need to make sure this check is fast enough\nfunction isHTMLElement(node: Node): node is HTMLElement {\n    const htmlElement = <HTMLElement>node;\n    return node.nodeType == Node.ELEMENT_NODE && !!htmlElement.style;\n}\n","import type { Border } from 'roosterjs-content-model-types';\n\nconst BorderStyles = [\n    'none',\n    'hidden',\n    'dotted',\n    'dashed',\n    'solid',\n    'double',\n    'groove',\n    'ridge',\n    'inset',\n    'outset',\n];\nconst BorderSizeRegex = /^(thin|medium|thick|[\\d\\.]+\\w*)$/;\n\n/**\n * Extract an integrated border string with border width, style, color to value tuple\n * @param combinedBorder The integrated border style string\n * @returns An array with the splitted values\n */\nexport function extractBorderValues(combinedBorder?: string): Border {\n    const result: Border = {};\n    const values = (combinedBorder || '').replace(/, /g, ',').split(' ');\n\n    values.forEach(v => {\n        if (BorderStyles.indexOf(v) >= 0 && !result.style) {\n            result.style = v;\n        } else if (BorderSizeRegex.test(v) && !result.width) {\n            result.width = v;\n        } else if (v && !result.color) {\n            result.color = v;\n        }\n    });\n\n    return result;\n}\n\n/**\n * Combine border value array back to string\n * @param values Input string values\n * @param initialValue Initial value for those items without valid value\n */\nexport function combineBorderValue(value: Border): string {\n    return [value.width || '', value.style || '', value.color || ''].join(' ').trim() || 'none';\n}\n","import type { PluginEvent } from 'roosterjs-content-model-types';\n\n/**\n * Gets the cached event data by cache key from event object if there is already one.\n * Otherwise, call getter function to create one, and cache it.\n * @param event The event object\n * @param key Cache key string, need to be unique\n * @param getter Getter function to get the object when it is not in cache yet\n */\nexport function cacheGetEventData<T, E extends PluginEvent>(\n    event: E,\n    key: string,\n    getter: (event: E) => T\n): T {\n    const result =\n        event.eventDataCache && event.eventDataCache.hasOwnProperty(key)\n            ? <T>event.eventDataCache[key]\n            : getter(event);\n    event.eventDataCache = event.eventDataCache || {};\n    event.eventDataCache[key] = result;\n\n    return result;\n}\n","const CTRL_CHAR_CODE = 'Control';\nconst ALT_CHAR_CODE = 'Alt';\nconst META_CHAR_CODE = 'Meta';\n\nconst CursorMovingKeys = new Set<string>([\n    'ArrowUp',\n    'ArrowDown',\n    'ArrowLeft',\n    'ArrowRight',\n    'Home',\n    'End',\n    'PageUp',\n    'PageDown',\n]);\n\n/**\n * Returns true when the event was fired from a modifier key, otherwise false\n * @param event The keyboard event object\n */\nexport function isModifierKey(event: KeyboardEvent): boolean {\n    const isCtrlKey = event.ctrlKey || event.key === CTRL_CHAR_CODE;\n    const isAltKey = event.altKey || event.key === ALT_CHAR_CODE;\n    const isMetaKey = event.metaKey || event.key === META_CHAR_CODE;\n\n    return isCtrlKey || isAltKey || isMetaKey;\n}\n\n/**\n * Returns true when the event was fired from a key that produces a character value, otherwise false\n * This detection is not 100% accurate. event.key is not fully supported by all browsers, and in some browsers (e.g. IE),\n * event.key is longer than 1 for num pad input. But here we just want to improve performance as much as possible.\n * So if we missed some case here it is still acceptable.\n * @param event The keyboard event object\n */\nexport function isCharacterValue(event: KeyboardEvent): boolean {\n    return !isModifierKey(event) && !!event.key && event.key.length == 1;\n}\n\n/**\n * @internal\n * Returns true if the given event is a cursor moving event (Left, Right, Up, Down, Home, End, Page Up, Page Down).\n * This does not check modifier keys (Ctrl, Alt, Meta). So if there are modifier keys pressed, it can still return true if one of the modifier key is pressed\n * @param event The keyboard event to check\n */\nexport function isCursorMovingKey(event: KeyboardEvent): boolean {\n    return CursorMovingKeys.has(event.key);\n}\n","import type { ContentModelSegment, ContentModelSegmentFormat } from 'roosterjs-content-model-types';\n\n/**\n * Get the text format of a segment, this function will return only format that is applicable to text\n * @param segment The segment to get format from\n * @returns\n */\nexport function getSegmentTextFormat(segment: ContentModelSegment): ContentModelSegmentFormat {\n    const { fontFamily, fontSize, textColor, backgroundColor, letterSpacing, lineHeight } =\n        segment?.format ?? {};\n\n    const textFormat: ContentModelSegmentFormat = {\n        fontFamily,\n        fontSize,\n        textColor,\n        backgroundColor,\n        letterSpacing,\n        lineHeight,\n    };\n\n    return removeUndefinedValues(textFormat);\n}\n\nconst removeUndefinedValues = (format: ContentModelSegmentFormat): ContentModelSegmentFormat => {\n    const textFormat: Record<string, string | undefined | boolean> = {};\n    Object.keys(format).filter(key => {\n        const value = format[key as keyof ContentModelSegmentFormat];\n        if (value !== undefined) {\n            textFormat[key] = value;\n        }\n    });\n    return textFormat;\n};\n","/**\n * Read a file object and invoke a callback function with the data url of this file\n * @param file The file to read\n * @param callback the callback to invoke with data url of the file.\n * If fail to read, dataUrl will be null\n */\nexport function readFile(file: File, callback: (dataUrl: string | null) => void) {\n    if (file) {\n        const reader = new FileReader();\n        reader.onload = () => {\n            callback(reader.result as string);\n        };\n        reader.onerror = () => {\n            callback(null);\n        };\n        reader.readAsDataURL(file);\n    }\n}\n","const SPACES_REGEX = /[\\u2000\\u2009\\u200a\\u200b\\u202f\\u205f\\u3000\\s\\t\\r\\n]/gm;\nconst PUNCTUATIONS = '.,?!:\"()[]\\\\/';\n\n/**\n * Check if the given character is punctuation\n * @param char The character to check\n */\nexport function isPunctuation(char: string) {\n    return PUNCTUATIONS.indexOf(char) >= 0;\n}\n\n/**\n * Check if the give character is a space. A space can be normal ASCII pace (32) or non-break space (160) or other kinds of spaces\n * such as ZeroWidthSpace, ...\n * @param char The character to check\n */\nexport function isSpace(char: string) {\n    const code = char?.charCodeAt(0) ?? 0;\n    return code == 160 || code == 32 || SPACES_REGEX.test(char);\n}\n\n/**\n * Normalize spaces of the given string. After normalization, all leading (for forward) or trailing (for backward) spaces\n * will be replaces with non-break space (160)\n * @param txt The string to normalize\n * @param isForward Whether normalize forward or backward\n */\nexport function normalizeText(txt: string, isForward: boolean): string {\n    return txt.replace(isForward ? /^\\u0020+/ : /\\u0020+$/, '\\u00A0');\n}\n","import { toArray } from 'roosterjs-content-model-dom';\nimport type { TableSelection } from 'roosterjs-content-model-types';\n\n/**\n * Parse a table into a two dimensions array of TD elements. For those merged cells, the value will be null.\n * @param table Input HTML Table element\n * @returns Array of TD elements\n */\nexport function parseTableCells(table: HTMLTableElement): (HTMLTableCellElement | null)[][] {\n    const trs = toArray(table.rows);\n    const cells: (HTMLTableCellElement | null)[][] = trs.map(row => []);\n\n    trs.forEach((tr, rowIndex) => {\n        for (let sourceCol = 0, targetCol = 0; sourceCol < tr.cells.length; sourceCol++) {\n            // Skip the cells which already initialized\n            for (; cells[rowIndex][targetCol] !== undefined; targetCol++) {}\n\n            const td = tr.cells[sourceCol];\n\n            for (let colSpan = 0; colSpan < td.colSpan; colSpan++, targetCol++) {\n                for (let rowSpan = 0; rowSpan < td.rowSpan; rowSpan++) {\n                    if (cells[rowIndex + rowSpan]) {\n                        cells[rowIndex + rowSpan][targetCol] =\n                            colSpan == 0 && rowSpan == 0 ? td : null;\n                    }\n                }\n            }\n        }\n\n        for (let col = 0; col < cells[rowIndex].length; col++) {\n            cells[rowIndex][col] = cells[rowIndex][col] || null;\n        }\n    });\n\n    return cells;\n}\n\n/**\n * Create ranges from a table selection\n * @param selection The source table selection\n * @returns An array of DOM ranges of selected table cells\n */\nexport function createTableRanges(selection: TableSelection): Range[] {\n    const result: Range[] = [];\n    const { table, firstColumn, firstRow, lastColumn, lastRow } = selection;\n    const cells = parseTableCells(table);\n\n    for (let row = firstRow; row <= lastRow; row++) {\n        for (let col = firstColumn; col <= lastColumn; col++) {\n            const td = cells[row]?.[col];\n\n            if (td) {\n                const range = table.ownerDocument.createRange();\n\n                range.selectNode(td);\n                result.push(range);\n            }\n        }\n    }\n\n    return result;\n}\n","import { extractBorderValues } from '../domUtils/borderValues';\nimport { getClosestAncestorBlockGroupIndex } from '../model/getClosestAncestorBlockGroupIndex';\nimport { isBold } from '../model/isBold';\nimport { iterateSelections } from '../selection/iterateSelections';\nimport { parseValueWithUnit } from 'roosterjs-content-model-dom';\nimport { updateTableMetadata } from '../../metadata/updateTableMetadata';\nimport type {\n    ContentModelFormatState,\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelFormatContainer,\n    ContentModelImage,\n    ContentModelListItem,\n    ContentModelParagraph,\n    ContentModelSegmentFormat,\n    TableSelectionContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * Retrieve format state from the given Content Model\n * @param model The Content Model to retrieve format state from\n * @param pendingFormat Existing pending format, if any\n * @param formatState Existing format state object, used for receiving the result\n */\nexport function retrieveModelFormatState(\n    model: ContentModelDocument,\n    pendingFormat: ContentModelSegmentFormat | null,\n    formatState: ContentModelFormatState\n) {\n    let firstTableContext: TableSelectionContext | undefined;\n    let firstBlock: ContentModelBlock | undefined;\n    let isFirst = true;\n    let isFirstImage = true;\n    let isFirstSegment = true;\n\n    iterateSelections(\n        model,\n        (path, tableContext, block, segments) => {\n            // Structure formats\n            retrieveStructureFormat(formatState, path, isFirst);\n\n            // Multiple line format\n            if (block) {\n                if (firstBlock) {\n                    formatState.isMultilineSelection = true;\n                } else {\n                    firstBlock = block;\n                }\n            }\n\n            if (block?.blockType == 'Paragraph') {\n                // Paragraph formats\n                retrieveParagraphFormat(formatState, block, isFirst);\n\n                // Segment formats\n                segments?.forEach(segment => {\n                    if (isFirstSegment || segment.segmentType != 'SelectionMarker') {\n                        const modelFormat = Object.assign({}, model.format);\n                        delete modelFormat?.italic;\n                        delete modelFormat?.underline;\n                        delete modelFormat?.fontWeight;\n\n                        retrieveSegmentFormat(\n                            formatState,\n                            isFirst,\n                            Object.assign(\n                                {},\n                                modelFormat,\n                                block.format,\n                                block.decorator?.format,\n                                segment.format,\n                                segment.code?.format,\n                                segment.link?.format,\n                                pendingFormat\n                            )\n                        );\n\n                        mergeValue(formatState, 'isCodeInline', !!segment?.code, isFirst);\n                    }\n\n                    // We only care the format of selection marker when it is the first selected segment. This is because when selection marker\n                    // is after some other selected segments, it mostly like appears at the beginning of a seconde line when the whole first line\n                    // is selected (e.g. triple-click on a line) then the second selection marker doesn't contain a correct format, so we need to\n                    // ignore it\n                    isFirstSegment = false;\n\n                    formatState.canUnlink = formatState.canUnlink || !!segment.link;\n                    formatState.canAddImageAltText =\n                        formatState.canAddImageAltText ||\n                        segments.some(segment => segment.segmentType == 'Image');\n\n                    isFirst = false;\n\n                    if (segment.segmentType === 'Image') {\n                        if (isFirstImage) {\n                            retrieveImageFormat(segment, formatState);\n                            isFirstImage = false;\n                        } else {\n                            formatState.imageFormat = undefined;\n                        }\n                    }\n                });\n\n                isFirst = false;\n            }\n\n            if (tableContext) {\n                if (firstTableContext) {\n                    const { table, colIndex, rowIndex } = firstTableContext;\n\n                    // Merge table format\n                    if (\n                        tableContext.table == table &&\n                        (tableContext.colIndex != colIndex || tableContext.rowIndex != rowIndex)\n                    ) {\n                        formatState.canMergeTableCell = true;\n                        formatState.isMultilineSelection = true;\n                    }\n                } else {\n                    // Table formats\n                    retrieveTableFormat(tableContext, formatState);\n                    firstTableContext = tableContext;\n                }\n            }\n        },\n        {\n            includeListFormatHolder: 'never',\n        }\n    );\n\n    if (formatState.fontSize) {\n        formatState.fontSize = px2Pt(formatState.fontSize);\n    }\n}\n\nfunction retrieveSegmentFormat(\n    result: ContentModelFormatState,\n    isFirst: boolean,\n    mergedFormat: ContentModelSegmentFormat\n) {\n    const superOrSubscript = mergedFormat.superOrSubScriptSequence?.split(' ')?.pop();\n\n    mergeValue(result, 'isBold', isBold(mergedFormat.fontWeight), isFirst);\n    mergeValue(result, 'isItalic', mergedFormat.italic, isFirst);\n    mergeValue(result, 'isUnderline', mergedFormat.underline, isFirst);\n    mergeValue(result, 'isStrikeThrough', mergedFormat.strikethrough, isFirst);\n    mergeValue(result, 'isSuperscript', superOrSubscript == 'super', isFirst);\n    mergeValue(result, 'isSubscript', superOrSubscript == 'sub', isFirst);\n    mergeValue(result, 'letterSpacing', mergedFormat.letterSpacing, isFirst);\n\n    mergeValue(result, 'fontName', mergedFormat.fontFamily, isFirst);\n    mergeValue(\n        result,\n        'fontSize',\n        mergedFormat.fontSize,\n        isFirst,\n        val => parseValueWithUnit(val, undefined, 'pt') + 'pt'\n    );\n    mergeValue(result, 'backgroundColor', mergedFormat.backgroundColor, isFirst);\n    mergeValue(result, 'textColor', mergedFormat.textColor, isFirst);\n    mergeValue(result, 'fontWeight', mergedFormat.fontWeight, isFirst);\n    mergeValue(result, 'lineHeight', mergedFormat.lineHeight, isFirst);\n}\n\nfunction retrieveParagraphFormat(\n    result: ContentModelFormatState,\n    paragraph: ContentModelParagraph,\n    isFirst: boolean\n) {\n    const headingLevel = parseInt((paragraph.decorator?.tagName || '').substring(1));\n    const validHeadingLevel = headingLevel >= 1 && headingLevel <= 6 ? headingLevel : undefined;\n\n    mergeValue(result, 'marginBottom', paragraph.format.marginBottom, isFirst);\n    mergeValue(result, 'marginTop', paragraph.format.marginTop, isFirst);\n    mergeValue(result, 'headingLevel', validHeadingLevel, isFirst);\n    mergeValue(result, 'textAlign', paragraph.format.textAlign, isFirst);\n    mergeValue(result, 'direction', paragraph.format.direction, isFirst);\n}\n\nfunction retrieveStructureFormat(\n    result: ContentModelFormatState,\n    path: ContentModelBlockGroup[],\n    isFirst: boolean\n) {\n    const listItemIndex = getClosestAncestorBlockGroupIndex(path, ['ListItem'], []);\n    const containerIndex = getClosestAncestorBlockGroupIndex(path, ['FormatContainer'], []);\n\n    if (listItemIndex >= 0) {\n        const listItem = path[listItemIndex] as ContentModelListItem;\n        const listType = listItem?.levels[listItem.levels.length - 1]?.listType;\n\n        mergeValue(result, 'isBullet', listType == 'UL', isFirst);\n        mergeValue(result, 'isNumbering', listType == 'OL', isFirst);\n    }\n\n    mergeValue(\n        result,\n        'isBlockQuote',\n        containerIndex >= 0 &&\n            (path[containerIndex] as ContentModelFormatContainer)?.tagName == 'blockquote',\n        isFirst\n    );\n}\n\nfunction retrieveTableFormat(tableContext: TableSelectionContext, result: ContentModelFormatState) {\n    const tableFormat = updateTableMetadata(tableContext.table);\n\n    result.isInTable = true;\n    result.tableHasHeader = tableContext.table.rows.some(row =>\n        row.cells.some(cell => cell.isHeader)\n    );\n\n    if (tableFormat) {\n        result.tableFormat = tableFormat;\n    }\n}\n\nfunction retrieveImageFormat(image: ContentModelImage, result: ContentModelFormatState) {\n    const { format } = image;\n    const borderKey = 'borderTop';\n    const extractedBorder = extractBorderValues(format[borderKey]);\n    const borderColor = extractedBorder.color;\n    const borderWidth = extractedBorder.width;\n    const borderStyle = extractedBorder.style;\n    result.imageFormat = {\n        borderColor,\n        borderWidth,\n        borderStyle,\n        boxShadow: format.boxShadow,\n        borderRadius: format.borderRadius,\n    };\n}\n\nfunction mergeValue<K extends keyof ContentModelFormatState>(\n    format: ContentModelFormatState,\n    key: K,\n    newValue: ContentModelFormatState[K] | undefined,\n    isFirst: boolean,\n    parseFn: (val: ContentModelFormatState[K]) => ContentModelFormatState[K] = val => val\n) {\n    if (isFirst) {\n        if (newValue !== undefined) {\n            format[key] = newValue;\n        }\n    } else if (parseFn(newValue) !== parseFn(format[key])) {\n        delete format[key];\n    }\n}\n\nfunction px2Pt(px: string) {\n    if (px && px.indexOf('px') == px.length - 2) {\n        // Edge may not handle the floating computing well which causes the calculated value is a little less than actual value\n        // So add 0.05 to fix it\n        return Math.round(parseFloat(px) * 75 + 0.05) / 100 + 'pt';\n    }\n    return px;\n}\n","import type {\n    ContentModelBlock,\n    ContentModelBlockBase,\n    ContentModelBlockGroupBase,\n    ContentModelBlockGroupType,\n    ContentModelBlockType,\n    ContentModelDivider,\n    ContentModelDocument,\n    ContentModelEntity,\n    ContentModelFormatBase,\n    ContentModelFormatContainer,\n    ContentModelGeneralBlock,\n    ContentModelImage,\n    ContentModelListItem,\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelSegmentBase,\n    ContentModelSegmentType,\n    ContentModelSelectionMarker,\n    ContentModelTable,\n    ContentModelTableCell,\n    ContentModelWithDataset,\n    ContentModelWithFormat,\n    ContentModelGeneralSegment,\n    ContentModelText,\n    ContentModelTableRow,\n    ContentModelListLevel,\n    CloneModelOptions,\n} from 'roosterjs-content-model-types';\n\n/**\n * Clone a content model\n * @param model The content model to clone\n * @param options @optional Options to specify customize the clone behavior\n */\nexport function cloneModel(\n    model: ContentModelDocument,\n    options?: CloneModelOptions\n): ContentModelDocument {\n    const newModel: ContentModelDocument = cloneBlockGroupBase(model, options || {});\n\n    if (model.format) {\n        newModel.format = Object.assign({}, model.format);\n    }\n\n    return newModel;\n}\n\nfunction cloneBlock(block: ContentModelBlock, options: CloneModelOptions): ContentModelBlock {\n    switch (block.blockType) {\n        case 'BlockGroup':\n            switch (block.blockGroupType) {\n                case 'FormatContainer':\n                    return cloneFormatContainer(block, options);\n                case 'General':\n                    return cloneGeneralBlock(block, options);\n                case 'ListItem':\n                    return cloneListItem(block, options);\n            }\n            break;\n        case 'Divider':\n            return cloneDivider(block, options);\n        case 'Entity':\n            return cloneEntity(block, options);\n        case 'Paragraph':\n            return cloneParagraph(block, options);\n        case 'Table':\n            return cloneTable(block, options);\n    }\n}\n\nfunction cloneSegment(\n    segment: ContentModelSegment,\n    options: CloneModelOptions\n): ContentModelSegment {\n    switch (segment.segmentType) {\n        case 'Br':\n            return cloneSegmentBase(segment);\n        case 'Entity':\n            return cloneEntity(segment, options);\n        case 'General':\n            return cloneGeneralSegment(segment, options);\n        case 'Image':\n            return cloneImage(segment);\n        case 'SelectionMarker':\n            return cloneSelectionMarker(segment);\n        case 'Text':\n            return cloneText(segment);\n    }\n}\n\nfunction cloneModelWithFormat<T extends ContentModelFormatBase>(\n    model: ContentModelWithFormat<T>\n): ContentModelWithFormat<T> {\n    return {\n        format: Object.assign({}, model.format),\n    };\n}\n\nfunction cloneModelWithDataset<T>(model: ContentModelWithDataset<T>): ContentModelWithDataset<T> {\n    return {\n        dataset: Object.assign({}, model.dataset),\n    };\n}\n\nfunction cloneBlockBase<T extends ContentModelBlockType>(\n    block: ContentModelBlockBase<T>\n): ContentModelBlockBase<T> {\n    const { blockType } = block;\n\n    return Object.assign(\n        {\n            blockType,\n        },\n        cloneModelWithFormat(block)\n    );\n}\n\nfunction cloneBlockGroupBase<T extends ContentModelBlockGroupType>(\n    group: ContentModelBlockGroupBase<T>,\n    options: CloneModelOptions\n): ContentModelBlockGroupBase<T> {\n    const { blockGroupType, blocks } = group;\n\n    return {\n        blockGroupType: blockGroupType,\n        blocks: blocks.map(block => cloneBlock(block, options)),\n    };\n}\n\nfunction cloneSegmentBase<T extends ContentModelSegmentType>(\n    segment: ContentModelSegmentBase<T>\n): ContentModelSegmentBase<T> {\n    const { segmentType, isSelected, code, link } = segment;\n\n    const newSegment: ContentModelSegmentBase<T> = Object.assign(\n        {\n            segmentType,\n            isSelected,\n        },\n        cloneModelWithFormat(segment)\n    );\n\n    if (code) {\n        newSegment.code = cloneModelWithFormat(code);\n    }\n    if (link) {\n        newSegment.link = Object.assign(cloneModelWithFormat(link), cloneModelWithDataset(link));\n    }\n\n    return newSegment;\n}\n\nfunction cloneEntity(entity: ContentModelEntity, options: CloneModelOptions): ContentModelEntity {\n    const { wrapper, entityFormat } = entity;\n\n    return Object.assign(\n        {\n            wrapper: handleCachedElement(wrapper, 'entity', options),\n            entityFormat: { ...entityFormat },\n        },\n        cloneBlockBase(entity),\n        cloneSegmentBase(entity)\n    );\n}\n\nfunction cloneParagraph(\n    paragraph: ContentModelParagraph,\n    options: CloneModelOptions\n): ContentModelParagraph {\n    const { cachedElement, segments, isImplicit, decorator, segmentFormat } = paragraph;\n\n    const newParagraph: ContentModelParagraph = Object.assign(\n        {\n            cachedElement: handleCachedElement(cachedElement, 'cache', options),\n            isImplicit,\n            segments: segments.map(segment => cloneSegment(segment, options)),\n            segmentFormat: segmentFormat ? { ...segmentFormat } : undefined,\n        },\n        cloneBlockBase(paragraph),\n        cloneModelWithFormat(paragraph)\n    );\n\n    if (decorator) {\n        newParagraph.decorator = Object.assign(\n            {\n                tagName: decorator.tagName,\n            },\n            cloneModelWithFormat(decorator)\n        );\n    }\n\n    return newParagraph;\n}\n\nfunction cloneTable(table: ContentModelTable, options: CloneModelOptions): ContentModelTable {\n    const { cachedElement, widths, rows } = table;\n\n    return Object.assign(\n        {\n            cachedElement: handleCachedElement(cachedElement, 'cache', options),\n            widths: Array.from(widths),\n            rows: rows.map(row => cloneTableRow(row, options)),\n        },\n        cloneBlockBase(table),\n        cloneModelWithDataset(table)\n    );\n}\n\nfunction cloneTableRow(\n    row: ContentModelTableRow,\n    options: CloneModelOptions\n): ContentModelTableRow {\n    const { height, cells, cachedElement } = row;\n\n    return Object.assign(\n        {\n            height,\n            cachedElement: handleCachedElement(cachedElement, 'cache', options),\n            cells: cells.map(cell => cloneTableCell(cell, options)),\n        },\n        cloneModelWithFormat(row)\n    );\n}\n\nfunction cloneTableCell(\n    cell: ContentModelTableCell,\n    options: CloneModelOptions\n): ContentModelTableCell {\n    const { cachedElement, isSelected, spanAbove, spanLeft, isHeader } = cell;\n\n    return Object.assign(\n        {\n            cachedElement: handleCachedElement(cachedElement, 'cache', options),\n            isSelected,\n            spanAbove,\n            spanLeft,\n            isHeader,\n        },\n        cloneBlockGroupBase(cell, options),\n        cloneModelWithFormat(cell),\n        cloneModelWithDataset(cell)\n    );\n}\n\nfunction cloneFormatContainer(\n    container: ContentModelFormatContainer,\n    options: CloneModelOptions\n): ContentModelFormatContainer {\n    const { tagName, cachedElement } = container;\n    const newContainer: ContentModelFormatContainer = Object.assign(\n        { tagName, cachedElement: handleCachedElement(cachedElement, 'cache', options) },\n        cloneBlockBase(container),\n        cloneBlockGroupBase(container, options)\n    );\n\n    if (container.zeroFontSize) {\n        newContainer.zeroFontSize = true;\n    }\n\n    return newContainer;\n}\n\nfunction cloneListItem(\n    item: ContentModelListItem,\n    options: CloneModelOptions\n): ContentModelListItem {\n    const { formatHolder, levels } = item;\n\n    return Object.assign(\n        {\n            formatHolder: cloneSelectionMarker(formatHolder),\n            levels: levels.map(cloneListLevel),\n        },\n        cloneBlockBase(item),\n        cloneBlockGroupBase(item, options)\n    );\n}\n\nfunction cloneListLevel(level: ContentModelListLevel): ContentModelListLevel {\n    const { listType } = level;\n\n    return Object.assign({ listType }, cloneModelWithFormat(level), cloneModelWithDataset(level));\n}\nfunction cloneDivider(\n    divider: ContentModelDivider,\n    options: CloneModelOptions\n): ContentModelDivider {\n    const { tagName, isSelected, cachedElement } = divider;\n\n    return Object.assign(\n        {\n            isSelected,\n            tagName,\n            cachedElement: handleCachedElement(cachedElement, 'cache', options),\n        },\n        cloneBlockBase(divider)\n    );\n}\n\nfunction cloneGeneralBlock(\n    general: ContentModelGeneralBlock,\n    options: CloneModelOptions\n): ContentModelGeneralBlock {\n    const { element } = general;\n\n    return Object.assign(\n        {\n            element: handleCachedElement(element, 'general', options),\n        },\n        cloneBlockBase(general),\n        cloneBlockGroupBase(general, options)\n    );\n}\n\nfunction cloneSelectionMarker(marker: ContentModelSelectionMarker): ContentModelSelectionMarker {\n    return Object.assign({ isSelected: marker.isSelected }, cloneSegmentBase(marker));\n}\n\nfunction cloneImage(image: ContentModelImage): ContentModelImage {\n    const { src, alt, title, isSelectedAsImageSelection } = image;\n\n    return Object.assign(\n        { src, alt, title, isSelectedAsImageSelection },\n        cloneSegmentBase(image),\n        cloneModelWithDataset(image)\n    );\n}\n\nfunction cloneGeneralSegment(\n    general: ContentModelGeneralSegment,\n    options: CloneModelOptions\n): ContentModelGeneralSegment {\n    return Object.assign(cloneGeneralBlock(general, options), cloneSegmentBase(general));\n}\n\nfunction cloneText(textSegment: ContentModelText): ContentModelText {\n    const { text } = textSegment;\n    return Object.assign({ text }, cloneSegmentBase(textSegment));\n}\n\nfunction handleCachedElement<T extends HTMLElement>(\n    node: T,\n    type: 'general' | 'entity',\n    options: CloneModelOptions\n): T;\n\nfunction handleCachedElement<T extends HTMLElement>(\n    node: T | undefined,\n    type: 'cache',\n    options: CloneModelOptions\n): T | undefined;\n\nfunction handleCachedElement<T extends HTMLElement>(\n    node: T | undefined,\n    type: 'general' | 'entity' | 'cache',\n    options: CloneModelOptions\n): T | undefined {\n    const { includeCachedElement } = options;\n\n    if (!node) {\n        return undefined;\n    } else if (!includeCachedElement) {\n        return type == 'cache' ? undefined : (node.cloneNode(true /*deep*/) as T);\n    } else if (includeCachedElement === true) {\n        return node;\n    } else {\n        const result = includeCachedElement(node, type) as T | undefined;\n\n        if ((type == 'general' || type == 'entity') && !result) {\n            throw new Error('Entity and General Model must has wrapper element');\n        }\n\n        return result;\n    }\n}\n","import { convertInlineCss, retrieveCssRules } from '../../utils/convertInlineCss';\nimport { createDomToModelContextForSanitizing } from '../../utils/createDomToModelContextForSanitizing';\nimport { createEmptyModel, domToContentModel, parseFormat } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelDocument,\n    ContentModelSegmentFormat,\n    DomToModelOption,\n    TrustedHTMLHandler,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create Content Model from HTML string\n * @param html The source HTML string\n * @param options Options for DOM to Content Model conversion\n * @param trustedHTMLHandler A string handler to convert string to trusted string\n * @returns A Content Model Document object that contains the Content Model from the give HTML, or undefined if failed to parse the source HTML\n */\nexport function createModelFromHtml(\n    html: string,\n    options?: DomToModelOption,\n    trustedHTMLHandler?: TrustedHTMLHandler,\n    defaultSegmentFormat?: ContentModelSegmentFormat\n): ContentModelDocument {\n    const doc = html\n        ? new DOMParser().parseFromString(trustedHTMLHandler?.(html) ?? html, 'text/html')\n        : null;\n\n    if (doc?.body) {\n        const context = createDomToModelContextForSanitizing(doc, defaultSegmentFormat, options);\n        const cssRules = doc ? retrieveCssRules(doc) : [];\n\n        convertInlineCss(doc, cssRules);\n        parseFormat(doc.body, context.formatParsers.segmentOnBlock, context.segmentFormat, context);\n\n        return domToContentModel(doc.body, context);\n    } else {\n        return createEmptyModel(defaultSegmentFormat);\n    }\n}\n","import {\n    contentModelToDom,\n    contentModelToText,\n    createModelToDomContext,\n} from 'roosterjs-content-model-dom';\nimport type { ExportContentMode, IEditor, ModelToDomOption } from 'roosterjs-content-model-types';\n\n/**\n * Export string content of editor\n * @param editor The editor to get content from\n * @param mode Mode of content to export. It supports:\n * - HTML: Export HTML content. If there are entities, this will cause EntityOperation event with option = 'replaceTemporaryContent' to get a dehydrated entity\n * - PlainText: Export plain text content\n * - PlainTextFast: Export plain text using editor's textContent property directly\n * @param options @optional Options for Model to DOM conversion\n */\nexport function exportContent(\n    editor: IEditor,\n    mode: ExportContentMode = 'HTML',\n    options?: ModelToDomOption\n): string {\n    if (mode == 'PlainTextFast') {\n        return editor.getDOMHelper().getTextContent();\n    } else {\n        const model = editor.getContentModelCopy('clean');\n\n        if (mode == 'PlainText') {\n            return contentModelToText(model);\n        } else {\n            const doc = editor.getDocument();\n            const div = doc.createElement('div');\n\n            contentModelToDom(\n                doc,\n                div,\n                model,\n                createModelToDomContext(undefined /*editorContext*/, options)\n            );\n\n            editor.triggerEvent('extractContentWithDom', { clonedRoot: div }, true /*broadcast*/);\n\n            return div.innerHTML;\n        }\n    }\n}\n","import type {\n    ContentModelBlockGroup,\n    ContentModelBlockGroupType,\n    TypeOfBlockGroup,\n} from 'roosterjs-content-model-types';\n\n/**\n * Get index of closest ancestor block group of the expected block group type. If not found, return -1\n * @param path The block group path, from the closest one to root\n * @param blockGroupTypes The expected block group types\n * @param stopTypes @optional Block group types that will cause stop searching\n */\nexport function getClosestAncestorBlockGroupIndex<T extends ContentModelBlockGroup>(\n    path: ContentModelBlockGroup[],\n    blockGroupTypes: TypeOfBlockGroup<T>[],\n    stopTypes: ContentModelBlockGroupType[] = []\n): number {\n    for (let i = 0; i < path.length; i++) {\n        const group = path[i];\n\n        if ((blockGroupTypes as string[]).indexOf(group.blockGroupType) >= 0) {\n            return i;\n        } else if (stopTypes.indexOf(group.blockGroupType) >= 0) {\n            // Do not go across boundary specified by stopTypes.\n            // For example, in most case we will set table as the boundary,\n            // in order to allow modify list item under a table when the table itself is in another list item\n            // Although this is not very likely to happen in most case, but we still need to handle it\n            return -1;\n        }\n    }\n\n    return -1;\n}\n","import type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    TypeOfBlockGroup,\n} from 'roosterjs-content-model-types';\n\n/**\n * Check if the given content model block or block group is of the expected block group type\n * @param input The object to check\n * @param type The expected type\n */\nexport function isBlockGroupOfType<T extends ContentModelBlockGroup>(\n    input: ContentModelBlock | ContentModelBlockGroup | null | undefined,\n    type: TypeOfBlockGroup<T>\n): input is T {\n    const item = <T | null | undefined>input;\n\n    return item?.blockGroupType == type;\n}\n","/**\n * Check if the given bold style represents a bold style\n * @param boldStyle The style to check\n */\nexport function isBold(boldStyle?: string): boolean {\n    return (\n        !!boldStyle && (boldStyle == 'bold' || boldStyle == 'bolder' || parseInt(boldStyle) >= 600)\n    );\n}\n","import { applyTableFormat } from '../table/applyTableFormat';\nimport { deleteSelection } from '../../publicApi/selection/deleteSelection';\nimport { getClosestAncestorBlockGroupIndex } from './getClosestAncestorBlockGroupIndex';\nimport { normalizeTable } from '../table/normalizeTable';\nimport {\n    addSegment,\n    createListItem,\n    createParagraph,\n    createSelectionMarker,\n    createTableCell,\n    getObjectKeys,\n    normalizeContentModel,\n} from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockFormat,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelListItem,\n    ContentModelParagraph,\n    ContentModelSegmentFormat,\n    ContentModelTable,\n    FormatContentModelContext,\n    InsertPoint,\n    MergeModelOption,\n} from 'roosterjs-content-model-types';\n\nconst HeadingTags = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n\n/**\n * Merge source model into target mode\n * @param target Target Content Model that will merge content into\n * @param source Source Content Model will be merged to target model\n * @param context Format context. When call this function inside formatContentModel, provide this context so that formatContentModel will do extra handling to the result\n * @param options More options, see MergeModelOption\n * @returns Insert point after merge, or null if there is no insert point\n */\nexport function mergeModel(\n    target: ContentModelDocument,\n    source: ContentModelDocument,\n    context?: FormatContentModelContext,\n    options?: MergeModelOption\n): InsertPoint | null {\n    const insertPosition =\n        options?.insertPosition ?? deleteSelection(target, [], context).insertPoint;\n\n    if (insertPosition) {\n        if (options?.mergeFormat && options.mergeFormat != 'none') {\n            const newFormat: ContentModelSegmentFormat = {\n                ...(target.format || {}),\n                ...insertPosition.marker.format,\n            };\n\n            applyDefaultFormat(source, newFormat, options?.mergeFormat);\n        }\n\n        for (let i = 0; i < source.blocks.length; i++) {\n            const block = source.blocks[i];\n\n            switch (block.blockType) {\n                case 'Paragraph':\n                    mergeParagraph(insertPosition, block, i == 0, context, options);\n                    break;\n\n                case 'Divider':\n                    insertBlock(insertPosition, block);\n                    break;\n\n                case 'Entity':\n                    insertBlock(insertPosition, block);\n                    context?.newEntities.push(block);\n                    break;\n\n                case 'Table':\n                    if (source.blocks.length == 1 && options?.mergeTable) {\n                        mergeTable(insertPosition, block, source);\n                    } else {\n                        insertBlock(insertPosition, block);\n                    }\n                    break;\n\n                case 'BlockGroup':\n                    switch (block.blockGroupType) {\n                        case 'General':\n                        case 'FormatContainer':\n                            insertBlock(insertPosition, block);\n                            break;\n                        case 'ListItem':\n                            mergeList(insertPosition, block);\n                            break;\n                    }\n                    break;\n            }\n        }\n    }\n\n    normalizeContentModel(target);\n\n    return insertPosition;\n}\n\nfunction mergeParagraph(\n    markerPosition: InsertPoint,\n    newPara: ContentModelParagraph,\n    mergeToCurrentParagraph: boolean,\n    context?: FormatContentModelContext,\n    option?: MergeModelOption\n) {\n    const { paragraph, marker } = markerPosition;\n    const newParagraph = mergeToCurrentParagraph\n        ? paragraph\n        : splitParagraph(markerPosition, newPara.format);\n    const segmentIndex = newParagraph.segments.indexOf(marker);\n\n    if (option?.mergeFormat == 'none' && mergeToCurrentParagraph) {\n        newParagraph.segments.forEach(segment => {\n            segment.format = { ...(newParagraph.segmentFormat || {}), ...segment.format };\n        });\n        delete newParagraph.segmentFormat;\n    }\n    if (segmentIndex >= 0) {\n        for (let i = 0; i < newPara.segments.length; i++) {\n            const segment = newPara.segments[i];\n\n            newParagraph.segments.splice(segmentIndex + i, 0, segment);\n\n            if (context) {\n                if (segment.segmentType == 'Entity') {\n                    context.newEntities.push(segment);\n                }\n\n                if (segment.segmentType == 'Image') {\n                    context.newImages.push(segment);\n                }\n            }\n        }\n    }\n\n    if (newPara.decorator) {\n        newParagraph.decorator = { ...newPara.decorator };\n        if (HeadingTags.indexOf(newParagraph.decorator.tagName) > -1) {\n            const sourceKeys: (keyof ContentModelSegmentFormat)[] = getObjectKeys(\n                newParagraph.decorator.format\n            );\n            const segmentDecoratorKeys: (keyof ContentModelSegmentFormat)[] = getObjectKeys(\n                newParagraph.segmentFormat || {}\n            );\n\n            sourceKeys.forEach(key => {\n                if (segmentDecoratorKeys.indexOf(key) > -1) {\n                    delete newParagraph.segmentFormat?.[key];\n                }\n            });\n        }\n    }\n\n    if (!mergeToCurrentParagraph) {\n        newParagraph.format = newPara.format;\n    } else {\n        newParagraph.format = {\n            ...newParagraph.format,\n            ...newPara.format,\n        };\n    }\n}\n\nfunction mergeTable(\n    markerPosition: InsertPoint,\n    newTable: ContentModelTable,\n    source: ContentModelDocument\n) {\n    const { tableContext, marker } = markerPosition;\n\n    if (tableContext && source.blocks.length == 1 && source.blocks[0] == newTable) {\n        const { table, colIndex, rowIndex } = tableContext;\n        for (let i = 0; i < newTable.rows.length; i++) {\n            for (let j = 0; j < newTable.rows[i].cells.length; j++) {\n                const newCell = newTable.rows[i].cells[j];\n\n                if (i == 0 && colIndex + j >= table.rows[0].cells.length) {\n                    for (let k = 0; k < table.rows.length; k++) {\n                        const leftCell = table.rows[k]?.cells[colIndex + j - 1];\n                        table.rows[k].cells[colIndex + j] = createTableCell(\n                            false /*spanLeft*/,\n                            false /*spanAbove*/,\n                            leftCell?.isHeader,\n                            leftCell?.format\n                        );\n                    }\n                }\n\n                if (j == 0 && rowIndex + i >= table.rows.length) {\n                    if (!table.rows[rowIndex + i]) {\n                        table.rows[rowIndex + i] = {\n                            cells: [],\n                            format: {},\n                            height: 0,\n                        };\n                    }\n\n                    for (let k = 0; k < table.rows[rowIndex].cells.length; k++) {\n                        const aboveCell = table.rows[rowIndex + i - 1]?.cells[k];\n                        table.rows[rowIndex + i].cells[k] = createTableCell(\n                            false /*spanLeft*/,\n                            false /*spanAbove*/,\n                            false /*isHeader*/,\n                            aboveCell?.format\n                        );\n                    }\n                }\n\n                const oldCell = table.rows[rowIndex + i].cells[colIndex + j];\n                table.rows[rowIndex + i].cells[colIndex + j] = newCell;\n\n                if (i == 0 && j == 0) {\n                    const newMarker = createSelectionMarker(marker.format);\n                    const newPara = addSegment(newCell, newMarker);\n\n                    if (markerPosition.path[0] == oldCell) {\n                        // Update insert point to match the change result\n                        markerPosition.path[0] = newCell;\n                        markerPosition.marker = newMarker;\n                        markerPosition.paragraph = newPara;\n                    }\n                }\n            }\n        }\n\n        normalizeTable(table, markerPosition.marker.format);\n        applyTableFormat(table, undefined /*newFormat*/, true /*keepCellShade*/);\n    } else {\n        insertBlock(markerPosition, newTable);\n    }\n}\n\nfunction mergeList(markerPosition: InsertPoint, newList: ContentModelListItem) {\n    splitParagraph(markerPosition, newList.format);\n\n    const { path, paragraph } = markerPosition;\n\n    const listItemIndex = getClosestAncestorBlockGroupIndex(path, ['ListItem']);\n    const listItem = path[listItemIndex] as ContentModelListItem;\n    const listParent = path[listItemIndex + 1]; // It is ok here when index is -1, that means there is no list and we just insert a new paragraph and use path[0] as its parent\n    const blockIndex = listParent.blocks.indexOf(listItem || paragraph);\n\n    if (blockIndex >= 0) {\n        listParent.blocks.splice(blockIndex, 0, newList);\n    }\n\n    if (listItem) {\n        listItem?.levels.forEach((level, i) => {\n            newList.levels[i] = { ...level };\n        });\n    }\n}\n\nfunction splitParagraph(markerPosition: InsertPoint, newParaFormat: ContentModelBlockFormat) {\n    const { paragraph, marker, path } = markerPosition;\n    const segmentIndex = paragraph.segments.indexOf(marker);\n    const paraIndex = path[0].blocks.indexOf(paragraph);\n    const newParagraph = createParagraph(\n        false /*isImplicit*/,\n        { ...paragraph.format, ...newParaFormat },\n        paragraph.segmentFormat\n    );\n\n    if (segmentIndex >= 0) {\n        newParagraph.segments = paragraph.segments.splice(segmentIndex);\n    }\n\n    if (paraIndex >= 0) {\n        path[0].blocks.splice(paraIndex + 1, 0, newParagraph);\n    }\n\n    const listItemIndex = getClosestAncestorBlockGroupIndex(\n        path,\n        ['ListItem'],\n        ['FormatContainer', 'TableCell']\n    );\n    const listItem = path[listItemIndex] as ContentModelListItem;\n\n    if (listItem) {\n        const listParent = listItemIndex >= 0 ? path[listItemIndex + 1] : null;\n        const blockIndex = listParent ? listParent.blocks.indexOf(listItem) : -1;\n\n        if (blockIndex >= 0 && listParent) {\n            const newListItem = createListItem(listItem.levels, listItem.formatHolder.format);\n\n            if (paraIndex >= 0) {\n                newListItem.blocks = listItem.blocks.splice(paraIndex + 1);\n            }\n\n            if (blockIndex >= 0) {\n                listParent.blocks.splice(blockIndex + 1, 0, newListItem);\n            }\n\n            path[listItemIndex] = newListItem;\n        }\n    }\n\n    markerPosition.paragraph = newParagraph;\n\n    return newParagraph;\n}\n\nfunction insertBlock(markerPosition: InsertPoint, block: ContentModelBlock) {\n    const { path } = markerPosition;\n    const newParaFormat = block.blockType !== 'Paragraph' ? {} : block.format;\n    const newPara = splitParagraph(markerPosition, newParaFormat);\n    const blockIndex = path[0].blocks.indexOf(newPara);\n\n    if (blockIndex >= 0) {\n        path[0].blocks.splice(blockIndex, 0, block);\n    }\n}\n\nfunction applyDefaultFormat(\n    group: ContentModelBlockGroup,\n    format: ContentModelSegmentFormat,\n    applyDefaultFormatOption: 'mergeAll' | 'keepSourceEmphasisFormat'\n) {\n    group.blocks.forEach(block => {\n        mergeBlockFormat(applyDefaultFormatOption, block);\n        switch (block.blockType) {\n            case 'BlockGroup':\n                if (block.blockGroupType == 'ListItem') {\n                    block.formatHolder.format = mergeSegmentFormat(\n                        applyDefaultFormatOption,\n                        format,\n                        block.formatHolder.format\n                    );\n                }\n                applyDefaultFormat(block, format, applyDefaultFormatOption);\n                break;\n\n            case 'Table':\n                block.rows.forEach(row =>\n                    row.cells.forEach(cell => {\n                        applyDefaultFormat(cell, format, applyDefaultFormatOption);\n                    })\n                );\n                break;\n\n            case 'Paragraph':\n                const paragraphFormat = block.decorator?.format || {};\n                block.segments.forEach(segment => {\n                    if (segment.segmentType == 'General') {\n                        applyDefaultFormat(segment, format, applyDefaultFormatOption);\n                    }\n\n                    segment.format = mergeSegmentFormat(applyDefaultFormatOption, format, {\n                        ...paragraphFormat,\n                        ...segment.format,\n                    });\n                });\n\n                if (applyDefaultFormatOption === 'keepSourceEmphasisFormat') {\n                    delete block.decorator;\n                }\n                break;\n        }\n    });\n}\n\nfunction mergeBlockFormat(applyDefaultFormatOption: string, block: ContentModelBlock) {\n    if (applyDefaultFormatOption == 'keepSourceEmphasisFormat' && block.format.backgroundColor) {\n        delete block.format.backgroundColor;\n    }\n}\n\nfunction mergeSegmentFormat(\n    applyDefaultFormatOption: 'mergeAll' | 'keepSourceEmphasisFormat',\n    targetformat: ContentModelSegmentFormat,\n    sourceFormat: ContentModelSegmentFormat\n): ContentModelSegmentFormat {\n    return applyDefaultFormatOption == 'mergeAll'\n        ? { ...targetformat, ...sourceFormat }\n        : {\n              ...targetformat,\n              ...getSemanticFormat(sourceFormat),\n          };\n}\n\nfunction getSemanticFormat(segmentFormat: ContentModelSegmentFormat): ContentModelSegmentFormat {\n    const result: ContentModelSegmentFormat = {};\n\n    const { fontWeight, italic, underline } = segmentFormat;\n\n    if (fontWeight && fontWeight != 'normal') {\n        result.fontWeight = fontWeight;\n    }\n    if (italic) {\n        result.italic = italic;\n    }\n    if (underline) {\n        result.underline = underline;\n    }\n\n    return result;\n}\n","import { convertInlineCss } from '../../utils/convertInlineCss';\nimport { createPasteFragment } from '../../utils/paste/createPasteFragment';\nimport { generatePasteOptionFromPlugins } from '../../utils/paste/generatePasteOptionFromPlugins';\nimport { mergePasteContent } from '../../utils/paste/mergePasteContent';\nimport { retrieveHtmlInfo } from '../../utils/paste/retrieveHtmlInfo';\nimport type {\n    PasteType,\n    ClipboardData,\n    TrustedHTMLHandler,\n    IEditor,\n} from 'roosterjs-content-model-types';\n\n/**\n * Paste into editor using a clipboardData object\n * @param editor The Editor object.\n * @param clipboardData Clipboard data retrieved from clipboard\n * @param pasteType Type of content to paste. @default normal\n */\nexport function paste(\n    editor: IEditor,\n    clipboardData: ClipboardData,\n    pasteType: PasteType = 'normal'\n) {\n    editor.focus();\n\n    const trustedHTMLHandler = editor.getTrustedHTMLHandler();\n\n    if (!clipboardData.modelBeforePaste) {\n        clipboardData.modelBeforePaste = editor.getContentModelCopy('connected');\n    }\n\n    // 1. Prepare variables\n    const doc = createDOMFromHtml(clipboardData.rawHtml, trustedHTMLHandler);\n\n    // 2. Handle HTML from clipboard\n    const htmlFromClipboard = retrieveHtmlInfo(doc, clipboardData);\n\n    // 3. Create target fragment\n    const sourceFragment = createPasteFragment(\n        editor.getDocument(),\n        clipboardData,\n        pasteType,\n        (clipboardData.rawHtml == clipboardData.html\n            ? doc\n            : createDOMFromHtml(clipboardData.html, trustedHTMLHandler)\n        )?.body\n    );\n\n    // 4. Trigger BeforePaste event to allow plugins modify the fragment\n    const eventResult = generatePasteOptionFromPlugins(\n        editor,\n        clipboardData,\n        sourceFragment,\n        htmlFromClipboard,\n        pasteType\n    );\n\n    // 5. Convert global CSS to inline CSS\n    convertInlineCss(eventResult.fragment, htmlFromClipboard.globalCssRules);\n\n    // 6. Merge pasted content into main Content Model\n    mergePasteContent(editor, eventResult, clipboardData);\n}\n\nfunction createDOMFromHtml(\n    html: string | null | undefined,\n    trustedHTMLHandler: TrustedHTMLHandler\n): Document | null {\n    return html ? new DOMParser().parseFromString(trustedHTMLHandler(html), 'text/html') : null;\n}\n","import { getClosestAncestorBlockGroupIndex } from '../model/getClosestAncestorBlockGroupIndex';\nimport { isBlockGroupOfType } from '../model/isBlockGroupOfType';\nimport { iterateSelections } from './iterateSelections';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelBlockGroupType,\n    ContentModelDocument,\n    ContentModelListItem,\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelTable,\n    IterateSelectionsOption,\n    OperationalBlocks,\n    TableSelectionContext,\n    TypeOfBlockGroup,\n} from 'roosterjs-content-model-types';\n\n/**\n * Get an array of selected parent paragraph and child segment pair\n * @param model The Content Model to get selection from\n * @param includingFormatHolder True means also include format holder as segment from list item, in that case paragraph will be null\n */\nexport function getSelectedSegmentsAndParagraphs(\n    model: ContentModelDocument,\n    includingFormatHolder: boolean\n): [ContentModelSegment, ContentModelParagraph | null][] {\n    const selections = collectSelections(model, {\n        includeListFormatHolder: includingFormatHolder ? 'allSegments' : 'never',\n    });\n    const result: [ContentModelSegment, ContentModelParagraph | null][] = [];\n\n    selections.forEach(({ segments, block }) => {\n        if (segments && ((includingFormatHolder && !block) || block?.blockType == 'Paragraph')) {\n            segments.forEach(segment => {\n                if (segment.segmentType != 'Entity' || !segment.entityFormat.isReadonly) {\n                    result.push([segment, block?.blockType == 'Paragraph' ? block : null]);\n                }\n            });\n        }\n    });\n\n    return result;\n}\n\n/**\n * Get an array of selected segments from a content model\n * @param model The Content Model to get selection from\n * @param includingFormatHolder True means also include format holder as segment from list item\n */\nexport function getSelectedSegments(\n    model: ContentModelDocument,\n    includingFormatHolder: boolean\n): ContentModelSegment[] {\n    return getSelectedSegmentsAndParagraphs(model, includingFormatHolder).map(x => x[0]);\n}\n\n/**\n * Get any array of selected paragraphs from a content model\n * @param model The Content Model to get selection from\n */\nexport function getSelectedParagraphs(model: ContentModelDocument): ContentModelParagraph[] {\n    const selections = collectSelections(model, { includeListFormatHolder: 'never' });\n    const result: ContentModelParagraph[] = [];\n\n    removeUnmeaningfulSelections(selections);\n\n    selections.forEach(({ block }) => {\n        if (block?.blockType == 'Paragraph') {\n            result.push(block);\n        }\n    });\n\n    return result;\n}\n\n/**\n * Get an array of block group - block pair that is of the expected block group type from selection\n * @param model The Content Model to get selection from\n * @param blockGroupTypes The expected block group types\n * @param stopTypes Block group types that will stop searching when hit\n * @param deepFirst True means search in deep first, otherwise wide first\n */\nexport function getOperationalBlocks<T extends ContentModelBlockGroup>(\n    model: ContentModelDocument,\n    blockGroupTypes: TypeOfBlockGroup<T>[],\n    stopTypes: ContentModelBlockGroupType[],\n    deepFirst?: boolean\n): OperationalBlocks<T>[] {\n    const result: OperationalBlocks<T>[] = [];\n    const findSequence = deepFirst ? blockGroupTypes.map(type => [type]) : [blockGroupTypes];\n    const selections = collectSelections(model, {\n        includeListFormatHolder: 'never',\n        contentUnderSelectedTableCell: 'ignoreForTable', // When whole table is selected, we treat the table as a single block\n    });\n\n    removeUnmeaningfulSelections(selections);\n\n    selections.forEach(({ path, block }) => {\n        for (let i = 0; i < findSequence.length; i++) {\n            const groupIndex = getClosestAncestorBlockGroupIndex(path, findSequence[i], stopTypes);\n\n            if (groupIndex >= 0) {\n                if (result.filter(x => x.block == path[groupIndex]).length <= 0) {\n                    result.push({\n                        parent: path[groupIndex + 1],\n                        block: path[groupIndex] as T,\n                        path: path.slice(groupIndex + 1),\n                    });\n                }\n                break;\n            } else if (i == findSequence.length - 1 && block) {\n                result.push({\n                    parent: path[0],\n                    block: block,\n                    path,\n                });\n                break;\n            }\n        }\n    });\n\n    return result;\n}\n\n/**\n * Get the first selected table from content model\n * @param model The Content Model to get selection from\n */\nexport function getFirstSelectedTable(\n    model: ContentModelDocument\n): [ContentModelTable | undefined, ContentModelBlockGroup[]] {\n    const selections = collectSelections(model, { includeListFormatHolder: 'never' });\n    let table: ContentModelTable | undefined;\n    let resultPath: ContentModelBlockGroup[] = [];\n\n    removeUnmeaningfulSelections(selections);\n\n    selections.forEach(({ block, tableContext, path }) => {\n        if (!table) {\n            if (block?.blockType == 'Table') {\n                table = block;\n                resultPath = [...path];\n            } else if (tableContext?.table) {\n                table = tableContext.table;\n\n                const parent = path.filter(\n                    group => group.blocks.indexOf(tableContext.table) >= 0\n                )[0];\n                const index = path.indexOf(parent);\n                resultPath = index >= 0 ? path.slice(index) : [];\n            }\n        }\n    });\n\n    return [table, resultPath];\n}\n\n/**\n * Get the first selected list item from content model\n * @param model The Content Model to get selection from\n */\nexport function getFirstSelectedListItem(\n    model: ContentModelDocument\n): ContentModelListItem | undefined {\n    let listItem: ContentModelListItem | undefined;\n\n    getOperationalBlocks(model, ['ListItem'], ['TableCell']).forEach(r => {\n        if (!listItem && isBlockGroupOfType<ContentModelListItem>(r.block, 'ListItem')) {\n            listItem = r.block;\n        }\n    });\n\n    return listItem;\n}\n\ninterface SelectionInfo {\n    path: ContentModelBlockGroup[];\n    segments?: ContentModelSegment[];\n    block?: ContentModelBlock;\n    tableContext?: TableSelectionContext;\n}\n\nfunction collectSelections(\n    model: ContentModelDocument,\n    option?: IterateSelectionsOption\n): SelectionInfo[] {\n    const selections: SelectionInfo[] = [];\n\n    iterateSelections(\n        model,\n        (path, tableContext, block, segments) => {\n            selections.push({\n                path,\n                tableContext,\n                block,\n                segments,\n            });\n        },\n        option\n    );\n\n    return selections;\n}\n\nfunction removeUnmeaningfulSelections(selections: SelectionInfo[]) {\n    if (\n        selections.length > 1 &&\n        isOnlySelectionMarkerSelected(selections, false /*checkFirstParagraph*/)\n    ) {\n        selections.pop();\n    }\n\n    // Remove head paragraph if first selection marker is the only selection\n    if (\n        selections.length > 1 &&\n        isOnlySelectionMarkerSelected(selections, true /*checkFirstParagraph*/)\n    ) {\n        selections.shift();\n    }\n}\n\nfunction isOnlySelectionMarkerSelected(\n    selections: SelectionInfo[],\n    checkFirstParagraph: boolean\n): boolean {\n    const selection = selections[checkFirstParagraph ? 0 : selections.length - 1];\n\n    if (\n        selection.block?.blockType == 'Paragraph' &&\n        selection.segments &&\n        selection.segments.length > 0\n    ) {\n        const allSegments = selection.block.segments;\n        const segment = selection.segments[0];\n\n        return (\n            selection.segments.length == 1 &&\n            segment.segmentType == 'SelectionMarker' &&\n            segment == allSegments[checkFirstParagraph ? allSegments.length - 1 : 0]\n        );\n    } else {\n        return false;\n    }\n}\n","import type {\n    ContentModelBlock,\n    EntityRemovalOperation,\n    FormatContentModelContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * Delete a content model block from current selection\n * @param blocks Array of the block to delete\n * @param blockToDelete The block to delete\n * @param replacement @optional If specified, use this block to replace the deleted block\n * @param context @optional Context object provided by formatContentModel API\n * @param direction @optional Whether this is deleting forward or backward. This is only used for deleting entity.\n * If not specified, only selected entity will be deleted\n */\nexport function deleteBlock(\n    blocks: ContentModelBlock[],\n    blockToDelete: ContentModelBlock,\n    replacement?: ContentModelBlock,\n    context?: FormatContentModelContext,\n    direction?: 'forward' | 'backward'\n): boolean {\n    const index = blocks.indexOf(blockToDelete);\n\n    switch (blockToDelete.blockType) {\n        case 'Table':\n        case 'Divider':\n            replacement ? blocks.splice(index, 1, replacement) : blocks.splice(index, 1);\n            return true;\n\n        case 'Entity':\n            const operation: EntityRemovalOperation | undefined = blockToDelete.isSelected\n                ? 'overwrite'\n                : direction == 'forward'\n                ? 'removeFromStart'\n                : direction == 'backward'\n                ? 'removeFromEnd'\n                : undefined;\n\n            if (operation !== undefined) {\n                replacement ? blocks.splice(index, 1, replacement) : blocks.splice(index, 1);\n                context?.deletedEntities.push({\n                    entity: blockToDelete,\n                    operation,\n                });\n            }\n\n            return true;\n\n        case 'BlockGroup':\n            switch (blockToDelete.blockGroupType) {\n                case 'General':\n                    if (replacement) {\n                        blocks.splice(index, 1, replacement);\n                        return true;\n                    } else {\n                        // no op, let browser handle it\n                        return false;\n                    }\n\n                case 'ListItem':\n                case 'FormatContainer':\n                    blocks.splice(index, 1);\n                    return true;\n            }\n    }\n\n    return false;\n}\n","import { deleteSingleChar } from '../../modelApi/edit/deleteSingleChar';\nimport { isWhiteSpacePreserved, normalizeSingleSegment } from 'roosterjs-content-model-dom';\nimport { normalizeText } from '../domUtils/stringUtil';\nimport type {\n    ContentModelParagraph,\n    ContentModelSegment,\n    EntityRemovalOperation,\n    FormatContentModelContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * Delete a content model segment from current selection\n * @param paragraph Parent paragraph of the segment to delete\n * @param segmentToDelete The segment to delete\n * @param context @optional Context object provided by formatContentModel API\n * @param direction @optional Whether this is deleting forward or backward. This is only used for deleting entity.\n * If not specified, only selected entity will be deleted\n */\nexport function deleteSegment(\n    paragraph: ContentModelParagraph,\n    segmentToDelete: ContentModelSegment,\n    context?: FormatContentModelContext,\n    direction?: 'forward' | 'backward'\n): boolean {\n    const segments = paragraph.segments;\n    const index = segments.indexOf(segmentToDelete);\n    const preserveWhiteSpace = isWhiteSpacePreserved(paragraph.format.whiteSpace);\n    const isForward = direction == 'forward';\n    const isBackward = direction == 'backward';\n\n    if (!preserveWhiteSpace) {\n        normalizePreviousSegment(segments, index);\n    }\n\n    switch (segmentToDelete.segmentType) {\n        case 'Br':\n        case 'Image':\n        case 'SelectionMarker':\n            segments.splice(index, 1);\n            return true;\n\n        case 'Entity':\n            const operation: EntityRemovalOperation | undefined = segmentToDelete.isSelected\n                ? 'overwrite'\n                : isForward\n                ? 'removeFromStart'\n                : isBackward\n                ? 'removeFromEnd'\n                : undefined;\n            if (operation !== undefined) {\n                segments.splice(index, 1);\n                context?.deletedEntities.push({\n                    entity: segmentToDelete,\n                    operation,\n                });\n            }\n\n            return true;\n\n        case 'Text':\n            let text = segmentToDelete.text;\n\n            if (text.length == 0 || segmentToDelete.isSelected) {\n                segments.splice(index, 1);\n            } else if (direction) {\n                text = deleteSingleChar(text, isForward); //  isForward ? text.substring(1) : text.substring(0, text.length - 1);\n\n                if (!preserveWhiteSpace) {\n                    text = normalizeText(text, isForward);\n                }\n\n                if (text == '') {\n                    segments.splice(index, 1);\n                } else {\n                    segmentToDelete.text = text;\n                }\n            }\n\n            return true;\n\n        case 'General':\n            if (segmentToDelete.isSelected) {\n                segments.splice(index, 1);\n                return true;\n            } else {\n                return false;\n            }\n    }\n}\n\nfunction normalizePreviousSegment(segments: ContentModelSegment[], currentIndex: number) {\n    let index = currentIndex - 1;\n\n    while (segments[index]?.segmentType == 'SelectionMarker') {\n        index--;\n    }\n\n    const segment = segments[index];\n\n    if (segment) {\n        normalizeSingleSegment(segment);\n    }\n}\n","import { deleteExpandedSelection } from '../../modelApi/edit/deleteExpandedSelection';\nimport type {\n    ContentModelDocument,\n    DeleteSelectionContext,\n    DeleteSelectionResult,\n    DeleteSelectionStep,\n    FormatContentModelContext,\n    ValidDeleteSelectionContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * Delete selected content from Content Model\n * @param model The model to delete selected content from\n * @param additionalSteps @optional Addition delete steps\n * @param formatContext @optional A context object provided by formatContentModel API\n * @returns A DeleteSelectionResult object to specify the deletion result\n */\nexport function deleteSelection(\n    model: ContentModelDocument,\n    additionalSteps: (DeleteSelectionStep | null)[] = [],\n    formatContext?: FormatContentModelContext\n): DeleteSelectionResult {\n    const context = deleteExpandedSelection(model, formatContext);\n\n    additionalSteps.forEach(step => {\n        if (step && isValidDeleteSelectionContext(context)) {\n            step(context);\n        }\n    });\n\n    mergeParagraphAfterDelete(context);\n    return context;\n}\n\nfunction isValidDeleteSelectionContext(\n    context: DeleteSelectionContext\n): context is ValidDeleteSelectionContext {\n    return !!context.insertPoint;\n}\n\n// If we end up with multiple paragraphs impacted, we need to merge them\nfunction mergeParagraphAfterDelete(context: DeleteSelectionContext) {\n    const { insertPoint, deleteResult, lastParagraph, lastTableContext } = context;\n\n    if (\n        insertPoint &&\n        deleteResult != 'notDeleted' &&\n        deleteResult != 'nothingToDelete' &&\n        lastParagraph &&\n        lastParagraph != insertPoint.paragraph &&\n        lastTableContext == insertPoint.tableContext\n    ) {\n        insertPoint.paragraph.segments.push(...lastParagraph.segments);\n        lastParagraph.segments = [];\n    }\n}\n","import type { DOMSelection } from 'roosterjs-content-model-types';\n\n/**\n * Get root node of a given DOM selection\n * For table selection, root node is the selected table\n * For image selection, root node is the selected image\n * For range selection, root node is the common ancestor container node of the selection range\n * @param selection The selection to get root node from\n */\nexport function getSelectionRootNode(selection: DOMSelection | undefined): Node | undefined {\n    return !selection\n        ? undefined\n        : selection.type == 'range'\n        ? selection.range.commonAncestorContainer\n        : selection.type == 'table'\n        ? selection.table\n        : selection.type == 'image'\n        ? selection.image\n        : undefined;\n}\n","import { hasSelectionInBlockGroup } from './hasSelectionInBlockGroup';\nimport { hasSelectionInSegment } from './hasSelectionInSegment';\nimport type { ContentModelBlock } from 'roosterjs-content-model-types';\n\n/**\n * Check if there is selection within the given block\n * @param block The block to check\n */\nexport function hasSelectionInBlock(block: ContentModelBlock): boolean {\n    switch (block.blockType) {\n        case 'Paragraph':\n            return block.segments.some(hasSelectionInSegment);\n\n        case 'Table':\n            return block.rows.some(row => row.cells.some(hasSelectionInBlockGroup));\n\n        case 'BlockGroup':\n            return hasSelectionInBlockGroup(block);\n\n        case 'Divider':\n        case 'Entity':\n            return !!block.isSelected;\n\n        default:\n            return false;\n    }\n}\n","import { hasSelectionInBlock } from './hasSelectionInBlock';\nimport type { ContentModelBlockGroup } from 'roosterjs-content-model-types';\n\n/**\n * Check if there is selection within the given block\n * @param block The block to check\n */\nexport function hasSelectionInBlockGroup(group: ContentModelBlockGroup): boolean {\n    if (group.blockGroupType == 'TableCell' && group.isSelected) {\n        return true;\n    }\n\n    if (group.blocks.some(hasSelectionInBlock)) {\n        return true;\n    }\n\n    return false;\n}\n","import { hasSelectionInBlock } from './hasSelectionInBlock';\nimport type { ContentModelSegment } from 'roosterjs-content-model-types';\n\n/**\n * Check if there is selection within the given segment\n * @param segment The segment to check\n */\nexport function hasSelectionInSegment(segment: ContentModelSegment): boolean {\n    return (\n        segment.isSelected ||\n        (segment.segmentType == 'General' && segment.blocks.some(hasSelectionInBlock))\n    );\n}\n","import type {\n    ContentModelBlockGroup,\n    ContentModelBlockWithCache,\n    ContentModelSegment,\n    IterateSelectionsCallback,\n    IterateSelectionsOption,\n    TableSelectionContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * Iterate all selected elements in a given model\n * @param group The given Content Model to iterate selection from\n * @param callback The callback function to access the selected element\n * @param option Option to determine how to iterate\n */\nexport function iterateSelections(\n    group: ContentModelBlockGroup,\n    callback: IterateSelectionsCallback,\n    option?: IterateSelectionsOption\n): void {\n    const internalCallback: IterateSelectionsCallback = (path, tableContext, block, segments) => {\n        if (!!(block as ContentModelBlockWithCache)?.cachedElement) {\n            delete (block as ContentModelBlockWithCache).cachedElement;\n        }\n\n        return callback(path, tableContext, block, segments);\n    };\n\n    internalIterateSelections([group], internalCallback, option);\n}\n\nfunction internalIterateSelections(\n    path: ContentModelBlockGroup[],\n    callback: IterateSelectionsCallback,\n    option?: IterateSelectionsOption,\n    table?: TableSelectionContext,\n    treatAllAsSelect?: boolean\n): boolean {\n    const parent = path[0];\n    const includeListFormatHolder = option?.includeListFormatHolder || 'allSegments';\n    const contentUnderSelectedTableCell = option?.contentUnderSelectedTableCell || 'include';\n    const contentUnderSelectedGeneralElement =\n        option?.contentUnderSelectedGeneralElement || 'contentOnly';\n\n    let hasSelectedSegment = false;\n    let hasUnselectedSegment = false;\n\n    for (let i = 0; i < parent.blocks.length; i++) {\n        const block = parent.blocks[i];\n\n        switch (block.blockType) {\n            case 'BlockGroup':\n                const newPath = [block, ...path];\n\n                if (block.blockGroupType == 'General') {\n                    const isSelected = treatAllAsSelect || block.isSelected;\n                    const handleGeneralContent =\n                        !isSelected ||\n                        contentUnderSelectedGeneralElement == 'both' ||\n                        contentUnderSelectedGeneralElement == 'contentOnly';\n                    const handleGeneralElement =\n                        isSelected &&\n                        (contentUnderSelectedGeneralElement == 'both' ||\n                            contentUnderSelectedGeneralElement == 'generalElementOnly' ||\n                            block.blocks.length == 0);\n\n                    if (\n                        (handleGeneralContent &&\n                            internalIterateSelections(\n                                newPath,\n                                callback,\n                                option,\n                                table,\n                                isSelected\n                            )) ||\n                        (handleGeneralElement && callback(path, table, block))\n                    ) {\n                        return true;\n                    }\n                } else if (\n                    internalIterateSelections(newPath, callback, option, table, treatAllAsSelect)\n                ) {\n                    return true;\n                }\n                break;\n\n            case 'Table':\n                const rows = block.rows;\n                const isWholeTableSelected = rows.every(row =>\n                    row.cells.every(cell => cell.isSelected)\n                );\n\n                if (contentUnderSelectedTableCell != 'include' && isWholeTableSelected) {\n                    if (callback(path, table, block)) {\n                        return true;\n                    }\n                } else {\n                    for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {\n                        const row = rows[rowIndex];\n\n                        for (let colIndex = 0; colIndex < row.cells.length; colIndex++) {\n                            const cell = row.cells[colIndex];\n                            if (!cell) {\n                                continue;\n                            }\n\n                            const newTable: TableSelectionContext = {\n                                table: block,\n                                rowIndex,\n                                colIndex,\n                                isWholeTableSelected,\n                            };\n\n                            if (cell.isSelected && callback(path, newTable)) {\n                                return true;\n                            }\n\n                            if (\n                                !cell.isSelected ||\n                                contentUnderSelectedTableCell != 'ignoreForTableOrCell'\n                            ) {\n                                const newPath = [cell, ...path];\n                                const isSelected = treatAllAsSelect || cell.isSelected;\n\n                                if (\n                                    internalIterateSelections(\n                                        newPath,\n                                        callback,\n                                        option,\n                                        newTable,\n                                        isSelected\n                                    )\n                                ) {\n                                    return true;\n                                }\n                            }\n                        }\n                    }\n                }\n\n                break;\n\n            case 'Paragraph':\n                const segments: ContentModelSegment[] = [];\n\n                for (let i = 0; i < block.segments.length; i++) {\n                    const segment = block.segments[i];\n                    const isSelected = treatAllAsSelect || segment.isSelected;\n\n                    if (segment.segmentType == 'General') {\n                        const handleGeneralContent =\n                            !isSelected ||\n                            contentUnderSelectedGeneralElement == 'both' ||\n                            contentUnderSelectedGeneralElement == 'contentOnly';\n                        const handleGeneralElement =\n                            isSelected &&\n                            (contentUnderSelectedGeneralElement == 'both' ||\n                                contentUnderSelectedGeneralElement == 'generalElementOnly' ||\n                                segment.blocks.length == 0);\n\n                        if (\n                            handleGeneralContent &&\n                            internalIterateSelections(\n                                [segment, ...path],\n                                callback,\n                                option,\n                                table,\n                                isSelected\n                            )\n                        ) {\n                            return true;\n                        }\n\n                        if (handleGeneralElement) {\n                            segments.push(segment);\n                        }\n                    } else if (isSelected) {\n                        segments.push(segment);\n                    }\n\n                    if (isSelected) {\n                        hasSelectedSegment = true;\n                    } else {\n                        hasUnselectedSegment = true;\n                    }\n                }\n\n                if (segments.length > 0 && callback(path, table, block, segments)) {\n                    return true;\n                }\n                break;\n\n            case 'Divider':\n            case 'Entity':\n                if ((treatAllAsSelect || block.isSelected) && callback(path, table, block)) {\n                    return true;\n                }\n\n                break;\n        }\n    }\n\n    if (\n        includeListFormatHolder != 'never' &&\n        parent.blockGroupType == 'ListItem' &&\n        hasSelectedSegment &&\n        (!hasUnselectedSegment || includeListFormatHolder == 'anySegment') &&\n        // When whole list item is selected, also add its format holder as selected segment\n        callback(path, table, undefined /*block*/, [parent.formatHolder])\n    ) {\n        return true;\n    }\n\n    return false;\n}\n","import { isGeneralSegment } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelSegment,\n    ContentModelTable,\n    Selectable,\n} from 'roosterjs-content-model-types';\n\n/**\n * Set selection into Content Model. If the Content Model already has selection, existing selection will be overwritten by the new one.\n * @param group The root level group of Content Model\n * @param start The start selected element. If not passed, existing selection of content model will be cleared\n * @param end The end selected element. If not passed, only the start element will be selected. If passed, all elements between start and end elements will be selected\n */\nexport function setSelection(group: ContentModelBlockGroup, start?: Selectable, end?: Selectable) {\n    setSelectionToBlockGroup(group, false /*isInSelection*/, start || null, end || null);\n}\n\nfunction setSelectionToBlockGroup(\n    group: ContentModelBlockGroup,\n    isInSelection: boolean,\n    start: Selectable | null,\n    end: Selectable | null\n): boolean {\n    return handleSelection(isInSelection, group, start, end, isInSelection => {\n        if (isGeneralSegment(group)) {\n            setIsSelected(group, isInSelection);\n        }\n\n        group.blocks.forEach(block => {\n            isInSelection = setSelectionToBlock(block, isInSelection, start, end);\n        });\n\n        return isInSelection;\n    });\n}\n\nfunction setSelectionToBlock(\n    block: ContentModelBlock,\n    isInSelection: boolean,\n    start: Selectable | null,\n    end: Selectable | null\n) {\n    switch (block.blockType) {\n        case 'BlockGroup':\n            return setSelectionToBlockGroup(block, isInSelection, start, end);\n\n        case 'Table':\n            return setSelectionToTable(block, isInSelection, start, end);\n\n        case 'Divider':\n        case 'Entity':\n            return handleSelection(isInSelection, block, start, end, isInSelection => {\n                if (isInSelection) {\n                    block.isSelected = true;\n                } else {\n                    delete block.isSelected;\n                }\n\n                return isInSelection;\n            });\n\n        case 'Paragraph':\n            const segmentsToDelete: number[] = [];\n\n            block.segments.forEach((segment, i) => {\n                isInSelection = handleSelection(\n                    isInSelection,\n                    segment,\n                    start,\n                    end,\n                    isInSelection => {\n                        return setSelectionToSegment(\n                            segment,\n                            isInSelection,\n                            segmentsToDelete,\n                            start,\n                            end,\n                            i\n                        );\n                    }\n                );\n            });\n\n            while (segmentsToDelete.length > 0) {\n                const index = segmentsToDelete.pop()!;\n\n                if (index >= 0) {\n                    block.segments.splice(index, 1);\n                }\n            }\n\n            return isInSelection;\n\n        default:\n            return isInSelection;\n    }\n}\n\nfunction setSelectionToTable(\n    table: ContentModelTable,\n    isInSelection: boolean,\n    start: Selectable | null,\n    end: Selectable | null\n): boolean {\n    const first = findCell(table, start);\n    const last = end ? findCell(table, end) : first;\n\n    if (!isInSelection) {\n        for (let row = 0; row < table.rows.length; row++) {\n            const currentRow = table.rows[row];\n            for (let col = 0; col < currentRow.cells.length; col++) {\n                const currentCell = table.rows[row].cells[col];\n                const isSelected =\n                    row >= first.row && row <= last.row && col >= first.col && col <= last.col;\n\n                setIsSelected(currentCell, isSelected);\n\n                if (!isSelected) {\n                    setSelectionToBlockGroup(currentCell, false /*isInSelection*/, start, end);\n                }\n            }\n        }\n    } else {\n        table.rows.forEach(row =>\n            row.cells.forEach(cell => {\n                isInSelection = setSelectionToBlockGroup(cell, isInSelection, start, end);\n            })\n        );\n    }\n\n    return isInSelection;\n}\n\nfunction findCell(table: ContentModelTable, cell: Selectable | null): { row: number; col: number } {\n    let col = -1;\n    const row = cell\n        ? table.rows.findIndex(row => (col = (row.cells as Selectable[]).indexOf(cell)) >= 0)\n        : -1;\n\n    return { row, col };\n}\n\nfunction setSelectionToSegment(\n    segment: ContentModelSegment,\n    isInSelection: boolean,\n    segmentsToDelete: number[],\n    start: Selectable | null,\n    end: Selectable | null,\n    i: number\n) {\n    switch (segment.segmentType) {\n        case 'SelectionMarker':\n            if (!isInSelection || (segment != start && segment != end)) {\n                // Delete the selection marker when\n                // 1. It is not in selection any more. Or\n                // 2. It is in middle of selection, so no need to have it\n                segmentsToDelete.push(i);\n            }\n            return isInSelection;\n\n        case 'General':\n            setIsSelected(segment, isInSelection);\n\n            return segment != start && segment != end\n                ? setSelectionToBlockGroup(segment, isInSelection, start, end)\n                : isInSelection;\n\n        case 'Image':\n            setIsSelected(segment, isInSelection);\n            segment.isSelectedAsImageSelection = start == segment && (!end || end == segment);\n            return isInSelection;\n        default:\n            setIsSelected(segment, isInSelection);\n            return isInSelection;\n    }\n}\n\nfunction setIsSelected(selectable: Selectable, value: boolean) {\n    if (value) {\n        selectable.isSelected = true;\n    } else {\n        delete selectable.isSelected;\n    }\n\n    return value;\n}\n\nfunction handleSelection(\n    isInSelection: boolean,\n    model: ContentModelBlockGroup | ContentModelBlock | ContentModelSegment,\n    start: Selectable | null,\n    end: Selectable | null,\n    callback: (isInSelection: boolean) => boolean\n) {\n    isInSelection = isInSelection || model == start;\n    isInSelection = callback(isInSelection);\n    return isInSelection && !!end && model != end;\n}\n","import { BorderKeys } from 'roosterjs-content-model-dom';\nimport { combineBorderValue, extractBorderValues } from '../domUtils/borderValues';\nimport { setTableCellBackgroundColor } from './setTableCellBackgroundColor';\nimport { TableBorderFormat } from '../../constants/TableBorderFormat';\nimport { updateTableCellMetadata } from '../../metadata/updateTableCellMetadata';\nimport { updateTableMetadata } from '../../metadata/updateTableMetadata';\nimport type {\n    BorderFormat,\n    ContentModelTable,\n    ContentModelTableRow,\n    TableMetadataFormat,\n} from 'roosterjs-content-model-types';\n\nconst DEFAULT_FORMAT: Required<TableMetadataFormat> = {\n    topBorderColor: '#ABABAB',\n    bottomBorderColor: '#ABABAB',\n    verticalBorderColor: '#ABABAB',\n    hasHeaderRow: false,\n    hasFirstColumn: false,\n    hasBandedRows: false,\n    hasBandedColumns: false,\n    bgColorEven: null,\n    bgColorOdd: '#ABABAB20',\n    headerRowColor: '#ABABAB',\n    tableBorderFormat: TableBorderFormat.Default,\n    verticalAlign: null,\n};\n\ntype MetaOverrides = {\n    bgColorOverrides: boolean[][];\n    vAlignOverrides: boolean[][];\n    borderOverrides: boolean[][];\n};\n\n/**\n * Apply table format from table metadata and the passed in new format\n * @param table The table to apply format to\n * @param newFormat @optional New format to apply. When passed, this value will be merged into existing metadata format and default format\n * @param keepCellShade @optional When pass true, table cells with customized shade color will not be overwritten. @default false\n */\nexport function applyTableFormat(\n    table: ContentModelTable,\n    newFormat?: TableMetadataFormat,\n    keepCellShade?: boolean\n) {\n    const { rows } = table;\n\n    updateTableMetadata(table, format => {\n        const effectiveMetadata = {\n            ...DEFAULT_FORMAT,\n            ...format,\n            ...(newFormat || {}),\n        };\n\n        const metaOverrides: MetaOverrides = updateOverrides(rows, !keepCellShade);\n\n        delete table.cachedElement;\n\n        clearCache(rows);\n        formatCells(rows, effectiveMetadata, metaOverrides);\n        setFirstColumnFormat(rows, effectiveMetadata, metaOverrides);\n        setHeaderRowFormat(rows, effectiveMetadata, metaOverrides);\n        return effectiveMetadata;\n    });\n}\n\nfunction clearCache(rows: ContentModelTableRow[]) {\n    rows.forEach(row => {\n        row.cells.forEach(cell => {\n            delete cell.cachedElement;\n        });\n\n        delete row.cachedElement;\n    });\n}\n\nfunction updateOverrides(rows: ContentModelTableRow[], removeCellShade: boolean): MetaOverrides {\n    const overrides: MetaOverrides = {\n        bgColorOverrides: [],\n        vAlignOverrides: [],\n        borderOverrides: [],\n    };\n\n    rows.forEach(row => {\n        const bgColorOverrides: boolean[] = [];\n        const vAlignOverrides: boolean[] = [];\n        const borderOverrides: boolean[] = [];\n\n        overrides.bgColorOverrides.push(bgColorOverrides);\n        overrides.vAlignOverrides.push(vAlignOverrides);\n        overrides.borderOverrides.push(borderOverrides);\n\n        row.cells.forEach(cell => {\n            updateTableCellMetadata(cell, metadata => {\n                if (metadata && removeCellShade) {\n                    bgColorOverrides.push(false);\n                    delete metadata.bgColorOverride;\n                } else {\n                    bgColorOverrides.push(!!metadata?.bgColorOverride);\n                }\n                vAlignOverrides.push(!!metadata?.vAlignOverride);\n                borderOverrides.push(!!metadata?.borderOverride);\n\n                return metadata;\n            });\n        });\n    });\n\n    return overrides;\n}\n\ntype ShouldUseTransparentBorder = (indexProp: {\n    firstRow: boolean;\n    lastRow: boolean;\n    firstColumn: boolean;\n    lastColumn: boolean;\n}) => [boolean, boolean, boolean, boolean];\n\nconst BorderFormatters: Record<number, ShouldUseTransparentBorder | undefined> = {\n    [TableBorderFormat.Default]: _ => [false, false, false, false],\n    [TableBorderFormat.ListWithSideBorders]: ({ lastColumn, firstColumn }) => [\n        false,\n        !lastColumn,\n        false,\n        !firstColumn,\n    ],\n    [TableBorderFormat.FirstColumnHeaderExternal]: ({\n        firstColumn,\n        firstRow,\n        lastColumn,\n        lastRow,\n    }) => [\n        !firstRow,\n        (!lastColumn && !firstColumn) || (firstColumn && firstRow),\n        !lastRow && !firstRow,\n        !firstColumn,\n    ],\n    [TableBorderFormat.NoHeaderBorders]: ({ firstRow, firstColumn, lastColumn }) => [\n        firstRow,\n        firstRow || lastColumn,\n        false,\n        firstRow || firstColumn,\n    ],\n    [TableBorderFormat.NoSideBorders]: ({ firstColumn, lastColumn }) => [\n        false,\n        lastColumn,\n        false,\n        firstColumn,\n    ],\n    [TableBorderFormat.EspecialType1]: ({ firstRow, firstColumn }) => [\n        firstColumn && !firstRow,\n        firstRow,\n        firstColumn && !firstRow,\n        firstRow && !firstColumn,\n    ],\n    [TableBorderFormat.EspecialType2]: ({ firstRow, firstColumn }) => [\n        !firstRow,\n        firstRow || !firstColumn,\n        !firstRow,\n        !firstColumn,\n    ],\n    [TableBorderFormat.EspecialType3]: ({ firstColumn, firstRow }) => [\n        true,\n        firstRow || !firstColumn,\n        !firstRow,\n        true,\n    ],\n    [TableBorderFormat.Clear]: () => [true, true, true, true],\n};\n\n/*\n * Apply vertical align, borders, and background color to all cells in the table\n */\nfunction formatCells(\n    rows: ContentModelTableRow[],\n    format: TableMetadataFormat,\n    metaOverrides: MetaOverrides\n) {\n    const { hasBandedRows, hasBandedColumns, bgColorOdd, bgColorEven } = format;\n\n    rows.forEach((row, rowIndex) => {\n        row.cells.forEach((cell, colIndex) => {\n            // Format Borders\n            if (\n                !metaOverrides.borderOverrides[rowIndex][colIndex] &&\n                typeof format.tableBorderFormat == 'number'\n            ) {\n                const transparentBorderMatrix = BorderFormatters[format.tableBorderFormat]?.({\n                    firstRow: rowIndex === 0,\n                    lastRow: rowIndex === rows.length - 1,\n                    firstColumn: colIndex === 0,\n                    lastColumn: colIndex === row.cells.length - 1,\n                });\n\n                const formatColor = [\n                    format.topBorderColor,\n                    format.verticalBorderColor,\n                    format.bottomBorderColor,\n                    format.verticalBorderColor,\n                ];\n\n                transparentBorderMatrix?.forEach((alwaysUseTransparent, i) => {\n                    const borderColor = (!alwaysUseTransparent && formatColor[i]) || '';\n\n                    cell.format[BorderKeys[i]] = combineBorderValue({\n                        style: getBorderStyleFromColor(borderColor),\n                        width: '1px',\n                        color: borderColor,\n                    });\n                });\n            }\n\n            // Format Background Color\n            if (!metaOverrides.bgColorOverrides[rowIndex][colIndex]) {\n                const color =\n                    hasBandedRows || hasBandedColumns\n                        ? (hasBandedColumns && colIndex % 2 != 0) ||\n                          (hasBandedRows && rowIndex % 2 != 0)\n                            ? bgColorOdd\n                            : bgColorEven\n                        : bgColorEven; /* bgColorEven is the default color */\n\n                setTableCellBackgroundColor(\n                    cell,\n                    color,\n                    false /*isColorOverride*/,\n                    true /*applyToSegments*/\n                );\n            }\n\n            // Format Vertical Align\n            if (format.verticalAlign && !metaOverrides.vAlignOverrides[rowIndex][colIndex]) {\n                cell.format.verticalAlign = format.verticalAlign;\n            }\n        });\n    });\n}\n\nfunction setFirstColumnFormat(\n    rows: ContentModelTableRow[],\n    format: Partial<TableMetadataFormat>,\n    metaOverrides: MetaOverrides\n) {\n    rows.forEach((row, rowIndex) => {\n        row.cells.forEach((cell, cellIndex) => {\n            if (format.hasFirstColumn && cellIndex === 0) {\n                cell.isHeader = true;\n\n                if (rowIndex !== 0 && !metaOverrides.bgColorOverrides[rowIndex][cellIndex]) {\n                    setBorderColor(cell.format, 'borderTop');\n                    setTableCellBackgroundColor(\n                        cell,\n                        null /*color*/,\n                        false /*isColorOverride*/,\n                        true /*applyToSegments*/\n                    );\n                }\n\n                if (rowIndex !== rows.length - 1 && rowIndex !== 0) {\n                    setBorderColor(cell.format, 'borderBottom');\n                }\n            } else {\n                cell.isHeader = false;\n            }\n        });\n    });\n}\n\nfunction setHeaderRowFormat(\n    rows: ContentModelTableRow[],\n    format: TableMetadataFormat,\n    metaOverrides: MetaOverrides\n) {\n    const rowIndex = 0;\n\n    rows[rowIndex]?.cells.forEach((cell, cellIndex) => {\n        cell.isHeader = format.hasHeaderRow;\n\n        if (format.hasHeaderRow && format.headerRowColor) {\n            if (!metaOverrides.bgColorOverrides[rowIndex][cellIndex]) {\n                setTableCellBackgroundColor(\n                    cell,\n                    format.headerRowColor,\n                    false /*isColorOverride*/,\n                    true /*applyToSegments*/\n                );\n            }\n\n            setBorderColor(cell.format, 'borderTop', format.headerRowColor);\n            setBorderColor(cell.format, 'borderRight', format.headerRowColor);\n            setBorderColor(cell.format, 'borderLeft', format.headerRowColor);\n        }\n    });\n}\n\nfunction setBorderColor(format: BorderFormat, key: keyof BorderFormat, value?: string) {\n    const border = extractBorderValues(format[key]);\n    border.color = value || '';\n    border.style = getBorderStyleFromColor(border.color);\n    format[key] = combineBorderValue(border);\n}\n\nfunction getBorderStyleFromColor(color?: string): string {\n    return !color || color == 'transparent' ? 'none' : 'solid';\n}\n","import { hasSelectionInBlockGroup } from '../selection/hasSelectionInBlockGroup';\nimport type { ContentModelTable, TableSelectionCoordinates } from 'roosterjs-content-model-types';\n\n/**\n * Get selection coordinates of a table. If there is no selection, return null\n * @param table The table model to get selection from\n */\nexport function getSelectedCells(table: ContentModelTable): TableSelectionCoordinates | null {\n    let firstRow = -1;\n    let firstColumn = -1;\n    let lastRow = -1;\n    let lastColumn = -1;\n    let hasSelection = false;\n\n    table.rows.forEach((row, rowIndex) =>\n        row.cells.forEach((cell, colIndex) => {\n            if (hasSelectionInBlockGroup(cell)) {\n                hasSelection = true;\n\n                if (firstRow < 0) {\n                    firstRow = rowIndex;\n                }\n\n                if (firstColumn < 0) {\n                    firstColumn = colIndex;\n                }\n\n                lastRow = Math.max(lastRow, rowIndex);\n                lastColumn = Math.max(lastColumn, colIndex);\n            }\n        })\n    );\n\n    return hasSelection ? { firstRow, firstColumn, lastRow, lastColumn } : null;\n}\n","import { addBlock, addSegment, createBr, createParagraph } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelSegment,\n    ContentModelSegmentFormat,\n    ContentModelTable,\n    ContentModelTableCell,\n} from 'roosterjs-content-model-types';\n\n/**\n * Minimum width for a table cell\n */\nexport const MIN_ALLOWED_TABLE_CELL_WIDTH: number = 30;\nconst MIN_HEIGHT = 22;\n\n/**\n * Normalize a Content Model table, make sure:\n * 1. Fist cells are not spanned\n * 2. Inner cells are not header\n * 3. All cells have content and width\n * 4. Table and table row have correct width/height\n * 5. Spanned cell has no child blocks\n * 6. default format is correctly applied\n * @param table The table to normalize\n * @param defaultSegmentFormat @optional Default segment format to apply to cell\n */\nexport function normalizeTable(\n    table: ContentModelTable,\n    defaultSegmentFormat?: ContentModelSegmentFormat\n) {\n    // Always collapse border and use border box for table in roosterjs to make layout simpler\n    const format = table.format;\n\n    if (!format.borderCollapse || !format.useBorderBox) {\n        format.borderCollapse = true;\n        format.useBorderBox = true;\n    }\n\n    // Make sure all first cells are not spanned\n    // Make sure all inner cells are not header\n    // Make sure all cells have content and width\n    table.rows.forEach((row, rowIndex) => {\n        row.cells.forEach((cell, colIndex) => {\n            if (cell.blocks.length == 0) {\n                const format = cell.format.textColor\n                    ? {\n                          ...defaultSegmentFormat,\n                          textColor: cell.format.textColor,\n                      }\n                    : defaultSegmentFormat;\n                addBlock(\n                    cell,\n                    createParagraph(undefined /*isImplicit*/, undefined /*blockFormat*/, format)\n                );\n                addSegment(cell, createBr(format));\n            }\n\n            if (rowIndex == 0) {\n                cell.spanAbove = false;\n            } else if (rowIndex > 0 && cell.isHeader) {\n                cell.isHeader = false;\n                delete cell.cachedElement;\n            }\n\n            if (colIndex == 0) {\n                cell.spanLeft = false;\n            }\n\n            cell.format.useBorderBox = true;\n        });\n\n        // Make sure table has correct width and height array\n        if (row.height < MIN_HEIGHT) {\n            row.height = MIN_HEIGHT;\n        }\n    });\n\n    const columns = Math.max(...table.rows.map(row => row.cells.length));\n\n    for (let i = 0; i < columns; i++) {\n        if (table.widths[i] === undefined) {\n            table.widths[i] = getTableCellWidth(columns);\n        } else if (table.widths[i] < MIN_ALLOWED_TABLE_CELL_WIDTH) {\n            table.widths[i] = MIN_ALLOWED_TABLE_CELL_WIDTH;\n        }\n    }\n\n    // Move blocks from spanned cell to its main cell if any,\n    // and remove rows/columns if all cells in it are spanned\n    const colCount = table.rows[0]?.cells.length || 0;\n\n    for (let colIndex = colCount - 1; colIndex > 0; colIndex--) {\n        table.rows.forEach(row => {\n            const cell = row.cells[colIndex];\n            const leftCell = row.cells[colIndex - 1];\n            if (cell && leftCell && cell.spanLeft) {\n                tryMoveBlocks(leftCell, cell);\n            }\n        });\n\n        if (table.rows.every(row => row.cells[colIndex]?.spanLeft)) {\n            table.rows.forEach(row => row.cells.splice(colIndex, 1));\n            table.widths.splice(\n                colIndex - 1,\n                2,\n                table.widths[colIndex - 1] + table.widths[colIndex]\n            );\n        }\n    }\n\n    for (let rowIndex = table.rows.length - 1; rowIndex > 0; rowIndex--) {\n        const row = table.rows[rowIndex];\n\n        row.cells.forEach((cell, colIndex) => {\n            const aboveCell = table.rows[rowIndex - 1]?.cells[colIndex];\n            if (aboveCell && cell.spanAbove) {\n                tryMoveBlocks(aboveCell, cell);\n            }\n        });\n\n        if (row.cells.every(cell => cell.spanAbove)) {\n            table.rows[rowIndex - 1].height += row.height;\n            table.rows.splice(rowIndex, 1);\n        }\n    }\n}\n\nfunction getTableCellWidth(columns: number): number {\n    if (columns <= 4) {\n        return 120;\n    } else if (columns <= 6) {\n        return 100;\n    } else {\n        return 70;\n    }\n}\n\nfunction tryMoveBlocks(targetCell: ContentModelTableCell, sourceCell: ContentModelTableCell) {\n    const onlyHasEmptyOrBr = sourceCell.blocks.every(\n        block => block.blockType == 'Paragraph' && hasOnlyBrSegment(block.segments)\n    );\n\n    if (!onlyHasEmptyOrBr) {\n        targetCell.blocks.push(...sourceCell.blocks);\n        sourceCell.blocks = [];\n    }\n}\n\nfunction hasOnlyBrSegment(segments: ContentModelSegment[]): boolean {\n    segments = segments.filter(s => s.segmentType != 'SelectionMarker');\n\n    return segments.length == 0 || (segments.length == 1 && segments[0].segmentType == 'Br');\n}\n","import { parseColor } from 'roosterjs-content-model-dom';\nimport { updateTableCellMetadata } from '../../metadata/updateTableCellMetadata';\nimport type { ContentModelTableCell } from 'roosterjs-content-model-types';\n\n// Using the HSL (hue, saturation and lightness) representation for RGB color values.\n// If the value of the lightness is less than 20, the color is dark.\n// If the value of the lightness is more than 80, the color is bright\nconst DARK_COLORS_LIGHTNESS = 20;\nconst BRIGHT_COLORS_LIGHTNESS = 80;\nconst White = '#ffffff';\nconst Black = '#000000';\n\n/**\n * Set shade color of table cell\n * @param cell The cell to set shade color to\n * @param color The color to set\n * @param isColorOverride @optional When pass true, it means this shade color is not part of table format, so it can be preserved when apply table format\n * @param applyToSegments @optional When pass true, we will also apply text color from table cell to its child blocks and segments\n */\nexport function setTableCellBackgroundColor(\n    cell: ContentModelTableCell,\n    color: string | null | undefined,\n    isColorOverride?: boolean,\n    applyToSegments?: boolean\n) {\n    if (color) {\n        cell.format.backgroundColor = color;\n\n        if (isColorOverride) {\n            updateTableCellMetadata(cell, metadata => {\n                metadata = metadata || {};\n                metadata.bgColorOverride = true;\n                return metadata;\n            });\n        }\n\n        const lightness = calculateLightness(color);\n\n        if (lightness < DARK_COLORS_LIGHTNESS) {\n            cell.format.textColor = White;\n        } else if (lightness > BRIGHT_COLORS_LIGHTNESS) {\n            cell.format.textColor = Black;\n        } else {\n            delete cell.format.textColor;\n        }\n\n        if (applyToSegments) {\n            setAdaptiveCellColor(cell);\n        }\n    } else {\n        delete cell.format.backgroundColor;\n        delete cell.format.textColor;\n        if (applyToSegments) {\n            removeAdaptiveCellColor(cell);\n        }\n    }\n\n    delete cell.cachedElement;\n}\n\nfunction removeAdaptiveCellColor(cell: ContentModelTableCell) {\n    cell.blocks.forEach(block => {\n        if (block.blockType == 'Paragraph') {\n            if (\n                block.segmentFormat?.textColor &&\n                shouldRemoveColor(block.segmentFormat?.textColor, cell.format.backgroundColor || '')\n            ) {\n                delete block.segmentFormat.textColor;\n            }\n            block.segments.forEach(segment => {\n                if (\n                    segment.format.textColor &&\n                    shouldRemoveColor(segment.format.textColor, cell.format.backgroundColor || '')\n                ) {\n                    delete segment.format.textColor;\n                }\n            });\n        }\n    });\n}\n\nfunction setAdaptiveCellColor(cell: ContentModelTableCell) {\n    if (cell.format.textColor) {\n        cell.blocks.forEach(block => {\n            if (block.blockType == 'Paragraph') {\n                if (!block.segmentFormat?.textColor) {\n                    block.segmentFormat = {\n                        ...block.segmentFormat,\n                        textColor: cell.format.textColor,\n                    };\n                }\n                block.segments.forEach(segment => {\n                    if (!segment.format?.textColor) {\n                        segment.format = {\n                            ...segment.format,\n                            textColor: cell.format.textColor,\n                        };\n                    }\n                });\n            }\n        });\n    }\n}\n\n/**\n * If the cell background color is too dark or too bright, and the text color is white or black, we should remove the text color\n * @param textColor the segment or block text color\n * @param cellBackgroundColor the cell background color\n * @returns\n */\nfunction shouldRemoveColor(textColor: string, cellBackgroundColor: string) {\n    const lightness = calculateLightness(cellBackgroundColor);\n    if (\n        ([White, 'rgb(255,255,255)'].indexOf(textColor) > -1 &&\n            (lightness > BRIGHT_COLORS_LIGHTNESS || cellBackgroundColor == '')) ||\n        ([Black, 'rgb(0,0,0)'].indexOf(textColor) > -1 &&\n            (lightness < DARK_COLORS_LIGHTNESS || cellBackgroundColor == ''))\n    ) {\n        return true;\n    }\n    return false;\n}\n\nfunction calculateLightness(color: string) {\n    const colorValues = parseColor(color);\n\n    // Use the values of r,g,b to calculate the lightness in the HSl representation\n    //First calculate the fraction of the light in each color, since in css the value of r,g,b is in the interval of [0,255], we have\n    if (colorValues) {\n        const red = colorValues[0] / 255;\n        const green = colorValues[1] / 255;\n        const blue = colorValues[2] / 255;\n\n        //Then the lightness in the HSL representation is the average between maximum fraction of r,g,b and the minimum fraction\n        return (Math.max(red, green, blue) + Math.min(red, green, blue)) * 50;\n    } else {\n        return 255;\n    }\n}\n","import type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Redo to next undo snapshot\n * @param editor The editor to undo with\n */\nexport function redo(editor: IEditor): void {\n    editor.focus();\n\n    const manager = editor.getSnapshotsManager();\n    const snapshot = manager.move(1);\n\n    if (snapshot) {\n        editor.restoreSnapshot(snapshot);\n    }\n}\n","import type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * Undo to last undo snapshot\n * @param editor The editor to undo with\n */\nexport function undo(editor: IEditor): void {\n    editor.focus();\n\n    const manager = editor.getSnapshotsManager();\n\n    if (manager.hasNewContent) {\n        editor.takeSnapshot();\n    }\n\n    const snapshot = manager.move(-1);\n\n    if (snapshot) {\n        editor.restoreSnapshot(snapshot);\n    }\n}\n","import { toArray } from 'roosterjs-content-model-dom';\n\n/**\n * @internal\n */\nexport interface CssRule {\n    selectors: string[];\n    text: string;\n}\n\n/**\n * @internal\n */\nexport function retrieveCssRules(doc: Document): CssRule[] {\n    const styles = toArray(doc.querySelectorAll('style'));\n    const result: CssRule[] = [];\n\n    styles.forEach(styleNode => {\n        const sheet = styleNode.sheet as CSSStyleSheet;\n\n        for (let ruleIndex = 0; ruleIndex < sheet.cssRules.length; ruleIndex++) {\n            const rule = sheet.cssRules[ruleIndex] as CSSStyleRule;\n\n            if (rule.type == CSSRule.STYLE_RULE && rule.selectorText) {\n                result.push({\n                    selectors: rule.selectorText.split(','),\n                    text: rule.style.cssText,\n                });\n            }\n        }\n\n        styleNode.parentNode?.removeChild(styleNode);\n    });\n\n    return result;\n}\n\n/**\n * @internal\n */\nexport function convertInlineCss(root: ParentNode, cssRules: CssRule[]) {\n    for (let i = cssRules.length - 1; i >= 0; i--) {\n        const { selectors, text } = cssRules[i];\n\n        for (const selector of selectors) {\n            if (!selector || !selector.trim() || selector.indexOf(':') >= 0) {\n                continue;\n            }\n\n            const nodes = toArray(root.querySelectorAll(selector));\n\n            // Always put existing styles after so that they have higher priority\n            // Which means if both global style and inline style apply to the same element,\n            // inline style will have higher priority\n            nodes.forEach(node =>\n                node.setAttribute('style', text + (node.getAttribute('style') || ''))\n            );\n        }\n    }\n}\n","import { containerSizeFormatParser } from '../override/containerSizeFormatParser';\nimport { createDomToModelContext } from 'roosterjs-content-model-dom';\nimport { createPasteEntityProcessor } from '../override/pasteEntityProcessor';\nimport { createPasteGeneralProcessor } from '../override/pasteGeneralProcessor';\nimport { getRootComputedStyleForContext } from './getRootComputedStyleForContext';\nimport { pasteBlockEntityParser } from '../override/pasteCopyBlockEntityParser';\nimport { pasteDisplayFormatParser } from '../override/pasteDisplayFormatParser';\nimport { pasteTextProcessor } from '../override/pasteTextProcessor';\nimport type {\n    ContentModelSegmentFormat,\n    DomToModelContext,\n    DomToModelOption,\n    DomToModelOptionForSanitizing,\n} from 'roosterjs-content-model-types';\n\nconst DefaultSanitizingOption: DomToModelOptionForSanitizing = {\n    processorOverride: {},\n    formatParserOverride: {},\n    additionalFormatParsers: {},\n    additionalAllowedTags: [],\n    additionalDisallowedTags: [],\n    styleSanitizers: {},\n    attributeSanitizers: {},\n};\n\n/**\n * @internal\n */\nexport function createDomToModelContextForSanitizing(\n    document: Document,\n    defaultFormat?: ContentModelSegmentFormat,\n    defaultOption?: DomToModelOption,\n    additionalSanitizingOption?: DomToModelOptionForSanitizing\n): DomToModelContext {\n    const sanitizingOption: DomToModelOptionForSanitizing = {\n        ...DefaultSanitizingOption,\n        ...additionalSanitizingOption,\n    };\n\n    return createDomToModelContext(\n        {\n            defaultFormat,\n            ...getRootComputedStyleForContext(document),\n        },\n        defaultOption,\n        {\n            processorOverride: {\n                '#text': pasteTextProcessor,\n                entity: createPasteEntityProcessor(sanitizingOption),\n                '*': createPasteGeneralProcessor(sanitizingOption),\n            },\n            formatParserOverride: {\n                display: pasteDisplayFormatParser,\n            },\n            additionalFormatParsers: {\n                container: [containerSizeFormatParser],\n                entity: [pasteBlockEntityParser],\n            },\n        },\n        sanitizingOption\n    );\n}\n","import { isElementOfType, isNodeOfType, moveChildNodes } from 'roosterjs-content-model-dom';\nimport type { SnapshotSelection, EditorCore } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function createSnapshotSelection(core: EditorCore): SnapshotSelection {\n    const { physicalRoot, api } = core;\n    const selection = api.getDOMSelection(core);\n\n    // Normalize tables to ensure they have TBODY element between TABLE and TR so that the selection path will include correct values\n    if (selection?.type == 'range') {\n        const { startContainer, startOffset, endContainer, endOffset } = selection.range;\n        let isDOMChanged = normalizeTableTree(startContainer, physicalRoot);\n\n        if (endContainer != startContainer) {\n            isDOMChanged = normalizeTableTree(endContainer, physicalRoot) || isDOMChanged;\n        }\n\n        if (isDOMChanged) {\n            const newRange = physicalRoot.ownerDocument.createRange();\n\n            newRange.setStart(startContainer, startOffset);\n            newRange.setEnd(endContainer, endOffset);\n            api.setDOMSelection(\n                core,\n                {\n                    type: 'range',\n                    range: newRange,\n                    isReverted: !!selection.isReverted,\n                },\n                true /*skipSelectionChangedEvent*/\n            );\n        }\n    }\n\n    switch (selection?.type) {\n        case 'image':\n            return {\n                type: 'image',\n                imageId: selection.image.id,\n            };\n\n        case 'table':\n            return {\n                type: 'table',\n                tableId: selection.table.id,\n                firstColumn: selection.firstColumn,\n                lastColumn: selection.lastColumn,\n                firstRow: selection.firstRow,\n                lastRow: selection.lastRow,\n            };\n\n        case 'range':\n            const range = selection.range;\n\n            return {\n                type: 'range',\n                start: getPath(range.startContainer, range.startOffset, physicalRoot),\n                end: getPath(range.endContainer, range.endOffset, physicalRoot),\n                isReverted: !!selection.isReverted,\n            };\n\n        default:\n            return {\n                type: 'range',\n                start: [],\n                end: [],\n                isReverted: false,\n            };\n    }\n}\n\n/**\n * Get the path of the node relative to rootNode.\n * The path of the node is an array of integer indices into the childNodes of the given node.\n *\n * The node path will be what the node path will be on a _normalized_ dom\n * (e.g. empty text nodes will be ignored and adjacent text nodes will be concatenated)\n *\n * @param rootNode the node the path will be relative to\n * @param position the position to get indexes from. Follows the same semantics\n * as selectionRange (if node is of type Text, it is an offset into the text of that node.\n * If node is of type Element, it is the index of a child in that Element node.)\n */\nfunction getPath(node: Node | null, offset: number, rootNode: Node): number[] {\n    const result: number[] = [];\n    let parent: Node | null;\n\n    if (!node || !rootNode.contains(node)) {\n        return result;\n    }\n\n    if (isNodeOfType(node, 'TEXT_NODE')) {\n        parent = node.parentNode;\n\n        while (node.previousSibling && isNodeOfType(node.previousSibling, 'TEXT_NODE')) {\n            offset += node.previousSibling.nodeValue?.length || 0;\n            node = node.previousSibling;\n        }\n\n        result.unshift(offset);\n    } else {\n        parent = node;\n        node = node.childNodes[offset];\n    }\n\n    do {\n        offset = 0;\n        let isPreviousText = false;\n\n        for (let c: Node | null = parent?.firstChild || null; c && c != node; c = c.nextSibling) {\n            if (isNodeOfType(c, 'TEXT_NODE')) {\n                if (c.nodeValue?.length === 0 || isPreviousText) {\n                    continue;\n                }\n\n                isPreviousText = true;\n            } else {\n                isPreviousText = false;\n            }\n\n            offset++;\n        }\n\n        result.unshift(offset);\n        node = parent;\n        parent = parent?.parentNode || null;\n    } while (node && node != rootNode);\n\n    return result;\n}\n\nfunction normalizeTableTree(startNode: Node, root: Node) {\n    let node: Node | null = startNode;\n    let isDOMChanged = false;\n\n    while (node && root.contains(node)) {\n        if (isNodeOfType(node, 'ELEMENT_NODE') && isElementOfType(node, 'table')) {\n            isDOMChanged = normalizeTable(node) || isDOMChanged;\n        }\n\n        node = node.parentNode;\n    }\n\n    return isDOMChanged;\n}\n\nfunction normalizeTable(table: HTMLTableElement): boolean {\n    let isDOMChanged = false;\n    let tbody: HTMLTableSectionElement | null = null;\n\n    for (let child = table.firstChild; child; child = child.nextSibling) {\n        const tag = isNodeOfType(child, 'ELEMENT_NODE') ? child.tagName : null;\n\n        switch (tag) {\n            case 'TR':\n                if (!tbody) {\n                    tbody = table.ownerDocument.createElement('tbody');\n                    table.insertBefore(tbody, child);\n                }\n\n                tbody.appendChild(child);\n                child = tbody;\n                isDOMChanged = true;\n\n                break;\n            case 'TBODY':\n                if (tbody) {\n                    moveChildNodes(tbody, child, true /*keepExistingChildren*/);\n                    child.parentNode?.removeChild(child);\n                    child = tbody;\n                    isDOMChanged = true;\n                } else {\n                    tbody = child as HTMLTableSectionElement;\n                }\n                break;\n            default:\n                tbody = null;\n                break;\n        }\n    }\n\n    const colgroups = table.querySelectorAll('colgroup');\n    const thead = table.querySelector('thead');\n\n    if (thead) {\n        colgroups.forEach(colgroup => {\n            if (!thead.contains(colgroup)) {\n                thead.appendChild(colgroup);\n            }\n        });\n    }\n\n    return isDOMChanged;\n}\n","import { readFile } from '../publicApi/domUtils/readFile';\nimport type { ClipboardData, EdgeLinkPreview } from 'roosterjs-content-model-types';\n\nconst ContentHandlers: {\n    [contentType: string]: (data: ClipboardData, value: string, type?: string) => void;\n} = {\n    ['text/html']: (data, value) => (data.rawHtml = value),\n    ['text/plain']: (data, value) => (data.text = value),\n    ['text/*']: (data, value, type?) => !!type && (data.customValues[type] = value),\n    ['text/link-preview']: tryParseLinkPreview,\n};\n\n/**\n * Extract clipboard items to be a ClipboardData object for IE\n * @param items The clipboard items retrieve from a DataTransfer object\n * @param allowedCustomPasteType Allowed custom content type when paste besides text/plain, text/html and images\n    Only text types are supported, and do not add \"text/\" prefix to the type values\n */\nexport function extractClipboardItems(\n    items: DataTransferItem[],\n    allowedCustomPasteType?: string[]\n): Promise<ClipboardData> {\n    const data: ClipboardData = {\n        types: [],\n        text: '',\n        image: null,\n        files: [],\n        rawHtml: null,\n        customValues: {},\n        pasteNativeEvent: true,\n    };\n\n    return Promise.all(\n        (items || []).map(item => {\n            const type = item.type;\n\n            if (type.indexOf('image/') == 0 && !data.image && item.kind == 'file') {\n                data.types.push(type);\n                data.image = item.getAsFile();\n                return new Promise<void>(resolve => {\n                    if (data.image) {\n                        readFile(data.image, dataUrl => {\n                            data.imageDataUri = dataUrl;\n                            resolve();\n                        });\n                    } else {\n                        resolve();\n                    }\n                });\n            } else if (item.kind == 'file') {\n                return new Promise<void>(resolve => {\n                    const file = item.getAsFile();\n                    if (!!file) {\n                        data.types.push(type);\n                        data.files!.push(file);\n                    }\n                    resolve();\n                });\n            } else {\n                const customType = getAllowedCustomType(type, allowedCustomPasteType);\n                const handler =\n                    ContentHandlers[type] || (customType ? ContentHandlers['text/*'] : null);\n                return new Promise<void>(resolve =>\n                    handler\n                        ? item.getAsString(value => {\n                              data.types.push(type);\n                              handler(data, value, customType);\n                              resolve();\n                          })\n                        : resolve()\n                );\n            }\n        })\n    ).then(() => data);\n}\n\nfunction tryParseLinkPreview(data: ClipboardData, value: string) {\n    try {\n        data.customValues['link-preview'] = value;\n        data.linkPreview = JSON.parse(value) as EdgeLinkPreview;\n    } catch {}\n}\n\nfunction getAllowedCustomType(type: string, allowedCustomPasteType?: string[]) {\n    const textType = type.indexOf('text/') == 0 ? type.substring('text/'.length) : null;\n    const index =\n        allowedCustomPasteType && textType ? allowedCustomPasteType.indexOf(textType) : -1;\n    return textType && index >= 0 ? textType : undefined;\n}\n","import { parseValueWithUnit } from 'roosterjs-content-model-dom';\nimport type { EditorContext } from 'roosterjs-content-model-types';\n\nconst DefaultRootFontSize = 16;\n\n/**\n * @internal\n */\nexport function getRootComputedStyleForContext(\n    document: Document\n): Pick<EditorContext, 'rootFontSize'> {\n    const rootComputedStyle = document.defaultView?.getComputedStyle(document.documentElement);\n    return { rootFontSize: parseValueWithUnit(rootComputedStyle?.fontSize) || DefaultRootFontSize };\n}\n","import { moveChildNodes, wrap } from 'roosterjs-content-model-dom';\nimport type { ClipboardData, PasteType } from 'roosterjs-content-model-types';\n\nconst NBSP_HTML = '\\u00A0';\nconst ENSP_HTML = '\\u2002';\nconst TAB_SPACES = 6;\n\n/**\n * @internal\n */\nexport function createPasteFragment(\n    document: Document,\n    clipboardData: ClipboardData,\n    pasteType: PasteType,\n    root: HTMLElement | undefined\n): DocumentFragment {\n    const { imageDataUri, text } = clipboardData;\n    const fragment = document.createDocumentFragment();\n\n    if (\n        (pasteType == 'asImage' && imageDataUri) ||\n        (pasteType != 'asPlainText' && !text && imageDataUri)\n    ) {\n        // Paste image\n        const img = document.createElement('img');\n        img.style.maxWidth = '100%';\n        img.src = imageDataUri;\n        fragment.appendChild(img);\n    } else if (pasteType != 'asPlainText' && root) {\n        moveChildNodes(fragment, root);\n    } else if (text) {\n        text.split('\\n').forEach((line, index, lines) => {\n            line = line\n                .replace(/^ /g, NBSP_HTML)\n                .replace(/ $/g, NBSP_HTML)\n                .replace(/\\r/g, '')\n                .replace(/ {2}/g, ' ' + NBSP_HTML);\n\n            if (line.includes('\\t')) {\n                line = transformTabCharacters(line);\n            }\n\n            const textNode = document.createTextNode(line);\n\n            // There are 3 scenarios:\n            // 1. Single line: Paste as it is\n            // 2. Two lines: Add <br> between the lines\n            // 3. 3 or More lines, For first and last line, paste as it is. For middle lines, wrap with DIV, and add BR if it is empty line\n            if (lines.length == 2 && index == 0) {\n                // 1 of 2 lines scenario, add BR\n                fragment.appendChild(textNode);\n                fragment.appendChild(document.createElement('br'));\n            } else if (index > 0 && index < lines.length - 1) {\n                // Middle line of >=3 lines scenario, wrap with DIV\n                fragment.appendChild(\n                    wrap(document, line == '' ? document.createElement('br') : textNode, 'div')\n                );\n            } else {\n                // All others, paste as it is\n                fragment.appendChild(textNode);\n            }\n        });\n    }\n\n    return fragment;\n}\n\n/**\n * Transform \\t characters into EN SPACE characters\n * @param input string NOT containing \\n characters\n * @example t(\"\\thello\", 2) => \"&ensp;&ensp;&ensp;&ensp;hello\"\n */\nfunction transformTabCharacters(input: string, initialOffset: number = 0) {\n    let line = input;\n    let tIndex: number;\n    while ((tIndex = line.indexOf('\\t')) != -1) {\n        const lineBefore = line.slice(0, tIndex);\n        const lineAfter = line.slice(tIndex + 1);\n        const tabCount = TAB_SPACES - ((lineBefore.length + initialOffset) % TAB_SPACES);\n        const tabStr = Array(tabCount).fill(ENSP_HTML).join('');\n        line = lineBefore + tabStr + lineAfter;\n    }\n    return line;\n}\n","import type { HtmlFromClipboard } from './retrieveHtmlInfo';\nimport type {\n    BeforePasteEvent,\n    ClipboardData,\n    DomToModelOptionForSanitizing,\n    PasteType,\n    IEditor,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function generatePasteOptionFromPlugins(\n    editor: IEditor,\n    clipboardData: ClipboardData,\n    fragment: DocumentFragment,\n    htmlFromClipboard: HtmlFromClipboard,\n    pasteType: PasteType\n): BeforePasteEvent {\n    const domToModelOption: DomToModelOptionForSanitizing = {\n        additionalAllowedTags: [],\n        additionalDisallowedTags: [],\n        additionalFormatParsers: {},\n        formatParserOverride: {},\n        processorOverride: {},\n        styleSanitizers: {},\n        attributeSanitizers: {},\n    };\n\n    const event: BeforePasteEvent = {\n        eventType: 'beforePaste',\n        clipboardData,\n        fragment,\n        htmlBefore: htmlFromClipboard.htmlBefore ?? '',\n        htmlAfter: htmlFromClipboard.htmlAfter ?? '',\n        htmlAttributes: htmlFromClipboard.metadata,\n        pasteType: pasteType,\n        domToModelOption,\n    };\n\n    return pasteType == 'asPlainText'\n        ? event\n        : editor.triggerEvent('beforePaste', event, true /* broadcast */);\n}\n","import { ChangeSource } from '../../constants/ChangeSource';\nimport { cloneModel } from '../../publicApi/model/cloneModel';\nimport { createDomToModelContextForSanitizing } from '../createDomToModelContextForSanitizing';\nimport { domToContentModel } from 'roosterjs-content-model-dom';\nimport { getSegmentTextFormat } from '../../publicApi/domUtils/getSegmentTextFormat';\nimport { getSelectedSegments } from '../../publicApi/selection/collectSelections';\nimport { mergeModel } from '../../publicApi/model/mergeModel';\nimport type {\n    BeforePasteEvent,\n    ClipboardData,\n    CloneModelOptions,\n    ContentModelDocument,\n    ContentModelSegmentFormat,\n    IEditor,\n    MergeModelOption,\n} from 'roosterjs-content-model-types';\n\nconst EmptySegmentFormat: Required<ContentModelSegmentFormat> = {\n    backgroundColor: '',\n    fontFamily: '',\n    fontSize: '',\n    fontWeight: '',\n    italic: false,\n    letterSpacing: '',\n    lineHeight: '',\n    strikethrough: false,\n    superOrSubScriptSequence: '',\n    textColor: '',\n    underline: false,\n};\nconst CloneOption: CloneModelOptions = {\n    includeCachedElement: (node, type) => (type == 'cache' ? undefined : node),\n};\n\n/**\n * @internal\n */\nexport function mergePasteContent(\n    editor: IEditor,\n    eventResult: BeforePasteEvent,\n    clipboardData: ClipboardData\n) {\n    const { fragment, domToModelOption, customizedMerge, pasteType } = eventResult;\n\n    editor.formatContentModel(\n        (model, context) => {\n            if (clipboardData.modelBeforePaste) {\n                const clonedModel = cloneModel(clipboardData.modelBeforePaste, CloneOption);\n                model.blocks = clonedModel.blocks;\n            }\n\n            const selectedSegment = getSelectedSegments(model, true /*includeFormatHolder*/)[0];\n            const domToModelContext = createDomToModelContextForSanitizing(\n                editor.getDocument(),\n                undefined /*defaultFormat*/,\n                editor.getEnvironment().domToModelSettings.customized,\n                domToModelOption\n            );\n\n            domToModelContext.segmentFormat = selectedSegment\n                ? getSegmentTextFormat(selectedSegment)\n                : {};\n\n            const pasteModel = domToContentModel(fragment, domToModelContext);\n            const mergeOption: MergeModelOption = {\n                mergeFormat: pasteType == 'mergeFormat' ? 'keepSourceEmphasisFormat' : 'none',\n                mergeTable: shouldMergeTable(pasteModel),\n            };\n\n            const insertPoint = customizedMerge\n                ? customizedMerge(model, pasteModel)\n                : mergeModel(model, pasteModel, context, mergeOption);\n\n            if (insertPoint) {\n                context.newPendingFormat = {\n                    ...EmptySegmentFormat,\n                    ...model.format,\n                    ...insertPoint.marker.format,\n                };\n            }\n\n            return true;\n        },\n        {\n            changeSource: ChangeSource.Paste,\n            getChangeData: () => clipboardData,\n            apiName: 'paste',\n        }\n    );\n}\n\nfunction shouldMergeTable(pasteModel: ContentModelDocument): boolean | undefined {\n    // If model contains a table and a paragraph element after the table with a single BR segment, remove the Paragraph after the table\n    if (\n        pasteModel.blocks.length == 2 &&\n        pasteModel.blocks[0].blockType === 'Table' &&\n        pasteModel.blocks[1].blockType === 'Paragraph' &&\n        pasteModel.blocks[1].segments.length === 1 &&\n        pasteModel.blocks[1].segments[0].segmentType === 'Br'\n    ) {\n        pasteModel.blocks.splice(1);\n    }\n    // Only merge table when the document contain a single table.\n    return pasteModel.blocks.length === 1 && pasteModel.blocks[0].blockType === 'Table';\n}\n","import { isNodeOfType, toArray } from 'roosterjs-content-model-dom';\nimport { retrieveCssRules } from '../convertInlineCss';\nimport type { CssRule } from '../convertInlineCss';\nimport type { ClipboardData } from 'roosterjs-content-model-types';\n\nconst START_FRAGMENT = '<!--StartFragment-->';\nconst END_FRAGMENT = '<!--EndFragment-->';\n\n/**\n * @internal\n */\nexport interface HtmlFromClipboard {\n    metadata: Record<string, string>;\n    globalCssRules: CssRule[];\n    htmlBefore?: string;\n    htmlAfter?: string;\n}\n\n/**\n * @internal\n */\nexport function retrieveHtmlInfo(\n    doc: Document | null,\n    clipboardData: Partial<ClipboardData>\n): HtmlFromClipboard {\n    let result: HtmlFromClipboard = {\n        metadata: {},\n        globalCssRules: [],\n    };\n\n    if (doc) {\n        result = {\n            ...retrieveHtmlStrings(clipboardData),\n            globalCssRules: retrieveCssRules(doc),\n            metadata: retrieveMetadata(doc),\n        };\n\n        clipboardData.htmlFirstLevelChildTags = retrieveTopLevelTags(doc);\n    }\n\n    return result;\n}\n\nfunction retrieveTopLevelTags(doc: Document): string[] {\n    const topLevelTags: string[] = [];\n\n    for (let child = doc.body.firstChild; child; child = child.nextSibling) {\n        if (isNodeOfType(child, 'TEXT_NODE')) {\n            const trimmedString = child.nodeValue?.replace(/(\\r\\n|\\r|\\n)/gm, '').trim();\n\n            if (trimmedString) {\n                topLevelTags.push(''); // Push an empty string as tag for text node\n            }\n        } else if (isNodeOfType(child, 'ELEMENT_NODE')) {\n            topLevelTags.push(child.tagName);\n        }\n    }\n\n    return topLevelTags;\n}\n\nfunction retrieveMetadata(doc: Document): Record<string, string> {\n    const result: Record<string, string> = {};\n    const attributes = doc.querySelector('html')?.attributes;\n\n    (attributes ? toArray(attributes) : []).forEach(attr => {\n        result[attr.name] = attr.value;\n    });\n\n    toArray(doc.querySelectorAll('meta')).forEach(meta => {\n        result[meta.name] = meta.content;\n    });\n\n    return result;\n}\n\nfunction retrieveHtmlStrings(\n    clipboardData: Partial<ClipboardData>\n): {\n    htmlBefore: string;\n    htmlAfter: string;\n} {\n    const rawHtml = clipboardData.rawHtml ?? '';\n    const startIndex = rawHtml.indexOf(START_FRAGMENT);\n    const endIndex = rawHtml.lastIndexOf(END_FRAGMENT);\n    let htmlBefore = '';\n    let htmlAfter = '';\n\n    if (startIndex >= 0 && endIndex >= startIndex + START_FRAGMENT.length) {\n        htmlBefore = rawHtml.substring(0, startIndex);\n        htmlAfter = rawHtml.substring(endIndex + END_FRAGMENT.length);\n        clipboardData.html = rawHtml.substring(startIndex + START_FRAGMENT.length, endIndex);\n    } else {\n        clipboardData.html = rawHtml;\n    }\n\n    return { htmlBefore, htmlAfter };\n}\n","import { transformColor } from '../publicApi/color/transformColor';\nimport type { EditorCore, Snapshot } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function restoreSnapshotColors(core: EditorCore, snapshot: Snapshot) {\n    const isDarkMode = core.lifecycle.isDarkMode;\n\n    core.darkColorHandler.updateKnownColor(isDarkMode); // Pass no parameter to force update all colors\n\n    if (!!snapshot.isDarkMode != !!isDarkMode) {\n        transformColor(\n            core.physicalRoot,\n            false /*includeSelf*/,\n            isDarkMode ? 'lightToDark' : 'darkToLight',\n            core.darkColorHandler\n        );\n    }\n}\n","import {\n    getAllEntityWrappers,\n    isEntityElement,\n    isNodeOfType,\n    parseEntityFormat,\n    reuseCachedElement,\n} from 'roosterjs-content-model-dom';\nimport type { Snapshot, EditorCore, KnownEntityItem } from 'roosterjs-content-model-types';\n\nconst BlockEntityContainer = '_E_EBlockEntityContainer';\n\n/**\n * @internal\n */\nexport function restoreSnapshotHTML(core: EditorCore, snapshot: Snapshot) {\n    const {\n        physicalRoot,\n        entity: { entityMap },\n    } = core;\n    let refNode: Node | null = physicalRoot.firstChild;\n\n    const body = new DOMParser().parseFromString(\n        core.trustedHTMLHandler?.(snapshot.html) ?? snapshot.html,\n        'text/html'\n    ).body;\n\n    for (let currentNode = body.firstChild; currentNode; ) {\n        const next = currentNode.nextSibling;\n        const originalEntityElement = tryGetEntityElement(entityMap, currentNode);\n\n        if (originalEntityElement) {\n            refNode = reuseCachedElement(physicalRoot, originalEntityElement, refNode);\n        } else {\n            physicalRoot.insertBefore(currentNode, refNode);\n\n            if (isNodeOfType(currentNode, 'ELEMENT_NODE')) {\n                const childEntities = getAllEntityWrappers(currentNode);\n\n                childEntities.forEach(element => {\n                    const wrapper = tryGetEntityElement(entityMap, element);\n\n                    if (wrapper) {\n                        if (wrapper == refNode) {\n                            // In case the node we are moving is just the ref node,\n                            // We create a temporary clone and insert it before the refNode, and use this cloned node as refNode\n                            // After replaceChild(), the original refNode will be moved away\n                            const markerNode = wrapper.cloneNode();\n\n                            physicalRoot.insertBefore(markerNode, refNode);\n                            refNode = markerNode;\n                        }\n\n                        element.parentNode?.replaceChild(wrapper, element);\n                    }\n                });\n            }\n        }\n        currentNode = next;\n    }\n\n    while (refNode) {\n        const next = refNode.nextSibling;\n\n        refNode.parentNode?.removeChild(refNode);\n        refNode = next;\n    }\n}\n\nfunction tryGetEntityElement(\n    entityMap: Record<string, KnownEntityItem>,\n    node: Node\n): HTMLElement | null {\n    let result: HTMLElement | null = null;\n\n    if (isNodeOfType(node, 'ELEMENT_NODE')) {\n        if (isEntityElement(node)) {\n            const format = parseEntityFormat(node);\n\n            result = getEntityWrapperForReuse(entityMap, format.id);\n        } else if (isBlockEntityContainer(node)) {\n            result = tryGetEntityFromContainer(node, entityMap);\n        }\n    }\n\n    return result;\n}\n\nfunction isBlockEntityContainer(node: HTMLElement) {\n    return node.classList.contains(BlockEntityContainer);\n}\n\nfunction tryGetEntityFromContainer(\n    element: HTMLElement,\n    entityMap: Record<string, KnownEntityItem>\n): HTMLElement | null {\n    for (let node = element.firstChild; node; node = node.nextSibling) {\n        if (isEntityElement(node) && isNodeOfType(node, 'ELEMENT_NODE')) {\n            const format = parseEntityFormat(node);\n            const parent = getEntityWrapperForReuse(entityMap, format.id)?.parentElement;\n\n            return isNodeOfType(parent, 'ELEMENT_NODE') && isBlockEntityContainer(parent)\n                ? parent\n                : null;\n        }\n    }\n\n    return null;\n}\n\nfunction getEntityWrapperForReuse(\n    entityMap: Record<string, KnownEntityItem>,\n    entityId: string | undefined\n): HTMLElement | null {\n    const entry = entityId ? entityMap[entityId] : undefined;\n\n    return entry?.canPersist ? entry.element : null;\n}\n","import { isNodeOfType } from 'roosterjs-content-model-dom';\nimport type { DOMSelection, EditorCore, Snapshot } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function restoreSnapshotSelection(core: EditorCore, snapshot: Snapshot) {\n    const snapshotSelection = snapshot.selection;\n    const { physicalRoot } = core;\n    let domSelection: DOMSelection | null = null;\n\n    if (snapshotSelection) {\n        switch (snapshotSelection.type) {\n            case 'range':\n                const startPos = getPositionFromPath(physicalRoot, snapshotSelection.start);\n                const endPos = getPositionFromPath(physicalRoot, snapshotSelection.end);\n                const range = physicalRoot.ownerDocument.createRange();\n\n                range.setStart(startPos.node, startPos.offset);\n                range.setEnd(endPos.node, endPos.offset);\n\n                domSelection = {\n                    type: 'range',\n                    range,\n                    isReverted: snapshotSelection.isReverted,\n                };\n                break;\n            case 'table':\n                const table = physicalRoot.querySelector(\n                    '#' + snapshotSelection.tableId\n                ) as HTMLTableElement;\n\n                if (table) {\n                    domSelection = {\n                        type: 'table',\n                        table: table,\n                        firstColumn: snapshotSelection.firstColumn,\n                        firstRow: snapshotSelection.firstRow,\n                        lastColumn: snapshotSelection.lastColumn,\n                        lastRow: snapshotSelection.lastRow,\n                    };\n                }\n                break;\n            case 'image':\n                const image = physicalRoot.querySelector(\n                    '#' + snapshotSelection.imageId\n                ) as HTMLImageElement;\n\n                if (image) {\n                    domSelection = {\n                        type: 'image',\n                        image: image,\n                    };\n                }\n                break;\n        }\n    }\n\n    if (domSelection) {\n        core.api.setDOMSelection(core, domSelection);\n    }\n}\n\nfunction getPositionFromPath(node: Node, path: number[]): { node: Node; offset: number } {\n    // Iterate with a for loop to avoid mutating the passed in element path stack\n    // or needing to copy it.\n    let offset: number = 0;\n\n    for (let i = 0; i < path.length; i++) {\n        offset = path[i];\n\n        if (\n            i < path.length - 1 &&\n            node &&\n            isNodeOfType(node, 'ELEMENT_NODE') &&\n            node.childNodes.length > offset\n        ) {\n            node = node.childNodes[offset];\n        } else {\n            break;\n        }\n    }\n\n    return { node, offset };\n}\n","import { isNodeOfType } from 'roosterjs-content-model-dom';\nimport type { ValueSanitizer } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const AllowedTags: ReadonlyArray<string> = [\n    'a',\n    'abbr',\n    'address',\n    'area',\n    'article',\n    'aside',\n    'b',\n    'bdi',\n    'bdo',\n    'blockquote',\n    'body',\n    'br',\n    'button',\n    'canvas',\n    'caption',\n    'center',\n    'cite',\n    'code',\n    'col',\n    'colgroup',\n    'data',\n    'datalist',\n    'dd',\n    'del',\n    'details',\n    'dfn',\n    'dialog',\n    'dir',\n    'div',\n    'dl',\n    'dt',\n    'em',\n    'fieldset',\n    'figcaption',\n    'figure',\n    'font',\n    'footer',\n    'h1',\n    'h2',\n    'h3',\n    'h4',\n    'h5',\n    'h6',\n    'head',\n    'header',\n    'hgroup',\n    'hr',\n    'html',\n    'i',\n    'img',\n    'input',\n    'ins',\n    'kbd',\n    'label',\n    'legend',\n    'li',\n    'main',\n    'map',\n    'mark',\n    'menu',\n    'menuitem',\n    'meter',\n    'nav',\n    'ol',\n    'optgroup',\n    'option',\n    'output',\n    'p',\n    'picture',\n    'pre',\n    'progress',\n    'q',\n    'rp',\n    'rt',\n    'ruby',\n    's',\n    'samp',\n    'section',\n    'select',\n    'small',\n    'span',\n    'strike',\n    'strong',\n    'sub',\n    'summary',\n    'sup',\n    'table',\n    'tbody',\n    'td',\n    'textarea',\n    'tfoot',\n    'th',\n    'thead',\n    'time',\n    'tr',\n    'tt',\n    'u',\n    'ul',\n    'var',\n    'wbr',\n    'xmp',\n];\n\n/**\n * @internal\n */\nexport const DisallowedTags: ReadonlyArray<string> = [\n    'applet',\n    'audio',\n    'base',\n    'basefont',\n    'embed',\n    'frame',\n    'frameset',\n    'iframe',\n    'link',\n    'meta',\n    'noscript',\n    'object',\n    'param',\n    'script',\n    'slot',\n    'source',\n    'style',\n    'template',\n    'title',\n    'track',\n    'video',\n];\n\nconst VARIABLE_REGEX = /^\\s*var\\(\\s*[a-zA-Z0-9-_]+\\s*(,\\s*(.*))?\\)\\s*$/;\nconst VARIABLE_PREFIX = 'var(';\n\nconst AllowedAttributes = [\n    'accept',\n    'align',\n    'alt',\n    'checked',\n    'cite',\n    'class',\n    'color',\n    'cols',\n    'colspan',\n    'contextmenu',\n    'coords',\n    'datetime',\n    'default',\n    'dir',\n    'dirname',\n    'disabled',\n    'download',\n    'face',\n    'headers',\n    'height',\n    'hidden',\n    'high',\n    'href',\n    'hreflang',\n    'ismap',\n    'kind',\n    'label',\n    'lang',\n    'list',\n    'low',\n    'max',\n    'maxlength',\n    'media',\n    'min',\n    'multiple',\n    'open',\n    'optimum',\n    'pattern',\n    'placeholder',\n    'readonly',\n    'rel',\n    'required',\n    'reversed',\n    'rows',\n    'rowspan',\n    'scope',\n    'selected',\n    'shape',\n    'size',\n    'sizes',\n    'span',\n    'spellcheck',\n    'src',\n    'srclang',\n    'srcset',\n    'start',\n    'step',\n    'style',\n    'tabindex',\n    'target',\n    'title',\n    'translate',\n    'type',\n    'usemap',\n    'valign',\n    'value',\n    'width',\n    'wrap',\n    'bgColor',\n];\n\nconst DefaultStyleValue: { [name: string]: string } = {\n    'background-color': 'transparent',\n    'border-bottom-color': 'rgb(0, 0, 0)',\n    'border-bottom-style': 'none',\n    'border-bottom-width': '0px',\n    'border-image-outset': '0',\n    'border-image-repeat': 'stretch',\n    'border-image-slice': '100%',\n    'border-image-source': 'none',\n    'border-image-width': '1',\n    'border-left-color': 'rgb(0, 0, 0)',\n    'border-left-style': 'none',\n    'border-left-width': '0px',\n    'border-right-color': 'rgb(0, 0, 0)',\n    'border-right-style': 'none',\n    'border-right-width': '0px',\n    'border-top-color': 'rgb(0, 0, 0)',\n    'border-top-style': 'none',\n    'border-top-width': '0px',\n    'outline-color': 'transparent',\n    'outline-style': 'none',\n    'outline-width': '0px',\n    overflow: 'visible',\n    '-webkit-text-stroke-width': '0px',\n    'word-wrap': 'break-word',\n    'margin-left': '0px',\n    'margin-right': '0px',\n    padding: '0px',\n    'padding-top': '0px',\n    'padding-left': '0px',\n    'padding-right': '0px',\n    'padding-bottom': '0px',\n    border: '0px',\n    'border-top': '0px',\n    'border-left': '0px',\n    'border-right': '0px',\n    'border-bottom': '0px',\n    'vertical-align': 'baseline',\n    float: 'none',\n    'font-style': 'normal',\n    'font-variant-ligatures': 'normal',\n    'font-variant-caps': 'normal',\n    'font-weight': '400',\n    'letter-spacing': 'normal',\n    orphans: '2',\n    'text-align': 'start',\n    'text-indent': '0px',\n    'text-transform': 'none',\n    widows: '2',\n    'word-spacing': '0px',\n    'white-space': 'normal',\n};\n\n/**\n * @internal\n */\nexport function sanitizeElement(\n    element: HTMLElement,\n    allowedTags: ReadonlyArray<string>,\n    disallowedTags: ReadonlyArray<string>,\n    styleSanitizers?: Readonly<Record<string, ValueSanitizer>>,\n    attributeSanitizers?: Readonly<Record<string, ValueSanitizer>>\n): HTMLElement | null {\n    const tag = element.tagName.toLowerCase();\n    const sanitizedElement =\n        disallowedTags.indexOf(tag) >= 0\n            ? null\n            : createSanitizedElement(\n                  element.ownerDocument,\n                  allowedTags.indexOf(tag) >= 0 ? tag : 'span',\n                  element.attributes,\n                  styleSanitizers,\n                  attributeSanitizers\n              );\n\n    if (sanitizedElement) {\n        for (let child = element.firstChild; child; child = child.nextSibling) {\n            const newChild = isNodeOfType(child, 'ELEMENT_NODE')\n                ? sanitizeElement(\n                      child,\n                      allowedTags,\n                      disallowedTags,\n                      styleSanitizers,\n                      attributeSanitizers\n                  )\n                : isNodeOfType(child, 'TEXT_NODE')\n                ? child.cloneNode()\n                : null;\n\n            if (newChild) {\n                sanitizedElement?.appendChild(newChild);\n            }\n        }\n    }\n\n    return sanitizedElement;\n}\n\n/**\n * @internal\n */\nexport function createSanitizedElement(\n    doc: Document,\n    tag: string,\n    attributes: NamedNodeMap,\n    styleSanitizers?: Readonly<Record<string, ValueSanitizer>>,\n    attributeSanitizers?: Readonly<Record<string, ValueSanitizer>>\n): HTMLElement {\n    const element = doc.createElement(tag);\n\n    for (let i = 0; i < attributes.length; i++) {\n        const attribute = attributes[i];\n        const name = attribute.name.toLowerCase().trim();\n        const value = attribute.value;\n\n        const sanitizer = attributeSanitizers?.[name];\n        const newValue =\n            name == 'style'\n                ? processStyles(tag, value, styleSanitizers)\n                : typeof sanitizer == 'function'\n                ? sanitizer(value, tag)\n                : typeof sanitizer === 'boolean'\n                ? sanitizer\n                    ? value\n                    : null\n                : AllowedAttributes.indexOf(name) >= 0 || name.indexOf('data-') == 0\n                ? value\n                : null;\n\n        if (\n            newValue !== null &&\n            newValue !== undefined &&\n            !newValue.match(/s\\n*c\\n*r\\n*i\\n*p\\n*t\\n*:/i) // match script: with any NewLine inside. Browser will ignore those NewLine char and still treat it as script prefix\n        ) {\n            element.setAttribute(name, newValue);\n        }\n    }\n\n    return element;\n}\n\nfunction processStyles(\n    tagName: string,\n    value: string,\n    styleSanitizers?: Readonly<Record<string, ValueSanitizer>>\n) {\n    const pairs = value.split(';');\n    const result: string[] = [];\n\n    pairs.forEach(pair => {\n        const valueIndex = pair.indexOf(':');\n        const name = pair.slice(0, valueIndex).trim();\n        let value: string = pair.slice(valueIndex + 1).trim();\n\n        if (name && value) {\n            if (isCssVariable(value)) {\n                value = processCssVariable(value);\n            }\n\n            const sanitizer = styleSanitizers?.[name];\n            const sanitizedValue =\n                typeof sanitizer == 'function'\n                    ? sanitizer(value, tagName)\n                    : sanitizer === false\n                    ? null\n                    : value;\n\n            if (\n                !!sanitizedValue &&\n                sanitizedValue != 'inherit' &&\n                sanitizedValue != 'initial' &&\n                sanitizedValue.indexOf('expression') < 0 &&\n                !name.startsWith('-') &&\n                DefaultStyleValue[name] != sanitizedValue\n            ) {\n                result.push(`${name}:${sanitizedValue}`);\n            }\n        }\n    });\n\n    return result.join(';');\n}\n\nfunction processCssVariable(value: string): string {\n    const match = VARIABLE_REGEX.exec(value);\n    return match?.[2] || ''; // Without fallback value, we don't know what does the original value mean, so ignore it\n}\n\nfunction isCssVariable(value: string): boolean {\n    return value.indexOf(VARIABLE_PREFIX) == 0;\n}\n","import type { DefaultImplicitFormatMap } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * A map from tag name to its default implicit formats\n */\nexport const defaultContentModelFormatMap: DefaultImplicitFormatMap = {\n    a: {\n        underline: true,\n    },\n    blockquote: {\n        marginTop: '1em',\n        marginBottom: '1em',\n        marginLeft: '40px',\n        marginRight: '40px',\n    },\n    code: {\n        fontFamily: 'monospace',\n    },\n    h1: {\n        fontWeight: 'bold',\n        fontSize: '2em',\n    },\n    h2: {\n        fontWeight: 'bold',\n        fontSize: '1.5em',\n    },\n    h3: {\n        fontWeight: 'bold',\n        fontSize: '1.17em',\n    },\n    h4: {\n        fontWeight: 'bold',\n        fontSize: '1em', // Set this default value here to overwrite existing font size when change heading level\n    },\n    h5: {\n        fontWeight: 'bold',\n        fontSize: '0.83em',\n    },\n    h6: {\n        fontWeight: 'bold',\n        fontSize: '0.67em',\n    },\n    p: {\n        marginTop: '1em',\n        marginBottom: '1em',\n    },\n    pre: {\n        fontFamily: 'monospace',\n        whiteSpace: 'pre',\n        marginTop: '1em',\n        marginBottom: '1em',\n    },\n};\n","import type { DefaultStyleMap } from 'roosterjs-content-model-types';\n\nconst blockElement: Partial<CSSStyleDeclaration> = {\n    display: 'block',\n};\n\n/**\n * @internal\n */\nexport const defaultHTMLStyleMap: DefaultStyleMap = {\n    address: blockElement,\n    article: blockElement,\n    aside: blockElement,\n    b: {\n        fontWeight: 'bold',\n    },\n    blockquote: {\n        display: 'block',\n        marginTop: '1em',\n        marginBottom: '1em',\n        marginLeft: '40px',\n        marginRight: '40px',\n    },\n    br: blockElement,\n    center: {\n        display: 'block',\n        textAlign: 'center',\n    },\n    dd: blockElement,\n    div: blockElement,\n    dl: blockElement,\n    dt: blockElement,\n    em: {\n        fontStyle: 'italic',\n    },\n    fieldset: blockElement,\n    figcaption: blockElement,\n    figure: blockElement,\n    footer: blockElement,\n    form: blockElement,\n    h1: {\n        display: 'block',\n        fontWeight: 'bold',\n        fontSize: '2em',\n    },\n    h2: {\n        display: 'block',\n        fontWeight: 'bold',\n        fontSize: '1.5em',\n    },\n    h3: {\n        display: 'block',\n        fontWeight: 'bold',\n        fontSize: '1.17em',\n    },\n    h4: {\n        display: 'block',\n        fontWeight: 'bold',\n    },\n    h5: {\n        display: 'block',\n        fontWeight: 'bold',\n        fontSize: '0.83em',\n    },\n    h6: {\n        display: 'block',\n        fontWeight: 'bold',\n        fontSize: '0.67em',\n    },\n    header: blockElement,\n    hr: blockElement,\n    i: {\n        fontStyle: 'italic',\n    },\n    li: {\n        display: 'list-item',\n    },\n    main: blockElement,\n    nav: blockElement,\n    ol: { ...blockElement, paddingInlineStart: '40px' },\n    p: {\n        display: 'block',\n        marginTop: '1em',\n        marginBottom: '1em',\n    },\n    pre: {\n        display: 'block',\n        fontFamily: 'monospace',\n        whiteSpace: 'pre',\n        marginTop: '1em',\n        marginBottom: '1em',\n    },\n    s: {\n        textDecoration: 'line-through',\n    },\n    section: blockElement,\n    strike: {\n        textDecoration: 'line-through',\n    },\n    strong: {\n        fontWeight: 'bold',\n    },\n    sub: {\n        verticalAlign: 'sub',\n        fontSize: 'smaller',\n    },\n    sup: {\n        verticalAlign: 'super',\n        fontSize: 'smaller',\n    },\n    table: {\n        display: 'table',\n        boxSizing: 'border-box',\n    },\n    td: {\n        display: 'table-cell',\n    },\n    th: {\n        display: 'table-cell',\n    },\n    u: {\n        textDecoration: 'underline',\n    },\n    ul: { ...blockElement, paddingInlineStart: '40px' },\n};\n","import { defaultProcessorMap } from './defaultProcessors';\nimport { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport {\n    defaultFormatKeysPerCategory,\n    defaultFormatParsers,\n} from '../../formatHandlers/defaultFormatHandlers';\nimport type {\n    ContentModelBlockFormat,\n    DomToModelContext,\n    DomToModelDecoratorContext,\n    DomToModelFormatContext,\n    DomToModelOption,\n    DomToModelSelectionContext,\n    DomToModelSettings,\n    EditorContext,\n    FormatParser,\n    FormatParsers,\n    FormatParsersPerCategory,\n    TextFormatParser,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create context object for DOM to Content Model conversion\n * @param editorContext Context of editor\n * @param options Option array to customize the DOM to Model conversion behavior\n */\nexport function createDomToModelContext(\n    editorContext?: EditorContext,\n    ...options: (DomToModelOption | undefined)[]\n): DomToModelContext {\n    return createDomToModelContextWithConfig(createDomToModelConfig(options), editorContext);\n}\n\n/**\n * Create context object for DOM to Content Model conversion with an existing configure\n * @param config A full config object to define how to convert DOM tree to Content Model\n * @param editorContext Context of editor\n */\nexport function createDomToModelContextWithConfig(\n    config: DomToModelSettings,\n    editorContext?: EditorContext\n) {\n    return Object.assign(\n        {},\n        editorContext,\n        createDomToModelSelectionContext(),\n        createDomToModelFormatContext(editorContext?.isRootRtl),\n        createDomToModelDecoratorContext(),\n        config\n    );\n}\n\nfunction createDomToModelSelectionContext(): DomToModelSelectionContext {\n    return { isInSelection: false };\n}\n\nfunction createDomToModelFormatContext(isRootRtl?: boolean): DomToModelFormatContext {\n    const blockFormat: ContentModelBlockFormat = isRootRtl ? { direction: 'rtl' } : {};\n\n    return {\n        blockFormat,\n        segmentFormat: {},\n\n        listFormat: {\n            levels: [],\n            threadItemCounts: [],\n        },\n    };\n}\n\nfunction createDomToModelDecoratorContext(): DomToModelDecoratorContext {\n    return {\n        link: {\n            format: {},\n            dataset: {},\n        },\n        code: {\n            format: {},\n        },\n        blockDecorator: {\n            format: {},\n            tagName: '',\n        },\n    };\n}\n\n/**\n * Create Dom to Content Model Config object\n * @param options All customizations of content model creation\n */\nexport function createDomToModelConfig(\n    options: (DomToModelOption | undefined)[]\n): DomToModelSettings {\n    return {\n        elementProcessors: Object.assign(\n            {},\n            defaultProcessorMap,\n            ...options.map(x => x?.processorOverride)\n        ),\n        formatParsers: buildFormatParsers(\n            options.map(x => x?.formatParserOverride),\n            options.map(x => x?.additionalFormatParsers)\n        ),\n        defaultElementProcessors: defaultProcessorMap,\n        defaultFormatParsers,\n    };\n}\n\n/**\n * @internal Export for test only\n * Build format parsers used by DOM to Content Model conversion\n * @param override\n * @param additionalParsersArray\n * @returns\n */\nexport function buildFormatParsers(\n    overrides: (Partial<FormatParsers> | undefined)[] = [],\n    additionalParsersArray: (Partial<FormatParsersPerCategory> | undefined)[] = []\n): FormatParsersPerCategory {\n    const combinedOverrides = Object.assign({}, ...overrides);\n\n    const result = getObjectKeys(defaultFormatKeysPerCategory).reduce(\n        (result, key) => {\n            const value = defaultFormatKeysPerCategory[key]\n                .map(\n                    formatKey =>\n                        (combinedOverrides[formatKey] === undefined\n                            ? defaultFormatParsers[formatKey]\n                            : combinedOverrides[formatKey]) as FormatParser<any>\n                )\n                .concat(\n                    ...additionalParsersArray.map(\n                        parsers => (parsers?.[key] ?? []) as FormatParser<any>[]\n                    )\n                );\n\n            result[key] = value;\n\n            return result;\n        },\n        {\n            text: [] as TextFormatParser[],\n        } as FormatParsersPerCategory\n    );\n\n    additionalParsersArray.forEach(parsers => {\n        if (parsers?.text) {\n            result.text = result.text.concat(parsers.text);\n        }\n    });\n\n    return result;\n}\n","import { brProcessor } from '../processors/brProcessor';\nimport { childProcessor } from '../processors/childProcessor';\nimport { codeProcessor } from '../processors/codeProcessor';\nimport { delimiterProcessor } from '../processors/delimiterProcessor';\nimport { elementProcessor } from '../processors/elementProcessor';\nimport { entityProcessor } from '../processors/entityProcessor';\nimport { fontProcessor } from '../processors/fontProcessor';\nimport { formatContainerProcessor } from '../processors/formatContainerProcessor';\nimport { generalProcessor } from '../processors/generalProcessor';\nimport { headingProcessor } from '../processors/headingProcessor';\nimport { hrProcessor } from '../processors/hrProcessor';\nimport { imageProcessor } from '../processors/imageProcessor';\nimport { knownElementProcessor } from '../processors/knownElementProcessor';\nimport { linkProcessor } from '../processors/linkProcessor';\nimport { listItemProcessor } from '../processors/listItemProcessor';\nimport { listProcessor } from '../processors/listProcessor';\nimport { pProcessor } from '../processors/pProcessor';\nimport { tableProcessor } from '../processors/tableProcessor';\nimport { textProcessor } from '../processors/textProcessor';\nimport type { ElementProcessorMap } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const defaultProcessorMap: ElementProcessorMap = {\n    a: linkProcessor,\n    b: knownElementProcessor,\n    blockquote: knownElementProcessor,\n    br: brProcessor,\n    code: codeProcessor,\n    div: knownElementProcessor,\n    em: knownElementProcessor,\n    font: fontProcessor,\n    i: knownElementProcessor,\n    img: imageProcessor,\n    h1: headingProcessor,\n    h2: headingProcessor,\n    h3: headingProcessor,\n    h4: headingProcessor,\n    h5: headingProcessor,\n    h6: headingProcessor,\n    hr: hrProcessor,\n    li: listItemProcessor,\n    ol: listProcessor,\n    p: pProcessor,\n    pre: formatContainerProcessor,\n    s: knownElementProcessor,\n    section: knownElementProcessor,\n    span: knownElementProcessor,\n    strike: knownElementProcessor,\n    strong: knownElementProcessor,\n    sub: knownElementProcessor,\n    sup: knownElementProcessor,\n    table: tableProcessor,\n    u: knownElementProcessor,\n    ul: listProcessor,\n\n    '*': generalProcessor,\n    '#text': textProcessor,\n    element: elementProcessor,\n    entity: entityProcessor,\n    child: childProcessor,\n    delimiter: delimiterProcessor,\n};\n","import { createContentModelDocument } from '../modelApi/creators/createContentModelDocument';\nimport { normalizeContentModel } from '../modelApi/common/normalizeContentModel';\nimport type {\n    ContentModelDocument,\n    DOMSelection,\n    DomToModelContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create Content Model from DOM tree in this editor\n * @param root Root element of DOM tree to create Content Model from\n * @param context Context object for DOM to Content Model conversion\n * @param selection Selection that already exists in content\n * @returns A ContentModelDocument object that contains all the models created from the give root element\n */\nexport function domToContentModel(\n    root: HTMLElement | DocumentFragment,\n    context: DomToModelContext,\n    selection?: DOMSelection\n): ContentModelDocument {\n    const model = createContentModelDocument(context.defaultFormat);\n\n    context.selection = selection;\n    context.elementProcessors.child(model, root, context);\n\n    normalizeContentModel(model);\n\n    return model;\n}\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { ContextStyles } from './formatContainerProcessor';\nimport { createParagraph } from '../../modelApi/creators/createParagraph';\nimport { parseFormat } from '../utils/parseFormat';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelSegmentFormat,\n    DomToModelContext,\n} from 'roosterjs-content-model-types';\n\nconst SegmentDecoratorTags = ['A', 'CODE'];\n\n/**\n * @internal\n */\nexport function blockProcessor(\n    group: ContentModelBlockGroup,\n    element: HTMLElement,\n    context: DomToModelContext,\n    segmentFormat?: ContentModelSegmentFormat\n) {\n    const decorator = context.blockDecorator.tagName ? context.blockDecorator : undefined;\n    const isSegmentDecorator = SegmentDecoratorTags.indexOf(element.tagName) >= 0;\n\n    parseFormat(element, context.formatParsers.block, context.blockFormat, context);\n\n    const blockFormat = { ...context.blockFormat };\n\n    parseFormat(element, context.formatParsers.container, blockFormat, context);\n\n    ContextStyles.forEach(style => {\n        if (blockFormat[style]) {\n            context.blockFormat[style] = blockFormat[style];\n        }\n    });\n\n    if (!isSegmentDecorator) {\n        const paragraph = createParagraph(\n            false /*isImplicit*/,\n            blockFormat,\n            segmentFormat,\n            decorator\n        );\n\n        addBlock(group, paragraph);\n    }\n\n    context.elementProcessors.child(group, element, context);\n}\n","import { addSegment } from '../../modelApi/common/addSegment';\nimport { createBr } from '../../modelApi/creators/createBr';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const brProcessor: ElementProcessor<HTMLBRElement> = (group, element, context) => {\n    const br = createBr(context.segmentFormat);\n\n    if (context.isInSelection) {\n        br.isSelected = true;\n    }\n\n    const paragraph = addSegment(group, br, context.blockFormat);\n    context.domIndexer?.onSegment(element, paragraph, [br]);\n};\n","import { addSelectionMarker } from '../utils/addSelectionMarker';\nimport { getRegularSelectionOffsets } from '../utils/getRegularSelectionOffsets';\nimport { isNodeOfType } from '../../domUtils/isNodeOfType';\nimport type {\n    ContentModelBlockGroup,\n    DomToModelContext,\n    ElementProcessor,\n} from 'roosterjs-content-model-types';\n\n/**\n * Content Model Element Processor for child elements\n * @param group The parent block group\n * @param parent Parent DOM node to process\n * @param context DOM to Content Model context\n */\nexport const childProcessor: ElementProcessor<ParentNode> = (\n    group: ContentModelBlockGroup,\n    parent: ParentNode,\n    context: DomToModelContext\n) => {\n    const [nodeStartOffset, nodeEndOffset] = getRegularSelectionOffsets(context, parent);\n    let index = 0;\n\n    for (let child = parent.firstChild; child; child = child.nextSibling) {\n        handleRegularSelection(index, context, group, nodeStartOffset, nodeEndOffset, parent);\n\n        processChildNode(group, child, context);\n\n        index++;\n    }\n\n    handleRegularSelection(index, context, group, nodeStartOffset, nodeEndOffset, parent);\n};\n\n/**\n * Helper function for processing child node\n * @param group The parent block group\n * @param parent Parent DOM node to process\n * @param context DOM to Content Model context\n *\n */\nexport function processChildNode(\n    group: ContentModelBlockGroup,\n    child: Node,\n    context: DomToModelContext\n) {\n    if (isNodeOfType(child, 'ELEMENT_NODE') && child.style.display != 'none') {\n        context.elementProcessors.element(group, child, context);\n    } else if (isNodeOfType(child, 'TEXT_NODE')) {\n        context.elementProcessors['#text'](group, child, context);\n    }\n}\n\n/**\n * Helper function to handle regular (range based) selection when process child node\n * @param index Index of current child node in its parent\n * @param context DOM to Content Model context\n * @param group The parent block group\n * @param nodeStartOffset Start offset of current regular selection\n * @param nodeEndOffset  End offset of current regular selection\n * @param container The container node of this selection\n */\nexport function handleRegularSelection(\n    index: number,\n    context: DomToModelContext,\n    group: ContentModelBlockGroup,\n    nodeStartOffset: number,\n    nodeEndOffset: number,\n    container?: Node\n) {\n    if (index == nodeStartOffset) {\n        context.isInSelection = true;\n\n        addSelectionMarker(group, context, container, index);\n    }\n\n    if (index == nodeEndOffset && context.selection?.type == 'range') {\n        if (!context.selection.range.collapsed) {\n            addSelectionMarker(group, context, container, index);\n        }\n        context.isInSelection = false;\n    }\n}\n","import { knownElementProcessor } from './knownElementProcessor';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const codeProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    stackFormat(context, { code: 'codeDefault' }, () => {\n        parseFormat(element, context.formatParsers.code, context.code.format, context);\n\n        knownElementProcessor(group, element, context);\n    });\n};\n","import { addSelectionMarker } from '../utils/addSelectionMarker';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * @param group\n * @param node\n * @param context\n */\nexport const delimiterProcessor: ElementProcessor<Node> = (group, node, context) => {\n    const range = context.selection?.type == 'range' ? context.selection.range : null;\n\n    if (range) {\n        if (node.contains(range.startContainer)) {\n            context.isInSelection = true;\n\n            addSelectionMarker(group, context);\n        }\n\n        if (context.selection?.type == 'range' && node.contains(range.endContainer)) {\n            if (!context.selection.range.collapsed) {\n                addSelectionMarker(group, context);\n            }\n\n            context.isInSelection = false;\n        }\n    }\n};\n","import { isEntityDelimiter, isEntityElement } from '../../domUtils/entityUtils';\nimport type {\n    DomToModelContext,\n    ElementProcessor,\n    ElementProcessorMap,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * @param group\n * @param element\n * @param context\n */\nexport const elementProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const tagName = element.tagName.toLowerCase() as keyof ElementProcessorMap;\n    const processor = (tryGetProcessorForEntity(element, context) ||\n        tryGetProcessorForDelimiter(element, context) ||\n        context.elementProcessors[tagName] ||\n        (tagName.indexOf(':') >= 0 && context.elementProcessors.child) ||\n        context.elementProcessors['*']) as ElementProcessor<Node>;\n    processor(group, element, context);\n};\n\nfunction tryGetProcessorForEntity(element: HTMLElement, context: DomToModelContext) {\n    return isEntityElement(element) || element.contentEditable == 'false' // For readonly element, treat as an entity\n        ? context.elementProcessors.entity\n        : null;\n}\n\nfunction tryGetProcessorForDelimiter(element: HTMLElement, context: DomToModelContext) {\n    return isEntityDelimiter(element) ? context.elementProcessors.delimiter : null;\n}\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { addSegment } from '../../modelApi/common/addSegment';\nimport { createEntity } from '../../modelApi/creators/createEntity';\nimport { isBlockElement } from '../utils/isBlockElement';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * Content Model Element Processor for entity\n * @param group The parent block group\n * @param parent Parent DOM node to process\n * @param context DOM to Content Model context\n */\nexport const entityProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const isBlockEntity =\n        isBlockElement(element) ||\n        (element.style.display == 'inline-block' && element.style.width == '100%');\n\n    stackFormat(\n        context,\n        { segment: isBlockEntity ? 'empty' : undefined, paragraph: 'empty' },\n        () => {\n            const entityModel = createEntity(element, true /*isReadonly*/, context.segmentFormat);\n\n            parseFormat(element, context.formatParsers.entity, entityModel.entityFormat, context);\n\n            if (context.isInSelection) {\n                entityModel.isSelected = true;\n            }\n\n            if (isBlockEntity) {\n                addBlock(group, entityModel);\n            } else {\n                const paragraph = addSegment(group, entityModel);\n                context.domIndexer?.onSegment(element, paragraph, [entityModel]);\n            }\n        }\n    );\n};\n","import { isBlockElement } from '../utils/isBlockElement';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\nconst FontSizes = ['10px', '13px', '16px', '18px', '24px', '32px', '48px'];\n\nfunction getFontSize(size: string | null) {\n    const intSize = parseInt(size || '');\n\n    if (Number.isNaN(intSize)) {\n        return undefined;\n    } else if (intSize < 1) {\n        return FontSizes[0];\n    } else if (intSize > FontSizes.length) {\n        return FontSizes[FontSizes.length - 1];\n    } else {\n        return FontSizes[intSize - 1];\n    }\n}\n\n/**\n * @internal\n */\nexport const fontProcessor: ElementProcessor<HTMLFontElement> = (group, element, context) => {\n    stackFormat(\n        context,\n        {\n            segment: isBlockElement(element) ? 'shallowCloneForBlock' : 'shallowClone',\n        },\n        () => {\n            const fontFamily = element.getAttribute('face');\n            const fontSize = getFontSize(element.getAttribute('size'));\n            const textColor = element.getAttribute('color');\n            const format = context.segmentFormat;\n\n            if (fontFamily) {\n                format.fontFamily = fontFamily;\n            }\n\n            if (fontSize) {\n                format.fontSize = fontSize;\n            }\n\n            if (textColor) {\n                format.textColor = textColor;\n            }\n\n            parseFormat(element, context.formatParsers.segment, context.segmentFormat, context);\n\n            context.elementProcessors.child(group, element, context);\n        }\n    );\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { createFormatContainer } from '../../modelApi/creators/createFormatContainer';\nimport { createParagraph } from '../../modelApi/creators/createParagraph';\nimport { getDefaultStyle } from '../utils/getDefaultStyle';\nimport { parseFormat } from '../utils/parseFormat';\nimport { setParagraphNotImplicit } from '../../modelApi/block/setParagraphNotImplicit';\nimport { stackFormat } from '../utils/stackFormat';\nimport type {\n    ContentModelFormatContainer,\n    ContentModelFormatContainerFormat,\n    ContentModelParagraph,\n    ElementProcessor,\n    MarginFormat,\n    PaddingFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const ContextStyles: (keyof (MarginFormat & PaddingFormat))[] = [\n    'marginLeft',\n    'marginRight',\n    'paddingLeft',\n    'paddingRight',\n];\n\n/**\n * @internal\n */\nexport const formatContainerProcessor: ElementProcessor<HTMLElement> = (\n    group,\n    element,\n    context\n) => {\n    stackFormat(context, { segment: 'shallowCloneForBlock', paragraph: 'shallowClone' }, () => {\n        parseFormat(element, context.formatParsers.block, context.blockFormat, context);\n        parseFormat(element, context.formatParsers.segmentOnBlock, context.segmentFormat, context);\n\n        const format: ContentModelFormatContainerFormat = {\n            ...context.blockFormat,\n        };\n\n        parseFormat(element, context.formatParsers.container, format, context);\n\n        const tagName =\n            getDefaultStyle(element).display == 'block' ? element.tagName.toLowerCase() : 'div';\n        const formatContainer = createFormatContainer(tagName, format);\n\n        // It is possible to inherit margin left/right styles from parent DIV or other containers,\n        // since we are going into a deeper level of format container now,\n        // the container will render these styles so no need to keep them in context format\n        ContextStyles.forEach(style => {\n            delete context.blockFormat[style];\n        });\n\n        context.elementProcessors.child(formatContainer, element, context);\n\n        if (element.style.fontSize && parseInt(element.style.fontSize) == 0) {\n            formatContainer.zeroFontSize = true;\n        }\n\n        if (shouldFallbackToParagraph(formatContainer)) {\n            // For DIV container that only has one paragraph child, container style can be merged into paragraph\n            // and no need to have this container\n            const paragraph = formatContainer.blocks[0] as ContentModelParagraph;\n\n            if (formatContainer.zeroFontSize) {\n                paragraph.segmentFormat = Object.assign({}, paragraph.segmentFormat, {\n                    fontSize: '0',\n                });\n            }\n\n            Object.assign(paragraph.format, formatContainer.format);\n            setParagraphNotImplicit(paragraph);\n            addBlock(group, paragraph);\n        } else {\n            addBlock(group, formatContainer);\n        }\n    });\n\n    addBlock(group, createParagraph(true /*isImplicit*/, context.blockFormat));\n};\n\nfunction shouldFallbackToParagraph(formatContainer: ContentModelFormatContainer) {\n    const firstChild = formatContainer.blocks[0];\n\n    return (\n        formatContainer.tagName == 'div' &&\n        formatContainer.blocks.length == 1 &&\n        firstChild.blockType == 'Paragraph' &&\n        firstChild.isImplicit\n    );\n}\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { addDecorators } from '../../modelApi/common/addDecorators';\nimport { addSegment } from '../../modelApi/common/addSegment';\nimport { createGeneralBlock } from '../../modelApi/creators/createGeneralBlock';\nimport { createGeneralSegment } from '../../modelApi/creators/createGeneralSegment';\nimport { isBlockElement } from '../utils/isBlockElement';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\nconst generalBlockProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const block = createGeneralBlock(element);\n    const isSelectedBefore = context.isInSelection;\n\n    stackFormat(\n        context,\n        {\n            segment: 'empty',\n            paragraph: 'empty',\n            link: 'empty',\n        },\n        () => {\n            addBlock(group, block);\n\n            parseFormat(element, context.formatParsers.general, block.format, context);\n\n            context.elementProcessors.child(block, element, context);\n        }\n    );\n\n    if (isSelectedBefore && context.isInSelection) {\n        block.isSelected = true;\n    }\n};\n\nconst generalSegmentProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const segment = createGeneralSegment(element, context.segmentFormat);\n    const isSelectedBefore = context.isInSelection;\n\n    addDecorators(segment, context);\n    const paragraph = addSegment(group, segment);\n    context.domIndexer?.onSegment(element, paragraph, [segment]);\n\n    stackFormat(\n        context,\n        {\n            segment:\n                'empty' /*clearFormat, General segment will include all properties and styles when generate back to HTML, so no need to carry over existing segment format*/,\n        },\n        () => {\n            parseFormat(element, context.formatParsers.general, segment.format, context);\n\n            context.elementProcessors.child(segment, element, context);\n        }\n    );\n\n    if (isSelectedBefore && context.isInSelection) {\n        segment.isSelected = true;\n    }\n};\n\n/**\n * @internal\n */\nexport const generalProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const processor = isBlockElement(element) ? generalBlockProcessor : generalSegmentProcessor;\n\n    processor(group, element, context);\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { blockProcessor } from './blockProcessor';\nimport { createParagraph } from '../../modelApi/creators/createParagraph';\nimport { createParagraphDecorator } from '../../modelApi/creators/createParagraphDecorator';\nimport { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ContentModelSegmentFormat, ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const headingProcessor: ElementProcessor<HTMLHeadingElement> = (group, element, context) => {\n    stackFormat(\n        context,\n        { segment: 'shallowCloneForBlock', paragraph: 'shallowClone', blockDecorator: 'empty' },\n        () => {\n            const segmentFormat: ContentModelSegmentFormat = {};\n\n            parseFormat(element, context.formatParsers.segmentOnBlock, segmentFormat, context);\n\n            // These formats are already declared on heading element, no need to keep them in context.\n            // And we should not duplicate them in context, either. Because when we want to turn off heading,\n            // inner text should not keep those text format from heading.\n            getObjectKeys(segmentFormat).forEach(key => {\n                delete context.segmentFormat[key];\n            });\n\n            context.blockDecorator = createParagraphDecorator(element.tagName, segmentFormat);\n\n            blockProcessor(group, element, context);\n        }\n    );\n\n    addBlock(group, createParagraph(true /*isImplicit*/, context.blockFormat));\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { createDivider } from '../../modelApi/creators/createDivider';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const hrProcessor: ElementProcessor<HTMLHRElement> = (group, element, context) => {\n    stackFormat(\n        context,\n        {\n            paragraph: 'shallowClone',\n        },\n        () => {\n            parseFormat(element, context.formatParsers.divider, context.blockFormat, context);\n\n            const hr = createDivider('hr', context.blockFormat);\n\n            if (element.size) {\n                hr.size = element.size;\n            }\n\n            if (context.isInSelection) {\n                hr.isSelected = true;\n            }\n\n            addBlock(group, hr);\n        }\n    );\n};\n","import { addDecorators } from '../../modelApi/common/addDecorators';\nimport { addSegment } from '../../modelApi/common/addSegment';\nimport { createImage } from '../../modelApi/creators/createImage';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ContentModelImageFormat, ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const imageProcessor: ElementProcessor<HTMLImageElement> = (group, element, context) => {\n    stackFormat(context, { segment: 'shallowClone' }, () => {\n        const imageFormat: ContentModelImageFormat = context.segmentFormat;\n\n        // Use getAttribute('src') instead of retrieving src directly, in case the src has port and may be stripped by browser\n        const src = element.getAttribute('src') ?? '';\n\n        parseFormat(element, context.formatParsers.segment, imageFormat, context);\n        parseFormat(element, context.formatParsers.image, imageFormat, context);\n        parseFormat(element, context.formatParsers.block, context.blockFormat, context);\n\n        const image = createImage(src, imageFormat);\n        const alt = element.alt;\n        const title = element.title;\n\n        parseFormat(element, context.formatParsers.dataset, image.dataset, context);\n        addDecorators(image, context);\n\n        if (alt) {\n            image.alt = alt;\n        }\n        if (title) {\n            image.title = title;\n        }\n        if (context.isInSelection) {\n            image.isSelected = true;\n        }\n        if (context.selection?.type == 'image' && context.selection.image == element) {\n            image.isSelectedAsImageSelection = true;\n            image.isSelected = true;\n        }\n\n        const paragraph = addSegment(group, image);\n        context.domIndexer?.onSegment(element, paragraph, [image]);\n    });\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { blockProcessor } from './blockProcessor';\nimport { createParagraph } from '../../modelApi/creators/createParagraph';\nimport { formatContainerProcessor } from './formatContainerProcessor';\nimport { getDefaultStyle } from '../utils/getDefaultStyle';\nimport { isBlockElement } from '../utils/isBlockElement';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type {\n    ContentModelSegmentFormat,\n    DomToModelContext,\n    ElementProcessor,\n} from 'roosterjs-content-model-types';\n\nconst FormatContainerTriggerStyles: (keyof CSSStyleDeclaration)[] = [\n    'marginBottom',\n    'marginTop',\n    'paddingBottom',\n    'paddingTop',\n    'paddingLeft',\n    'paddingRight',\n    'borderTopWidth',\n    'borderBottomWidth',\n    'borderLeftWidth',\n    'borderRightWidth',\n    'width',\n    'height',\n    'maxWidth',\n    'maxHeight',\n    'minWidth',\n    'minHeight',\n];\nconst ByPassFormatContainerTags = ['H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'P', 'A'];\nconst SegmentDecoratorTags = ['A', 'CODE'];\n\n/**\n * @internal\n */\nexport const knownElementProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const isBlock = isBlockElement(element);\n\n    if (\n        (isBlock || element.style.display == 'inline-block') && // For inline-block here, we will also check if it should be represented as Format Container\n        shouldUseFormatContainer(element, context)\n    ) {\n        formatContainerProcessor(group, element, context);\n    } else if (isBlock) {\n        const decorator = context.blockDecorator.tagName ? context.blockDecorator : undefined;\n        const isSegmentDecorator = SegmentDecoratorTags.indexOf(element.tagName) >= 0;\n\n        stackFormat(context, { segment: 'shallowCloneForBlock', paragraph: 'shallowClone' }, () => {\n            const segmentFormat: ContentModelSegmentFormat = {};\n\n            parseFormat(element, context.formatParsers.segmentOnBlock, segmentFormat, context);\n            Object.assign(context.segmentFormat, segmentFormat);\n\n            blockProcessor(group, element, context, segmentFormat);\n        });\n\n        if (isBlock && !isSegmentDecorator) {\n            addBlock(\n                group,\n                createParagraph(\n                    true /*isImplicit*/,\n                    context.blockFormat,\n                    undefined /*segmentFormat*/,\n                    decorator\n                )\n            );\n        }\n    } else {\n        stackFormat(\n            context,\n            {\n                segment: 'shallowClone',\n                paragraph: 'shallowClone',\n                link: 'cloneFormat',\n            },\n            () => {\n                parseFormat(element, context.formatParsers.segment, context.segmentFormat, context);\n\n                if (context.link.format.href && element.tagName != 'A') {\n                    parseFormat(\n                        element,\n                        context.formatParsers.segmentUnderLink,\n                        context.link.format,\n                        context\n                    );\n                }\n\n                context.elementProcessors.child(group, element, context);\n            }\n        );\n    }\n};\n\nfunction shouldUseFormatContainer(element: HTMLElement, context: DomToModelContext) {\n    // For those tags that we know we should not use format container, just return false\n    if (ByPassFormatContainerTags.indexOf(element.tagName) >= 0) {\n        return false;\n    }\n\n    const style = element.style;\n    const defaultStyle = getDefaultStyle(element);\n\n    const bgcolor = style.getPropertyValue('background-color');\n\n    // For block element with background, we need to use format container\n    if (bgcolor && bgcolor != 'transparent') {\n        return true;\n    }\n\n    // For block element with positive value of border width or top/bottom margin/padding,\n    // we need to use format container\n    if (\n        FormatContainerTriggerStyles.some(\n            key => parseInt((style[key] as string) || (defaultStyle[key] as string) || '') > 0\n        )\n    ) {\n        return true;\n    }\n\n    // For margin left/right with value \"auto\", we need to use format container\n    if (style.marginLeft == 'auto' || style.marginRight == 'auto') {\n        return true;\n    }\n\n    // For element with \"align\" attribute, we need to use format container\n    if (element.getAttribute('align')) {\n        return true;\n    }\n\n    return false;\n}\n","import { knownElementProcessor } from './knownElementProcessor';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const linkProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    if (element.hasAttribute('href')) {\n        stackFormat(context, { link: 'linkDefault' }, () => {\n            parseFormat(element, context.formatParsers.link, context.link.format, context);\n            parseFormat(element, context.formatParsers.dataset, context.link.dataset, context);\n\n            knownElementProcessor(group, element, context);\n        });\n    } else {\n        // A tag without href, can be treated as normal SPAN tag\n        knownElementProcessor(group, element, context);\n    }\n};\n","import { createListItem } from '../../modelApi/creators/createListItem';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const listItemProcessor: ElementProcessor<HTMLLIElement> = (group, element, context) => {\n    const { listFormat } = context;\n\n    if (listFormat.listParent && listFormat.levels.length > 0) {\n        stackFormat(\n            context,\n            {\n                segment: 'shallowCloneForBlock',\n            },\n            () => {\n                parseFormat(\n                    element,\n                    context.formatParsers.segmentOnBlock,\n                    context.segmentFormat,\n                    context\n                );\n\n                const listItem = createListItem(listFormat.levels, context.segmentFormat);\n                parseFormat(\n                    element,\n                    context.formatParsers.listItemElement,\n                    listItem.format,\n                    context\n                );\n\n                listFormat.listParent!.blocks.push(listItem);\n\n                parseFormat(\n                    element,\n                    context.formatParsers.listItemThread,\n                    listItem.levels[listItem.levels.length - 1].format,\n                    context\n                );\n\n                context.elementProcessors.child(listItem, element, context);\n\n                const firstChild = listItem.blocks[0];\n\n                if (\n                    listItem.blocks.length == 1 &&\n                    firstChild.blockType == 'Paragraph' &&\n                    firstChild.isImplicit\n                ) {\n                    Object.assign(listItem.format, firstChild.format);\n                    firstChild.format = {};\n                }\n            }\n        );\n    } else {\n        const currentBlocks = listFormat.listParent?.blocks;\n        const lastItem = currentBlocks?.[currentBlocks?.length - 1];\n\n        context.elementProcessors['*'](\n            lastItem?.blockType == 'BlockGroup' ? lastItem : group,\n            element,\n            context\n        );\n    }\n};\n","import { createListLevel } from '../../modelApi/creators/createListLevel';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ContentModelListLevel, ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const listProcessor: ElementProcessor<HTMLOListElement | HTMLUListElement> = (\n    group,\n    element,\n    context\n) => {\n    stackFormat(\n        context,\n        {\n            segment: 'shallowCloneForBlock',\n            paragraph: 'shallowCloneForGroup',\n        },\n        () => {\n            const level: ContentModelListLevel = createListLevel(\n                element.tagName as 'OL' | 'UL',\n                context.blockFormat\n            );\n            const { listFormat } = context;\n\n            parseFormat(element, context.formatParsers.dataset, level.dataset, context);\n            parseFormat(element, context.formatParsers.listLevelThread, level.format, context);\n            parseFormat(element, context.formatParsers.listLevel, level.format, context);\n            parseFormat(element, context.formatParsers.segment, context.segmentFormat, context);\n\n            const originalListParent = listFormat.listParent;\n\n            listFormat.listParent = listFormat.listParent || group;\n            listFormat.levels.push(level);\n\n            try {\n                context.elementProcessors.child(group, element, context);\n            } finally {\n                listFormat.levels.pop();\n                listFormat.listParent = originalListParent;\n            }\n        }\n    );\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { blockProcessor } from './blockProcessor';\nimport { createParagraph } from '../../modelApi/creators/createParagraph';\nimport { createParagraphDecorator } from '../../modelApi/creators/createParagraphDecorator';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ContentModelSegmentFormat, ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const pProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    stackFormat(\n        context,\n        { blockDecorator: 'empty', segment: 'shallowCloneForBlock', paragraph: 'shallowClone' },\n        () => {\n            context.blockDecorator = createParagraphDecorator(element.tagName);\n\n            const segmentFormat: ContentModelSegmentFormat = {};\n\n            parseFormat(element, context.formatParsers.segmentOnBlock, segmentFormat, context);\n            Object.assign(context.segmentFormat, segmentFormat);\n\n            blockProcessor(group, element, context, segmentFormat);\n        }\n    );\n\n    addBlock(group, createParagraph(true /*isImplicit*/, context.blockFormat));\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { createTable } from '../../modelApi/creators/createTable';\nimport { createTableCell } from '../../modelApi/creators/createTableCell';\nimport { getBoundingClientRect } from '../utils/getBoundingClientRect';\nimport { isElementOfType } from '../../domUtils/isElementOfType';\nimport { isNodeOfType } from '../../domUtils/isNodeOfType';\nimport { parseFormat } from '../utils/parseFormat';\nimport { parseValueWithUnit } from '../../formatHandlers/utils/parseValueWithUnit';\nimport { stackFormat } from '../utils/stackFormat';\nimport type {\n    ContentModelTableCellFormat,\n    DatasetFormat,\n    DomToModelContext,\n    ElementProcessor,\n    SizeFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Content Model Element Processor for table\n *\n * For Table with merged/splitted cells, HTML uses colSpan and rowSpan attributes to specify how it should be rendered.\n * To make it easier to edit a table, we will use a different way to describe table.\n *\n * 1. For a m * n table (m rows, n columns), we always create a m * n array for the cells.\n * 2. For a regular table cell, it is mapped to one item of this array\n * 3. For a merged/splitted table cell, it will has colSpan/rowSpan value. We also created TableCell model for those spanned\n * cells, and use \"spanLeft\" and \"spanAbove\" to mark its state\n * 4. When edit table, we always edit on this mapped m * n array because it always has an item for each cell\n * 5. When write back to DOM, we create TD/TH elements for those non-spanned cells, and mark its colSpan/rowSpan value according\n * its neighbour cell's spanLeft/spanAbove attribute\n * @param group The parent block group\n * @param parent Parent DOM node to process\n * @param context DOM to Content Model context\n */\nexport const tableProcessor: ElementProcessor<HTMLTableElement> = (\n    group,\n    tableElement,\n    context\n) => {\n    stackFormat(\n        context,\n        { segment: 'shallowCloneForBlock', paragraph: 'shallowCloneForGroup' },\n        () => {\n            parseFormat(tableElement, context.formatParsers.block, context.blockFormat, context);\n\n            const table = createTable(tableElement.rows.length, context.blockFormat);\n            const tableSelection = context.selection?.type == 'table' ? context.selection : null;\n            const selectedTable = tableSelection?.table;\n            const hasTableSelection = selectedTable == tableElement;\n\n            if (context.allowCacheElement) {\n                table.cachedElement = tableElement;\n            }\n\n            context.domIndexer?.onTable(tableElement, table);\n\n            parseFormat(tableElement, context.formatParsers.table, table.format, context);\n            parseFormat(tableElement, context.formatParsers.tableBorder, table.format, context);\n            parseFormat(\n                tableElement,\n                context.formatParsers.segmentOnBlock,\n                context.segmentFormat,\n                context\n            );\n            parseFormat(tableElement, context.formatParsers.dataset, table.dataset, context);\n            addBlock(group, table);\n\n            const columnPositions: (number | undefined)[] = [0];\n            const hasColGroup = processColGroup(tableElement, context, columnPositions);\n            const rowPositions: number[] = [0];\n            const zoomScale = context.zoomScale || 1;\n\n            for (let row = 0; row < tableElement.rows.length; row++) {\n                const tr = tableElement.rows[row];\n                const tableRow = table.rows[row];\n\n                const tbody = tr.parentNode;\n\n                if (\n                    isNodeOfType(tbody, 'ELEMENT_NODE') &&\n                    (isElementOfType(tbody, 'tbody') ||\n                        isElementOfType(tbody, 'thead') ||\n                        isElementOfType(tbody, 'tfoot'))\n                ) {\n                    parseFormat(tbody, context.formatParsers.tableRow, tableRow.format, context);\n                } else if (context.allowCacheElement) {\n                    tableRow.cachedElement = tr;\n                }\n\n                parseFormat(tr, context.formatParsers.tableRow, tableRow.format, context);\n\n                stackFormat(context, { paragraph: 'shallowClone', segment: 'shallowClone' }, () => {\n                    const parent = tr.parentElement;\n                    const parentTag = parent?.tagName;\n\n                    if (\n                        parent &&\n                        (parentTag == 'TBODY' || parentTag == 'THEAD' || parentTag == 'TFOOT')\n                    ) {\n                        // If there is TBODY around TR, retrieve format from TBODY first, in case some format are declared there\n                        parseFormat(\n                            parent,\n                            context.formatParsers.block,\n                            context.blockFormat,\n                            context\n                        );\n                        parseFormat(\n                            parent,\n                            context.formatParsers.segmentOnBlock,\n                            context.segmentFormat,\n                            context\n                        );\n                    }\n\n                    parseFormat(tr, context.formatParsers.block, context.blockFormat, context);\n                    parseFormat(\n                        tr,\n                        context.formatParsers.segmentOnBlock,\n                        context.segmentFormat,\n                        context\n                    );\n\n                    for (\n                        let sourceCol = 0, targetCol = 0;\n                        sourceCol < tr.cells.length;\n                        sourceCol++\n                    ) {\n                        for (; tableRow.cells[targetCol]; targetCol++) {}\n\n                        const td = tr.cells[sourceCol];\n                        const hasSelectionBeforeCell = context.isInSelection;\n                        const colEnd = targetCol + td.colSpan;\n                        const rowEnd = row + td.rowSpan;\n                        const needCalcWidth = columnPositions[colEnd] === undefined;\n                        const needCalcHeight = rowPositions[rowEnd] === undefined;\n\n                        if (needCalcWidth || needCalcHeight) {\n                            const rect = getBoundingClientRect(td);\n\n                            if (rect.width > 0 || rect.height > 0) {\n                                if (needCalcWidth) {\n                                    const pos = columnPositions[targetCol];\n\n                                    columnPositions[colEnd] =\n                                        (typeof pos == 'number' ? pos : 0) + rect.width / zoomScale;\n                                }\n\n                                if (needCalcHeight) {\n                                    rowPositions[rowEnd] =\n                                        rowPositions[row] + rect.height / zoomScale;\n                                }\n                            }\n                        }\n\n                        stackFormat(\n                            context,\n                            { paragraph: 'shallowClone', segment: 'shallowClone' },\n                            () => {\n                                parseFormat(\n                                    td,\n                                    context.formatParsers.block,\n                                    context.blockFormat,\n                                    context\n                                );\n                                parseFormat(\n                                    td,\n                                    context.formatParsers.segmentOnTableCell,\n                                    context.segmentFormat,\n                                    context\n                                );\n\n                                const cellFormat: ContentModelTableCellFormat = {\n                                    ...context.blockFormat,\n                                };\n                                const dataset: DatasetFormat = {};\n\n                                parseFormat(\n                                    td,\n                                    context.formatParsers.tableCell,\n                                    cellFormat,\n                                    context\n                                );\n                                parseFormat(\n                                    td,\n                                    context.formatParsers.tableBorder,\n                                    cellFormat,\n                                    context\n                                );\n                                parseFormat(td, context.formatParsers.dataset, dataset, context);\n\n                                for (\n                                    let colSpan = 1;\n                                    colSpan <= td.colSpan;\n                                    colSpan++, targetCol++\n                                ) {\n                                    for (let rowSpan = 1; rowSpan <= td.rowSpan; rowSpan++) {\n                                        const hasTd = colSpan == 1 && rowSpan == 1;\n                                        const cell = createTableCell(\n                                            colSpan > 1,\n                                            rowSpan > 1,\n                                            td.tagName == 'TH',\n                                            cellFormat\n                                        );\n\n                                        cell.dataset = { ...dataset };\n\n                                        const spannedRow = table.rows[row + rowSpan - 1];\n\n                                        if (spannedRow) {\n                                            spannedRow.cells[targetCol] = cell;\n                                        }\n\n                                        if (hasTd) {\n                                            // When there is COLGROUP, width on table cell should be ignored, so we should not cache the table cell,\n                                            // and always recreate it when write back using the table formats\n                                            if (context.allowCacheElement && !hasColGroup) {\n                                                cell.cachedElement = td;\n                                            }\n\n                                            const { listParent, levels } = context.listFormat;\n\n                                            context.listFormat.listParent = undefined;\n                                            context.listFormat.levels = [];\n\n                                            try {\n                                                context.elementProcessors.child(cell, td, context);\n                                            } finally {\n                                                context.listFormat.listParent = listParent;\n                                                context.listFormat.levels = levels;\n                                            }\n                                        }\n\n                                        const hasSelectionAfterCell = context.isInSelection;\n\n                                        if (\n                                            (hasSelectionBeforeCell && hasSelectionAfterCell) ||\n                                            (hasTableSelection &&\n                                                tableSelection &&\n                                                row >= tableSelection.firstRow &&\n                                                row <= tableSelection.lastRow &&\n                                                targetCol >= tableSelection.firstColumn &&\n                                                targetCol <= tableSelection.lastColumn)\n                                        ) {\n                                            cell.isSelected = true;\n                                        }\n                                    }\n                                }\n                            }\n                        );\n                    }\n                });\n\n                for (let col = 0; col < tableRow.cells.length; col++) {\n                    if (!tableRow.cells[col]) {\n                        tableRow.cells[col] = createTableCell(\n                            false,\n                            false,\n                            false,\n                            context.blockFormat\n                        );\n                    }\n                }\n            }\n\n            table.widths = calcSizes(columnPositions);\n\n            const heights = calcSizes(rowPositions);\n\n            table.rows.forEach((row, i) => {\n                if (heights[i] > 0) {\n                    row.height = heights[i];\n                }\n            });\n        }\n    );\n};\n\nfunction calcSizes(positions: (number | undefined)[]): number[] {\n    const result: number[] = [];\n    let lastPos = 0;\n\n    for (let i = positions.length - 1; i >= 0; i--) {\n        const pos = positions[i];\n\n        if (typeof pos == 'number') {\n            lastPos = pos;\n            break;\n        }\n    }\n\n    for (let i = positions.length - 2; i >= 0; i--) {\n        const pos = positions[i];\n        if (pos === undefined) {\n            result[i] = 0;\n        } else {\n            result[i] = lastPos - pos;\n            lastPos = pos;\n        }\n    }\n\n    return result;\n}\n\nfunction processColGroup(\n    table: HTMLElement,\n    context: DomToModelContext,\n    result: (number | undefined)[]\n): boolean {\n    let lastPos = 0;\n    let hasColGroup = false;\n\n    for (let child = table.firstChild; child; child = child.nextSibling) {\n        if (isNodeOfType(child, 'ELEMENT_NODE') && child.tagName == 'COLGROUP') {\n            hasColGroup = true;\n\n            for (let col = child.firstChild; col; col = col.nextSibling) {\n                if (isNodeOfType(col, 'ELEMENT_NODE') && col.tagName == 'COL') {\n                    const colFormat: SizeFormat = {};\n\n                    parseFormat(col, context.formatParsers.tableColumn, colFormat, context);\n\n                    for (let i = 0; i < parseInt(col.getAttribute('span') ?? '1'); i++) {\n                        if (colFormat.width === undefined) {\n                            result.push(undefined);\n                        } else {\n                            const width = parseValueWithUnit(\n                                colFormat.width ?? '',\n                                undefined /*element*/,\n                                'px'\n                            );\n\n                            result.push(width + lastPos);\n                            lastPos += width;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    return hasColGroup;\n}\n","import { addDecorators } from '../../modelApi/common/addDecorators';\nimport { addSegment } from '../../modelApi/common/addSegment';\nimport { addSelectionMarker } from '../utils/addSelectionMarker';\nimport { createText } from '../../modelApi/creators/createText';\nimport { ensureParagraph } from '../../modelApi/common/ensureParagraph';\nimport { getRegularSelectionOffsets } from '../utils/getRegularSelectionOffsets';\nimport { hasSpacesOnly } from '../../modelApi/common/hasSpacesOnly';\nimport { isWhiteSpacePreserved } from '../../domUtils/isWhiteSpacePreserved';\nimport { stackFormat } from '../utils/stackFormat';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelParagraph,\n    ContentModelText,\n    DomToModelContext,\n    ElementProcessor,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const textProcessor: ElementProcessor<Text> = (\n    group: ContentModelBlockGroup,\n    textNode: Text,\n    context: DomToModelContext\n) => {\n    if (context.formatParsers.text.length > 0) {\n        stackFormat(context, { segment: 'shallowClone' }, () => {\n            context.formatParsers.text.forEach(parser => {\n                parser(context.segmentFormat, textNode, context);\n                internalTextProcessor(group, textNode, context);\n            });\n        });\n    } else {\n        internalTextProcessor(group, textNode, context);\n    }\n};\n\nfunction internalTextProcessor(\n    group: ContentModelBlockGroup,\n    textNode: Text,\n    context: DomToModelContext\n) {\n    let txt = textNode.nodeValue || '';\n    const offsets = getRegularSelectionOffsets(context, textNode);\n    const txtStartOffset = offsets[0];\n    let txtEndOffset = offsets[1];\n    const segments: (ContentModelText | undefined)[] = [];\n    const paragraph = ensureParagraph(group, context.blockFormat);\n\n    if (txtStartOffset >= 0) {\n        const subText = txt.substring(0, txtStartOffset);\n        segments.push(addTextSegment(group, subText, paragraph, context));\n        context.isInSelection = true;\n\n        addSelectionMarker(group, context, textNode, txtStartOffset);\n\n        txt = txt.substring(txtStartOffset);\n        txtEndOffset -= txtStartOffset;\n    }\n\n    if (txtEndOffset >= 0) {\n        const subText = txt.substring(0, txtEndOffset);\n        segments.push(addTextSegment(group, subText, paragraph, context));\n\n        if (\n            context.selection &&\n            (context.selection.type != 'range' || !context.selection.range.collapsed)\n        ) {\n            addSelectionMarker(group, context, textNode, offsets[1]); // Must use offsets[1] here as the unchanged offset value, cannot use txtEndOffset since it has been modified\n        }\n\n        context.isInSelection = false;\n        txt = txt.substring(txtEndOffset);\n    }\n\n    segments.push(addTextSegment(group, txt, paragraph, context));\n    context.domIndexer?.onSegment(\n        textNode,\n        paragraph,\n        segments.filter((x): x is ContentModelText => !!x)\n    );\n}\n\nfunction addTextSegment(\n    group: ContentModelBlockGroup,\n    text: string,\n    paragraph: ContentModelParagraph,\n    context: DomToModelContext\n): ContentModelText | undefined {\n    let textModel: ContentModelText | undefined;\n\n    if (text) {\n        if (\n            !hasSpacesOnly(text) ||\n            (paragraph?.segments.length ?? 0) > 0 ||\n            isWhiteSpacePreserved(paragraph?.format.whiteSpace)\n        ) {\n            textModel = createText(text, context.segmentFormat);\n\n            if (context.isInSelection) {\n                textModel.isSelected = true;\n            }\n\n            addDecorators(textModel, context);\n\n            addSegment(group, textModel, context.blockFormat);\n        }\n    }\n\n    return textModel;\n}\n","import { addDecorators } from '../../modelApi/common/addDecorators';\nimport { addSegment } from '../../modelApi/common/addSegment';\nimport { createSelectionMarker } from '../../modelApi/creators/createSelectionMarker';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelSegmentFormat,\n    DomToModelContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function addSelectionMarker(\n    group: ContentModelBlockGroup,\n    context: DomToModelContext,\n    container?: Node,\n    offset?: number\n) {\n    const lastPara = group.blocks[group.blocks.length - 1];\n    const formatFromParagraph: ContentModelSegmentFormat =\n        !lastPara || lastPara.blockType != 'Paragraph'\n            ? {}\n            : lastPara.decorator\n            ? {\n                  fontFamily: lastPara.decorator.format.fontFamily,\n                  fontSize: lastPara.decorator.format.fontSize,\n              }\n            : lastPara.segmentFormat\n            ? {\n                  fontFamily: lastPara.segmentFormat.fontFamily,\n                  fontSize: lastPara.segmentFormat.fontSize,\n              }\n            : {};\n\n    const pendingFormat =\n        context.pendingFormat &&\n        context.pendingFormat.posContainer === container &&\n        context.pendingFormat.posOffset === offset\n            ? context.pendingFormat.format\n            : undefined;\n    const segmentFormat = {\n        ...context.defaultFormat,\n        ...formatFromParagraph,\n        ...context.segmentFormat,\n        ...pendingFormat,\n    };\n    const marker = createSelectionMarker(segmentFormat);\n\n    addDecorators(marker, context);\n\n    addSegment(group, marker, context.blockFormat, segmentFormat);\n}\n","import { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport type { ContentModelFormatBase } from 'roosterjs-content-model-types';\n\n/**\n * Check if the two given formats object are equal. This is a check to value but not to reference\n * @param f1 The first format object to check\n * @param f2 The second format object to check\n */\nexport function areSameFormats<T extends ContentModelFormatBase>(f1: T, f2: T) {\n    if (f1 == f2) {\n        return true;\n    } else {\n        const keys1 = getObjectKeys(f1);\n        const keys2 = getObjectKeys(f2);\n\n        return keys1.length == keys2.length && keys1.every(key => f1[key] == f2[key]);\n    }\n}\n","/**\n * @internal\n */\nexport function getBoundingClientRect(element: Element): DOMRect {\n    return element.getBoundingClientRect();\n}\n","import { defaultHTMLStyleMap } from '../../config/defaultHTMLStyleMap';\nimport type { DefaultStyleMap } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Get default CSS style of given element\n * @param element The element to get default style from\n * @returns A valid CSS style object\n */\nexport function getDefaultStyle(element: HTMLElement): Partial<CSSStyleDeclaration> {\n    const tag = element.tagName.toLowerCase() as keyof DefaultStyleMap;\n\n    return defaultHTMLStyleMap[tag] || {};\n}\n","import type { DomToModelContext } from 'roosterjs-content-model-types';\n\n/**\n * Get offset numbers of a regular (range based) selection.\n * If the selection start/end position is not in the given node, it will return -1 for the related value\n * @param context DOM to Content Model context used for retrieve the selection\n * @param currentContainer The container node to check\n * @returns a tuple of start and end offsets. -1 means selection is not directly under the given node\n */\nexport function getRegularSelectionOffsets(\n    context: DomToModelContext,\n    currentContainer: Node\n): [number, number] {\n    const range = context.selection?.type == 'range' ? context.selection.range : null;\n\n    const startOffset = range?.startContainer == currentContainer ? range.startOffset : -1;\n    const endOffset = range?.endContainer == currentContainer ? range.endOffset! : -1;\n\n    return [startOffset, endOffset];\n}\n","import { getDefaultStyle } from './getDefaultStyle';\n\nconst BLOCK_DISPLAY_STYLES = ['block', 'list-item', 'table', 'table-cell', 'flex'];\n\n/**\n * Check if the given element will be layout as a block\n * @param element The element to check\n * @param context The context of DOM to Content Model conversion\n */\nexport function isBlockElement(element: HTMLElement): boolean {\n    const display = element.style.display || getDefaultStyle(element).display || '';\n\n    return BLOCK_DISPLAY_STYLES.indexOf(display) >= 0;\n}\n","import { getDefaultStyle } from './getDefaultStyle';\nimport type {\n    ContentModelFormatBase,\n    DomToModelContext,\n    FormatParser,\n} from 'roosterjs-content-model-types';\n\n/**\n * Parse formats of the given HTML element using specified format parsers\n * @param element The element to parse format from\n * @param parsers The parses we are using to parse format\n * @param format The format object to hold result format\n * @param context DOM to Content Model context\n */\nexport function parseFormat<T extends ContentModelFormatBase>(\n    element: HTMLElement,\n    parsers: (FormatParser<T> | null)[],\n    format: T,\n    context: DomToModelContext\n) {\n    const defaultStyle = getDefaultStyle(element);\n\n    parsers.forEach(parser => {\n        parser?.(format, element, context, defaultStyle);\n    });\n}\n","import { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelCode,\n    ContentModelFormatBase,\n    ContentModelLink,\n    ContentModelParagraphDecorator,\n    ContentModelSegmentFormat,\n    DomToModelContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport interface StackFormatOptions {\n    segment?: 'shallowClone' | 'shallowCloneForBlock' | 'empty';\n    paragraph?: 'shallowClone' | 'shallowCloneForGroup' | 'empty';\n    blockDecorator?: 'empty';\n    link?: 'linkDefault' | 'cloneFormat' | 'empty';\n    code?: 'codeDefault' | 'empty';\n}\n\n// Some styles, such as background color, won't be inherited by block element if it was originally\n// declared from an inline element. So we need to skip them.\n// e.g.\n// <span style=\"background-color: red\">\n//   line 1       <---------------------------- in red here\n//   <div>line 2</div>  <---------------------- not in red here\n// </span>\nconst SkippedStylesForBlockOnSegmentOnSegment: (keyof ContentModelSegmentFormat)[] = [\n    'backgroundColor',\n];\nconst SkippedStylesForTable: (keyof ContentModelBlockFormat)[] = [\n    'marginLeft',\n    'marginRight',\n    'paddingLeft',\n    'paddingRight',\n];\n\n/**\n * @internal\n */\nexport function stackFormat(\n    context: DomToModelContext,\n    options: StackFormatOptions,\n    callback: () => void\n) {\n    const {\n        segmentFormat,\n        blockFormat,\n        link: linkFormat,\n        code: codeFormat,\n        blockDecorator: decoratorFormat,\n    } = context;\n    const { segment, paragraph, link, code, blockDecorator } = options;\n\n    try {\n        context.segmentFormat = stackFormatInternal(segmentFormat, segment);\n        context.blockFormat = stackFormatInternal(blockFormat, paragraph);\n        context.link = stackLinkInternal(linkFormat, link);\n        context.code = stackCodeInternal(codeFormat, code);\n        context.blockDecorator = stackDecoratorInternal(decoratorFormat, blockDecorator);\n\n        callback();\n    } finally {\n        context.segmentFormat = segmentFormat;\n        context.blockFormat = blockFormat;\n        context.link = linkFormat;\n        context.code = codeFormat;\n        context.blockDecorator = decoratorFormat;\n    }\n}\n\nfunction stackLinkInternal(\n    linkFormat: ContentModelLink,\n    link?: 'linkDefault' | 'cloneFormat' | 'empty'\n) {\n    switch (link) {\n        case 'linkDefault':\n            return {\n                format: {\n                    underline: true,\n                },\n                dataset: {},\n            };\n\n        case 'empty':\n            return {\n                format: {},\n                dataset: {},\n            };\n\n        case 'cloneFormat':\n        default:\n            return {\n                dataset: linkFormat.dataset,\n                format: { ...linkFormat.format },\n            };\n    }\n}\n\nfunction stackCodeInternal(codeFormat: ContentModelCode, code?: 'codeDefault' | 'empty') {\n    switch (code) {\n        case 'codeDefault':\n            return {\n                format: {\n                    fontFamily: 'monospace',\n                },\n            };\n        case 'empty':\n            return {\n                format: {},\n            };\n        default:\n            return codeFormat;\n    }\n}\n\nfunction stackDecoratorInternal(\n    format: ContentModelParagraphDecorator,\n    decorator?: 'decoratorDefault' | 'empty'\n) {\n    switch (decorator) {\n        case 'empty':\n            return {\n                format: {},\n                tagName: '',\n            };\n        default:\n            return format;\n    }\n}\n\nfunction stackFormatInternal<T extends ContentModelFormatBase>(\n    format: T,\n    processType?: 'shallowClone' | 'shallowCloneForBlock' | 'shallowCloneForGroup' | 'empty'\n): T | {} {\n    switch (processType) {\n        case 'empty':\n            return {};\n\n        case undefined:\n            return format;\n\n        default:\n            const result = { ...format };\n\n            getObjectKeys(format).forEach(key => {\n                if (\n                    (processType == 'shallowCloneForBlock' &&\n                        SkippedStylesForBlockOnSegmentOnSegment.indexOf(\n                            key as keyof ContentModelSegmentFormat\n                        ) >= 0) ||\n                    (processType == 'shallowCloneForGroup' &&\n                        SkippedStylesForTable.indexOf(key as keyof ContentModelBlockFormat) >= 0)\n                ) {\n                    delete result[key];\n                }\n            });\n\n            if (processType == 'shallowClone' || processType == 'shallowCloneForGroup') {\n                const blockFormat = format as ContentModelBlockFormat;\n\n                // For a new paragraph, if current text indent is already applied to previous block in the same level,\n                // we need to ignore it according to browser rendering behavior\n                if (blockFormat.textIndent) {\n                    delete (result as ContentModelBlockFormat).isTextIndentApplied;\n                    blockFormat.isTextIndentApplied = true;\n                }\n            }\n\n            return result;\n    }\n}\n","import { applyFormat } from '../modelToDom/utils/applyFormat';\nimport { isElementOfType } from './isElementOfType';\nimport { isNodeOfType } from './isNodeOfType';\nimport { toArray } from './toArray';\nimport type {\n    ContentModelEntityFormat,\n    ContentModelSegmentFormat,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\nconst ENTITY_INFO_NAME = '_Entity';\nconst ENTITY_TYPE_PREFIX = '_EType_';\nconst ENTITY_ID_PREFIX = '_EId_';\nconst ENTITY_READONLY_PREFIX = '_EReadonly_';\nconst ZERO_WIDTH_SPACE = '\\u200B';\nconst DELIMITER_BEFORE = 'entityDelimiterBefore';\nconst DELIMITER_AFTER = 'entityDelimiterAfter';\n\n/**\n * Check if the given DOM Node is an entity wrapper element\n */\nexport function isEntityElement(node: Node): boolean {\n    return isNodeOfType(node, 'ELEMENT_NODE') && node.classList.contains(ENTITY_INFO_NAME);\n}\n\n/**\n * Get all entity wrapper elements under the given root element\n * @param root The root element to query from\n * @returns An array of entity wrapper elements\n */\nexport function getAllEntityWrappers(root: HTMLElement): HTMLElement[] {\n    return toArray(root.querySelectorAll('.' + ENTITY_INFO_NAME)) as HTMLElement[];\n}\n\n/**\n * Parse entity format from entity wrapper element\n * @param wrapper The wrapper element to parse entity format from\n * @returns Entity format\n */\nexport function parseEntityFormat(wrapper: HTMLElement): ContentModelEntityFormat {\n    let isEntity = false;\n    const format: ContentModelEntityFormat = {};\n\n    wrapper.classList.forEach(name => {\n        isEntity = parseEntityClassName(name, format) || isEntity;\n    });\n\n    if (!isEntity) {\n        format.isFakeEntity = true;\n        format.isReadonly = !wrapper.isContentEditable;\n    }\n\n    return format;\n}\n\n/**\n * Parse entity class names from entity wrapper element\n * @param className Class names of entity\n * @param format The output entity format object\n */\nfunction parseEntityClassName(\n    className: string,\n    format: ContentModelEntityFormat\n): boolean | undefined {\n    if (className == ENTITY_INFO_NAME) {\n        return true;\n    } else if (className.indexOf(ENTITY_TYPE_PREFIX) == 0) {\n        format.entityType = className.substring(ENTITY_TYPE_PREFIX.length);\n    } else if (className.indexOf(ENTITY_ID_PREFIX) == 0) {\n        format.id = className.substring(ENTITY_ID_PREFIX.length);\n    } else if (className.indexOf(ENTITY_READONLY_PREFIX) == 0) {\n        format.isReadonly = className.substring(ENTITY_READONLY_PREFIX.length) == '1';\n    }\n}\n\n/**\n * Generate Entity class names for an entity wrapper\n * @param format The source entity format object\n * @returns A combined CSS class name string for entity wrapper\n */\nexport function generateEntityClassNames(format: ContentModelEntityFormat): string {\n    return format.isFakeEntity\n        ? ''\n        : `${ENTITY_INFO_NAME} ${ENTITY_TYPE_PREFIX}${format.entityType ?? ''} ${\n              format.id ? `${ENTITY_ID_PREFIX}${format.id} ` : ''\n          }${ENTITY_READONLY_PREFIX}${format.isReadonly ? '1' : '0'}`;\n}\n\n/**\n * Checks whether the node provided is a Entity delimiter\n * @param node the node to check\n * @return true if it is a delimiter\n */\nexport function isEntityDelimiter(element: HTMLElement): boolean {\n    return (\n        isElementOfType(element, 'span') &&\n        (element.classList.contains(DELIMITER_AFTER) ||\n            element.classList.contains(DELIMITER_BEFORE)) &&\n        element.textContent === ZERO_WIDTH_SPACE\n    );\n}\n\n/**\n * Adds delimiters to the element provided. If the delimiters already exists, will not be added\n * @param element the node to add the delimiters\n * @param format format to set to the delimiters, so when typing inside of one the format is not lost\n * @param context Model to Dom context to use.\n */\nexport function addDelimiters(\n    doc: Document,\n    element: HTMLElement,\n    format?: ContentModelSegmentFormat | null,\n    context?: ModelToDomContext\n): HTMLElement[] {\n    let [delimiterAfter, delimiterBefore] = getDelimiters(element);\n\n    if (!delimiterAfter) {\n        delimiterAfter = insertDelimiter(doc, element, true /*isAfter*/);\n        if (context && format) {\n            applyFormat(delimiterAfter, context.formatAppliers.segment, format, context);\n        }\n    }\n\n    if (!delimiterBefore) {\n        delimiterBefore = insertDelimiter(doc, element, false /*isAfter*/);\n        if (context && format) {\n            applyFormat(delimiterBefore, context.formatAppliers.segment, format, context);\n        }\n    }\n\n    return [delimiterAfter, delimiterBefore];\n}\n\nfunction getDelimiters(entityWrapper: HTMLElement): (HTMLElement | undefined)[] {\n    const result: (HTMLElement | undefined)[] = [];\n    const { nextElementSibling, previousElementSibling } = entityWrapper;\n    result.push(\n        isDelimiter(nextElementSibling, DELIMITER_AFTER),\n        isDelimiter(previousElementSibling, DELIMITER_BEFORE)\n    );\n\n    return result;\n}\n\nfunction isDelimiter(el: Element | null, className: string): HTMLElement | undefined {\n    return el?.classList.contains(className) && el.textContent == ZERO_WIDTH_SPACE\n        ? (el as HTMLElement)\n        : undefined;\n}\n\nfunction insertDelimiter(doc: Document, element: Element, isAfter: boolean) {\n    const span = doc.createElement('span');\n\n    span.className = isAfter ? DELIMITER_AFTER : DELIMITER_BEFORE;\n    span.appendChild(doc.createTextNode(ZERO_WIDTH_SPACE));\n    element.parentNode?.insertBefore(span, isAfter ? element.nextSibling : element);\n\n    return span;\n}\n","/**\n * Provide a strong-typed version of Object.keys()\n * @param obj The source object\n * @returns Array of keys\n */\nexport function getObjectKeys<T extends string | number | symbol>(\n    obj: Record<T, any> | Partial<Record<T, any>>\n): T[] {\n    return Object.keys(obj) as T[];\n}\n","/**\n * Check if the given element is of the type that we are checking according to its tag name\n * @param element The element to check\n * @param tag The HTML tag name to check\n * @returns True if the element has the given tag, otherwise false\n */\nexport function isElementOfType<Tag extends keyof HTMLElementTagNameMap>(\n    element: HTMLElement,\n    tag: Tag\n): element is HTMLElementTagNameMap[Tag] {\n    return element?.tagName?.toLocaleLowerCase() == tag;\n}\n","import type { NodeTypeMap } from 'roosterjs-content-model-types';\n\n/**\n * Type checker for Node. Return true if it of the specified node type\n * @param node The node to check\n * @param expectedType The type to check\n */\nexport function isNodeOfType<T extends keyof NodeTypeMap>(\n    node: Node | null | undefined,\n    expectedType: T\n): node is NodeTypeMap[T] {\n    return !!node && node.nodeType == Node[expectedType];\n}\n","// According to https://developer.mozilla.org/en-US/docs/Web/CSS/white-space, these style values will need to preserve white spaces\nconst WHITESPACE_PRE_VALUES = ['pre', 'pre-wrap', 'break-spaces'];\n\n/**\n * Check if the given white-space style value will cause preserving white space\n * @param whiteSpace The white-space style value to check\n */\nexport function isWhiteSpacePreserved(whiteSpace: string | undefined): boolean {\n    return !!whiteSpace && WHITESPACE_PRE_VALUES.indexOf(whiteSpace) >= 0;\n}\n","import { validate } from './validate';\nimport type { ContentModelWithDataset, Definition } from 'roosterjs-content-model-types';\n\nconst EditingInfoDatasetName = 'editingInfo';\n\n/**\n * Update metadata of the given model\n * @param model The model to update metadata to\n * @param callback A callback function to update metadata\n * @param definition @optional Metadata definition used for verify the metadata object\n * @returns The metadata object if any, or null\n */\nexport function updateMetadata<T>(\n    model: ContentModelWithDataset<T>,\n    callback?: (metadata: T | null) => T | null,\n    definition?: Definition<T>\n): T | null {\n    const metadataString = model.dataset[EditingInfoDatasetName];\n    let obj: T | null = null;\n\n    try {\n        obj = JSON.parse(metadataString) as T;\n    } catch {}\n\n    if (definition && !validate(obj, definition)) {\n        obj = null;\n    }\n\n    if (callback) {\n        obj = callback(obj);\n\n        if (!obj) {\n            delete model.dataset[EditingInfoDatasetName];\n        } else if (!definition || validate(obj, definition)) {\n            model.dataset[EditingInfoDatasetName] = JSON.stringify(obj);\n        }\n    }\n\n    return obj;\n}\n\n/**\n * Check if the given model has metadata\n * @param model The content model to check\n */\nexport function hasMetadata<T>(model: ContentModelWithDataset<T> | HTMLElement): boolean {\n    return !!model.dataset[EditingInfoDatasetName];\n}\n","import { getObjectKeys } from '../getObjectKeys';\nimport type { Definition } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Validate the given object with a type definition object\n * @param input The object to validate\n * @param def The type definition object used for validation\n * @returns True if the object passed the validation, otherwise false\n */\nexport function validate<T>(input: any, def: Definition<T>): input is T {\n    let result = false;\n    if ((def.isOptional && typeof input === 'undefined') || (def.allowNull && input === null)) {\n        result = true;\n    } else if (\n        (!def.isOptional && typeof input === 'undefined') ||\n        (!def.allowNull && input === null)\n    ) {\n        return false;\n    } else {\n        switch (def.type) {\n            case 'string':\n                result =\n                    typeof input === 'string' &&\n                    (typeof def.value === 'undefined' || input === def.value);\n                break;\n\n            case 'number':\n                result =\n                    typeof input === 'number' &&\n                    (typeof def.value === 'undefined' || areSameNumbers(def.value, input)) &&\n                    (typeof def.minValue === 'undefined' || input >= def.minValue) &&\n                    (typeof def.maxValue === 'undefined' || input <= def.maxValue);\n                break;\n\n            case 'boolean':\n                result =\n                    typeof input === 'boolean' &&\n                    (typeof def.value === 'undefined' || input === def.value);\n                break;\n\n            case 'array':\n                result =\n                    Array.isArray(input) &&\n                    (typeof def.minLength === 'undefined' || input.length >= def.minLength) &&\n                    (typeof def.maxLength === 'undefined' || input.length <= def.maxLength) &&\n                    input.every(x => validate(x, def.itemDef));\n                break;\n\n            case 'object':\n                result =\n                    typeof input === 'object' &&\n                    getObjectKeys(def.propertyDef).every(x =>\n                        validate(input[x], def.propertyDef[x])\n                    );\n                break;\n        }\n    }\n\n    return result;\n}\n\nfunction areSameNumbers(n1: number, n2: number) {\n    return Math.abs(n1 - n2) < 1e-3;\n}\n","/**\n * Replace all child nodes of the given target node to the child nodes of source node.\n * @param target Target node, all child nodes of this node will be removed if keepExistingChildren is not set to true\n * @param source (Optional) source node, all child nodes of this node will be move to target node\n * @param keepExistingChildren (Optional) When set to true, all existing child nodes of target will be kept\n */\nexport function moveChildNodes(target: Node, source?: Node, keepExistingChildren?: boolean) {\n    if (!target) {\n        return;\n    }\n\n    while (!keepExistingChildren && target.firstChild) {\n        target.removeChild(target.firstChild);\n    }\n\n    while (source?.firstChild) {\n        target.appendChild(source.firstChild);\n    }\n}\n\n/**\n * Wrap all child nodes of the given parent element using a new element with the given tag name\n * @param parent The parent element\n * @param tagName The tag name of new wrapper\n * @returns New wrapper element\n */\nexport function wrapAllChildNodes<T extends keyof HTMLElementTagNameMap>(\n    parent: HTMLElement,\n    tagName: T\n): HTMLElementTagNameMap[T] {\n    const newElement = parent.ownerDocument.createElement(tagName);\n\n    moveChildNodes(newElement, parent);\n    parent.appendChild(newElement);\n\n    return newElement;\n}\n","import type { Rect } from 'roosterjs-content-model-types';\n\n/**\n * A ClientRect of all 0 is possible. i.e. chrome returns a ClientRect of 0 when the cursor is on an empty p\n * We validate that and only return a rect when the passed in ClientRect is valid\n * @param clientRect Client rect object normally retrieved from getBoundingClientRect function\n */\nexport function normalizeRect(clientRect: DOMRect): Rect | null {\n    const { left, right, top, bottom } =\n        clientRect || <DOMRect>{ left: 0, right: 0, top: 0, bottom: 0 };\n    return left === 0 && right === 0 && top === 0 && bottom === 0\n        ? null\n        : {\n              left: Math.round(left),\n              right: Math.round(right),\n              top: Math.round(top),\n              bottom: Math.round(bottom),\n          };\n}\n","import { isEntityElement } from './entityUtils';\n\n/**\n * When set a DOM tree into editor, reuse the existing element in editor and no need to change it\n * @param param Parent node of the reused element\n * @param element The element to keep in parent node\n * @param refNode Reference node, it is point to current node that is being processed. It must be a child of parent node, or null.\n * We will start processing from this node, if it is not the same with element, remove it and keep processing its next sibling,\n * until we see an element that is the same with the passed in element or null.\n * @returns The new reference element\n */\nexport function reuseCachedElement(parent: Node, element: Node, refNode: Node | null): Node | null {\n    if (element.parentNode == parent) {\n        const isEntity = isEntityElement(element);\n\n        // Remove nodes before the one we are hitting since they don't appear in Content Model at this position.\n        // But we don't want to touch entity since it would better to keep entity at its place unless it is removed\n        // In that case we will remove it after we have handled all other nodes\n        while (refNode && refNode != element && (isEntity || !isEntityElement(refNode))) {\n            const next = refNode.nextSibling;\n\n            refNode.parentNode?.removeChild(refNode);\n            refNode = next;\n        }\n\n        if (refNode && refNode == element) {\n            refNode = refNode.nextSibling;\n        } else {\n            parent.insertBefore(element, refNode);\n        }\n    } else {\n        parent.insertBefore(element, refNode);\n    }\n\n    return refNode;\n}\n\n/**\n * @internal\n */\nexport function removeNode(node: Node): Node | null {\n    const next = node.nextSibling;\n    node.parentNode?.removeChild(node);\n\n    return next;\n}\n","/**\n * Convert a named node map to an array\n * @param collection The map to convert\n */\nexport function toArray(collection: NamedNodeMap): Attr[];\n\n/**\n * Convert a named node map to an array\n * @param collection The map to convert\n */\nexport function toArray(collection: DataTransferItemList): DataTransferItem[];\n\n/**\n * Convert a collection to an array\n * @param collection The collection to convert\n */\nexport function toArray<T extends Node>(collection: NodeListOf<T>): T[];\n\n/**\n * Convert a collection to an array\n * @param collection The collection to convert\n */\nexport function toArray<T extends Element>(collection: HTMLCollectionOf<T>): T[];\n\n/**\n * Convert an array to an array.\n * This is to satisfy typescript compiler. For some cases the object can be a collection at runtime,\n * but the declaration is an array. e.g. ClipboardData.types\n * @param array The array to convert\n */\nexport function toArray<T>(array: readonly T[]): T[];\n\nexport function toArray(collection: any): any[] {\n    return [].slice.call(collection);\n}\n","/**\n * @internal\n * Removes the node and keep all children in place, return the parentNode where the children are attached\n * @param node the node to remove\n */\nexport function unwrap(node: Node): Node | null {\n    // Unwrap requires a parentNode\n    const parentNode = node ? node.parentNode : null;\n\n    if (!parentNode) {\n        return null;\n    }\n\n    while (node.firstChild) {\n        parentNode.insertBefore(node.firstChild, node);\n    }\n\n    parentNode.removeChild(node);\n    return parentNode;\n}\n","/**\n * Wrap the given node with a new element, put the wrapper node under the parent of the first node\n * and return the wrapper element.\n * @param doc Parent document object\n * @param node The node to wrap\n * @param wrapperTag The tag of wrapper HTML element\n * @returns The wrapper element\n */\nexport function wrap<T extends keyof HTMLElementTagNameMap>(\n    doc: Document,\n    node: Node,\n    wrapperTag: T\n): HTMLElementTagNameMap[T] {\n    const wrapper = doc.createElement(wrapperTag);\n    node.parentNode?.insertBefore(wrapper, node);\n    wrapper.appendChild(node);\n\n    return wrapper;\n}\n","import type { DirectionFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const directionFormatHandler: FormatHandler<DirectionFormat> = {\n    parse: (format, element, _, defaultStyle) => {\n        const dir = element.style.direction || element.dir || defaultStyle.direction;\n\n        if (dir) {\n            format.direction = dir == 'rtl' ? 'rtl' : 'ltr';\n        }\n    },\n    apply: (format, element) => {\n        if (format.direction) {\n            element.style.direction = format.direction;\n        }\n    },\n};\n","import type { DisplayFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const displayFormatHandler: FormatHandler<DisplayFormat> = {\n    parse: (format, element) => {\n        const display = element.style.display;\n\n        if (display) {\n            format.display = display;\n        }\n    },\n    apply: (format, element) => {\n        if (format.display) {\n            element.style.display = format.display;\n        }\n    },\n};\n","import { calcAlign, ResultMap } from '../utils/dir';\nimport { directionFormatHandler } from './directionFormatHandler';\nimport type {\n    DirectionFormat,\n    HtmlAlignFormat,\n    TextAlignFormat,\n} from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const htmlAlignFormatHandler: FormatHandler<\n    DirectionFormat & HtmlAlignFormat & TextAlignFormat\n> = {\n    parse: (format, element, context, defaultStyle) => {\n        directionFormatHandler.parse(format, element, context, defaultStyle);\n\n        const htmlAlign = element.getAttribute('align');\n\n        if (htmlAlign) {\n            format.htmlAlign = calcAlign(htmlAlign, format.direction);\n            delete format.textAlign;\n            delete context.blockFormat.textAlign;\n        }\n    },\n    apply: (format, element) => {\n        const dir: 'ltr' | 'rtl' = format.direction == 'rtl' ? 'rtl' : 'ltr';\n\n        if (format.htmlAlign) {\n            element.setAttribute('align', ResultMap[format.htmlAlign][dir]);\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { LineHeightFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const lineHeightFormatHandler: FormatHandler<LineHeightFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const lineHeight = element.style.lineHeight || defaultStyle.lineHeight;\n\n        if (lineHeight && lineHeight != 'inherit') {\n            format.lineHeight = lineHeight;\n        }\n    },\n    apply: (format, element) => {\n        if (format.lineHeight) {\n            element.style.lineHeight = format.lineHeight;\n        }\n    },\n};\n","import { parseValueWithUnit } from '../utils/parseValueWithUnit';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { MarginFormat } from 'roosterjs-content-model-types';\n\nconst MarginKeys: (keyof MarginFormat & keyof CSSStyleDeclaration)[] = [\n    'marginTop',\n    'marginRight',\n    'marginBottom',\n    'marginLeft',\n];\n\n/**\n * @internal\n */\nexport const marginFormatHandler: FormatHandler<MarginFormat> = {\n    parse: (format, element, _, defaultStyle) => {\n        MarginKeys.forEach(key => {\n            const value = element.style[key] || defaultStyle[key];\n\n            if (value) {\n                switch (key) {\n                    case 'marginTop':\n                    case 'marginBottom':\n                        format[key] = value;\n                        break;\n\n                    case 'marginLeft':\n                    case 'marginRight':\n                        format[key] = format[key]\n                            ? parseValueWithUnit(format[key] || '', element) +\n                              parseValueWithUnit(value, element) +\n                              'px'\n                            : value;\n                        break;\n                }\n            }\n        });\n    },\n    apply: (format, element, context) => {\n        MarginKeys.forEach(key => {\n            const value = format[key];\n\n            if (value != context.implicitFormat[key]) {\n                element.style[key] = value || '0';\n            }\n        });\n    },\n};\n","import { directionFormatHandler } from './directionFormatHandler';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { DirectionFormat, PaddingFormat } from 'roosterjs-content-model-types';\n\nconst PaddingKeys: (keyof PaddingFormat & keyof CSSStyleDeclaration)[] = [\n    'paddingTop',\n    'paddingRight',\n    'paddingBottom',\n    'paddingLeft',\n];\n\nconst AlternativeKeyLtr: Partial<Record<\n    keyof PaddingFormat,\n    keyof CSSStyleDeclaration | undefined\n>> = {\n    paddingLeft: 'paddingInlineStart',\n};\n\nconst AlternativeKeyRtl: Partial<Record<\n    keyof PaddingFormat,\n    keyof CSSStyleDeclaration | undefined\n>> = {\n    paddingRight: 'paddingInlineStart',\n};\n\n/**\n * @internal\n */\nexport const paddingFormatHandler: FormatHandler<PaddingFormat & DirectionFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        directionFormatHandler.parse(format, element, context, defaultStyle);\n\n        PaddingKeys.forEach(key => {\n            let value = element.style[key];\n            const alterativeKey = (format.direction == 'rtl'\n                ? AlternativeKeyRtl\n                : AlternativeKeyLtr)[key];\n            const defaultValue: string =\n                (defaultStyle[key] ??\n                    (alterativeKey ? defaultStyle[alterativeKey] : undefined) ??\n                    '0px') + '';\n\n            if (!value) {\n                value = defaultValue;\n            }\n\n            if (!value || value == '0') {\n                value = '0px';\n            }\n\n            if (value && value != defaultValue) {\n                format[key] = value;\n            }\n        });\n    },\n    apply: (format, element, context) => {\n        PaddingKeys.forEach(key => {\n            const value = format[key];\n            let defaultValue: string | undefined = undefined;\n\n            if (element.tagName == 'OL' || element.tagName == 'UL') {\n                if (\n                    (format.direction == 'rtl' && key == 'paddingRight') ||\n                    (format.direction != 'rtl' && key == 'paddingLeft')\n                ) {\n                    defaultValue = '40px';\n                }\n            }\n\n            if (value && value != defaultValue) {\n                element.style[key] = value;\n            }\n        });\n    },\n};\n","import { calcAlign, ResultMap } from '../utils/dir';\nimport { directionFormatHandler } from './directionFormatHandler';\nimport type { DirectionFormat, TextAlignFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const textAlignFormatHandler: FormatHandler<DirectionFormat & TextAlignFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        directionFormatHandler.parse(format, element, context, defaultStyle);\n\n        let textAlign = element.style.textAlign || defaultStyle.textAlign;\n\n        if (\n            element.tagName == 'LI' &&\n            element.parentElement?.style.display === 'flex' &&\n            element.parentElement.style.flexDirection === 'column' &&\n            element.style.alignSelf\n        ) {\n            // For LI element with flex style applied, we use its \"align-self\" style value instead since LI has a different implementation for align\n            textAlign = element.style.alignSelf;\n        }\n\n        if (textAlign) {\n            format.textAlign = calcAlign(textAlign, format.direction);\n        }\n    },\n    apply: (format, element) => {\n        const dir: 'ltr' | 'rtl' = format.direction == 'rtl' ? 'rtl' : 'ltr';\n\n        if (format.textAlign) {\n            const parent = element.parentElement;\n            const parentTag = parent?.tagName;\n\n            if (element.tagName == 'LI' && parent && (parentTag == 'OL' || parentTag == 'UL')) {\n                element.style.alignSelf = format.textAlign;\n                element.parentElement.style.flexDirection = 'column';\n                element.parentElement.style.display = 'flex';\n            } else {\n                element.style.textAlign = ResultMap[format.textAlign][dir];\n            }\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { TextIndentFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const textIndentFormatHandler: FormatHandler<TextIndentFormat> = {\n    parse: (format, element) => {\n        const textIndent = element.style.textIndent;\n\n        if (textIndent) {\n            format.textIndent = textIndent;\n        }\n    },\n    apply: (format, element) => {\n        if (format.textIndent) {\n            element.style.textIndent = format.textIndent;\n        }\n    },\n};\n","import { shouldSetValue } from '../utils/shouldSetValue';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { WhiteSpaceFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const whiteSpaceFormatHandler: FormatHandler<WhiteSpaceFormat> = {\n    parse: (format, element, _, defaultStyle) => {\n        const whiteSpace = element.style.whiteSpace || defaultStyle.whiteSpace;\n\n        if (shouldSetValue(whiteSpace, 'normal', format.whiteSpace, defaultStyle.whiteSpace)) {\n            format.whiteSpace = whiteSpace;\n        }\n    },\n    apply: (format, element, context) => {\n        const whiteSpace = context.implicitFormat.whiteSpace;\n        if (format.whiteSpace != whiteSpace) {\n            element.style.whiteSpace = format.whiteSpace || 'normal';\n        }\n    },\n};\n","import { getColor, setColor } from '../utils/color';\nimport { shouldSetValue } from '../utils/shouldSetValue';\nimport type { BackgroundColorFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const backgroundColorFormatHandler: FormatHandler<BackgroundColorFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const backgroundColor =\n            getColor(\n                element,\n                true /*isBackground*/,\n                !!context.isDarkMode,\n                context.darkColorHandler\n            ) || defaultStyle.backgroundColor;\n\n        if (\n            shouldSetValue(\n                backgroundColor,\n                'transparent',\n                undefined /*existingValue*/,\n                defaultStyle.backgroundColor\n            )\n        ) {\n            format.backgroundColor = backgroundColor;\n        }\n    },\n    apply: (format, element, context) => {\n        if (format.backgroundColor) {\n            setColor(\n                element,\n                format.backgroundColor,\n                true /*isBackground*/,\n                !!context.isDarkMode,\n                context.darkColorHandler\n            );\n        }\n    },\n};\n","import type { BorderBoxFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const borderBoxFormatHandler: FormatHandler<BorderBoxFormat> = {\n    parse: (format, element) => {\n        if (element.style?.boxSizing == 'border-box') {\n            format.useBorderBox = true;\n        }\n    },\n    apply: (format, element) => {\n        if (format.useBorderBox) {\n            element.style.boxSizing = 'border-box';\n        }\n    },\n};\n","import type { BorderFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * Keys of border items\n */\nexport const BorderKeys: (keyof BorderFormat & keyof CSSStyleDeclaration)[] = [\n    'borderTop',\n    'borderRight',\n    'borderBottom',\n    'borderLeft',\n];\n\n// This array needs to match BorderKeys array\nconst BorderWidthKeys: (keyof CSSStyleDeclaration)[] = [\n    'borderTopWidth',\n    'borderRightWidth',\n    'borderBottomWidth',\n    'borderLeftWidth',\n];\n\nconst BorderRadiusKeys: (keyof BorderFormat & keyof CSSStyleDeclaration)[] = [\n    'borderTopLeftRadius',\n    'borderTopRightRadius',\n    'borderBottomLeftRadius',\n    'borderBottomRightRadius',\n];\n\nconst AllKeys = BorderKeys.concat(BorderRadiusKeys);\n\n/**\n * @internal\n */\nexport const borderFormatHandler: FormatHandler<BorderFormat> = {\n    parse: (format, element, _, defaultStyle) => {\n        BorderKeys.forEach((key, i) => {\n            const value = element.style[key];\n            const defaultWidth = defaultStyle[BorderWidthKeys[i]] ?? '0px';\n            let width = element.style[BorderWidthKeys[i]];\n\n            if (width == '0') {\n                width = '0px';\n            }\n\n            if (value && width != defaultWidth) {\n                format[key] = value == 'none' ? '' : value;\n            }\n        });\n\n        const borderRadius = element.style.borderRadius;\n\n        if (borderRadius) {\n            format.borderRadius = borderRadius;\n        } else {\n            BorderRadiusKeys.forEach(key => {\n                const value = element.style[key];\n\n                if (value) {\n                    format[key] = value;\n                }\n            });\n        }\n    },\n    apply: (format, element) => {\n        AllKeys.forEach(key => {\n            const value = format[key];\n\n            if (value) {\n                element.style[key] = value;\n            }\n        });\n\n        if (format.borderRadius) {\n            element.style.borderRadius = format.borderRadius;\n        }\n    },\n};\n","import type { BoxShadowFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const boxShadowFormatHandler: FormatHandler<BoxShadowFormat> = {\n    parse: (format, element) => {\n        if (element.style?.boxShadow) {\n            format.boxShadow = element.style.boxShadow;\n        }\n    },\n    apply: (format, element) => {\n        if (format.boxShadow) {\n            element.style.boxShadow = format.boxShadow;\n        }\n    },\n};\n","import { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport type { DatasetFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const datasetFormatHandler: FormatHandler<DatasetFormat> = {\n    parse: (format, element) => {\n        const dataset = element.dataset;\n\n        getObjectKeys(dataset).forEach(key => {\n            format[key] = dataset[key] || '';\n        });\n    },\n\n    apply: (format, element) => {\n        getObjectKeys(format).forEach(key => {\n            element.dataset[key] = format[key];\n        });\n    },\n};\n","import type { FloatFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const floatFormatHandler: FormatHandler<FloatFormat> = {\n    parse: (format, element) => {\n        const float = element.style.float || element.getAttribute('align');\n\n        if (float) {\n            format.float = float;\n        }\n    },\n    apply: (format, element) => {\n        if (format.float) {\n            element.style.float = format.float;\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { IdFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const idFormatHandler: FormatHandler<IdFormat> = {\n    parse: (format, element) => {\n        if (element.id) {\n            format.id = element.id;\n        }\n    },\n    apply: (format, element) => {\n        if (format.id) {\n            element.id = format.id;\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { SizeFormat } from 'roosterjs-content-model-types';\n\nconst PercentageRegex = /[\\d\\.]+%/;\n\n/**\n * @internal\n */\nexport const sizeFormatHandler: FormatHandler<SizeFormat> = {\n    parse: (format, element, context) => {\n        const width = element.style.width || tryParseSize(element, 'width');\n        const height = element.style.height || tryParseSize(element, 'height');\n        const maxWidth = element.style.maxWidth;\n        const maxHeight = element.style.maxHeight;\n        const minWidth = element.style.minWidth;\n        const minHeight = element.style.minHeight;\n\n        if (width) {\n            format.width = width;\n        }\n        if (height) {\n            format.height = height;\n        }\n        if (maxWidth) {\n            format.maxWidth = maxWidth;\n        }\n        if (maxHeight) {\n            format.maxHeight = maxHeight;\n        }\n        if (minWidth) {\n            format.minWidth = minWidth;\n        }\n        if (minHeight) {\n            format.minHeight = minHeight;\n        }\n    },\n    apply: (format, element) => {\n        if (format.width) {\n            element.style.width = format.width;\n        }\n        if (format.height) {\n            element.style.height = format.height;\n        }\n        if (format.maxWidth) {\n            element.style.maxWidth = format.maxWidth;\n        }\n        if (format.maxHeight) {\n            element.style.maxHeight = format.maxHeight;\n        }\n        if (format.minWidth) {\n            element.style.minWidth = format.minWidth;\n        }\n        if (format.minHeight) {\n            element.style.minHeight = format.minHeight;\n        }\n    },\n};\n\nfunction tryParseSize(element: HTMLElement, attrName: 'width' | 'height'): string | undefined {\n    const attrValue = element.getAttribute(attrName);\n    const value = parseInt(attrValue || '');\n\n    return attrValue && PercentageRegex.test(attrValue)\n        ? attrValue\n        : Number.isNaN(value) || value == 0\n        ? undefined\n        : value + 'px';\n}\n","import type { FormatHandler } from '../FormatHandler';\nimport type { VerticalAlignFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const verticalAlignFormatHandler: FormatHandler<VerticalAlignFormat> = {\n    parse: (format, element) => {\n        const align = element.style.verticalAlign || element.getAttribute('valign');\n\n        switch (align) {\n            case 'baseline':\n            case 'initial':\n            case 'super':\n            case 'sub':\n            case 'text-top':\n            case 'text-bottom':\n            case 'top':\n                format.verticalAlign = 'top';\n                break;\n\n            case 'bottom':\n                format.verticalAlign = 'bottom';\n                break;\n\n            case 'middle':\n                format.verticalAlign = 'middle';\n                break;\n        }\n    },\n    apply: (format, element) => {\n        if (format.verticalAlign) {\n            element.style.verticalAlign = format.verticalAlign;\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { WordBreakFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const wordBreakFormatHandler: FormatHandler<WordBreakFormat> = {\n    parse: (format, element, _, defaultStyle) => {\n        const wordBreak = element.style.wordBreak || defaultStyle.wordBreak;\n\n        if (wordBreak) {\n            format.wordBreak = wordBreak;\n        }\n    },\n    apply: (format, element) => {\n        if (format.wordBreak) {\n            element.style.wordBreak = format.wordBreak;\n        }\n    },\n};\n","import { backgroundColorFormatHandler } from './common/backgroundColorFormatHandler';\nimport { boldFormatHandler } from './segment/boldFormatHandler';\nimport { borderBoxFormatHandler } from './common/borderBoxFormatHandler';\nimport { borderFormatHandler } from './common/borderFormatHandler';\nimport { boxShadowFormatHandler } from './common/boxShadowFormatHandler';\nimport { datasetFormatHandler } from './common/datasetFormatHandler';\nimport { directionFormatHandler } from './block/directionFormatHandler';\nimport { displayFormatHandler } from './block/displayFormatHandler';\nimport { entityFormatHandler } from './entity/entityFormatHandler';\nimport { floatFormatHandler } from './common/floatFormatHandler';\nimport { fontFamilyFormatHandler } from './segment/fontFamilyFormatHandler';\nimport { fontSizeFormatHandler } from './segment/fontSizeFormatHandler';\nimport { getObjectKeys } from '../domUtils/getObjectKeys';\nimport { htmlAlignFormatHandler } from './block/htmlAlignFormatHandler';\nimport { idFormatHandler } from './common/idFormatHandler';\nimport { italicFormatHandler } from './segment/italicFormatHandler';\nimport { letterSpacingFormatHandler } from './segment/letterSpacingFormatHandler';\nimport { lineHeightFormatHandler } from './block/lineHeightFormatHandler';\nimport { linkFormatHandler } from './segment/linkFormatHandler';\nimport { listItemThreadFormatHandler } from './list/listItemThreadFormatHandler';\nimport { listLevelThreadFormatHandler } from './list/listLevelThreadFormatHandler';\nimport { listStyleFormatHandler } from './list/listStyleFormatHandler';\nimport { marginFormatHandler } from './block/marginFormatHandler';\nimport { paddingFormatHandler } from './block/paddingFormatHandler';\nimport { sizeFormatHandler } from './common/sizeFormatHandler';\nimport { strikeFormatHandler } from './segment/strikeFormatHandler';\nimport { superOrSubScriptFormatHandler } from './segment/superOrSubScriptFormatHandler';\nimport { tableLayoutFormatHandler } from './table/tableLayoutFormatHandler';\nimport { tableSpacingFormatHandler } from './table/tableSpacingFormatHandler';\nimport { textAlignFormatHandler } from './block/textAlignFormatHandler';\nimport { textColorFormatHandler } from './segment/textColorFormatHandler';\nimport { textColorOnTableCellFormatHandler } from './table/textColorOnTableCellFormatHandler';\nimport { textIndentFormatHandler } from './block/textIndentFormatHandler';\nimport { underlineFormatHandler } from './segment/underlineFormatHandler';\nimport { verticalAlignFormatHandler } from './common/verticalAlignFormatHandler';\nimport { whiteSpaceFormatHandler } from './block/whiteSpaceFormatHandler';\nimport { wordBreakFormatHandler } from './common/wordBreakFormatHandler';\nimport type { FormatHandler } from './FormatHandler';\nimport type {\n    ContentModelFormatMap,\n    FormatApplier,\n    FormatAppliers,\n    FormatHandlerTypeMap,\n    FormatKey,\n    FormatParser,\n    FormatParsers,\n} from 'roosterjs-content-model-types';\n\ntype FormatHandlers = {\n    [Key in FormatKey]: FormatHandler<FormatHandlerTypeMap[Key]>;\n};\n\nconst defaultFormatHandlerMap: FormatHandlers = {\n    backgroundColor: backgroundColorFormatHandler,\n    bold: boldFormatHandler,\n    border: borderFormatHandler,\n    borderBox: borderBoxFormatHandler,\n    boxShadow: boxShadowFormatHandler,\n    dataset: datasetFormatHandler,\n    direction: directionFormatHandler,\n    display: displayFormatHandler,\n    float: floatFormatHandler,\n    fontFamily: fontFamilyFormatHandler,\n    fontSize: fontSizeFormatHandler,\n    entity: entityFormatHandler,\n    htmlAlign: htmlAlignFormatHandler,\n    id: idFormatHandler,\n    italic: italicFormatHandler,\n    letterSpacing: letterSpacingFormatHandler,\n    lineHeight: lineHeightFormatHandler,\n    link: linkFormatHandler,\n    listItemThread: listItemThreadFormatHandler,\n    listLevelThread: listLevelThreadFormatHandler,\n    listStyle: listStyleFormatHandler,\n    margin: marginFormatHandler,\n    padding: paddingFormatHandler,\n    size: sizeFormatHandler,\n    strike: strikeFormatHandler,\n    superOrSubScript: superOrSubScriptFormatHandler,\n    tableLayout: tableLayoutFormatHandler,\n    tableSpacing: tableSpacingFormatHandler,\n    textAlign: textAlignFormatHandler,\n    textColor: textColorFormatHandler,\n    textColorOnTableCell: textColorOnTableCellFormatHandler,\n    textIndent: textIndentFormatHandler,\n    underline: underlineFormatHandler,\n    verticalAlign: verticalAlignFormatHandler,\n    whiteSpace: whiteSpaceFormatHandler,\n    wordBreak: wordBreakFormatHandler,\n};\n\nconst styleBasedSegmentFormats: (keyof FormatHandlerTypeMap)[] = [\n    'letterSpacing',\n    'fontFamily',\n    'fontSize',\n];\n\nconst elementBasedSegmentFormats: (keyof FormatHandlerTypeMap)[] = [\n    'strike',\n    'underline',\n    'superOrSubScript',\n    'italic',\n    'bold',\n];\nconst sharedBlockFormats: (keyof FormatHandlerTypeMap)[] = [\n    'direction',\n    'textAlign',\n    'textIndent',\n    'lineHeight',\n    'whiteSpace',\n];\nconst sharedContainerFormats: (keyof FormatHandlerTypeMap)[] = [\n    'backgroundColor',\n    'margin',\n    'padding',\n    'border',\n];\n\n/**\n * @internal\n */\nexport const defaultFormatKeysPerCategory: {\n    [key in keyof ContentModelFormatMap]: (keyof FormatHandlerTypeMap)[];\n} = {\n    block: sharedBlockFormats,\n    listItemThread: ['listItemThread'],\n    listLevelThread: ['listLevelThread'],\n    listItemElement: [\n        ...sharedBlockFormats,\n        'direction',\n        'textAlign',\n        'lineHeight',\n        'margin',\n        'listStyle',\n    ],\n    listLevel: ['direction', 'textAlign', 'margin', 'padding', 'listStyle', 'backgroundColor'],\n    styleBasedSegment: [...styleBasedSegmentFormats, 'textColor', 'backgroundColor', 'lineHeight'],\n    elementBasedSegment: elementBasedSegmentFormats,\n    segment: [\n        ...styleBasedSegmentFormats,\n        ...elementBasedSegmentFormats,\n        'textColor',\n        'backgroundColor',\n        'lineHeight',\n    ],\n    segmentOnBlock: [...styleBasedSegmentFormats, ...elementBasedSegmentFormats, 'textColor'],\n    segmentOnTableCell: [\n        ...styleBasedSegmentFormats,\n        ...elementBasedSegmentFormats,\n        'textColorOnTableCell',\n    ],\n    tableCell: [\n        'border',\n        'backgroundColor',\n        'padding',\n        'verticalAlign',\n        'wordBreak',\n        'textColor',\n        'htmlAlign',\n        'size',\n    ],\n    tableRow: ['backgroundColor'],\n    tableColumn: ['size'],\n    table: [\n        'id',\n        'border',\n        'backgroundColor',\n        'display',\n        'htmlAlign',\n        'margin',\n        'size',\n        'tableLayout',\n        'textColor',\n    ],\n    tableBorder: ['borderBox', 'tableSpacing'],\n    tableCellBorder: ['borderBox'],\n    image: [\n        'id',\n        'size',\n        'margin',\n        'padding',\n        'borderBox',\n        'border',\n        'boxShadow',\n        'display',\n        'float',\n        'verticalAlign',\n    ],\n    link: [\n        'link',\n        'textColor',\n        'underline',\n        'display',\n        'margin',\n        'padding',\n        'backgroundColor',\n        'border',\n        'size',\n        'textAlign',\n    ],\n    segmentUnderLink: ['textColor'],\n    code: ['fontFamily', 'display'],\n    dataset: ['dataset'],\n    divider: [...sharedBlockFormats, ...sharedContainerFormats, 'display', 'size', 'htmlAlign'],\n    container: [...sharedContainerFormats, 'htmlAlign', 'size', 'display'],\n    entity: ['entity'],\n    general: ['textColor', 'backgroundColor'], // General model still need to do color transformation in dark mode\n};\n\n/**\n * @internal\n */\nexport const defaultFormatParsers: FormatParsers = getObjectKeys(defaultFormatHandlerMap).reduce(\n    (result, key) => {\n        result[key] = defaultFormatHandlerMap[key].parse as FormatParser<any>;\n        return result;\n    },\n    <FormatParsers>{}\n);\n\n/**\n * @internal\n */\nexport const defaultFormatAppliers: FormatAppliers = getObjectKeys(defaultFormatHandlerMap).reduce(\n    (result, key) => {\n        result[key] = defaultFormatHandlerMap[key].apply as FormatApplier<any>;\n        return result;\n    },\n    <FormatAppliers>{}\n);\n","import { generateEntityClassNames, parseEntityFormat } from '../../domUtils/entityUtils';\nimport type { EntityInfoFormat, IdFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const entityFormatHandler: FormatHandler<EntityInfoFormat & IdFormat> = {\n    parse: (format, element) => {\n        Object.assign(format, parseEntityFormat(element));\n    },\n\n    apply: (format, element) => {\n        if (!format.isFakeEntity) {\n            element.className = generateEntityClassNames(format);\n        }\n\n        if (format.isReadonly) {\n            element.contentEditable = 'false';\n        } else {\n            element.removeAttribute('contenteditable');\n        }\n    },\n};\n","import { isElementOfType } from '../../domUtils/isElementOfType';\nimport { isNodeOfType } from '../../domUtils/isNodeOfType';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { ListThreadFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const listItemThreadFormatHandler: FormatHandler<ListThreadFormat> = {\n    parse: (format, element, context, defaultStyles) => {\n        const { listFormat } = context;\n        const depth = listFormat.levels.length;\n        const display = element.style.display || defaultStyles.display;\n\n        if (display && display != 'list-item') {\n            format.displayForDummyItem = display;\n        } else if (isLiUnderOl(element) && depth > 0) {\n            listFormat.threadItemCounts[depth - 1]++;\n            listFormat.threadItemCounts.splice(depth);\n            listFormat.levels.forEach(level => {\n                // Delete restart number so next list item doesn't need to have this value.\n                // Then it will be treated as a continuous list item to the previous one\n                delete level.format.startNumberOverride;\n            });\n        }\n    },\n    apply: (format, element, context) => {\n        if (format.displayForDummyItem) {\n            element.style.display = format.displayForDummyItem;\n        } else if (isLiUnderOl(element)) {\n            const { listFormat } = context;\n            const { threadItemCounts } = listFormat;\n            const index = listFormat.nodeStack.length - 2; // The first one is always the parent of list, then minus another 1 to convert length to index\n\n            if (index >= 0) {\n                threadItemCounts.splice(index + 1);\n                threadItemCounts[index] = (threadItemCounts[index] ?? 0) + 1;\n            }\n        }\n    },\n};\n\nfunction isLiUnderOl(element: HTMLElement) {\n    return (\n        isElementOfType(element, 'li') &&\n        isNodeOfType(element.parentNode, 'ELEMENT_NODE') &&\n        isElementOfType(element.parentNode, 'ol')\n    );\n}\n","import { isElementOfType } from '../../domUtils/isElementOfType';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { ListThreadFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const listLevelThreadFormatHandler: FormatHandler<ListThreadFormat> = {\n    parse: (format, element, context) => {\n        if (isElementOfType(element, 'ol')) {\n            const { listFormat } = context;\n            const { threadItemCounts, levels } = listFormat;\n            const depth = levels.length;\n\n            if (\n                typeof threadItemCounts[depth] === 'number' &&\n                element.start != threadItemCounts[depth] + 1\n            ) {\n                format.startNumberOverride = element.start;\n            }\n\n            threadItemCounts[depth] = element.start - 1;\n        }\n    },\n    apply: (format, element, context) => {\n        const {\n            listFormat: { threadItemCounts, nodeStack },\n        } = context;\n\n        // The first one is always the parent of list, and minus another one to convert length to index\n        // This format applier needs to be executed after new list level is pushed into node stack\n        const depth = nodeStack.length - 2;\n\n        if (depth >= 0 && isElementOfType(element, 'ol')) {\n            const startNumber = format.startNumberOverride;\n\n            if (typeof startNumber === 'number') {\n                threadItemCounts[depth] = startNumber - 1;\n            } else if (typeof threadItemCounts[depth] != 'number') {\n                threadItemCounts[depth] = 0;\n            }\n\n            threadItemCounts.splice(depth + 1);\n            element.start = threadItemCounts[depth] + 1;\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { ListStyleFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const listStyleFormatHandler: FormatHandler<ListStyleFormat> = {\n    parse: (format, element) => {\n        const listStylePosition = element.style.listStylePosition;\n        const listStyleType = element.style.listStyleType;\n\n        if (listStylePosition) {\n            format.listStylePosition = listStylePosition;\n        }\n\n        if (listStyleType) {\n            format.listStyleType = listStyleType;\n        }\n    },\n    apply: (format, element) => {\n        if (format.listStylePosition) {\n            element.style.listStylePosition = format.listStylePosition;\n        }\n\n        if (format.listStyleType) {\n            element.style.listStyleType = format.listStyleType;\n        }\n    },\n};\n","import { shouldSetValue } from '../utils/shouldSetValue';\nimport { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type { BoldFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const boldFormatHandler: FormatHandler<BoldFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const fontWeight = element.style.fontWeight || defaultStyle.fontWeight;\n\n        if (shouldSetValue(fontWeight, '400', format.fontWeight, defaultStyle.fontWeight)) {\n            format.fontWeight = fontWeight;\n        }\n    },\n    apply: (format, element, context) => {\n        if (typeof format.fontWeight === 'undefined') {\n            return;\n        }\n\n        const blockFontWeight = context.implicitFormat.fontWeight;\n\n        if (\n            (blockFontWeight && blockFontWeight != format.fontWeight) ||\n            (!blockFontWeight && format.fontWeight && format.fontWeight != 'normal')\n        ) {\n            if (format.fontWeight == 'bold') {\n                wrapAllChildNodes(element, 'b');\n            } else {\n                element.style.fontWeight = format.fontWeight || 'normal';\n            }\n        }\n    },\n};\n","import type { FontFamilyFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const fontFamilyFormatHandler: FormatHandler<FontFamilyFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const fontFamily = element.style.fontFamily || defaultStyle.fontFamily;\n\n        if (fontFamily && fontFamily != 'inherit') {\n            format.fontFamily = fontFamily;\n        }\n    },\n    apply: (format, element, context) => {\n        if (format.fontFamily && format.fontFamily != context.implicitFormat.fontFamily) {\n            element.style.fontFamily = format.fontFamily;\n        }\n    },\n};\n","import { isSuperOrSubScript } from './superOrSubScriptFormatHandler';\nimport { parseValueWithUnit } from '../utils/parseValueWithUnit';\nimport type { EditorContext, FontSizeFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const fontSizeFormatHandler: FormatHandler<FontSizeFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const fontSize = element.style.fontSize || defaultStyle.fontSize;\n        const verticalAlign = element.style.verticalAlign || defaultStyle.verticalAlign;\n\n        // when font size is 'smaller' and the style is for superscript/subscript,\n        // the font size will be handled by superOrSubScript handler\n        if (fontSize && !isSuperOrSubScript(fontSize, verticalAlign) && fontSize != 'inherit') {\n            if (element.style.fontSize) {\n                format.fontSize = normalizeFontSize(\n                    fontSize,\n                    context.segmentFormat.fontSize,\n                    context\n                );\n            } else if (defaultStyle.fontSize) {\n                format.fontSize = fontSize;\n            }\n        }\n    },\n    apply: (format, element, context) => {\n        if (format.fontSize && format.fontSize != context.implicitFormat.fontSize) {\n            element.style.fontSize = format.fontSize;\n        }\n    },\n};\n\n// https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\nconst KnownFontSizes: Record<string, string> = {\n    'xx-small': '6.75pt',\n    'x-small': '7.5pt',\n    small: '9.75pt',\n    medium: '12pt',\n    large: '13.5pt',\n    'x-large': '18pt',\n    'xx-large': '24pt',\n    'xxx-large': '36pt',\n};\n\nfunction normalizeFontSize(\n    fontSize: string,\n    contextFont: string | undefined,\n    context: EditorContext\n): string | undefined {\n    const knownFontSize = KnownFontSizes[fontSize];\n    const isRemUnit = fontSize.endsWith('rem');\n\n    if (knownFontSize) {\n        return knownFontSize;\n    } else if (\n        fontSize == 'smaller' ||\n        fontSize == 'larger' ||\n        fontSize.endsWith('em') ||\n        fontSize.endsWith('%') ||\n        isRemUnit\n    ) {\n        if (!contextFont && !isRemUnit) {\n            return undefined;\n        } else {\n            const existingFontSize = isRemUnit\n                ? context.rootFontSize\n                : parseValueWithUnit(contextFont);\n\n            if (existingFontSize) {\n                switch (fontSize) {\n                    case 'smaller':\n                        return Math.round((existingFontSize * 500) / 6) / 100 + 'px';\n                    case 'larger':\n                        return Math.round((existingFontSize * 600) / 5) / 100 + 'px';\n                    default:\n                        return parseValueWithUnit(fontSize, existingFontSize, 'px') + 'px';\n                }\n            }\n        }\n    } else if (fontSize == 'inherit' || fontSize == 'revert' || fontSize == 'unset') {\n        return undefined;\n    } else {\n        return fontSize;\n    }\n}\n","import { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { ItalicFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const italicFormatHandler: FormatHandler<ItalicFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const fontStyle = element.style.fontStyle || defaultStyle.fontStyle;\n\n        if (fontStyle == 'italic' || fontStyle == 'oblique') {\n            format.italic = true;\n        } else if (fontStyle == 'initial' || fontStyle == 'normal') {\n            format.italic = false;\n        }\n    },\n    apply: (format, element, context) => {\n        if (typeof format.italic === 'undefined') {\n            return;\n        }\n\n        const implicitItalic = context.implicitFormat.italic;\n\n        if (!!implicitItalic != !!format.italic) {\n            if (format.italic) {\n                wrapAllChildNodes(element, 'i');\n            } else {\n                element.style.fontStyle = 'normal';\n            }\n        }\n    },\n};\n","import { shouldSetValue } from '../utils/shouldSetValue';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { LetterSpacingFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const letterSpacingFormatHandler: FormatHandler<LetterSpacingFormat> = {\n    parse: (format, element, _, defaultStyle) => {\n        const letterSpacing = element.style.letterSpacing || defaultStyle.letterSpacing;\n\n        if (\n            shouldSetValue(\n                letterSpacing,\n                'normal',\n                format.letterSpacing,\n                defaultStyle.letterSpacing\n            )\n        ) {\n            format.letterSpacing = letterSpacing;\n        }\n    },\n    apply: (format, element) => {\n        if (format.letterSpacing) {\n            element.style.letterSpacing = format.letterSpacing;\n        }\n    },\n};\n","import { isElementOfType } from '../../domUtils/isElementOfType';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { LinkFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const linkFormatHandler: FormatHandler<LinkFormat> = {\n    parse: (format, element) => {\n        if (isElementOfType(element, 'a')) {\n            const name = element.name;\n            const href = element.getAttribute('href'); // Use getAttribute to get original HREF but not the resolved absolute url\n            const target = element.target;\n            const rel = element.rel;\n            const id = element.id;\n            const className = element.className;\n            const title = element.title;\n\n            if (name) {\n                format.name = name;\n            }\n\n            if (href) {\n                format.href = href;\n            }\n\n            if (target) {\n                format.target = target;\n            }\n\n            if (id) {\n                format.anchorId = id;\n            }\n\n            if (rel) {\n                format.relationship = rel;\n            }\n\n            if (title) {\n                format.anchorTitle = title;\n            }\n\n            if (className) {\n                format.anchorClass = className;\n            }\n        }\n    },\n    apply: (format, element) => {\n        if (isElementOfType(element, 'a') && format.href) {\n            element.href = format.href;\n\n            if (format.name) {\n                element.name = format.name;\n            }\n\n            if (format.target) {\n                element.target = format.target;\n            }\n\n            if (format.anchorId) {\n                element.id = format.anchorId;\n            }\n\n            if (format.anchorClass) {\n                element.className = format.anchorClass;\n            }\n\n            if (format.anchorTitle) {\n                element.title = format.anchorTitle;\n            }\n\n            if (format.relationship) {\n                element.rel = format.relationship;\n            }\n        }\n    },\n};\n","import { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { StrikeFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const strikeFormatHandler: FormatHandler<StrikeFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const textDecoration = element.style.textDecoration || defaultStyle.textDecoration;\n\n        if (textDecoration?.indexOf('line-through')! >= 0) {\n            format.strikethrough = true;\n        }\n    },\n    apply: (format, element) => {\n        if (format.strikethrough) {\n            wrapAllChildNodes(element, 's');\n        }\n    },\n};\n","import { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { SuperOrSubScriptFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const superOrSubScriptFormatHandler: FormatHandler<SuperOrSubScriptFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const verticalAlign = element.style.verticalAlign || defaultStyle.verticalAlign;\n        const fontSize = element.style.fontSize || defaultStyle.fontSize;\n\n        if (isSuperOrSubScript(fontSize, verticalAlign)) {\n            format.superOrSubScriptSequence = (format.superOrSubScriptSequence || '')\n                .split(' ')\n                .concat(verticalAlign)\n                .join(' ')\n                .trim();\n        }\n    },\n    apply: (format, element) => {\n        if (format.superOrSubScriptSequence) {\n            format.superOrSubScriptSequence\n                .split(' ')\n                .reverse()\n                .forEach(value => {\n                    const tagName = value == 'super' ? 'sup' : value == 'sub' ? 'sub' : null;\n\n                    if (tagName) {\n                        wrapAllChildNodes(element, tagName);\n                    }\n                });\n        }\n    },\n};\n\n/**\n * @internal\n */\nexport function isSuperOrSubScript(\n    fontSize: string | undefined,\n    verticalAlign: string | undefined\n): verticalAlign is 'sub' | 'super' {\n    return fontSize == 'smaller' && (verticalAlign == 'sub' || verticalAlign == 'super');\n}\n","import { getColor, setColor } from '../utils/color';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { TextColorFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const textColorFormatHandler: FormatHandler<TextColorFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const textColor =\n            getColor(\n                element,\n                false /*isBackground*/,\n                !!context.isDarkMode,\n                context.darkColorHandler\n            ) || defaultStyle.color;\n\n        if (textColor && textColor != 'inherit') {\n            format.textColor = textColor;\n        }\n    },\n    apply: (format, element, context) => {\n        const implicitColor = context.implicitFormat.textColor;\n\n        if (format.textColor && format.textColor != implicitColor) {\n            setColor(\n                element,\n                format.textColor,\n                false /*isBackground*/,\n                !!context.isDarkMode,\n                context.darkColorHandler\n            );\n        }\n    },\n};\n","import { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { UnderlineFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const underlineFormatHandler: FormatHandler<UnderlineFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const textDecoration = element.style.textDecoration || defaultStyle.textDecoration;\n\n        if (textDecoration?.indexOf('underline')! >= 0) {\n            format.underline = true;\n        } else if (element.tagName == 'A' && textDecoration == 'none') {\n            format.underline = false;\n        }\n    },\n    apply: (format, element, context) => {\n        if (typeof format.underline === 'undefined') {\n            return;\n        }\n\n        const blockUnderline = context.implicitFormat.underline;\n\n        if (!!blockUnderline != !!format.underline) {\n            if (format.underline) {\n                wrapAllChildNodes(element, 'u');\n            } else {\n                element.style.textDecoration = 'none';\n            }\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { TableLayoutFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const tableLayoutFormatHandler: FormatHandler<TableLayoutFormat> = {\n    parse: (format, element) => {\n        const tableLayout = element.style.tableLayout;\n        if (tableLayout && tableLayout != 'inherit') {\n            format.tableLayout = tableLayout;\n        }\n    },\n    apply: (format, element) => {\n        if (format.tableLayout) {\n            element.style.tableLayout = format.tableLayout;\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { SpacingFormat } from 'roosterjs-content-model-types';\n\nconst BorderCollapsed = 'collapse';\nconst BorderSeparate = 'separate';\nconst CellPadding = 'cellPadding';\n\n/**\n * @internal\n */\nexport const tableSpacingFormatHandler: FormatHandler<SpacingFormat> = {\n    parse: (format, element) => {\n        if (element.style.borderCollapse == BorderCollapsed) {\n            format.borderCollapse = true;\n        } else {\n            const cellPadding = element.getAttribute(CellPadding);\n            if (cellPadding) {\n                format.borderCollapse = true;\n            }\n        }\n\n        if (element.style.borderCollapse == BorderSeparate) {\n            format.borderSeparate = true;\n        }\n    },\n    apply: (format, element) => {\n        if (format.borderCollapse) {\n            element.style.borderCollapse = BorderCollapsed;\n            element.style.borderSpacing = '0';\n            element.style.boxSizing = 'border-box';\n        } else if (format.borderSeparate) {\n            element.style.borderCollapse = BorderSeparate;\n            element.style.borderSpacing = '0';\n            element.style.boxSizing = 'border-box';\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { TextColorFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const textColorOnTableCellFormatHandler: FormatHandler<TextColorFormat> = {\n    parse: (format, element) => {\n        if (element.style.color) {\n            // Delete color from format since text color on TD/TH will be handled by separate code\n            // and text color on segment format context need to be reset so that it will not inherit\n            // value outer container\n            delete format.textColor;\n        }\n    },\n    apply: () => {},\n};\n","import { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport type { DarkColorHandler, Colors } from 'roosterjs-content-model-types';\n\n/**\n * List of deprecated colors\n */\nexport const DeprecatedColors: string[] = [\n    'inactiveborder',\n    'activeborder',\n    'inactivecaptiontext',\n    'inactivecaption',\n    'activecaption',\n    'appworkspace',\n    'infobackground',\n    'background',\n    'buttonhighlight',\n    'buttonshadow',\n    'captiontext',\n    'infotext',\n    'menutext',\n    'menu',\n    'scrollbar',\n    'threeddarkshadow',\n    'threedface',\n    'threedhighlight',\n    'threedlightshadow',\n    'threedfhadow',\n    'windowtext',\n    'windowframe',\n    'window',\n];\n\nconst BlackColor = 'rgb(0, 0, 0)';\nconst HEX3_REGEX = /^#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/;\nconst HEX6_REGEX = /^#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/;\nconst RGB_REGEX = /^rgb\\(\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*\\)$/;\nconst RGBA_REGEX = /^rgba\\(\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*\\)$/;\nconst VARIABLE_REGEX = /^\\s*var\\(\\s*(\\-\\-[a-zA-Z0-9\\-_]+)\\s*(?:,\\s*(.*))?\\)\\s*$/;\nconst VARIABLE_PREFIX = 'var(';\nconst VARIABLE_POSTFIX = ')';\nconst COLOR_VAR_PREFIX = '--darkColor';\n\n/**\n * Get color from given HTML element\n * @param element The element to get color from\n * @param isBackground True to get background color, false to get text color\n * @param isDarkMode Whether element is in dark mode now\n * @param darkColorHandler @optional The dark color handler object to help manager dark mode color\n */\nexport function getColor(\n    element: HTMLElement,\n    isBackground: boolean,\n    isDarkMode: boolean,\n    darkColorHandler?: DarkColorHandler\n): string | undefined {\n    let color =\n        (isBackground ? element.style.backgroundColor : element.style.color) ||\n        element.getAttribute(isBackground ? 'bgcolor' : 'color') ||\n        undefined;\n\n    if (color && DeprecatedColors.indexOf(color) > -1) {\n        color = isBackground ? undefined : BlackColor;\n    } else if (darkColorHandler && color) {\n        const match = color.startsWith(VARIABLE_PREFIX) ? VARIABLE_REGEX.exec(color) : null;\n\n        if (match) {\n            color = match[2] || '';\n        } else if (isDarkMode) {\n            // If editor is in dark mode but the color is not in dark color format, it is possible the color was inserted from external code\n            // without any light color info. So we first try to see if there is a known dark color can match this color, and use its related\n            // light color as light mode color. Otherwise we need to drop this color to avoid show \"white on white\" content.\n            color = findLightColorFromDarkColor(color, darkColorHandler.knownColors) || '';\n        }\n    }\n\n    return color;\n}\n\n/**\n * Set color to given HTML element\n * @param element The element to set color to\n * @param color The color to set, always pass in color in light mode\n * @param isBackground True to set background color, false to set text color\n * @param isDarkMode Whether element is in dark mode now\n * @param darkColorHandler @optional The dark color handler object to help manager dark mode color\n */\nexport function setColor(\n    element: HTMLElement,\n    color: string | null | undefined,\n    isBackground: boolean,\n    isDarkMode: boolean,\n    darkColorHandler?: DarkColorHandler\n) {\n    const match = color && color.startsWith(VARIABLE_PREFIX) ? VARIABLE_REGEX.exec(color) : null;\n    const [_, existingKey, fallbackColor] = match ?? [];\n\n    color = fallbackColor ?? color;\n\n    if (darkColorHandler && color) {\n        const key = existingKey || `${COLOR_VAR_PREFIX}_${color.replace(/[^\\d\\w]/g, '_')}`;\n        const darkModeColor =\n            darkColorHandler.knownColors?.[key]?.darkModeColor ||\n            darkColorHandler.getDarkColor(\n                color,\n                undefined /*baseLAValue*/,\n                isBackground ? 'background' : 'text',\n                element\n            );\n\n        darkColorHandler.updateKnownColor(isDarkMode, key, {\n            lightModeColor: color,\n            darkModeColor,\n        });\n\n        color = isDarkMode ? `${VARIABLE_PREFIX}${key}, ${color}${VARIABLE_POSTFIX}` : color;\n    }\n\n    element.removeAttribute(isBackground ? 'bgcolor' : 'color');\n    element.style.setProperty(isBackground ? 'background-color' : 'color', color || null);\n}\n\n/**\n * Parse color string to r/g/b value.\n * If the given color is not in a recognized format, return null\n * @param color The source color to parse\n * @returns An array of Red/Green/Blue value, or null if fail to parse\n */\nexport function parseColor(color: string): [number, number, number] | null {\n    color = (color || '').trim();\n\n    let match: RegExpMatchArray | null;\n    if ((match = color.match(HEX3_REGEX))) {\n        return [\n            parseInt(match[1] + match[1], 16),\n            parseInt(match[2] + match[2], 16),\n            parseInt(match[3] + match[3], 16),\n        ];\n    } else if ((match = color.match(HEX6_REGEX))) {\n        return [parseInt(match[1], 16), parseInt(match[2], 16), parseInt(match[3], 16)];\n    } else if ((match = color.match(RGB_REGEX) || color.match(RGBA_REGEX))) {\n        return [parseInt(match[1]), parseInt(match[2]), parseInt(match[3])];\n    } else {\n        // CSS color names such as red, green is not included for now.\n        // If need, we can add those colors from https://www.w3.org/wiki/CSS/Properties/color/keywords\n        return null;\n    }\n}\n\nfunction findLightColorFromDarkColor(\n    darkColor: string,\n    knownColors?: Record<string, Colors>\n): string | null {\n    const rgbSearch = parseColor(darkColor);\n\n    if (rgbSearch && knownColors) {\n        const key = getObjectKeys(knownColors).find(key => {\n            const rgbCurrent = parseColor(knownColors[key].darkModeColor);\n\n            return (\n                rgbCurrent &&\n                rgbCurrent[0] == rgbSearch[0] &&\n                rgbCurrent[1] == rgbSearch[1] &&\n                rgbCurrent[2] == rgbSearch[2]\n            );\n        });\n\n        if (key) {\n            return knownColors[key].lightModeColor;\n        }\n    }\n\n    return null;\n}\n","/**\n * @internal\n */\nexport const ResultMap = {\n    start: {\n        ltr: 'left',\n        rtl: 'right',\n    },\n    center: {\n        ltr: 'center',\n        rtl: 'center',\n    },\n    end: {\n        ltr: 'right',\n        rtl: 'left',\n    },\n    initial: {\n        ltr: 'initial',\n        rtl: 'initial',\n    },\n    justify: {\n        ltr: 'justify',\n        rtl: 'justify',\n    },\n};\n\n/**\n * @internal\n */\nexport function calcAlign(align: string, dir?: 'ltr' | 'rtl') {\n    switch (align) {\n        case 'center':\n            return 'center';\n\n        case 'left':\n            return dir == 'rtl' ? 'end' : 'start';\n\n        case 'right':\n            return dir == 'rtl' ? 'start' : 'end';\n\n        case 'start':\n        case 'end':\n            return align;\n\n        case 'justify':\n        case 'initial':\n            return align;\n\n        default:\n            return undefined;\n    }\n}\n","const MarginValueRegex = /(-?\\d+(\\.\\d+)?)([a-z]+|%)/;\n\n// According to https://developer.mozilla.org/en-US/docs/Glossary/CSS_pixel, 1in = 96px\nconst PixelPerInch = 96;\n\nconst DefaultRootFontSize = 16;\n\n/**\n * Parse unit value with its unit\n * @param value The source value to parse\n * @param currentSizePxOrElement The source element which has this unit value, or current font size (in px) from context.\n * @param resultUnit Unit for result, can be px or pt. @default px\n */\nexport function parseValueWithUnit(\n    value: string = '',\n    currentSizePxOrElement?: number | HTMLElement,\n    resultUnit: 'px' | 'pt' = 'px'\n): number {\n    const match = MarginValueRegex.exec(value);\n    let result = 0;\n\n    if (match) {\n        const [_, numStr, __, unit] = match;\n        const num = parseFloat(numStr);\n\n        switch (unit) {\n            case 'px':\n                result = num;\n                break;\n            case 'pt':\n                result = ptToPx(num);\n                break;\n            case 'em':\n                result = getFontSize(currentSizePxOrElement) * num;\n                break;\n            case 'ex':\n                result = (getFontSize(currentSizePxOrElement) * num) / 2;\n                break;\n            case '%':\n                result = (getFontSize(currentSizePxOrElement) * num) / 100;\n                break;\n            case 'in':\n                result = num * PixelPerInch;\n                break;\n            case 'rem':\n                result = (getFontSize(currentSizePxOrElement) || DefaultRootFontSize) * num;\n                break;\n        }\n    }\n\n    if (result > 0 && resultUnit == 'pt') {\n        result = pxToPt(result);\n    }\n\n    return result;\n}\n\nfunction getFontSize(currentSizeOrElement?: number | HTMLElement): number {\n    if (typeof currentSizeOrElement === 'undefined') {\n        return 0;\n    } else if (typeof currentSizeOrElement === 'number') {\n        return currentSizeOrElement;\n    } else {\n        const styleInPt =\n            currentSizeOrElement.ownerDocument.defaultView?.getComputedStyle(currentSizeOrElement)\n                .fontSize ?? '';\n        const floatInPt = parseFloat(styleInPt);\n        const floatInPx = ptToPx(floatInPt);\n\n        return floatInPx;\n    }\n}\n\nfunction ptToPx(pt: number): number {\n    return Math.round((pt * 4000) / 3) / 1000;\n}\n\nfunction pxToPt(px: number) {\n    return Math.round((px * 3000) / 4) / 1000;\n}\n","/**\n * @internal\n */\nexport function shouldSetValue(\n    value: string | undefined,\n    normalValue: string,\n    existingValue: string | undefined,\n    defaultValue: string | undefined\n): boolean {\n    return (\n        !!value &&\n        value != 'inherit' &&\n        !!(value != normalValue || existingValue || (defaultValue && value != defaultValue))\n    );\n}\n","export { domToContentModel } from './domToModel/domToContentModel';\nexport { contentModelToDom } from './modelToDom/contentModelToDom';\nexport { contentModelToText } from './modelToText/contentModelToText';\n\nexport {\n    childProcessor,\n    handleRegularSelection,\n    processChildNode,\n} from './domToModel/processors/childProcessor';\nexport { entityProcessor } from './domToModel/processors/entityProcessor';\nexport { tableProcessor } from './domToModel/processors/tableProcessor';\nexport { getRegularSelectionOffsets } from './domToModel/utils/getRegularSelectionOffsets';\nexport { parseFormat } from './domToModel/utils/parseFormat';\nexport { areSameFormats } from './domToModel/utils/areSameFormats';\nexport { isBlockElement } from './domToModel/utils/isBlockElement';\n\nexport { updateMetadata, hasMetadata } from './domUtils/metadata/updateMetadata';\nexport { isNodeOfType } from './domUtils/isNodeOfType';\nexport { isElementOfType } from './domUtils/isElementOfType';\nexport { getObjectKeys } from './domUtils/getObjectKeys';\nexport { toArray } from './domUtils/toArray';\nexport { moveChildNodes, wrapAllChildNodes } from './domUtils/moveChildNodes';\nexport { wrap } from './domUtils/wrap';\nexport {\n    isEntityElement,\n    getAllEntityWrappers,\n    parseEntityFormat,\n    generateEntityClassNames,\n    addDelimiters,\n    isEntityDelimiter,\n} from './domUtils/entityUtils';\nexport { reuseCachedElement } from './domUtils/reuseCachedElement';\nexport { isWhiteSpacePreserved } from './domUtils/isWhiteSpacePreserved';\nexport { normalizeRect } from './domUtils/normalizeRect';\n\nexport { createBr } from './modelApi/creators/createBr';\nexport { createListItem } from './modelApi/creators/createListItem';\nexport { createFormatContainer } from './modelApi/creators/createFormatContainer';\nexport { createParagraph } from './modelApi/creators/createParagraph';\nexport { createSelectionMarker } from './modelApi/creators/createSelectionMarker';\nexport { createTable } from './modelApi/creators/createTable';\nexport { createTableCell } from './modelApi/creators/createTableCell';\nexport { createText } from './modelApi/creators/createText';\nexport { createImage } from './modelApi/creators/createImage';\nexport { createContentModelDocument } from './modelApi/creators/createContentModelDocument';\nexport { createParagraphDecorator } from './modelApi/creators/createParagraphDecorator';\nexport { createGeneralSegment } from './modelApi/creators/createGeneralSegment';\nexport { createGeneralBlock } from './modelApi/creators/createGeneralBlock';\nexport { createEntity } from './modelApi/creators/createEntity';\nexport { createDivider } from './modelApi/creators/createDivider';\nexport { createListLevel } from './modelApi/creators/createListLevel';\nexport { createEmptyModel } from './modelApi/creators/createEmptyModel';\n\nexport { addBlock } from './modelApi/common/addBlock';\nexport { addCode } from './modelApi/common/addDecorators';\nexport { addLink } from './modelApi/common/addDecorators';\nexport { normalizeParagraph } from './modelApi/common/normalizeParagraph';\n\nexport { normalizeContentModel } from './modelApi/common/normalizeContentModel';\nexport { isGeneralSegment } from './modelApi/common/isGeneralSegment';\nexport { unwrapBlock } from './modelApi/common/unwrapBlock';\nexport { addSegment } from './modelApi/common/addSegment';\nexport { isEmpty } from './modelApi/common/isEmpty';\nexport { normalizeSingleSegment } from './modelApi/common/normalizeSegment';\n\nexport { setParagraphNotImplicit } from './modelApi/block/setParagraphNotImplicit';\n\nexport { parseValueWithUnit } from './formatHandlers/utils/parseValueWithUnit';\nexport { BorderKeys } from './formatHandlers/common/borderFormatHandler';\nexport { DeprecatedColors, getColor, setColor, parseColor } from './formatHandlers/utils/color';\n\nexport {\n    createDomToModelContext,\n    createDomToModelContextWithConfig,\n    createDomToModelConfig,\n} from './domToModel/context/createDomToModelContext';\nexport {\n    createModelToDomContext,\n    createModelToDomContextWithConfig,\n    createModelToDomConfig,\n} from './modelToDom/context/createModelToDomContext';\n","import type { ContentModelBlock } from 'roosterjs-content-model-types';\n\n/**\n * For a given block, if it is a paragraph, set it to be not-implicit\n * @param block The block to check\n */\nexport function setParagraphNotImplicit(block: ContentModelBlock) {\n    if (block.blockType == 'Paragraph' && block.isImplicit) {\n        block.isImplicit = false;\n    }\n}\n","import type { ContentModelBlock, ContentModelBlockGroup } from 'roosterjs-content-model-types';\n\n/**\n * Add a given block to block group\n * @param group The block group to add block into\n * @param block The block to add\n */\nexport function addBlock(group: ContentModelBlockGroup, block: ContentModelBlock) {\n    group.blocks.push(block);\n}\n","import type {\n    ContentModelCode,\n    ContentModelLink,\n    ContentModelSegment,\n    DomToModelDecoratorContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function addLink(segment: ContentModelSegment, link: ContentModelLink) {\n    if (link.format.href) {\n        segment.link = {\n            format: { ...link.format },\n            dataset: { ...link.dataset },\n        };\n    }\n}\n\n/**\n * Add a code decorator into segment if any\n * @param segment The segment to add decorator to\n * @param code The code decorator to add\n */\nexport function addCode(segment: ContentModelSegment, code: ContentModelCode) {\n    if (code.format.fontFamily) {\n        segment.code = {\n            format: { ...code.format },\n        };\n    }\n}\n\n/**\n * @internal\n */\nexport function addDecorators(segment: ContentModelSegment, context: DomToModelDecoratorContext) {\n    addLink(segment, context.link);\n    addCode(segment, context.code);\n}\n","import { ensureParagraph } from './ensureParagraph';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelBlockGroup,\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Add a given segment into a paragraph from its parent group. If the last block of the given group is not paragraph, create a new paragraph.\n * @param group The parent block group of the paragraph to add segment into\n * @param newSegment The segment to add\n * @param blockFormat The block format used for creating a new paragraph when need\n * @returns The parent paragraph where the segment is added to\n */\nexport function addSegment(\n    group: ContentModelBlockGroup,\n    newSegment: ContentModelSegment,\n    blockFormat?: ContentModelBlockFormat,\n    segmentFormat?: ContentModelSegmentFormat\n): ContentModelParagraph {\n    const paragraph = ensureParagraph(group, blockFormat, segmentFormat);\n    const lastSegment = paragraph.segments[paragraph.segments.length - 1];\n\n    if (blockFormat?.textIndent) {\n        // For a new paragraph, if current text indent is already applied to previous block in the same level,\n        // we need to ignore it according to browser rendering behavior\n        if (blockFormat.isTextIndentApplied && paragraph.segments.length == 0) {\n            delete paragraph.format.textIndent;\n        } else {\n            blockFormat.isTextIndentApplied = true;\n        }\n\n        delete paragraph.format.isTextIndentApplied;\n    }\n\n    if (newSegment.segmentType == 'SelectionMarker') {\n        if (!lastSegment || !lastSegment.isSelected) {\n            paragraph.segments.push(newSegment);\n        }\n    } else {\n        if (newSegment.isSelected && lastSegment?.segmentType == 'SelectionMarker') {\n            paragraph.segments.pop();\n        }\n\n        paragraph.segments.push(newSegment);\n    }\n\n    return paragraph;\n}\n","import { addBlock } from './addBlock';\nimport { createParagraph } from '../creators/createParagraph';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelBlockGroup,\n    ContentModelParagraph,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Ensure there is a Paragraph that can insert segments in a Content Model Block Group\n * @param group The parent block group of the target paragraph\n * @param blockFormat Format of the paragraph. This is only used if we need to create a new paragraph\n */\nexport function ensureParagraph(\n    group: ContentModelBlockGroup,\n    blockFormat?: ContentModelBlockFormat,\n    segmentFormat?: ContentModelSegmentFormat\n): ContentModelParagraph {\n    const lastBlock = group.blocks[group.blocks.length - 1];\n\n    if (lastBlock?.blockType == 'Paragraph') {\n        return lastBlock;\n    } else {\n        const paragraph = createParagraph(true, blockFormat, segmentFormat);\n        addBlock(group, paragraph);\n\n        return paragraph;\n    }\n}\n","// A regex to match text that only has space and CR\n// We use real space char \" \" (\\u0020) here but not \"\\s\" since \"\\s\" will also match \"&nbsp;\" (\\u00A0) which is something we need to keep\nconst SPACE_TEXT_REGEX = /^[\\r\\n\\t ]*$/;\n\n/**\n * @internal\n * Check if the given string only has space, including line breaks.\n * @param txt The string to check\n */\nexport function hasSpacesOnly(txt: string): boolean {\n    return SPACE_TEXT_REGEX.test(txt);\n}\n","import type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelSegment,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function isBlockEmpty(block: ContentModelBlock): boolean {\n    switch (block.blockType) {\n        case 'Paragraph':\n            return block.segments.length == 0;\n\n        case 'Table':\n            return block.rows.every(row => row.cells.length == 0);\n\n        case 'BlockGroup':\n            return isBlockGroupEmpty(block);\n\n        case 'Entity':\n            return false;\n\n        default:\n            return false;\n    }\n}\n\n/**\n * @internal\n */\nexport function isBlockGroupEmpty(group: ContentModelBlockGroup): boolean {\n    switch (group.blockGroupType) {\n        case 'FormatContainer':\n            // Format Container of DIV is a container for style, so we always treat it as not empty\n            return group.tagName == 'div' ? false : group.blocks.every(isBlockEmpty);\n\n        case 'ListItem':\n            return group.blocks.every(isBlockEmpty);\n\n        case 'Document':\n        case 'General':\n        case 'TableCell':\n            return false;\n\n        default:\n            return true;\n    }\n}\n\n/**\n * @internal\n */\nexport function isSegmentEmpty(segment: ContentModelSegment): boolean {\n    switch (segment.segmentType) {\n        case 'Text':\n            return !segment.text;\n\n        case 'Image':\n            return !segment.src;\n\n        default:\n            return false;\n    }\n}\n\n/**\n * Get whether the model is empty.\n * @returns true if the model is empty.\n */\nexport function isEmpty(\n    model: ContentModelBlock | ContentModelBlockGroup | ContentModelSegment\n): boolean {\n    if (isBlockGroup(model)) {\n        return isBlockGroupEmpty(model);\n    } else if (isBlock(model)) {\n        return isBlockEmpty(model);\n    } else if (isSegment(model)) {\n        return isSegmentEmpty(model);\n    }\n\n    return false;\n}\n\nfunction isSegment(\n    model: ContentModelBlock | ContentModelBlockGroup | ContentModelSegment\n): model is ContentModelSegment {\n    return typeof (<ContentModelSegment>model).segmentType === 'string';\n}\n\nfunction isBlock(\n    model: ContentModelBlock | ContentModelBlockGroup | ContentModelSegment\n): model is ContentModelBlock {\n    return typeof (<ContentModelBlock>model).blockType === 'string';\n}\n\nfunction isBlockGroup(\n    model: ContentModelBlock | ContentModelBlockGroup | ContentModelSegment\n): model is ContentModelBlockGroup {\n    return typeof (<ContentModelBlockGroup>model).blockGroupType === 'string';\n}\n","import type {\n    ContentModelBlockGroup,\n    ContentModelGeneralSegment,\n} from 'roosterjs-content-model-types';\n\n/**\n * Check if the given block group is a general segment\n * @param group The group to check\n */\nexport function isGeneralSegment(\n    group: ContentModelBlockGroup | ContentModelGeneralSegment\n): group is ContentModelGeneralSegment {\n    return (\n        group.blockGroupType == 'General' &&\n        (<ContentModelGeneralSegment>group).segmentType == 'General'\n    );\n}\n","import { isBlockEmpty } from './isEmpty';\nimport { normalizeParagraph } from './normalizeParagraph';\nimport { unwrapBlock } from './unwrapBlock';\nimport type { ContentModelBlockGroup } from 'roosterjs-content-model-types';\n\n/**\n * For a given content model, normalize it to make the model be consistent.\n * This process includes:\n * - For a list item without any list level, unwrap the list item\n * - For a paragraph, make sure it has BR at the end if it is an empty paragraph\n * - For text segments under paragraph, make sure its space values are correct (use nbsp to replace space when necessary)\n * - For an empty block, remove it\n * @param group The root level block group of content model to normalize\n */\nexport function normalizeContentModel(group: ContentModelBlockGroup) {\n    for (let i = group.blocks.length - 1; i >= 0; i--) {\n        const block = group.blocks[i];\n\n        switch (block.blockType) {\n            case 'BlockGroup':\n                if (block.blockGroupType == 'ListItem' && block.levels.length == 0) {\n                    i += block.blocks.length;\n                    unwrapBlock(group, block);\n                } else {\n                    normalizeContentModel(block);\n                }\n                break;\n            case 'Paragraph':\n                normalizeParagraph(block);\n                break;\n            case 'Table':\n                for (let r = 0; r < block.rows.length; r++) {\n                    for (let c = 0; c < block.rows[r].cells.length; c++) {\n                        if (block.rows[r].cells[c]) {\n                            normalizeContentModel(block.rows[r].cells[c]);\n                        }\n                    }\n                }\n                break;\n        }\n\n        if (isBlockEmpty(block)) {\n            group.blocks.splice(i, 1);\n        }\n    }\n}\n","import { areSameFormats } from '../../domToModel/utils/areSameFormats';\nimport { createBr } from '../creators/createBr';\nimport { isSegmentEmpty } from './isEmpty';\nimport { isWhiteSpacePreserved } from '../../domUtils/isWhiteSpacePreserved';\nimport { normalizeAllSegments } from './normalizeSegment';\nimport type {\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * @param paragraph The paragraph to normalize\n * Normalize a paragraph. If it is empty, add a BR segment to make sure it can insert content\n */\nexport function normalizeParagraph(paragraph: ContentModelParagraph) {\n    const segments = paragraph.segments;\n\n    if (!paragraph.isImplicit && segments.length > 0) {\n        const last = segments[segments.length - 1];\n        const secondLast = segments[segments.length - 2];\n\n        if (\n            last.segmentType == 'SelectionMarker' &&\n            (!secondLast || secondLast.segmentType == 'Br')\n        ) {\n            segments.push(createBr(last.format));\n        } else if (segments.length > 1 && segments[segments.length - 1].segmentType == 'Br') {\n            const noMarkerSegments = segments.filter(x => x.segmentType != 'SelectionMarker');\n\n            // When there is content with a <BR> tag at the end, we can remove the BR.\n            // But if there are more than one <BR> at the end, do not remove them.\n            if (\n                noMarkerSegments.length > 1 &&\n                noMarkerSegments[noMarkerSegments.length - 2].segmentType != 'Br'\n            ) {\n                segments.pop();\n            }\n        }\n    }\n\n    if (!isWhiteSpacePreserved(paragraph.format.whiteSpace)) {\n        normalizeAllSegments(paragraph);\n    }\n\n    removeEmptyLinks(paragraph);\n\n    removeEmptySegments(paragraph);\n\n    moveUpSegmentFormat(paragraph);\n}\n\nfunction removeEmptySegments(block: ContentModelParagraph) {\n    for (let j = block.segments.length - 1; j >= 0; j--) {\n        if (isSegmentEmpty(block.segments[j])) {\n            block.segments.splice(j, 1);\n        }\n    }\n}\n\nfunction removeEmptyLinks(paragraph: ContentModelParagraph) {\n    const marker = paragraph.segments.find(x => x.segmentType == 'SelectionMarker');\n    if (marker) {\n        const markerIndex = paragraph.segments.indexOf(marker);\n        const prev = paragraph.segments[markerIndex - 1];\n        const next = paragraph.segments[markerIndex + 1];\n        if (\n            (prev &&\n                !prev.link &&\n                areSameFormats(prev.format, marker.format) &&\n                (!next || (!next.link && areSameFormats(next.format, marker.format))) &&\n                marker.link) ||\n            (!prev &&\n                marker.link &&\n                next &&\n                !next.link &&\n                areSameFormats(next.format, marker.format))\n        ) {\n            delete marker.link;\n        }\n    }\n}\n\ntype FormatsToMoveUp = 'fontFamily' | 'fontSize' | 'textColor';\nconst formatsToMoveUp: FormatsToMoveUp[] = ['fontFamily', 'fontSize', 'textColor'];\n\n// When all segments are sharing the same segment format (font name, size and color), we can move its format to paragraph\nfunction moveUpSegmentFormat(paragraph: ContentModelParagraph) {\n    if (!paragraph.decorator) {\n        const segments = paragraph.segments.filter(x => x.segmentType != 'SelectionMarker');\n        const target = paragraph.segmentFormat || {};\n        let changed = false;\n\n        formatsToMoveUp.forEach(key => {\n            changed = internalMoveUpSegmentFormat(segments, target, key) || changed;\n        });\n\n        if (changed) {\n            paragraph.segmentFormat = target;\n        }\n    }\n}\n\nfunction internalMoveUpSegmentFormat(\n    segments: ContentModelSegment[],\n    target: ContentModelSegmentFormat,\n    formatKey: FormatsToMoveUp\n): boolean {\n    const firstFormat = segments[0]?.format;\n\n    if (\n        firstFormat?.[formatKey] &&\n        segments.every(segment => segment.format[formatKey] == firstFormat[formatKey])\n    ) {\n        target[formatKey] = firstFormat[formatKey];\n        return true;\n    } else {\n        return false;\n    }\n}\n","import { hasSpacesOnly } from './hasSpacesOnly';\nimport type {\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelText,\n} from 'roosterjs-content-model-types';\n\nconst SPACE = '\\u0020';\nconst NONE_BREAK_SPACE = '\\u00A0';\nconst LEADING_SPACE_REGEX = /^\\u0020+/;\nconst TRAILING_SPACE_REGEX = /\\u0020+$/;\n\n/**\n * @internal\n */\nexport function normalizeAllSegments(paragraph: ContentModelParagraph) {\n    const context = resetNormalizeSegmentContext();\n\n    paragraph.segments.forEach(segment => {\n        normalizeSegment(segment, context);\n    });\n\n    normalizeTextSegments(context.textSegments, context.lastInlineSegment);\n    normalizeLastTextSegment(context.lastTextSegment, context.lastInlineSegment);\n}\n\n/**\n * Normalize a given segment, make sure its spaces are correctly represented by space and non-break space\n * @param segment The segment to normalize\n * @param ignoreTrailingSpaces Whether we should ignore the trailing space of the text segment @default false\n */\nexport function normalizeSingleSegment(\n    segment: ContentModelSegment,\n    ignoreTrailingSpaces: boolean = false\n) {\n    const context = resetNormalizeSegmentContext();\n\n    context.ignoreTrailingSpaces = ignoreTrailingSpaces;\n    normalizeSegment(segment, context);\n}\n\n/**\n * @internal Export for test only\n */\nexport interface NormalizeSegmentContext {\n    textSegments: ContentModelText[];\n    ignoreLeadingSpaces: boolean;\n    ignoreTrailingSpaces: boolean;\n    lastTextSegment: ContentModelText | undefined;\n    lastInlineSegment: ContentModelSegment | undefined;\n}\n\n/**\n * @internal Export for test only\n */\nexport function createNormalizeSegmentContext(): NormalizeSegmentContext {\n    return resetNormalizeSegmentContext();\n}\n\nfunction resetNormalizeSegmentContext(\n    context?: Partial<NormalizeSegmentContext>\n): NormalizeSegmentContext {\n    return Object.assign(context ?? {}, {\n        textSegments: [],\n        ignoreLeadingSpaces: true,\n        ignoreTrailingSpaces: true,\n        lastInlineSegment: undefined,\n        lastTextSegment: undefined,\n    });\n}\n\n/**\n * @internal Export for test only\n */\nexport function normalizeSegment(segment: ContentModelSegment, context: NormalizeSegmentContext) {\n    switch (segment.segmentType) {\n        case 'Br':\n            normalizeTextSegments(context.textSegments, context.lastInlineSegment);\n            normalizeLastTextSegment(context.lastTextSegment, context.lastInlineSegment);\n\n            // Line ends, reset all states\n            resetNormalizeSegmentContext(context);\n            break;\n\n        case 'Entity':\n        case 'General':\n        case 'Image':\n            // Here \"inline segment\" means a segment showing some content inline such as text, image, or other inline HTML elements\n            // BR will end current line, so it is not treated as \"inline\" here.\n            // We will do some normalization to the trailing spaces for non-inline-segments\n            context.lastInlineSegment = segment;\n            context.ignoreLeadingSpaces = false;\n            break;\n\n        case 'Text':\n            context.textSegments.push(segment);\n            context.lastInlineSegment = segment;\n            context.lastTextSegment = segment;\n\n            const first = segment.text.substring(0, 1);\n            const last = segment.text.substr(-1);\n\n            if (!hasSpacesOnly(segment.text)) {\n                if (first == SPACE) {\n                    // 1. Multiple leading space => single &nbsp; or empty (depends on if previous segment ends with space)\n                    segment.text = segment.text.replace(\n                        LEADING_SPACE_REGEX,\n                        context.ignoreLeadingSpaces ? '' : NONE_BREAK_SPACE\n                    );\n                }\n\n                if (last == SPACE) {\n                    // 2. Multiple trailing space => single space\n                    segment.text = segment.text.replace(\n                        TRAILING_SPACE_REGEX,\n                        context.ignoreTrailingSpaces ? SPACE : NONE_BREAK_SPACE\n                    );\n                }\n            }\n\n            context.ignoreLeadingSpaces = last == SPACE;\n\n            break;\n    }\n}\n\nfunction normalizeTextSegments(\n    segments: ContentModelText[],\n    lastInlineSegment: ContentModelSegment | undefined\n) {\n    segments.forEach(segment => {\n        // 3. Segment ends with &nbsp; replace it with space if the previous char is not space so that next segment can wrap\n        // Only do this for segments that is not the last one since the last space will be removed in step 4\n        if (segment != lastInlineSegment) {\n            const text = segment.text;\n\n            if (\n                text.substr(-1) == NONE_BREAK_SPACE &&\n                text.length > 1 &&\n                text.substr(-2, 1) != SPACE\n            ) {\n                segment.text = text.substring(0, text.length - 1) + SPACE;\n            }\n        }\n    });\n}\n\nfunction normalizeLastTextSegment(\n    segment: ContentModelText | undefined,\n    lastInlineSegment: ContentModelSegment | undefined\n) {\n    if (segment && segment == lastInlineSegment && segment?.text.substr(-1) == SPACE) {\n        // 4. last text segment of the paragraph, remove trailing space\n        segment.text = segment.text.replace(TRAILING_SPACE_REGEX, '');\n    }\n}\n","import { setParagraphNotImplicit } from '../block/setParagraphNotImplicit';\nimport type { ContentModelBlock, ContentModelBlockGroup } from 'roosterjs-content-model-types';\n\n/**\n * Unwrap a given block group, move its child blocks to be under its parent group\n * @param parent Parent block group of the unwrapping group\n * @param groupToUnwrap  The block group to unwrap\n */\nexport function unwrapBlock(\n    parent: ContentModelBlockGroup | null,\n    groupToUnwrap: ContentModelBlockGroup & ContentModelBlock\n) {\n    const index = parent?.blocks.indexOf(groupToUnwrap) ?? -1;\n\n    if (index >= 0) {\n        groupToUnwrap.blocks.forEach(setParagraphNotImplicit);\n\n        parent?.blocks.splice(index, 1, ...groupToUnwrap.blocks);\n    }\n}\n","import type { ContentModelBr, ContentModelSegmentFormat } from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelBr model\n * @param format @optional The format of this model\n */\nexport function createBr(format?: ContentModelSegmentFormat): ContentModelBr {\n    return {\n        segmentType: 'Br',\n        format: format ? { ...format } : {},\n    };\n}\n","import type {\n    ContentModelDocument,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelDocument model\n * @param defaultFormat @optional Default format of this model\n */\nexport function createContentModelDocument(\n    defaultFormat?: ContentModelSegmentFormat\n): ContentModelDocument {\n    const result: ContentModelDocument = {\n        blockGroupType: 'Document',\n        blocks: [],\n    };\n\n    if (defaultFormat) {\n        result.format = defaultFormat;\n    }\n\n    return result;\n}\n","import type { ContentModelBlockFormat, ContentModelDivider } from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelDivider model\n * @param tagName Tag name of this divider. Currently only hr and div are supported\n * @param format @optional The format of this model\n */\nexport function createDivider(\n    tagName: 'hr' | 'div',\n    format?: ContentModelBlockFormat\n): ContentModelDivider {\n    return {\n        blockType: 'Divider',\n        tagName,\n        format: format ? { ...format } : {},\n    };\n}\n","import { createBr } from './createBr';\nimport { createContentModelDocument } from './createContentModelDocument';\nimport { createParagraph } from './createParagraph';\nimport { createSelectionMarker } from './createSelectionMarker';\nimport type {\n    ContentModelDocument,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create an empty Content Model Document with initial empty line and insert point with default format\n * @param format @optional The default format to be applied to this Content Model\n */\nexport function createEmptyModel(format?: ContentModelSegmentFormat): ContentModelDocument {\n    const model = createContentModelDocument(format);\n    const paragraph = createParagraph(false /*isImplicit*/, undefined /*blockFormat*/, format);\n\n    paragraph.segments.push(createSelectionMarker(format), createBr(format));\n    model.blocks.push(paragraph);\n\n    return model;\n}\n","import type { ContentModelEntity, ContentModelSegmentFormat } from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelEntity model\n * @param wrapper Wrapper element of this entity\n * @param isReadonly Whether this is a readonly entity @default true\n * @param segmentFormat @optional Segment format of this entity\n * @param type @optional Type of this entity\n * @param id @optional Id of this entity\n */\nexport function createEntity(\n    wrapper: HTMLElement,\n    isReadonly: boolean = true,\n    segmentFormat?: ContentModelSegmentFormat,\n    type?: string,\n    id?: string\n): ContentModelEntity {\n    return {\n        segmentType: 'Entity',\n        blockType: 'Entity',\n        format: { ...segmentFormat },\n        entityFormat: {\n            id,\n            entityType: type,\n            isReadonly,\n        },\n        wrapper,\n    };\n}\n","import type {\n    ContentModelFormatContainer,\n    ContentModelFormatContainerFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelFormatContainer model\n * @param tag Tag name of this format container, in lower case\n * @param format @optional The format of this model\n */\nexport function createFormatContainer(\n    tag: Lowercase<string>,\n    format?: ContentModelFormatContainerFormat\n): ContentModelFormatContainer {\n    return {\n        blockType: 'BlockGroup',\n        blockGroupType: 'FormatContainer',\n        tagName: tag,\n        blocks: [],\n        format: { ...(format || {}) },\n    };\n}\n","import type { ContentModelGeneralBlock } from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelGeneralBlock model\n * @param element Original element of this model\n */\nexport function createGeneralBlock(element: HTMLElement): ContentModelGeneralBlock {\n    return {\n        blockType: 'BlockGroup',\n        blockGroupType: 'General',\n        element: element,\n        blocks: [],\n        format: {},\n    };\n}\n","import type {\n    ContentModelGeneralSegment,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelGeneralSegment model\n * @param element The original DOM element\n * @param format @optional The format of this model\n */\nexport function createGeneralSegment(\n    element: HTMLElement,\n    format?: ContentModelSegmentFormat\n): ContentModelGeneralSegment {\n    return {\n        blockType: 'BlockGroup',\n        blockGroupType: 'General',\n        segmentType: 'General',\n        format: format ? { ...format } : {},\n        blocks: [],\n        element: element,\n    };\n}\n","import type { ContentModelImage, ContentModelImageFormat } from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelImage model\n * @param src Image source\n * @param format @optional The format of this model\n */\nexport function createImage(src: string, format?: ContentModelImageFormat): ContentModelImage {\n    return {\n        segmentType: 'Image',\n        src: src,\n        format: format ? { ...format } : {},\n        dataset: {},\n    };\n}\n","import { createListLevel } from './createListLevel';\nimport { createSelectionMarker } from './createSelectionMarker';\nimport type {\n    ContentModelListItem,\n    ContentModelListLevel,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelListItem model\n * @param levels Existing list levels\n * @param format @optional The format of this model\n */\nexport function createListItem(\n    levels: ContentModelListLevel[],\n    format?: ContentModelSegmentFormat\n): ContentModelListItem {\n    return {\n        blockType: 'BlockGroup',\n        blockGroupType: 'ListItem',\n        blocks: [],\n        levels: levels\n            ? levels.map(level => createListLevel(level.listType, level.format, level.dataset))\n            : [],\n        formatHolder: createSelectionMarker(format),\n        format: {},\n    };\n}\n","import type {\n    ContentModelListItemLevelFormat,\n    ContentModelListLevel,\n    DatasetFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelListLevel model\n * @param listType Tag name of the list, either OL or UL\n * @param format @optional The format of this model\n * @param dataset @optional The dataset of this model\n */\nexport function createListLevel(\n    listType: 'OL' | 'UL',\n    format?: ContentModelListItemLevelFormat,\n    dataset?: DatasetFormat\n): ContentModelListLevel {\n    return {\n        listType,\n        format: { ...format },\n        dataset: { ...dataset },\n    };\n}\n","import type {\n    ContentModelBlockFormat,\n    ContentModelParagraph,\n    ContentModelParagraphDecorator,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelParagraph model\n * @param isImplicit @optional Whether this is an implicit paragraph. An implicit paragraph is a paragraph that will not render with DOM element container\n * @param blockFormat @optional Format of this paragraph\n * @param segmentFormat @optional Segment format applied to this block\n * @param decorator @optional Decorator of this paragraph\n */\nexport function createParagraph(\n    isImplicit?: boolean,\n    blockFormat?: ContentModelBlockFormat,\n    segmentFormat?: ContentModelSegmentFormat,\n    decorator?: ContentModelParagraphDecorator\n): ContentModelParagraph {\n    const result: ContentModelParagraph = {\n        blockType: 'Paragraph',\n        segments: [],\n        format: blockFormat ? { ...blockFormat } : {},\n    };\n\n    if (segmentFormat && Object.keys(segmentFormat).length > 0) {\n        result.segmentFormat = { ...segmentFormat };\n    }\n\n    if (isImplicit) {\n        result.isImplicit = true;\n    }\n\n    if (decorator) {\n        result.decorator = {\n            tagName: decorator.tagName,\n            format: { ...decorator.format },\n        };\n    }\n\n    return result;\n}\n","import type {\n    ContentModelParagraphDecorator,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelParagraphDecorator model\n * @param tagName Tag name of this decorator\n * @param format @optional The format of this model\n */\nexport function createParagraphDecorator(\n    tagName: string,\n    format?: ContentModelSegmentFormat\n): ContentModelParagraphDecorator {\n    return {\n        tagName: tagName.toLocaleLowerCase(),\n        format: { ...(format || {}) },\n    };\n}\n","import type {\n    ContentModelSegmentFormat,\n    ContentModelSelectionMarker,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelSelectionMarker model\n * @param format @optional The format of this model\n */\nexport function createSelectionMarker(\n    format?: ContentModelSegmentFormat\n): ContentModelSelectionMarker {\n    return {\n        segmentType: 'SelectionMarker',\n        isSelected: true,\n        format: format ? { ...format } : {},\n    };\n}\n","import type {\n    ContentModelTable,\n    ContentModelTableFormat,\n    ContentModelTableRow,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelTable model\n * @param rowCount Count of rows of this table\n * @param format @optional The format of this model\n */\nexport function createTable(rowCount: number, format?: ContentModelTableFormat): ContentModelTable {\n    const rows: ContentModelTableRow[] = [];\n\n    for (let i = 0; i < rowCount; i++) {\n        rows.push({\n            height: 0,\n            format: {},\n            cells: [],\n        });\n    }\n\n    return {\n        blockType: 'Table',\n        rows,\n        format: { ...(format || {}) },\n        widths: [],\n        dataset: {},\n    };\n}\n","import type {\n    ContentModelTableCell,\n    ContentModelTableCellFormat,\n    DatasetFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelTableCell model\n * @param spanLeftOrColSpan @optional Whether this is a table cell merged with its left cell, or colspan number @default false\n * @param spanAboveOrRowSpan Whether this is a table cell merged with its upper cell, or rowSpan number @default false\n * @param isHeader @optional Whether this is a header cell @default false\n * @param format @optional The format of this model\n */\nexport function createTableCell(\n    spanLeftOrColSpan?: boolean | number,\n    spanAboveOrRowSpan?: boolean | number,\n    isHeader?: boolean,\n    format?: ContentModelTableCellFormat,\n    dataset?: DatasetFormat\n): ContentModelTableCell {\n    const spanLeft =\n        typeof spanLeftOrColSpan === 'number' ? spanLeftOrColSpan > 1 : !!spanLeftOrColSpan;\n    const spanAbove =\n        typeof spanAboveOrRowSpan === 'number' ? spanAboveOrRowSpan > 1 : !!spanAboveOrRowSpan;\n    return {\n        blockGroupType: 'TableCell',\n        blocks: [],\n        format: format ? { ...format } : {},\n        spanLeft,\n        spanAbove,\n        isHeader: !!isHeader,\n        dataset: { ...dataset },\n    };\n}\n","import { addCode, addLink } from '../common/addDecorators';\nimport type {\n    ContentModelCode,\n    ContentModelLink,\n    ContentModelSegmentFormat,\n    ContentModelText,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelText model\n * @param text Text of this model\n * @param format @optional The format of this model\n * @param link @optional The link decorator\n * @param code @option The code decorator\n */\nexport function createText(\n    text: string,\n    format?: ContentModelSegmentFormat,\n    link?: ContentModelLink,\n    code?: ContentModelCode\n): ContentModelText {\n    const result: ContentModelText = {\n        segmentType: 'Text',\n        text: text,\n        format: format ? { ...format } : {},\n    };\n\n    if (link) {\n        addLink(result, link);\n    }\n\n    if (code) {\n        addCode(result, code);\n    }\n\n    return result;\n}\n","import { isNodeOfType } from '../domUtils/isNodeOfType';\nimport { toArray } from '../domUtils/toArray';\nimport type {\n    ContentModelDocument,\n    DOMSelection,\n    ModelToDomBlockAndSegmentNode,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create DOM tree fragment from Content Model document\n * @param doc Document object of the target DOM tree\n * @param root Target node that will become the container of new DOM tree.\n * When a DOM node with existing node is passed, it will be merged with content model so that unchanged blocks\n * won't be touched.\n * @param model The content model document to generate DOM tree from\n * @param context The context object for Content Model to DOM conversion\n * @returns The selection range created in DOM tree from this model, or null when there is no selection\n */\nexport function contentModelToDom(\n    doc: Document,\n    root: Node,\n    model: ContentModelDocument,\n    context: ModelToDomContext\n): DOMSelection | null {\n    context.modelHandlers.blockGroupChildren(doc, root, model, context);\n\n    const range = extractSelectionRange(doc, context);\n\n    root.normalize();\n\n    return range;\n}\n\nfunction extractSelectionRange(doc: Document, context: ModelToDomContext): DOMSelection | null {\n    const {\n        regularSelection: { start, end },\n        tableSelection,\n        imageSelection,\n    } = context;\n\n    let startPosition: { container: Node; offset: number } | undefined;\n    let endPosition: { container: Node; offset: number } | undefined;\n\n    if (imageSelection) {\n        return imageSelection;\n    } else if (\n        (startPosition = start && calcPosition(start)) &&\n        (endPosition = end && calcPosition(end))\n    ) {\n        const range = doc.createRange();\n\n        range.setStart(startPosition.container, startPosition.offset);\n        range.setEnd(endPosition.container, endPosition.offset);\n\n        return {\n            type: 'range',\n            range,\n            isReverted: false,\n        };\n    } else if (tableSelection) {\n        return tableSelection;\n    } else {\n        return null;\n    }\n}\n\nfunction calcPosition(\n    pos: ModelToDomBlockAndSegmentNode\n): { container: Node; offset: number } | undefined {\n    let result: { container: Node; offset: number } | undefined;\n\n    if (pos.block) {\n        if (!pos.segment) {\n            result = { container: pos.block, offset: 0 };\n        } else if (isNodeOfType(pos.segment, 'TEXT_NODE')) {\n            result = { container: pos.segment, offset: pos.segment.nodeValue?.length || 0 };\n        } else if (pos.segment.parentNode) {\n            result = {\n                container: pos.segment.parentNode,\n                offset:\n                    toArray(pos.segment.parentNode.childNodes as NodeListOf<Node>).indexOf(\n                        pos.segment\n                    ) + 1,\n            };\n        }\n    }\n\n    if (result && isNodeOfType(result.container, 'DOCUMENT_FRAGMENT_NODE')) {\n        const childNodes = result.container.childNodes;\n\n        if (childNodes.length > result.offset) {\n            result = { container: childNodes[result.offset], offset: 0 };\n        } else if (result.container.lastChild) {\n            const container = result.container.lastChild;\n            result = {\n                container,\n                offset: isNodeOfType(container, 'TEXT_NODE')\n                    ? container.nodeValue?.length ?? 0\n                    : container.childNodes.length,\n            };\n        } else {\n            result = undefined;\n        }\n    }\n\n    return result;\n}\n","import { defaultContentModelHandlers } from './defaultContentModelHandlers';\nimport { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport {\n    defaultFormatAppliers,\n    defaultFormatKeysPerCategory,\n} from '../../formatHandlers/defaultFormatHandlers';\nimport type {\n    EditorContext,\n    FormatApplier,\n    FormatAppliers,\n    FormatAppliersPerCategory,\n    ModelToDomContext,\n    ModelToDomFormatContext,\n    ModelToDomOption,\n    ModelToDomSelectionContext,\n    ModelToDomSettings,\n    TextFormatApplier,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create context object fro Content Model to DOM conversion\n * @param editorContext Context of editor\n * @param options Option array to customize the Model to DOM conversion behavior\n */\nexport function createModelToDomContext(\n    editorContext?: EditorContext,\n    ...options: (ModelToDomOption | undefined)[]\n): ModelToDomContext {\n    return createModelToDomContextWithConfig(createModelToDomConfig(options), editorContext);\n}\n\n/**\n * Create context object for Content Model to DOM conversion with an existing configure\n * @param config A full config object to define how to convert Content Model to DOM tree\n * @param editorContext Context of editor\n */\nexport function createModelToDomContextWithConfig(\n    config: ModelToDomSettings,\n    editorContext?: EditorContext\n) {\n    return Object.assign(\n        {},\n        editorContext,\n        createModelToDomSelectionContext(),\n        createModelToDomFormatContext(),\n        config\n    );\n}\n\nfunction createModelToDomSelectionContext(): ModelToDomSelectionContext {\n    return {\n        regularSelection: {\n            current: {\n                block: null,\n                segment: null,\n            },\n        },\n    };\n}\n\nfunction createModelToDomFormatContext(): ModelToDomFormatContext {\n    return {\n        listFormat: {\n            threadItemCounts: [],\n            nodeStack: [],\n        },\n        implicitFormat: {},\n    };\n}\n\n/**\n * Create Content Model to DOM Config object\n * @param options All customizations of DOM creation\n */\nexport function createModelToDomConfig(\n    options: (ModelToDomOption | undefined)[]\n): ModelToDomSettings {\n    return {\n        modelHandlers: Object.assign(\n            {},\n            defaultContentModelHandlers,\n            ...options.map(x => x?.modelHandlerOverride)\n        ),\n        formatAppliers: buildFormatAppliers(\n            options.map(x => x?.formatApplierOverride),\n            options.map(x => x?.additionalFormatAppliers)\n        ),\n        defaultModelHandlers: defaultContentModelHandlers,\n        defaultFormatAppliers,\n        metadataAppliers: Object.assign({}, ...options.map(x => x?.metadataAppliers)),\n    };\n}\n\n/**\n * @internal Export for test only\n * Build format appliers used by Content Model to DOM conversion\n */\nexport function buildFormatAppliers(\n    overrides: (Partial<FormatAppliers> | undefined)[] = [],\n    additionalAppliersArray: (Partial<FormatAppliersPerCategory> | undefined)[] = []\n): FormatAppliersPerCategory {\n    const combinedOverrides = Object.assign({}, ...overrides);\n\n    const result = getObjectKeys(defaultFormatKeysPerCategory).reduce(\n        (result, key) => {\n            const value = defaultFormatKeysPerCategory[key]\n                .map(\n                    formatKey =>\n                        (combinedOverrides[formatKey] === undefined\n                            ? defaultFormatAppliers[formatKey]\n                            : combinedOverrides[formatKey]) as FormatApplier<any>\n                )\n                .concat(\n                    ...additionalAppliersArray.map(\n                        appliers => (appliers?.[key] ?? []) as FormatApplier<any>[]\n                    )\n                );\n\n            result[key] = value;\n\n            return result;\n        },\n        {\n            text: [] as TextFormatApplier[],\n        } as FormatAppliersPerCategory\n    );\n\n    additionalAppliersArray.forEach(appliers => {\n        if (appliers?.text) {\n            result.text = result.text.concat(appliers.text);\n        }\n    });\n\n    return result;\n}\n","import { handleBlock } from '../handlers/handleBlock';\nimport { handleBlockGroupChildren } from '../handlers/handleBlockGroupChildren';\nimport { handleBr } from '../handlers/handleBr';\nimport { handleDivider } from '../handlers/handleDivider';\nimport { handleEntityBlock, handleEntitySegment } from '../handlers/handleEntity';\nimport { handleFormatContainer } from '../handlers/handleFormatContainer';\nimport { handleGeneralBlock, handleGeneralSegment } from '../handlers/handleGeneralModel';\nimport { handleImage } from '../handlers/handleImage';\nimport { handleList } from '../handlers/handleList';\nimport { handleListItem } from '../handlers/handleListItem';\nimport { handleParagraph } from '../handlers/handleParagraph';\nimport { handleSegment } from '../handlers/handleSegment';\nimport { handleSegmentDecorator } from '../handlers/handleSegmentDecorator';\nimport { handleTable } from '../handlers/handleTable';\nimport { handleText } from '../handlers/handleText';\nimport type { ContentModelHandlerMap } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const defaultContentModelHandlers: ContentModelHandlerMap = {\n    block: handleBlock,\n    blockGroupChildren: handleBlockGroupChildren,\n    br: handleBr,\n    entityBlock: handleEntityBlock,\n    entitySegment: handleEntitySegment,\n    generalBlock: handleGeneralBlock,\n    generalSegment: handleGeneralSegment,\n    divider: handleDivider,\n    image: handleImage,\n    list: handleList,\n    listItem: handleListItem,\n    paragraph: handleParagraph,\n    formatContainer: handleFormatContainer,\n    segment: handleSegment,\n    segmentDecorator: handleSegmentDecorator,\n    table: handleTable,\n    text: handleText,\n};\n","import type {\n    ContentModelBlock,\n    ContentModelBlockHandler,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleBlock: ContentModelBlockHandler<ContentModelBlock> = (\n    doc: Document,\n    parent: Node,\n    block: ContentModelBlock,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    const handlers = context.modelHandlers;\n\n    switch (block.blockType) {\n        case 'Table':\n            refNode = handlers.table(doc, parent, block, context, refNode);\n            break;\n        case 'Paragraph':\n            refNode = handlers.paragraph(doc, parent, block, context, refNode);\n            break;\n        case 'Entity':\n            refNode = handlers.entityBlock(doc, parent, block, context, refNode);\n            break;\n        case 'Divider':\n            refNode = handlers.divider(doc, parent, block, context, refNode);\n            break;\n        case 'BlockGroup':\n            switch (block.blockGroupType) {\n                case 'General':\n                    refNode = handlers.generalBlock(doc, parent, block, context, refNode);\n                    break;\n\n                case 'FormatContainer':\n                    refNode = handlers.formatContainer(doc, parent, block, context, refNode);\n                    break;\n\n                case 'ListItem':\n                    refNode = handlers.listItem(doc, parent, block, context, refNode);\n                    break;\n            }\n\n            break;\n    }\n\n    return refNode;\n};\n","import type {\n    ContentModelBlockGroup,\n    ContentModelHandler,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleBlockGroupChildren: ContentModelHandler<ContentModelBlockGroup> = (\n    doc: Document,\n    parent: Node,\n    group: ContentModelBlockGroup,\n    context: ModelToDomContext\n) => {\n    const { listFormat } = context;\n    const nodeStack = listFormat.nodeStack;\n    let refNode: Node | null = parent.firstChild;\n\n    try {\n        group.blocks.forEach((childBlock, index) => {\n            // When process list, we need a node stack.\n            // When there are two continuous lists, they should share the same stack\n            // so that list items with same type/threadId can be merged into the same list element\n            // In other cases, clear the stack so that two separate lists won't share the same list element\n            if (\n                index == 0 ||\n                childBlock.blockType != 'BlockGroup' ||\n                childBlock.blockGroupType != 'ListItem'\n            ) {\n                listFormat.nodeStack = [];\n            }\n\n            refNode = context.modelHandlers.block(doc, parent, childBlock, context, refNode);\n        });\n\n        // Remove all rest node if any since they don't appear in content model\n        while (refNode) {\n            const next = refNode.nextSibling;\n\n            refNode.parentNode?.removeChild(refNode);\n            refNode = next;\n        }\n    } finally {\n        listFormat.nodeStack = nodeStack;\n    }\n};\n","import { handleSegmentCommon } from '../utils/handleSegmentCommon';\nimport type { ContentModelBr, ContentModelSegmentHandler } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleBr: ContentModelSegmentHandler<ContentModelBr> = (\n    doc,\n    parent,\n    segment,\n    context,\n    segmentNodes\n) => {\n    const br = doc.createElement('br');\n    const element = doc.createElement('span');\n    element.appendChild(br);\n    parent.appendChild(element);\n\n    handleSegmentCommon(doc, br, element, segment, context, segmentNodes);\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { reuseCachedElement } from '../../domUtils/reuseCachedElement';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelDivider,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleDivider: ContentModelBlockHandler<ContentModelDivider> = (\n    doc: Document,\n    parent: Node,\n    divider: ContentModelDivider,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    let element = context.allowCacheElement ? divider.cachedElement : undefined;\n\n    if (element) {\n        refNode = reuseCachedElement(parent, element, refNode);\n    } else {\n        element = doc.createElement(divider.tagName);\n\n        if (context.allowCacheElement) {\n            divider.cachedElement = element;\n        }\n\n        parent.insertBefore(element, refNode);\n\n        applyFormat(element, context.formatAppliers.divider, divider.format, context);\n\n        if (divider.size) {\n            element.setAttribute('size', divider.size);\n        }\n    }\n\n    context.onNodeCreated?.(divider, element);\n\n    return refNode;\n};\n","import { addDelimiters } from '../../domUtils/entityUtils';\nimport { applyFormat } from '../utils/applyFormat';\nimport { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport { reuseCachedElement } from '../../domUtils/reuseCachedElement';\nimport { wrap } from '../../domUtils/wrap';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelEntity,\n    ContentModelSegmentFormat,\n    ContentModelSegmentHandler,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\nconst BlockEntityContainer = '_E_EBlockEntityContainer';\n\n/**\n * @internal\n */\nexport const handleEntityBlock: ContentModelBlockHandler<ContentModelEntity> = (\n    doc,\n    parent,\n    entityModel,\n    context,\n    refNode\n) => {\n    const { entityFormat, wrapper } = entityModel;\n\n    applyFormat(wrapper, context.formatAppliers.entity, entityFormat, context);\n\n    const isCursorAroundEntity =\n        context.addDelimiterForEntity &&\n        wrapper.style.display == 'inline-block' &&\n        wrapper.style.width == '100%';\n    const isContained = wrapper.parentElement?.classList.contains(BlockEntityContainer);\n    const elementToReuse = isContained && isCursorAroundEntity ? wrapper.parentElement! : wrapper;\n\n    refNode = reuseCachedElement(parent, elementToReuse, refNode);\n\n    if (isCursorAroundEntity) {\n        if (!isContained) {\n            const element = wrap(doc, wrapper, 'div');\n            element.classList.add(BlockEntityContainer);\n        }\n        addDelimiters(doc, wrapper, getSegmentFormat(context), context);\n    }\n\n    context.onNodeCreated?.(entityModel, wrapper);\n\n    return refNode;\n};\n\n/**\n * @internal\n */\nexport const handleEntitySegment: ContentModelSegmentHandler<ContentModelEntity> = (\n    doc,\n    parent,\n    entityModel,\n    context,\n    newSegments\n) => {\n    const { entityFormat, wrapper, format } = entityModel;\n\n    parent.appendChild(wrapper);\n    newSegments?.push(wrapper);\n\n    if (getObjectKeys(format).length > 0) {\n        const span = wrap(doc, wrapper, 'span');\n\n        applyFormat(span, context.formatAppliers.segment, format, context);\n    }\n\n    applyFormat(wrapper, context.formatAppliers.entity, entityFormat, context);\n\n    if (context.addDelimiterForEntity && entityFormat.isReadonly) {\n        const [after, before] = addDelimiters(doc, wrapper, getSegmentFormat(context), context);\n\n        newSegments?.push(after, before);\n        context.regularSelection.current.segment = after;\n    } else {\n        context.regularSelection.current.segment = wrapper;\n    }\n\n    context.onNodeCreated?.(entityModel, wrapper);\n};\nfunction getSegmentFormat(\n    context: ModelToDomContext\n): ContentModelSegmentFormat | null | undefined {\n    return {\n        ...context.pendingFormat?.format,\n        ...context.defaultFormat,\n    };\n}\n","import { applyFormat } from '../utils/applyFormat';\nimport { isBlockGroupEmpty } from '../../modelApi/common/isEmpty';\nimport { reuseCachedElement } from '../../domUtils/reuseCachedElement';\nimport { stackFormat } from '../utils/stackFormat';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelBlockHandler,\n    ContentModelFormatContainer,\n    ContentModelSegmentFormat,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\nconst PreChildFormat: ContentModelSegmentFormat & ContentModelBlockFormat = {\n    fontFamily: 'monospace',\n    whiteSpace: 'pre',\n};\n\n/**\n * @internal\n */\nexport const handleFormatContainer: ContentModelBlockHandler<ContentModelFormatContainer> = (\n    doc: Document,\n    parent: Node,\n    container: ContentModelFormatContainer,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    let element = context.allowCacheElement ? container.cachedElement : undefined;\n\n    if (element) {\n        refNode = reuseCachedElement(parent, element, refNode);\n\n        context.modelHandlers.blockGroupChildren(doc, element, container, context);\n    } else if (!isBlockGroupEmpty(container)) {\n        const containerNode = doc.createElement(container.tagName);\n\n        if (context.allowCacheElement) {\n            container.cachedElement = containerNode;\n        }\n\n        parent.insertBefore(containerNode, refNode);\n\n        stackFormat(context, container.tagName, () => {\n            applyFormat(containerNode, context.formatAppliers.container, container.format, context);\n            applyFormat(\n                containerNode,\n                context.formatAppliers.segmentOnBlock,\n                container.format,\n                context\n            );\n\n            applyFormat(containerNode, context.formatAppliers.container, container.format, context);\n        });\n\n        if (container.tagName == 'pre') {\n            stackFormat(context, PreChildFormat, () => {\n                context.modelHandlers.blockGroupChildren(doc, containerNode, container, context);\n            });\n        } else {\n            context.modelHandlers.blockGroupChildren(doc, containerNode, container, context);\n        }\n\n        element = containerNode;\n    }\n\n    if (element) {\n        context.onNodeCreated?.(container, element);\n    }\n\n    return refNode;\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { handleSegmentCommon } from '../utils/handleSegmentCommon';\nimport { isNodeOfType } from '../../domUtils/isNodeOfType';\nimport { reuseCachedElement } from '../../domUtils/reuseCachedElement';\nimport { wrap } from '../../domUtils/wrap';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelGeneralBlock,\n    ContentModelGeneralSegment,\n    ContentModelSegmentHandler,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleGeneralBlock: ContentModelBlockHandler<ContentModelGeneralBlock> = (\n    doc,\n    parent,\n    group,\n    context,\n    refNode\n) => {\n    let node: HTMLElement = group.element;\n\n    if (refNode && node.parentNode == parent) {\n        refNode = reuseCachedElement(parent, node, refNode);\n    } else {\n        node = node.cloneNode() as HTMLElement;\n        group.element = node as HTMLElement;\n\n        applyFormat(node, context.formatAppliers.general, group.format, context);\n\n        parent.insertBefore(node, refNode);\n    }\n\n    context.onNodeCreated?.(group, node);\n    context.modelHandlers.blockGroupChildren(doc, node, group, context);\n\n    return refNode;\n};\n\n/**\n * @internal\n */\nexport const handleGeneralSegment: ContentModelSegmentHandler<ContentModelGeneralSegment> = (\n    doc,\n    parent,\n    group,\n    context,\n    segmentNodes\n) => {\n    const node = group.element.cloneNode() as HTMLElement;\n    group.element = node;\n    parent.appendChild(node);\n\n    if (isNodeOfType(node, 'ELEMENT_NODE')) {\n        const element = wrap(doc, node, 'span');\n\n        handleSegmentCommon(doc, node, element, group, context, segmentNodes);\n        applyFormat(node, context.formatAppliers.general, group.format, context);\n\n        context.onNodeCreated?.(group, node);\n    }\n\n    context.modelHandlers.blockGroupChildren(doc, node, group, context);\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { handleSegmentCommon } from '../utils/handleSegmentCommon';\nimport { parseValueWithUnit } from '../../formatHandlers/utils/parseValueWithUnit';\nimport type { ContentModelImage, ContentModelSegmentHandler } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleImage: ContentModelSegmentHandler<ContentModelImage> = (\n    doc,\n    parent,\n    imageModel,\n    context,\n    segmentNodes\n) => {\n    const img = doc.createElement('img');\n    const element = document.createElement('span');\n\n    parent.appendChild(element);\n    element.appendChild(img);\n\n    img.src = imageModel.src;\n\n    if (imageModel.alt) {\n        img.alt = imageModel.alt;\n    }\n\n    if (imageModel.title) {\n        img.title = imageModel.title;\n    }\n\n    applyFormat(img, context.formatAppliers.image, imageModel.format, context);\n    applyFormat(img, context.formatAppliers.dataset, imageModel.dataset, context);\n\n    const { width, height } = imageModel.format;\n    const widthNum = width ? parseValueWithUnit(width) : 0;\n    const heightNum = height ? parseValueWithUnit(height) : 0;\n\n    if (widthNum > 0) {\n        img.width = widthNum;\n    }\n\n    if (heightNum > 0) {\n        img.height = heightNum;\n    }\n\n    if (imageModel.isSelectedAsImageSelection) {\n        context.imageSelection = {\n            type: 'image',\n            image: img,\n        };\n    }\n\n    handleSegmentCommon(doc, img, element, imageModel, context, segmentNodes);\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { applyMetadata } from '../utils/applyMetadata';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelListItem,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleList: ContentModelBlockHandler<ContentModelListItem> = (\n    doc: Document,\n    parent: Node,\n    listItem: ContentModelListItem,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    let layer = 0;\n    const { nodeStack } = context.listFormat;\n\n    if (nodeStack.length == 0) {\n        nodeStack.push({\n            node: parent,\n        });\n    }\n\n    // Skip existing list levels that has same properties so we can reuse them\n    for (; layer < listItem.levels.length && layer + 1 < nodeStack.length; layer++) {\n        const stackLevel = nodeStack[layer + 1];\n        const itemLevel = listItem.levels[layer];\n\n        if (\n            stackLevel.listType != itemLevel.listType ||\n            stackLevel.dataset?.editingInfo != itemLevel.dataset.editingInfo ||\n            (itemLevel.listType == 'OL' && typeof itemLevel.format.startNumberOverride === 'number')\n        ) {\n            break;\n        }\n    }\n\n    // Cut off remained list levels that we can't reuse\n    nodeStack.splice(layer + 1);\n\n    // Create new list levels that are after reused ones\n    for (; layer < listItem.levels.length; layer++) {\n        const level = listItem.levels[layer];\n        const newList = doc.createElement(level.listType || 'UL');\n        const lastParent = nodeStack[nodeStack.length - 1].node;\n\n        lastParent.insertBefore(newList, layer == 0 ? refNode : null);\n        nodeStack.push({ node: newList, ...level });\n\n        applyFormat(newList, context.formatAppliers.listLevelThread, level.format, context);\n\n        // Need to apply metadata after applying list level format since the list numbers value relies on the result of list thread handling\n        applyMetadata(level, context.metadataAppliers.listLevel, level.format, context);\n\n        // Need to apply listItemElement formats after applying metadata since the list numbers value relies on the result of metadata handling\n        applyFormat(newList, context.formatAppliers.listLevel, level.format, context);\n        applyFormat(newList, context.formatAppliers.dataset, level.dataset, context);\n\n        context.onNodeCreated?.(level, newList);\n    }\n\n    return refNode;\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { applyMetadata } from '../utils/applyMetadata';\nimport { setParagraphNotImplicit } from '../../modelApi/block/setParagraphNotImplicit';\nimport { unwrap } from '../../domUtils/unwrap';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelListItem,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleListItem: ContentModelBlockHandler<ContentModelListItem> = (\n    doc: Document,\n    parent: Node,\n    listItem: ContentModelListItem,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    refNode = context.modelHandlers.list(doc, parent, listItem, context, refNode);\n\n    const { nodeStack } = context.listFormat;\n\n    const listParent = nodeStack?.[nodeStack?.length - 1]?.node || parent;\n    const li = doc.createElement('li');\n    const level = listItem.levels[listItem.levels.length - 1];\n\n    // It is possible listParent is the same with parent param.\n    // This happens when outdent a list item to cause it has no list level\n    listParent.insertBefore(li, refNode?.parentNode == listParent ? refNode : null);\n\n    if (level) {\n        applyFormat(li, context.formatAppliers.segment, listItem.formatHolder.format, context);\n        applyFormat(li, context.formatAppliers.listItemThread, level.format, context);\n\n        // Need to apply metadata after applying listItem format since the list numbers value relies on the result of list thread handling\n        applyMetadata(level, context.metadataAppliers.listItem, listItem.format, context);\n\n        // Need to apply listItemElement formats after applying metadata since the list numbers value relies on the result of metadata handling\n        applyFormat(li, context.formatAppliers.listItemElement, listItem.format, context);\n\n        context.modelHandlers.blockGroupChildren(doc, li, listItem, context);\n    } else {\n        // There is no level for this list item, that means it should be moved out of the list\n        // For each paragraph, make it not implicit so it will have a DIV around it, to avoid more paragraphs connected together\n        listItem.blocks.forEach(setParagraphNotImplicit);\n\n        context.modelHandlers.blockGroupChildren(doc, li, listItem, context);\n\n        unwrap(li);\n    }\n\n    context.onNodeCreated?.(listItem, li);\n\n    return refNode;\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport { optimize } from '../optimizers/optimize';\nimport { reuseCachedElement } from '../../domUtils/reuseCachedElement';\nimport { stackFormat } from '../utils/stackFormat';\nimport { unwrap } from '../../domUtils/unwrap';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelParagraph,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\nconst DefaultParagraphTag = 'div';\n\n/**\n * @internal\n */\nexport const handleParagraph: ContentModelBlockHandler<ContentModelParagraph> = (\n    doc: Document,\n    parent: Node,\n    paragraph: ContentModelParagraph,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    let container = context.allowCacheElement ? paragraph.cachedElement : undefined;\n\n    if (container) {\n        refNode = reuseCachedElement(parent, container, refNode);\n    } else {\n        stackFormat(context, paragraph.decorator?.tagName || null, () => {\n            const needParagraphWrapper =\n                !paragraph.isImplicit ||\n                !!paragraph.decorator ||\n                (getObjectKeys(paragraph.format).length > 0 &&\n                    paragraph.segments.some(segment => segment.segmentType != 'SelectionMarker'));\n            const formatOnWrapper = needParagraphWrapper\n                ? {\n                      ...(paragraph.decorator?.format || {}),\n                      ...paragraph.segmentFormat,\n                  }\n                : {};\n\n            container = doc.createElement(paragraph.decorator?.tagName || DefaultParagraphTag);\n\n            parent.insertBefore(container, refNode);\n\n            context.regularSelection.current = {\n                block: needParagraphWrapper ? container : container.parentNode,\n                segment: null,\n            };\n\n            const handleSegments = () => {\n                const parent = container;\n\n                if (parent) {\n                    const firstSegment = paragraph.segments[0];\n\n                    if (firstSegment?.segmentType == 'SelectionMarker') {\n                        // Make sure there is a segment created before selection marker.\n                        // If selection marker is the first selected segment in a paragraph, create a dummy text node,\n                        // so after rewrite, the regularSelection object can have a valid segment object set to the text node.\n                        context.modelHandlers.text(\n                            doc,\n                            parent,\n                            {\n                                ...firstSegment,\n                                segmentType: 'Text',\n                                text: '',\n                            },\n                            context,\n                            []\n                        );\n                    }\n\n                    paragraph.segments.forEach(segment => {\n                        const newSegments: Node[] = [];\n                        context.modelHandlers.segment(doc, parent, segment, context, newSegments);\n\n                        newSegments.forEach(node => {\n                            context.domIndexer?.onSegment(node, paragraph, [segment]);\n                        });\n                    });\n                }\n            };\n\n            if (needParagraphWrapper) {\n                stackFormat(context, formatOnWrapper, handleSegments);\n\n                applyFormat(container, context.formatAppliers.block, paragraph.format, context);\n                applyFormat(container, context.formatAppliers.container, paragraph.format, context);\n                applyFormat(\n                    container,\n                    context.formatAppliers.segmentOnBlock,\n                    formatOnWrapper,\n                    context\n                );\n            } else {\n                handleSegments();\n            }\n\n            optimize(container);\n\n            // It is possible the next sibling node is changed during processing child segments\n            // e.g. When this paragraph is an implicit paragraph and it contains an inline entity segment\n            // The segment will be appended to container as child then the container will be removed\n            // since this paragraph it is implicit. In that case container.nextSibling will become original\n            // inline entity's next sibling. So reset refNode to its real next sibling (after change) here\n            // to make sure the value is correct.\n            refNode = container.nextSibling;\n\n            if (container) {\n                context.onNodeCreated?.(paragraph, container);\n                context.domIndexer?.onParagraph(container);\n            }\n\n            if (needParagraphWrapper) {\n                if (context.allowCacheElement) {\n                    paragraph.cachedElement = container;\n                }\n            } else {\n                unwrap(container);\n                container = undefined;\n            }\n        });\n    }\n\n    return refNode;\n};\n","import type {\n    ContentModelSegment,\n    ContentModelSegmentHandler,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleSegment: ContentModelSegmentHandler<ContentModelSegment> = (\n    doc,\n    parent,\n    segment,\n    context,\n    segmentNodes\n) => {\n    const regularSelection = context.regularSelection;\n\n    // If start position is not set yet, and current segment is in selection, set start position\n    if (segment.isSelected && !regularSelection.start) {\n        regularSelection.start = {\n            ...regularSelection.current,\n        };\n    }\n\n    switch (segment.segmentType) {\n        case 'Text':\n            context.modelHandlers.text(doc, parent, segment, context, segmentNodes);\n            break;\n\n        case 'Br':\n            context.modelHandlers.br(doc, parent, segment, context, segmentNodes);\n            break;\n\n        case 'Image':\n            context.modelHandlers.image(doc, parent, segment, context, segmentNodes);\n            break;\n\n        case 'General':\n            context.modelHandlers.generalSegment(doc, parent, segment, context, segmentNodes);\n            break;\n\n        case 'Entity':\n            context.modelHandlers.entitySegment(doc, parent, segment, context, segmentNodes);\n            break;\n    }\n\n    // If end position is not set, or it is not finalized, and current segment is still in selection, set end position\n    // If there is other selection, we will overwrite regularSelection.end when we process that segment\n    if (segment.isSelected && regularSelection.start) {\n        regularSelection.end = {\n            ...regularSelection.current,\n        };\n    }\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { isNodeOfType } from '../../domUtils/isNodeOfType';\nimport { stackFormat } from '../utils/stackFormat';\nimport { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type {\n    ContentModelSegment,\n    ContentModelSegmentHandler,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleSegmentDecorator: ContentModelSegmentHandler<ContentModelSegment> = (\n    _,\n    parent,\n    segment,\n    context,\n    segmentNodes\n) => {\n    const { code, link } = segment;\n\n    if (isNodeOfType(parent, 'ELEMENT_NODE')) {\n        if (link) {\n            stackFormat(context, 'a', () => {\n                const a = wrapAllChildNodes(parent, 'a');\n\n                applyFormat(a, context.formatAppliers.link, link.format, context);\n                applyFormat(a, context.formatAppliers.dataset, link.dataset, context);\n\n                segmentNodes?.push(a);\n                context.onNodeCreated?.(link, a);\n            });\n        }\n\n        if (code) {\n            stackFormat(context, 'code', () => {\n                const codeNode = wrapAllChildNodes(parent, 'code');\n\n                applyFormat(codeNode, context.formatAppliers.code, code.format, context);\n\n                segmentNodes?.push(codeNode);\n                context.onNodeCreated?.(code, codeNode);\n            });\n        }\n    }\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { hasMetadata } from '../../domUtils/metadata/updateMetadata';\nimport { isBlockEmpty } from '../../modelApi/common/isEmpty';\nimport { moveChildNodes } from '../../domUtils/moveChildNodes';\nimport { reuseCachedElement } from '../../domUtils/reuseCachedElement';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelTable,\n    ModelToDomContext,\n    TableSelection,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleTable: ContentModelBlockHandler<ContentModelTable> = (\n    doc: Document,\n    parent: Node,\n    table: ContentModelTable,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    if (isBlockEmpty(table)) {\n        // Empty table, do not create TABLE element and just return\n        return refNode;\n    }\n\n    let tableNode = context.allowCacheElement ? table.cachedElement : undefined;\n\n    if (tableNode) {\n        refNode = reuseCachedElement(parent, tableNode, refNode);\n\n        moveChildNodes(tableNode);\n    } else {\n        tableNode = doc.createElement('table');\n\n        if (context.allowCacheElement) {\n            table.cachedElement = tableNode;\n        }\n\n        parent.insertBefore(tableNode, refNode);\n\n        applyFormat(tableNode, context.formatAppliers.block, table.format, context);\n        applyFormat(tableNode, context.formatAppliers.table, table.format, context);\n        applyFormat(tableNode, context.formatAppliers.tableBorder, table.format, context);\n        applyFormat(tableNode, context.formatAppliers.dataset, table.dataset, context);\n    }\n\n    context.onNodeCreated?.(table, tableNode);\n\n    const tbody = doc.createElement('tbody');\n    tableNode.appendChild(tbody);\n\n    for (let row = 0; row < table.rows.length; row++) {\n        const tableRow = table.rows[row];\n\n        if (tableRow.cells.length == 0) {\n            // Skip empty row\n            continue;\n        }\n\n        const tr = (context.allowCacheElement && tableRow.cachedElement) || doc.createElement('tr');\n        tbody.appendChild(tr);\n        moveChildNodes(tr);\n\n        if (!tableRow.cachedElement) {\n            if (context.allowCacheElement) {\n                tableRow.cachedElement = tr;\n            }\n\n            applyFormat(tr, context.formatAppliers.tableRow, tableRow.format, context);\n        }\n\n        context.onNodeCreated?.(tableRow, tr);\n\n        for (let col = 0; col < tableRow.cells.length; col++) {\n            const cell = tableRow.cells[col];\n\n            if (cell.isSelected) {\n                const tableSelection: TableSelection = context.tableSelection || {\n                    type: 'table',\n                    table: tableNode,\n                    firstColumn: col,\n                    lastColumn: col,\n                    firstRow: row,\n                    lastRow: row,\n                };\n\n                if (tableSelection.table == tableNode) {\n                    tableSelection.lastColumn = Math.max(tableSelection.lastColumn, col);\n                    tableSelection.lastRow = Math.max(tableSelection.lastRow, row);\n                }\n\n                context.tableSelection = tableSelection;\n            }\n\n            if (!cell.spanAbove && !cell.spanLeft) {\n                const td =\n                    (context.allowCacheElement && cell.cachedElement) ||\n                    doc.createElement(cell.isHeader ? 'th' : 'td');\n\n                tr.appendChild(td);\n\n                let rowSpan = 1;\n                let colSpan = 1;\n                let width = table.widths[col];\n                let height = tableRow.height;\n\n                for (; table.rows[row + rowSpan]?.cells[col]?.spanAbove; rowSpan++) {\n                    height += table.rows[row + rowSpan].height;\n                }\n                for (; tableRow.cells[col + colSpan]?.spanLeft; colSpan++) {\n                    width += table.widths[col + colSpan];\n                }\n\n                if (rowSpan > 1) {\n                    td.rowSpan = rowSpan;\n                }\n\n                if (colSpan > 1) {\n                    td.colSpan = colSpan;\n                }\n\n                if (!cell.cachedElement || (cell.format.useBorderBox && hasMetadata(table))) {\n                    if (width > 0 && !td.style.width) {\n                        td.style.width = width + 'px';\n                    }\n\n                    if (height > 0 && !td.style.height) {\n                        td.style.height = height + 'px';\n                    }\n                }\n\n                if (!cell.cachedElement) {\n                    if (context.allowCacheElement) {\n                        cell.cachedElement = td;\n                    }\n\n                    applyFormat(td, context.formatAppliers.block, cell.format, context);\n                    applyFormat(td, context.formatAppliers.tableCell, cell.format, context);\n                    applyFormat(td, context.formatAppliers.tableCellBorder, cell.format, context);\n                    applyFormat(td, context.formatAppliers.dataset, cell.dataset, context);\n                }\n\n                context.modelHandlers.blockGroupChildren(doc, td, cell, context);\n\n                context.onNodeCreated?.(cell, td);\n            }\n        }\n    }\n\n    context.domIndexer?.onTable(tableNode, table);\n\n    return refNode;\n};\n","import { handleSegmentCommon } from '../utils/handleSegmentCommon';\nimport type { ContentModelSegmentHandler, ContentModelText } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleText: ContentModelSegmentHandler<ContentModelText> = (\n    doc,\n    parent,\n    segment,\n    context,\n    segmentNodes\n) => {\n    const txt = doc.createTextNode(segment.text);\n    const element = doc.createElement('span');\n\n    parent.appendChild(element);\n    element.appendChild(txt);\n\n    context.formatAppliers.text.forEach(applier => applier(segment.format, txt, context));\n\n    handleSegmentCommon(doc, txt, element, segment, context, segmentNodes);\n};\n","import { isNodeOfType } from '../../domUtils/isNodeOfType';\n\nconst OptimizeTags = ['SPAN', 'B', 'EM', 'I', 'U', 'SUB', 'SUP', 'STRIKE', 'S', 'A', 'CODE'];\n\n/**\n * @internal\n */\nexport function mergeNode(root: Node) {\n    for (let child = root.firstChild; child; ) {\n        const next = child.nextSibling;\n\n        if (\n            next &&\n            isNodeOfType(child, 'ELEMENT_NODE') &&\n            isNodeOfType(next, 'ELEMENT_NODE') &&\n            child.tagName == next.tagName &&\n            OptimizeTags.indexOf(child.tagName) >= 0 &&\n            hasSameAttributes(child, next)\n        ) {\n            while (next.firstChild) {\n                child.appendChild(next.firstChild);\n            }\n\n            next.parentNode!.removeChild(next);\n        } else {\n            child = next;\n        }\n    }\n}\n\nfunction hasSameAttributes(element1: HTMLElement, element2: HTMLElement) {\n    const attr1 = element1.attributes;\n    const attr2 = element2.attributes;\n\n    if (attr1.length != attr2.length) {\n        return false;\n    }\n\n    for (let i = 0; i < attr1.length; i++) {\n        if (attr1[i].name != attr2[i].name || attr1[i].value != attr2[i].value) {\n            return false;\n        }\n    }\n\n    return true;\n}\n","import { isEntityElement } from '../../domUtils/entityUtils';\nimport { mergeNode } from './mergeNode';\nimport { removeUnnecessarySpan } from './removeUnnecessarySpan';\n\n/**\n * @internal\n */\nexport function optimize(root: Node) {\n    /**\n     * Do no do any optimization to entity\n     */\n    if (isEntityElement(root)) {\n        return;\n    }\n\n    removeUnnecessarySpan(root);\n    mergeNode(root);\n\n    for (let child = root.firstChild; child; child = child.nextSibling) {\n        optimize(child);\n    }\n}\n","import { isNodeOfType } from '../../domUtils/isNodeOfType';\n\n/**\n * @internal\n */\nexport function removeUnnecessarySpan(root: Node) {\n    for (let child = root.firstChild; child; ) {\n        if (\n            isNodeOfType(child, 'ELEMENT_NODE') &&\n            child.tagName == 'SPAN' &&\n            child.attributes.length == 0\n        ) {\n            const node = child;\n            let refNode = child.nextSibling;\n            child = child.nextSibling;\n\n            while (node.lastChild) {\n                const newNode = node.lastChild;\n                root.insertBefore(newNode, refNode);\n                refNode = newNode;\n            }\n\n            root.removeChild(node);\n        } else {\n            child = child.nextSibling;\n        }\n    }\n}\n","import type {\n    ContentModelFormatBase,\n    FormatApplier,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Apply formats to the given HTML element using specified appliers\n * @param element The element to apply formats to\n * @param appliers The appliers we are using to apply formats\n * @param format The format object we get format info from\n * @param context Content Model to DOM context\n */\nexport function applyFormat<T extends ContentModelFormatBase>(\n    element: HTMLElement,\n    appliers: (FormatApplier<T> | null)[],\n    format: T,\n    context: ModelToDomContext\n) {\n    appliers.forEach(applier => {\n        applier?.(format, element, context);\n    });\n}\n","import { updateMetadata } from '../../domUtils/metadata/updateMetadata';\nimport type {\n    ContentModelFormatBase,\n    ContentModelWithDataset,\n    MetadataApplier,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function applyMetadata<TMetadata, TFormat extends ContentModelFormatBase>(\n    model: ContentModelWithDataset<TMetadata>,\n    applier: MetadataApplier<TMetadata, TFormat> | undefined,\n    format: TFormat,\n    context: ModelToDomContext\n) {\n    if (applier) {\n        updateMetadata(\n            model,\n            metadata => {\n                applier.applierFunction(metadata, format, context);\n                return metadata;\n            },\n            applier.metadataDefinition\n        );\n    }\n}\n","import { applyFormat } from './applyFormat';\nimport type { ContentModelSegment, ModelToDomContext } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function handleSegmentCommon(\n    doc: Document,\n    segmentNode: Node,\n    containerNode: HTMLElement,\n    segment: ContentModelSegment,\n    context: ModelToDomContext,\n    segmentNodes: Node[]\n) {\n    if (!segmentNode.firstChild) {\n        context.regularSelection.current.segment = segmentNode;\n    }\n\n    applyFormat(containerNode, context.formatAppliers.styleBasedSegment, segment.format, context);\n\n    segmentNodes?.push(segmentNode);\n    context.modelHandlers.segmentDecorator(doc, containerNode, segment, context, segmentNodes);\n\n    applyFormat(containerNode, context.formatAppliers.elementBasedSegment, segment.format, context);\n\n    context.onNodeCreated?.(segment, segmentNode);\n}\n","import { defaultContentModelFormatMap } from '../../config/defaultContentModelFormatMap';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelSegmentFormat,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function stackFormat(\n    context: ModelToDomContext,\n    tagNameOrFormat: string | (ContentModelSegmentFormat & ContentModelBlockFormat) | null,\n    callback: () => void\n) {\n    const newFormat =\n        typeof tagNameOrFormat === 'string'\n            ? defaultContentModelFormatMap[tagNameOrFormat]\n            : tagNameOrFormat;\n\n    if (newFormat) {\n        const implicitFormat = context.implicitFormat;\n\n        try {\n            context.implicitFormat = {\n                ...implicitFormat,\n                ...newFormat,\n            };\n\n            callback();\n        } finally {\n            context.implicitFormat = implicitFormat;\n        }\n    } else {\n        callback();\n    }\n}\n","import type { ContentModelBlockGroup, ContentModelDocument } from 'roosterjs-content-model-types';\n\n/**\n * Convert Content Model to plain text\n * @param model The source Content Model\n * @param [separator='\\r\\n'] The separator string used for connect lines\n */\nexport function contentModelToText(\n    model: ContentModelDocument,\n    separator: string = '\\r\\n'\n): string {\n    const textArray: string[] = [];\n\n    contentModelToTextArray(model, textArray);\n\n    return textArray.join(separator);\n}\n\nfunction contentModelToTextArray(group: ContentModelBlockGroup, textArray: string[]) {\n    group.blocks.forEach(block => {\n        switch (block.blockType) {\n            case 'Paragraph':\n                let text = '';\n\n                block.segments.forEach(segment => {\n                    switch (segment.segmentType) {\n                        case 'Br':\n                            textArray.push(text);\n                            text = '';\n                            break;\n\n                        case 'Entity':\n                            text += segment.wrapper.textContent || '';\n                            break;\n\n                        case 'General':\n                            text += segment.element.textContent || '';\n                            break;\n\n                        case 'Text':\n                            text += segment.text;\n                            break;\n\n                        case 'Image':\n                            text += ' ';\n                            break;\n                    }\n                });\n                textArray.push(text);\n                break;\n\n            case 'Divider':\n            case 'Entity':\n                textArray.push('');\n                break;\n\n            case 'Table':\n                block.rows.forEach(row =>\n                    row.cells.forEach(cell => {\n                        contentModelToTextArray(cell, textArray);\n                    })\n                );\n                break;\n\n            case 'BlockGroup':\n                contentModelToTextArray(block, textArray);\n                break;\n        }\n    });\n}\n","import { createLink } from './link/createLink';\nimport { createLinkAfterSpace } from './link/createLinkAfterSpace';\nimport { keyboardListTrigger } from './list/keyboardListTrigger';\nimport { unlink } from './link/unlink';\nimport type {\n    ContentChangedEvent,\n    EditorPlugin,\n    IEditor,\n    KeyDownEvent,\n    PluginEvent,\n} from 'roosterjs-content-model-types';\n\n/**\n * Options to customize the Content Model Auto Format Plugin\n */\nexport type AutoFormatOptions = {\n    /**\n     * When true, after type *, ->, -, --, => , , > and space key a type of bullet list will be triggered. @default true\n     */\n    autoBullet: boolean;\n\n    /**\n     * When true, after type 1, A, a, i, I followed by ., ), - or between () and space key a type of numbering list will be triggered. @default true\n     */\n    autoNumbering: boolean;\n\n    /**\n     * When press backspace before a link, remove the hyperlink\n     */\n    autoUnlink: boolean;\n\n    /**\n     * When paste content, create hyperlink for the pasted link\n     */\n    autoLink: boolean;\n};\n\n/**\n * @internal\n */\nconst DefaultOptions: Required<AutoFormatOptions> = {\n    autoBullet: true,\n    autoNumbering: true,\n    autoUnlink: false,\n    autoLink: true,\n};\n\n/**\n * Auto Format plugin handles auto formatting, such as transforming * characters into a bullet list.\n * It can be customized with options to enable or disable auto list features.\n */\nexport class AutoFormatPlugin implements EditorPlugin {\n    private editor: IEditor | null = null;\n\n    /**\n     * @param options An optional parameter that takes in an object of type AutoFormatOptions, which includes the following properties:\n     *  - autoBullet: A boolean that enables or disables automatic bullet list formatting. Defaults to true.\n     *  - autoNumbering: A boolean that enables or disables automatic numbering formatting. Defaults to true.\n     */\n    constructor(private options: AutoFormatOptions = DefaultOptions) {}\n\n    /**\n     * Get name of this plugin\n     */\n    getName() {\n        return 'AutoFormat';\n    }\n\n    /**\n     * The first method that editor will call to a plugin when editor is initializing.\n     * It will pass in the editor instance, plugin should take this chance to save the\n     * editor reference so that it can call to any editor method or format API later.\n     * @param editor The editor object\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n    }\n\n    /**\n     * The last method that editor will call to a plugin before it is disposed.\n     * Plugin can take this chance to clear the reference to editor. After this method is\n     * called, plugin should not call to any editor method since it will result in error.\n     */\n    dispose() {\n        this.editor = null;\n    }\n\n    /**\n     * Core method for a plugin. Once an event happens in editor, editor will call this\n     * method of each plugin to handle the event as long as the event is not handled\n     * exclusively by another plugin.\n     * @param event The event to handle:\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (this.editor) {\n            switch (event.eventType) {\n                case 'keyDown':\n                    this.handleKeyDownEvent(this.editor, event);\n                    break;\n                case 'contentChanged':\n                    this.handleContentChangedEvent(this.editor, event);\n                    break;\n            }\n        }\n    }\n\n    private handleKeyDownEvent(editor: IEditor, event: KeyDownEvent) {\n        const rawEvent = event.rawEvent;\n        if (!rawEvent.defaultPrevented && !event.handledByEditFeature) {\n            const { autoBullet, autoNumbering, autoUnlink, autoLink } = this.options;\n            switch (rawEvent.key) {\n                case ' ':\n                    keyboardListTrigger(editor, rawEvent, autoBullet, autoNumbering);\n                    if (autoLink) {\n                        createLinkAfterSpace(editor);\n                    }\n                    break;\n                case 'Backspace':\n                    if (autoUnlink) {\n                        unlink(editor, rawEvent);\n                    }\n                    break;\n            }\n        }\n    }\n\n    private handleContentChangedEvent(editor: IEditor, event: ContentChangedEvent) {\n        const { autoLink } = this.options;\n        if (event.source == 'Paste' && autoLink) {\n            createLink(editor);\n        }\n    }\n}\n","import { addLink } from 'roosterjs-content-model-dom';\nimport { getLinkSegment } from './getLinkSegment';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function createLink(editor: IEditor) {\n    editor.formatContentModel(model => {\n        const link = getLinkSegment(model);\n        if (link && !link.link) {\n            addLink(link, {\n                format: {\n                    href: link.text,\n                    underline: true,\n                },\n                dataset: {},\n            });\n            return true;\n        }\n        return false;\n    });\n}\n","import { createText } from 'roosterjs-content-model-dom';\nimport { getSelectedSegmentsAndParagraphs } from 'roosterjs-content-model-core';\nimport { matchLink } from 'roosterjs-content-model-api';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function createLinkAfterSpace(editor: IEditor) {\n    editor.formatContentModel(model => {\n        const selectedSegmentsAndParagraphs = getSelectedSegmentsAndParagraphs(\n            model,\n            false /* includingFormatHolder */\n        );\n        if (selectedSegmentsAndParagraphs[0] && selectedSegmentsAndParagraphs[0][1]) {\n            const length = selectedSegmentsAndParagraphs[0][1].segments.length;\n            const marker = selectedSegmentsAndParagraphs[0][1].segments[length - 1];\n            const textSegment = selectedSegmentsAndParagraphs[0][1].segments[length - 2];\n            if (\n                marker.segmentType == 'SelectionMarker' &&\n                textSegment.segmentType == 'Text' &&\n                !textSegment.link\n            ) {\n                const link = textSegment.text.split(' ').pop();\n                if (link && matchLink(link)) {\n                    textSegment.text = textSegment.text.replace(link, '');\n                    const linkSegment = createText(link, marker.format, {\n                        format: {\n                            href: link,\n                            underline: true,\n                        },\n                        dataset: {},\n                    });\n                    selectedSegmentsAndParagraphs[0][1].segments.splice(length - 1, 0, linkSegment);\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    });\n}\n","import { getSelectedSegmentsAndParagraphs } from 'roosterjs-content-model-core';\nimport { matchLink } from 'roosterjs-content-model-api';\nimport type { ContentModelDocument } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function getLinkSegment(model: ContentModelDocument) {\n    const selectedSegmentsAndParagraphs = getSelectedSegmentsAndParagraphs(\n        model,\n        false /* includingFormatHolder */\n    );\n    if (selectedSegmentsAndParagraphs.length == 1 && selectedSegmentsAndParagraphs[0][1]) {\n        const selectedParagraph = selectedSegmentsAndParagraphs[0][1];\n        const marker = selectedParagraph.segments[selectedParagraph.segments.length - 1];\n        const link = selectedParagraph.segments[selectedParagraph.segments.length - 2];\n        if (\n            marker &&\n            link &&\n            marker.segmentType === 'SelectionMarker' &&\n            marker.isSelected &&\n            link.segmentType === 'Text' &&\n            (matchLink(link.text) || link.link)\n        ) {\n            return link;\n        }\n    }\n    return undefined;\n}\n","import { getLinkSegment } from './getLinkSegment';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function unlink(editor: IEditor, rawEvent: KeyboardEvent) {\n    editor.formatContentModel(model => {\n        const link = getLinkSegment(model);\n        if (link?.link) {\n            link.link = undefined;\n            rawEvent.preventDefault();\n            return true;\n        }\n\n        return false;\n    });\n}\n","/**\n * @internal\n * Convert english alphabet numbers into decimal numbers\n * @param letter The letter that needs to be converted\n * @returns\n */\nexport function convertAlphaToDecimals(letter: string): number | undefined {\n    const alpha = letter.toUpperCase();\n    if (alpha) {\n        let result = 0;\n        for (let i = 0; i < alpha.length; i++) {\n            const charCode = alpha.charCodeAt(i) - 65 + 1;\n            result = result * 26 + charCode;\n        }\n\n        return result;\n    }\n    return undefined;\n}\n","import { convertAlphaToDecimals } from './convertAlphaToDecimals';\n\n/**\n * @internal\n */\nexport function getIndex(listIndex: string) {\n    const index = listIndex.replace(/[^a-zA-Z0-9 ]/g, '');\n    const indexNumber = parseInt(index);\n    return !isNaN(indexNumber) ? indexNumber : convertAlphaToDecimals(index);\n}\n","import { findListItemsInSameThread } from 'roosterjs-content-model-api';\nimport { getNumberingListStyle } from './getNumberingListStyle';\nimport type {\n    ContentModelDocument,\n    ContentModelListItem,\n    ContentModelParagraph,\n} from 'roosterjs-content-model-types';\nimport {\n    BulletListType,\n    isBlockGroupOfType,\n    updateListMetadata,\n    getOperationalBlocks,\n    getSelectedSegmentsAndParagraphs,\n} from 'roosterjs-content-model-core';\n\n/**\n * @internal\n */\ninterface ListTypeStyle {\n    listType: 'UL' | 'OL';\n    styleType: number;\n    index?: number;\n}\n\n/**\n * @internal\n */\nexport function getListTypeStyle(\n    model: ContentModelDocument,\n    shouldSearchForBullet: boolean = true,\n    shouldSearchForNumbering: boolean = true\n): ListTypeStyle | undefined {\n    const selectedSegmentsAndParagraphs = getSelectedSegmentsAndParagraphs(model, true);\n    if (!selectedSegmentsAndParagraphs[0]) {\n        return undefined;\n    }\n    const marker = selectedSegmentsAndParagraphs[0][0];\n    const paragraph = selectedSegmentsAndParagraphs[0][1];\n    const listMarkerSegment = paragraph?.segments[0];\n\n    if (\n        marker &&\n        marker.segmentType == 'SelectionMarker' &&\n        listMarkerSegment &&\n        listMarkerSegment.segmentType == 'Text'\n    ) {\n        const listMarker = listMarkerSegment.text;\n        const bulletType = bulletListType[listMarker];\n\n        if (bulletType && shouldSearchForBullet) {\n            return { listType: 'UL', styleType: bulletType };\n        } else if (shouldSearchForNumbering) {\n            const previousList = getPreviousListLevel(model, paragraph);\n            const previousIndex = getPreviousListIndex(model, previousList);\n            const previousListStyle = getPreviousListStyle(previousList);\n            const numberingType = getNumberingListStyle(\n                listMarker,\n                previousIndex,\n                previousListStyle\n            );\n            if (numberingType) {\n                return {\n                    listType: 'OL',\n                    styleType: numberingType,\n                    index:\n                        !isNewList(listMarker) &&\n                        previousListStyle === numberingType &&\n                        previousIndex\n                            ? previousIndex + 1\n                            : undefined,\n                };\n            }\n        }\n    }\n    return undefined;\n}\n\nconst getPreviousListIndex = (\n    model: ContentModelDocument,\n    previousListItem?: ContentModelListItem\n) => {\n    return previousListItem ? findListItemsInSameThread(model, previousListItem).length : undefined;\n};\n\nconst getPreviousListLevel = (model: ContentModelDocument, paragraph: ContentModelParagraph) => {\n    const blocks = getOperationalBlocks<ContentModelListItem>(\n        model,\n        ['ListItem'],\n        ['TableCell']\n    )[0];\n    let listItem: ContentModelListItem | undefined = undefined;\n    if (blocks) {\n        const listBlockIndex = blocks.parent.blocks.indexOf(paragraph);\n\n        if (listBlockIndex > -1) {\n            for (let i = listBlockIndex - 1; i > -1; i--) {\n                const item = blocks.parent.blocks[i];\n                if (isBlockGroupOfType<ContentModelListItem>(item, 'ListItem')) {\n                    listItem = item;\n                    break;\n                }\n            }\n        }\n    }\n\n    return listItem;\n};\n\nconst getPreviousListStyle = (list?: ContentModelListItem) => {\n    if (list?.levels[0].dataset) {\n        return updateListMetadata(list.levels[0])?.orderedStyleType;\n    }\n};\n\nconst bulletListType: Record<string, number> = {\n    '*': BulletListType.Disc,\n    '-': BulletListType.Dash,\n    '--': BulletListType.Square,\n    '->': BulletListType.LongArrow,\n    '-->': BulletListType.DoubleLongArrow,\n    '=>': BulletListType.UnfilledArrow,\n    '>': BulletListType.ShortArrow,\n    '': BulletListType.Hyphen,\n};\n\nconst isNewList = (listMarker: string) => {\n    const marker = listMarker.replace(/[^\\w\\s]/g, '');\n    const pattern = /^[1aAiI]$/;\n    return pattern.test(marker);\n};\n","import { getIndex } from './getIndex';\nimport { NumberingListType } from 'roosterjs-content-model-core';\n\nconst enum NumberingTypes {\n    Decimal = 1,\n    LowerAlpha = 2,\n    UpperAlpha = 3,\n    LowerRoman = 4,\n    UpperRoman = 5,\n}\n\nconst enum Character {\n    Dot = 1,\n    Dash = 2,\n    Parenthesis = 3,\n    DoubleParenthesis = 4,\n}\n\nconst characters: Record<string, number> = {\n    '.': Character.Dot,\n    '-': Character.Dash,\n    ')': Character.Parenthesis,\n};\n\nconst lowerRomanTypes = [\n    NumberingListType.LowerRoman,\n    NumberingListType.LowerRomanDash,\n    NumberingListType.LowerRomanDoubleParenthesis,\n    NumberingListType.LowerRomanParenthesis,\n];\nconst upperRomanTypes = [\n    NumberingListType.UpperRoman,\n    NumberingListType.UpperRomanDash,\n    NumberingListType.UpperRomanDoubleParenthesis,\n    NumberingListType.UpperRomanParenthesis,\n];\nconst numberingTriggers = ['1', 'a', 'A', 'I', 'i'];\nconst lowerRomanNumbers = ['i', 'v', 'x', 'l', 'c', 'd', 'm'];\nconst upperRomanNumbers = ['I', 'V', 'X', 'L', 'C', 'D', 'M'];\n\nconst identifyNumberingType = (text: string, previousListStyle?: number) => {\n    if (!isNaN(parseInt(text))) {\n        return NumberingTypes.Decimal;\n    } else if (/[a-z]+/g.test(text)) {\n        if (\n            (previousListStyle === NumberingTypes.LowerRoman &&\n                lowerRomanTypes.indexOf(previousListStyle) > -1 &&\n                lowerRomanNumbers.indexOf(text[0]) > -1) ||\n            (!previousListStyle && text === 'i')\n        ) {\n            return NumberingTypes.LowerRoman;\n        } else if (\n            previousListStyle === NumberingTypes.LowerAlpha ||\n            (!previousListStyle && text === 'a')\n        ) {\n            return NumberingTypes.LowerAlpha;\n        }\n    } else if (/[A-Z]+/g.test(text)) {\n        if (\n            (previousListStyle == NumberingTypes.UpperRoman &&\n                upperRomanTypes.indexOf(previousListStyle) > -1 &&\n                upperRomanNumbers.indexOf(text[0]) > -1) ||\n            (!previousListStyle && text === 'I')\n        ) {\n            return NumberingTypes.UpperRoman;\n        } else if (\n            previousListStyle == NumberingTypes.UpperAlpha ||\n            (!previousListStyle && text === 'A')\n        ) {\n            return NumberingTypes.UpperAlpha;\n        }\n    }\n};\n\nconst numberingListTypes: Record<number, (char: number) => number | undefined> = {\n    [NumberingTypes.Decimal]: char => DecimalsTypes[char] || undefined,\n    [NumberingTypes.LowerAlpha]: char => LowerAlphaTypes[char] || undefined,\n    [NumberingTypes.UpperAlpha]: char => UpperAlphaTypes[char] || undefined,\n    [NumberingTypes.LowerRoman]: char => LowerRomanTypes[char] || undefined,\n    [NumberingTypes.UpperRoman]: char => UpperRomanTypes[char] || undefined,\n};\n\nconst UpperRomanTypes: Record<number, number> = {\n    [Character.Dot]: NumberingListType.UpperRoman,\n    [Character.Dash]: NumberingListType.UpperRomanDash,\n    [Character.Parenthesis]: NumberingListType.UpperRomanParenthesis,\n    [Character.DoubleParenthesis]: NumberingListType.UpperRomanDoubleParenthesis,\n};\n\nconst LowerRomanTypes: Record<number, number> = {\n    [Character.Dot]: NumberingListType.LowerRoman,\n    [Character.Dash]: NumberingListType.LowerRomanDash,\n    [Character.Parenthesis]: NumberingListType.LowerRomanParenthesis,\n    [Character.DoubleParenthesis]: NumberingListType.LowerRomanDoubleParenthesis,\n};\n\nconst UpperAlphaTypes: Record<number, number> = {\n    [Character.Dot]: NumberingListType.UpperAlpha,\n    [Character.Dash]: NumberingListType.UpperAlphaDash,\n    [Character.Parenthesis]: NumberingListType.UpperAlphaParenthesis,\n    [Character.DoubleParenthesis]: NumberingListType.UpperAlphaDoubleParenthesis,\n};\n\nconst LowerAlphaTypes: Record<number, number> = {\n    [Character.Dot]: NumberingListType.LowerAlpha,\n    [Character.Dash]: NumberingListType.LowerAlphaDash,\n    [Character.Parenthesis]: NumberingListType.LowerAlphaParenthesis,\n    [Character.DoubleParenthesis]: NumberingListType.LowerAlphaDoubleParenthesis,\n};\n\nconst DecimalsTypes: Record<number, number> = {\n    [Character.Dot]: NumberingListType.Decimal,\n    [Character.Dash]: NumberingListType.DecimalDash,\n    [Character.Parenthesis]: NumberingListType.DecimalParenthesis,\n    [Character.DoubleParenthesis]: NumberingListType.DecimalDoubleParenthesis,\n};\n\nconst identifyNumberingListType = (\n    numbering: string,\n    isDoubleParenthesis: boolean,\n    previousListStyle?: number\n): number | undefined => {\n    const separatorCharacter = isDoubleParenthesis\n        ? Character.DoubleParenthesis\n        : characters[numbering[numbering.length - 1]];\n    // if separator is not valid, no need to check if the number is valid.\n    if (separatorCharacter) {\n        const number = isDoubleParenthesis ? numbering.slice(1, -1) : numbering.slice(0, -1);\n        const numberingType = identifyNumberingType(number, previousListStyle);\n        return numberingType ? numberingListTypes[numberingType](separatorCharacter) : undefined;\n    }\n    return undefined;\n};\n\n/**\n * @internal\n */\nexport function getNumberingListStyle(\n    textBeforeCursor: string,\n    previousListIndex?: number,\n    previousListStyle?: number\n): number | undefined {\n    const trigger = textBeforeCursor.trim();\n    const isDoubleParenthesis = trigger[0] === '(' && trigger[trigger.length - 1] === ')';\n    //Only the staring items ['1', 'a', 'A', 'I', 'i'] must trigger a new list. All the other triggers is used to keep the list chain.\n    //The index is always the characters before the last character\n    const listIndex = isDoubleParenthesis ? trigger.slice(1, -1) : trigger.slice(0, -1);\n    const index = getIndex(listIndex);\n    const isContinuosList = numberingTriggers.indexOf(listIndex) < 0;\n\n    if (\n        !index ||\n        index < 1 ||\n        (!previousListIndex && isContinuosList) ||\n        (previousListIndex && isContinuosList && !canAppendList(index, previousListIndex))\n    ) {\n        return undefined;\n    }\n\n    const numberingType = isValidNumbering(listIndex)\n        ? identifyNumberingListType(\n              trigger,\n              isDoubleParenthesis,\n              isContinuosList ? previousListStyle : undefined\n          )\n        : undefined;\n    return numberingType;\n}\n\n/**\n * Check if index has only numbers or only letters to avoid sequence of character such 1:1. trigger a list.\n * @param index\n * @returns\n */\nfunction isValidNumbering(index: string) {\n    return Number(index) || /^[A-Za-z\\s]*$/.test(index);\n}\n\nfunction canAppendList(index?: number, previousListIndex?: number) {\n    return previousListIndex && index && previousListIndex + 1 === index;\n}\n","import { getListTypeStyle } from './getListTypeStyle';\nimport { getSelectedSegmentsAndParagraphs } from 'roosterjs-content-model-core';\nimport { normalizeContentModel } from 'roosterjs-content-model-dom';\nimport { setListStartNumber, setListStyle, setListType } from 'roosterjs-content-model-api';\nimport type { ContentModelDocument, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function keyboardListTrigger(\n    editor: IEditor,\n    rawEvent: KeyboardEvent,\n    shouldSearchForBullet: boolean = true,\n    shouldSearchForNumbering: boolean = true\n) {\n    if (shouldSearchForBullet || shouldSearchForNumbering) {\n        editor.formatContentModel((model, _context) => {\n            const listStyleType = getListTypeStyle(\n                model,\n                shouldSearchForBullet,\n                shouldSearchForNumbering\n            );\n            if (listStyleType) {\n                const segmentsAndParagraphs = getSelectedSegmentsAndParagraphs(model, false);\n                if (segmentsAndParagraphs[0] && segmentsAndParagraphs[0][1]) {\n                    segmentsAndParagraphs[0][1].segments.splice(0, 1);\n                }\n                const { listType, styleType, index } = listStyleType;\n                triggerList(editor, model, listType, styleType, index);\n                rawEvent.preventDefault();\n                normalizeContentModel(model);\n\n                return true;\n            }\n            return false;\n        });\n    }\n}\n\nconst triggerList = (\n    editor: IEditor,\n    model: ContentModelDocument,\n    listType: 'OL' | 'UL',\n    styleType: number,\n    index?: number\n) => {\n    setListType(model, listType);\n    const isOrderedList = listType == 'OL';\n    // If the index < 1, it is a new list, so it will be starting by 1, then no need to set startNumber\n    if (index && index > 1 && isOrderedList) {\n        setListStartNumber(editor, index);\n    }\n    setListStyle(\n        editor,\n        isOrderedList\n            ? {\n                  orderedStyleType: styleType,\n              }\n            : {\n                  unorderedStyleType: styleType,\n              }\n    );\n};\n","import type { EditorPlugin, IEditor, PluginEvent } from 'roosterjs-content-model-types';\n\n/**\n * Context Menu options for ContextMenu plugin\n */\nexport interface ContextMenuOptions<T> {\n    /**\n     * Render function for the context menu\n     * @param container The container HTML element, it will be located at the mouse click position,\n     * so the callback just need to render menu content into this container\n     * @param onDismiss The onDismiss callback, some menu render need to know this callback so that\n     * it can handle the dismiss event\n     */\n    render: (container: HTMLElement, items: (T | null)[], onDismiss: () => void) => void;\n\n    /**\n     * Dismiss function for the context menu, it will be called when user wants to dismiss this context menu\n     * e.g. user click away so the menu should be dismissed\n     * @param container The container HTML element\n     */\n    dismiss?: (container: HTMLElement) => void;\n\n    /**\n     * Whether the default context menu is allowed. @default false\n     */\n    allowDefaultMenu?: boolean;\n}\n\n/**\n * An editor plugin that support showing a context menu using render() function from options parameter\n */\nexport class ContextMenuPluginBase<T> implements EditorPlugin {\n    private container: HTMLElement | null = null;\n    private editor: IEditor | null = null;\n    private isMenuShowing: boolean = false;\n\n    /**\n     * Create a new instance of ContextMenu class\n     * @param options An options object to determine how to show/hide the context menu\n     */\n    constructor(private options: ContextMenuOptions<T>) {}\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'ContextMenu';\n    }\n\n    /**\n     * Initialize this plugin\n     * @param editor The editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.onDismiss();\n\n        if (this.container?.parentNode) {\n            this.container.parentNode.removeChild(this.container);\n            this.container = null;\n        }\n        this.editor = null;\n    }\n\n    /**\n     * Handle events triggered from editor\n     * @param event PluginEvent object\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (event.eventType == 'contextMenu' && event.items.length > 0) {\n            const { rawEvent, items } = event;\n\n            this.onDismiss();\n\n            if (!this.options.allowDefaultMenu) {\n                rawEvent.preventDefault();\n            }\n\n            if (this.initContainer(rawEvent.pageX, rawEvent.pageY)) {\n                this.options.render(this.container!, items as T[], this.onDismiss);\n                this.isMenuShowing = true;\n            }\n        }\n    }\n\n    private initContainer(x: number, y: number) {\n        if (!this.container && this.editor) {\n            this.container = this.editor.getDocument().createElement('div');\n\n            this.container.style.position = 'fixed';\n            this.container.style.width = '0';\n            this.container.style.height = '0';\n            this.editor.getDocument().body.appendChild(this.container);\n        }\n        this.container?.style.setProperty('left', x + 'px');\n        this.container?.style.setProperty('top', y + 'px');\n        return !!this.container;\n    }\n\n    private onDismiss = () => {\n        if (this.container && this.isMenuShowing) {\n            this.options.dismiss?.(this.container);\n            this.isMenuShowing = false;\n        }\n    };\n}\n","import { keyboardDelete } from './keyboardDelete';\nimport { keyboardInput } from './keyboardInput';\nimport { keyboardTab } from './keyboardTab';\nimport type {\n    EditorPlugin,\n    IEditor,\n    KeyDownEvent,\n    PluginEvent,\n} from 'roosterjs-content-model-types';\n\nconst BACKSPACE_KEY = 8;\nconst DELETE_KEY = 46;\n\n/**\n * Edit plugins helps editor to do editing operation on top of content model.\n * This includes:\n * 1. Delete Key\n * 2. Backspace Key\n * 3. Tab Key\n */\nexport class EditPlugin implements EditorPlugin {\n    private editor: IEditor | null = null;\n    private disposer: (() => void) | null = null;\n    private shouldHandleNextInputEvent = false;\n\n    /**\n     * Get name of this plugin\n     */\n    getName() {\n        return 'Edit';\n    }\n\n    /**\n     * The first method that editor will call to a plugin when editor is initializing.\n     * It will pass in the editor instance, plugin should take this chance to save the\n     * editor reference so that it can call to any editor method or format API later.\n     * @param editor The editor object\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n        if (editor.getEnvironment().isAndroid) {\n            this.disposer = this.editor.attachDomEvent({\n                beforeinput: {\n                    beforeDispatch: e => this.handleBeforeInputEvent(editor, e),\n                },\n            });\n        }\n    }\n\n    /**\n     * The last method that editor will call to a plugin before it is disposed.\n     * Plugin can take this chance to clear the reference to editor. After this method is\n     * called, plugin should not call to any editor method since it will result in error.\n     */\n    dispose() {\n        this.editor = null;\n        this.disposer?.();\n        this.disposer = null;\n    }\n\n    /**\n     * Core method for a plugin. Once an event happens in editor, editor will call this\n     * method of each plugin to handle the event as long as the event is not handled\n     * exclusively by another plugin.\n     * @param event The event to handle:\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (this.editor) {\n            switch (event.eventType) {\n                case 'keyDown':\n                    this.handleKeyDownEvent(this.editor, event);\n                    break;\n            }\n        }\n    }\n\n    private handleKeyDownEvent(editor: IEditor, event: KeyDownEvent) {\n        const rawEvent = event.rawEvent;\n\n        if (!rawEvent.defaultPrevented && !event.handledByEditFeature) {\n            switch (rawEvent.key) {\n                case 'Backspace':\n                case 'Delete':\n                    // Use our API to handle BACKSPACE/DELETE key.\n                    // No need to clear cache here since if we rely on browser's behavior, there will be Input event and its handler will reconcile cache\n                    keyboardDelete(editor, rawEvent);\n                    break;\n\n                case 'Tab':\n                    keyboardTab(editor, rawEvent);\n                    break;\n                case 'Unidentified':\n                    if (editor.getEnvironment().isAndroid) {\n                        this.shouldHandleNextInputEvent = true;\n                    }\n                    break;\n\n                case 'Enter':\n                default:\n                    keyboardInput(editor, rawEvent);\n                    break;\n            }\n        }\n    }\n\n    private handleBeforeInputEvent(editor: IEditor, rawEvent: Event) {\n        // Some Android IMEs doesn't fire correct keydown event for BACKSPACE/DELETE key\n        // Here we translate input event to BACKSPACE/DELETE keydown event to be compatible with existing logic\n        if (\n            !this.shouldHandleNextInputEvent ||\n            !(rawEvent instanceof InputEvent) ||\n            rawEvent.defaultPrevented\n        ) {\n            return;\n        }\n        this.shouldHandleNextInputEvent = false;\n\n        let handled = false;\n        switch (rawEvent.inputType) {\n            case 'deleteContentBackward':\n                handled = keyboardDelete(\n                    editor,\n                    new KeyboardEvent('keydown', {\n                        key: 'Backspace',\n                        keyCode: BACKSPACE_KEY,\n                        which: BACKSPACE_KEY,\n                    })\n                );\n                break;\n            case 'deleteContentForward':\n                handled = keyboardDelete(\n                    editor,\n                    new KeyboardEvent('keydown', {\n                        key: 'Delete',\n                        keyCode: DELETE_KEY,\n                        which: DELETE_KEY,\n                    })\n                );\n                break;\n        }\n\n        if (handled) {\n            rawEvent.preventDefault();\n        }\n    }\n}\n","import { deleteSegment } from 'roosterjs-content-model-core';\nimport type { DeleteSelectionStep } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const deleteAllSegmentBefore: DeleteSelectionStep = context => {\n    if (context.deleteResult != 'notDeleted') {\n        return;\n    }\n\n    const { paragraph, marker } = context.insertPoint;\n    const index = paragraph.segments.indexOf(marker);\n\n    for (let i = index - 1; i >= 0; i--) {\n        const segment = paragraph.segments[i];\n\n        segment.isSelected = true;\n\n        if (deleteSegment(paragraph, segment, context.formatContext)) {\n            context.deleteResult = 'range';\n        }\n    }\n};\n","import { getLeafSiblingBlock } from '../utils/getLeafSiblingBlock';\nimport { setModelIndentation } from 'roosterjs-content-model-api';\nimport { setParagraphNotImplicit } from 'roosterjs-content-model-dom';\nimport {\n    deleteBlock,\n    deleteSegment,\n    getClosestAncestorBlockGroupIndex,\n} from 'roosterjs-content-model-core';\nimport type { BlockAndPath } from '../utils/getLeafSiblingBlock';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelParagraph,\n    ContentModelSegment,\n    DeleteSelectionStep,\n} from 'roosterjs-content-model-types';\n\nfunction getDeleteCollapsedSelection(direction: 'forward' | 'backward'): DeleteSelectionStep {\n    return context => {\n        if (context.deleteResult != 'notDeleted') {\n            return;\n        }\n\n        const isForward = direction == 'forward';\n        const { paragraph, marker, path, tableContext } = context.insertPoint;\n        const segments = paragraph.segments;\n\n        fixupBr(segments);\n\n        const index = segments.indexOf(marker) + (isForward ? 1 : -1);\n        const segmentToDelete = segments[index];\n        let blockToDelete: BlockAndPath | null;\n        let root: ContentModelDocument | null;\n\n        if (segmentToDelete) {\n            if (deleteSegment(paragraph, segmentToDelete, context.formatContext, direction)) {\n                context.deleteResult = 'singleChar';\n\n                // It is possible that we have deleted everything from this paragraph, so we need to mark it as not implicit\n                // to avoid losing its format. See https://github.com/microsoft/roosterjs/issues/1953\n                setParagraphNotImplicit(paragraph);\n            }\n        } else if (\n            shouldOutdentParagraph(isForward, segments, paragraph, path) &&\n            (root = getRoot(path))\n        ) {\n            setModelIndentation(root, 'outdent');\n            context.deleteResult = 'range';\n        } else if ((blockToDelete = getLeafSiblingBlock(path, paragraph, isForward))) {\n            const { block, path, siblingSegment } = blockToDelete;\n\n            if (block.blockType == 'Paragraph') {\n                if (siblingSegment) {\n                    // When selection is under general segment, need to check if it has a sibling sibling, and delete from it\n                    if (deleteSegment(block, siblingSegment, context.formatContext, direction)) {\n                        context.deleteResult = 'range';\n                    }\n                } else {\n                    if (isForward) {\n                        context.lastParagraph = block;\n                    } else {\n                        if (block.segments[block.segments.length - 1]?.segmentType == 'Br') {\n                            block.segments.pop();\n                        }\n\n                        context.insertPoint = {\n                            marker,\n                            paragraph: block,\n                            path,\n                            tableContext,\n                        };\n                        context.lastParagraph = paragraph;\n                        delete block.cachedElement;\n                    }\n\n                    context.deleteResult = 'range';\n                }\n\n                // When go across table, getLeafSiblingBlock will return null, when we are here, we must be in the same table context\n                context.lastTableContext = tableContext;\n            } else {\n                if (\n                    deleteBlock(\n                        path[0].blocks,\n                        block,\n                        undefined /*replacement*/,\n                        context.formatContext,\n                        direction\n                    )\n                ) {\n                    context.deleteResult = 'range';\n                }\n            }\n        } else {\n            // We have nothing to delete, in this case we don't want browser handle it as well.\n            // Because when Backspace on an empty document, it will also delete the only DIV and SPAN element, causes\n            // editor is really empty. We don't want that happen. So the handling should stop here.\n            context.deleteResult = 'nothingToDelete';\n        }\n    };\n}\n\nfunction getRoot(path: ContentModelBlockGroup[]): ContentModelDocument | null {\n    const lastInPath = path[path.length - 1];\n    return lastInPath.blockGroupType == 'Document' ? lastInPath : null;\n}\n\nfunction shouldOutdentParagraph(\n    isForward: boolean,\n    segments: ContentModelSegment[],\n    paragraph: ContentModelParagraph,\n    path: ContentModelBlockGroup[]\n) {\n    return (\n        !isForward &&\n        segments.length == 1 &&\n        segments[0].segmentType == 'SelectionMarker' &&\n        paragraph.format.marginLeft &&\n        parseInt(paragraph.format.marginLeft) &&\n        getClosestAncestorBlockGroupIndex(path, ['Document', 'TableCell'], ['ListItem']) > -1\n    );\n}\n\n/**\n * If the last segment is BR, remove it for now. We may add it back later when normalize model.\n * So that if this is an empty paragraph, it will start to delete next block\n */\nfunction fixupBr(segments: ContentModelSegment[]) {\n    if (segments[segments.length - 1]?.segmentType == 'Br') {\n        const segmentsWithoutBr = segments.filter(x => x.segmentType != 'SelectionMarker');\n\n        if (segmentsWithoutBr[segmentsWithoutBr.length - 2]?.segmentType != 'Br') {\n            segments.pop();\n        }\n    }\n}\n\n/**\n * @internal if we didn't delete anything, and we want to delete forward, now perform it\n */\nexport const forwardDeleteCollapsedSelection = getDeleteCollapsedSelection('forward');\n\n/**\n * @internal if we didn't delete anything, and we want to delete backward, now perform it\n */\nexport const backwardDeleteCollapsedSelection = getDeleteCollapsedSelection('backward');\n","import { createParagraph, createSelectionMarker, unwrapBlock } from 'roosterjs-content-model-dom';\nimport {\n    getClosestAncestorBlockGroupIndex,\n    isBlockGroupOfType,\n} from 'roosterjs-content-model-core';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelFormatContainer,\n    DeleteSelectionStep,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const deleteEmptyQuote: DeleteSelectionStep = context => {\n    const { deleteResult } = context;\n    if (\n        deleteResult == 'nothingToDelete' ||\n        deleteResult == 'notDeleted' ||\n        deleteResult == 'range'\n    ) {\n        const { insertPoint, formatContext } = context;\n        const { path } = insertPoint;\n        const rawEvent = formatContext?.rawEvent as KeyboardEvent;\n        const index = getClosestAncestorBlockGroupIndex(\n            path,\n            ['FormatContainer', 'ListItem'],\n            ['TableCell']\n        );\n        const quote = path[index];\n\n        if (quote && quote.blockGroupType === 'FormatContainer' && quote.tagName == 'blockquote') {\n            const parent = path[index + 1];\n            const quoteBlockIndex = parent.blocks.indexOf(quote);\n            const blockQuote = parent.blocks[quoteBlockIndex];\n            if (\n                isBlockGroupOfType<ContentModelFormatContainer>(blockQuote, 'FormatContainer') &&\n                blockQuote.tagName === 'blockquote'\n            ) {\n                if (isEmptyQuote(blockQuote)) {\n                    unwrapBlock(parent, blockQuote);\n                    rawEvent?.preventDefault();\n                    context.deleteResult = 'range';\n                } else if (isSelectionOnEmptyLine(blockQuote) && rawEvent?.key === 'Enter') {\n                    insertNewLine(blockQuote, parent, quoteBlockIndex);\n                    rawEvent?.preventDefault();\n                    context.deleteResult = 'range';\n                }\n            }\n        }\n    }\n};\n\nconst isEmptyQuote = (quote: ContentModelFormatContainer) => {\n    return (\n        quote.blocks.length === 1 &&\n        quote.blocks[0].blockType === 'Paragraph' &&\n        quote.blocks[0].segments.every(\n            s => s.segmentType === 'SelectionMarker' || s.segmentType === 'Br'\n        )\n    );\n};\n\nconst isSelectionOnEmptyLine = (quote: ContentModelFormatContainer) => {\n    const quoteLength = quote.blocks.length;\n    const lastParagraph = quote.blocks[quoteLength - 1];\n    if (lastParagraph && lastParagraph.blockType === 'Paragraph') {\n        return lastParagraph.segments.every(\n            s => s.segmentType === 'SelectionMarker' || s.segmentType === 'Br'\n        );\n    }\n};\n\nconst insertNewLine = (\n    quote: ContentModelFormatContainer,\n    parent: ContentModelBlockGroup,\n    index: number\n) => {\n    const quoteLength = quote.blocks.length;\n    quote.blocks.splice(quoteLength - 1, 1);\n    const marker = createSelectionMarker();\n    const newParagraph = createParagraph(false /* isImplicit */);\n    newParagraph.segments.push(marker);\n    parent.blocks.splice(index + 1, 0, newParagraph);\n};\n","import { getClosestAncestorBlockGroupIndex } from 'roosterjs-content-model-core';\nimport type { DeleteSelectionStep } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const deleteList: DeleteSelectionStep = context => {\n    const { paragraph, marker, path } = context.insertPoint;\n\n    if (context.deleteResult == 'nothingToDelete' || context.deleteResult == 'notDeleted') {\n        const index = getClosestAncestorBlockGroupIndex(path, ['ListItem', 'TableCell']);\n        const item = path[index];\n        if (\n            item &&\n            index >= 0 &&\n            paragraph.segments[0] == marker &&\n            item.blockGroupType == 'ListItem' &&\n            (paragraph.segments.length == 1 ||\n                (paragraph.segments.length == 2 && paragraph.segments[1].segmentType == 'Br'))\n        ) {\n            item.levels = [];\n            context.deleteResult = 'range';\n        }\n    }\n};\n","import { isPunctuation, isSpace, normalizeText } from 'roosterjs-content-model-core';\nimport { isWhiteSpacePreserved } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelParagraph,\n    DeleteSelectionContext,\n    DeleteSelectionStep,\n} from 'roosterjs-content-model-types';\n\nconst enum DeleteWordState {\n    Start,\n    Punctuation,\n    Text,\n    NonText,\n    Space,\n    End,\n}\n\ninterface CharInfo {\n    text: boolean;\n    space: boolean;\n    punctuation: boolean;\n}\n\nfunction getDeleteWordSelection(direction: 'forward' | 'backward'): DeleteSelectionStep {\n    return context => {\n        if (context.deleteResult != 'notDeleted') {\n            return;\n        }\n\n        const { marker, paragraph } = context.insertPoint;\n        const startIndex = paragraph.segments.indexOf(marker);\n        const deleteNext = direction == 'forward';\n\n        const iterator = iterateSegments(paragraph, startIndex, deleteNext, context);\n        let curr = iterator.next();\n\n        for (let state = DeleteWordState.Start; state != DeleteWordState.End && !curr.done; ) {\n            const { punctuation, space, text } = curr.value;\n\n            // This is a state machine of how to delete a whole word together with space and punctuations.\n            // For a full state machine chart, see\n            // Forward delete: https://github.com/microsoft/roosterjs/blob/master/assets/design-charts/ForwardDeleteWord.png\n            // Backward delete: https://github.com/microsoft/roosterjs/blob/master/assets/design-charts/BackwardDeleteWord.png\n            switch (state) {\n                case DeleteWordState.Start:\n                    state = space\n                        ? DeleteWordState.Space\n                        : punctuation\n                        ? DeleteWordState.Punctuation\n                        : DeleteWordState.Text;\n                    curr = iterator.next(true /*delete*/);\n                    break;\n\n                case DeleteWordState.Punctuation:\n                    if (deleteNext && space) {\n                        state = DeleteWordState.NonText;\n                        curr = iterator.next(true /*delete*/);\n                    } else if (punctuation) {\n                        curr = iterator.next(true /*delete*/);\n                    } else {\n                        state = DeleteWordState.End;\n                    }\n                    break;\n\n                case DeleteWordState.Text:\n                    if (deleteNext && space) {\n                        state = DeleteWordState.NonText;\n                        curr = iterator.next(true /*delete*/);\n                    } else if (text) {\n                        curr = iterator.next(true /*delete*/);\n                    } else {\n                        state = DeleteWordState.End;\n                    }\n                    break;\n\n                case DeleteWordState.NonText:\n                    if (punctuation || !space) {\n                        state = DeleteWordState.End;\n                    } else {\n                        curr = iterator.next(true /*delete*/);\n                    }\n                    break;\n\n                case DeleteWordState.Space:\n                    if (space) {\n                        curr = iterator.next(true /*delete*/);\n                    } else if (punctuation) {\n                        state = deleteNext ? DeleteWordState.NonText : DeleteWordState.Punctuation;\n                        curr = iterator.next(true /*delete*/);\n                    } else {\n                        state = deleteNext ? DeleteWordState.End : DeleteWordState.Text;\n                    }\n                    break;\n            }\n        }\n    };\n}\n\nfunction* iterateSegments(\n    paragraph: ContentModelParagraph,\n    markerIndex: number,\n    forward: boolean,\n    context: DeleteSelectionContext\n): Generator<CharInfo, null, boolean> {\n    const step = forward ? 1 : -1;\n    const segments = paragraph.segments;\n    const preserveWhiteSpace = isWhiteSpacePreserved(paragraph.format.whiteSpace);\n\n    for (let i = markerIndex + step; i >= 0 && i < segments.length; i += step) {\n        const segment = segments[i];\n\n        switch (segment.segmentType) {\n            case 'Text':\n                for (\n                    let j = forward ? 0 : segment.text.length - 1;\n                    j >= 0 && j < segment.text.length;\n                    j += step\n                ) {\n                    const c = segment.text[j];\n                    const punctuation = isPunctuation(c);\n                    const space = isSpace(c);\n                    const text = !punctuation && !space;\n\n                    if (yield { punctuation, space, text }) {\n                        let newText = segment.text;\n\n                        newText = newText.substring(0, j) + newText.substring(j + 1);\n\n                        if (!preserveWhiteSpace) {\n                            newText = normalizeText(newText, forward);\n                        }\n\n                        context.deleteResult = 'range';\n\n                        if (newText) {\n                            segment.text = newText;\n\n                            if (step > 0) {\n                                j -= step;\n                            }\n                        } else {\n                            segments.splice(i, 1);\n\n                            if (step > 0) {\n                                i -= step;\n                            }\n\n                            break;\n                        }\n                    }\n                }\n                break;\n\n            case 'Image':\n                if (\n                    yield { punctuation: true, space: false, text: false } // Treat image as punctuation since they have the same behavior.\n                ) {\n                    segments.splice(i, 1);\n\n                    if (step > 0) {\n                        i -= step;\n                    }\n\n                    context.deleteResult = 'range';\n                }\n                break;\n\n            case 'SelectionMarker':\n                break;\n\n            default:\n                return null;\n        }\n    }\n\n    return null;\n}\n\n/**\n * @internal\n */\nexport const forwardDeleteWordSelection = getDeleteWordSelection('forward');\n\n/**\n * @internal\n */\nexport const backwardDeleteWordSelection = getDeleteWordSelection('backward');\n","import { normalizeContentModel } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelDocument,\n    DeleteResult,\n    FormatContentModelContext,\n    IEditor,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * @return True means content is changed, so need to rewrite content model to editor. Otherwise false\n */\nexport function handleKeyboardEventResult(\n    editor: IEditor,\n    model: ContentModelDocument,\n    rawEvent: KeyboardEvent,\n    result: DeleteResult,\n    context: FormatContentModelContext\n): boolean {\n    context.skipUndoSnapshot = true;\n    context.clearModelCache = false;\n\n    switch (result) {\n        case 'notDeleted':\n            // We have not delete anything, we will let browser handle this event, so that current cached model may be invalid\n            context.clearModelCache = true;\n\n            // Return false here since we didn't do any change to Content Model, so no need to rewrite with Content Model\n            return false;\n\n        case 'nothingToDelete':\n            // We known there is nothing to delete, no need to let browser keep handling the event\n            rawEvent.preventDefault();\n            return false;\n\n        case 'range':\n        case 'singleChar':\n            // We have deleted what we need from content model, no need to let browser keep handling the event\n            rawEvent.preventDefault();\n            normalizeContentModel(model);\n\n            if (result == 'range') {\n                // A range is about to be deleted, so add an undo snapshot immediately\n                context.skipUndoSnapshot = false;\n            }\n\n            // Trigger an event to let plugins know the content is about to be changed by Content Model keyboard editing.\n            // So plugins can do proper handling. e.g. UndoPlugin can decide whether take a snapshot before this change happens.\n            editor.triggerEvent('beforeKeyboardEditing', {\n                rawEvent,\n            });\n\n            return true;\n    }\n}\n\n/**\n * @internal\n */\nexport function shouldDeleteWord(rawEvent: KeyboardEvent, isMac: boolean) {\n    return (\n        (isMac && rawEvent.altKey && !rawEvent.metaKey) ||\n        (!isMac && rawEvent.ctrlKey && !rawEvent.altKey)\n    );\n}\n\n/**\n * @internal\n */\nexport function shouldDeleteAllSegmentsBefore(rawEvent: KeyboardEvent) {\n    return rawEvent.metaKey && !rawEvent.altKey;\n}\n","import {\n    getClosestAncestorBlockGroupIndex,\n    isBlockGroupOfType,\n} from 'roosterjs-content-model-core';\nimport {\n    createBr,\n    createListItem,\n    createListLevel,\n    createParagraph,\n    createSelectionMarker,\n    normalizeContentModel,\n    normalizeParagraph,\n    setParagraphNotImplicit,\n} from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelListItem,\n    DeleteSelectionStep,\n    InsertPoint,\n    ValidDeleteSelectionContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleEnterOnList: DeleteSelectionStep = context => {\n    const { deleteResult } = context;\n    if (\n        deleteResult == 'nothingToDelete' ||\n        deleteResult == 'notDeleted' ||\n        deleteResult == 'range'\n    ) {\n        const { insertPoint, formatContext } = context;\n        const { path } = insertPoint;\n        const rawEvent = formatContext?.rawEvent;\n        const index = getClosestAncestorBlockGroupIndex(path, ['ListItem'], ['TableCell']);\n\n        const listItem = path[index];\n        const listParent = path[index + 1];\n\n        if (listItem && listItem.blockGroupType === 'ListItem' && listParent) {\n            const listIndex = listParent.blocks.indexOf(listItem);\n            const nextBlock = listParent.blocks[listIndex + 1];\n            if (deleteResult == 'range' && nextBlock) {\n                normalizeContentModel(listParent);\n                const nextListItem = listParent.blocks[listIndex + 1];\n                if (\n                    isBlockGroupOfType<ContentModelListItem>(nextListItem, 'ListItem') &&\n                    nextListItem.levels[0]\n                ) {\n                    nextListItem.levels.forEach((level, index) => {\n                        level.format.startNumberOverride = undefined;\n                        level.dataset = listItem.levels[index]\n                            ? listItem.levels[index].dataset\n                            : {};\n                    });\n                    const lastParagraph = listItem.blocks[listItem.blocks.length - 1];\n                    const nextParagraph = nextListItem.blocks[0];\n                    if (\n                        nextParagraph.blockType === 'Paragraph' &&\n                        lastParagraph.blockType === 'Paragraph' &&\n                        lastParagraph.segments[lastParagraph.segments.length - 1].segmentType ===\n                            'SelectionMarker'\n                    ) {\n                        lastParagraph.segments.pop();\n\n                        nextParagraph.segments.unshift(\n                            createSelectionMarker(insertPoint.marker.format)\n                        );\n                    }\n                    context.lastParagraph = undefined;\n                }\n            } else if (deleteResult !== 'range') {\n                if (isEmptyListItem(listItem)) {\n                    listItem.levels.pop();\n                } else {\n                    createNewListItem(context, listItem, listParent);\n                }\n            }\n            rawEvent?.preventDefault();\n            context.deleteResult = 'range';\n        }\n    }\n};\n\nconst isEmptyListItem = (listItem: ContentModelListItem) => {\n    return (\n        listItem.blocks.length === 1 &&\n        listItem.blocks[0].blockType === 'Paragraph' &&\n        listItem.blocks[0].segments.length === 2 &&\n        listItem.blocks[0].segments[0].segmentType === 'SelectionMarker' &&\n        listItem.blocks[0].segments[1].segmentType === 'Br'\n    );\n};\n\nconst createNewListItem = (\n    context: ValidDeleteSelectionContext,\n    listItem: ContentModelListItem,\n    listParent: ContentModelBlockGroup\n) => {\n    const { insertPoint } = context;\n    const listIndex = listParent.blocks.indexOf(listItem);\n    const newParagraph = createNewParagraph(insertPoint);\n\n    const levels = createNewListLevel(listItem);\n    const newListItem = createListItem(levels, insertPoint.marker.format);\n    newListItem.blocks.push(newParagraph);\n    insertPoint.paragraph = newParagraph;\n    context.lastParagraph = newParagraph;\n    listParent.blocks.splice(listIndex + 1, 0, newListItem);\n};\n\nconst createNewListLevel = (listItem: ContentModelListItem) => {\n    return listItem.levels.map(level => {\n        return createListLevel(\n            level.listType,\n            {\n                ...level.format,\n                startNumberOverride: undefined,\n            },\n            level.dataset\n        );\n    });\n};\n\nconst createNewParagraph = (insertPoint: InsertPoint) => {\n    const { paragraph, marker } = insertPoint;\n    const newParagraph = createParagraph(\n        false /*isImplicit*/,\n        paragraph.format,\n        paragraph.segmentFormat\n    );\n\n    const markerIndex = paragraph.segments.indexOf(marker);\n    const segments = paragraph.segments.splice(\n        markerIndex,\n        paragraph.segments.length - markerIndex\n    );\n\n    newParagraph.segments.push(...segments);\n\n    setParagraphNotImplicit(paragraph);\n\n    if (paragraph.segments.every(x => x.segmentType == 'SelectionMarker')) {\n        paragraph.segments.push(createBr(marker.format));\n    }\n\n    normalizeParagraph(newParagraph);\n\n    return newParagraph;\n};\n","import { ChangeSource, deleteSelection, isModifierKey } from 'roosterjs-content-model-core';\nimport { deleteAllSegmentBefore } from './deleteSteps/deleteAllSegmentBefore';\nimport { deleteEmptyQuote } from './deleteSteps/deleteEmptyQuote';\nimport { deleteList } from './deleteSteps/deleteList';\nimport { isNodeOfType } from 'roosterjs-content-model-dom';\nimport {\n    handleKeyboardEventResult,\n    shouldDeleteAllSegmentsBefore,\n    shouldDeleteWord,\n} from './handleKeyboardEventCommon';\nimport {\n    backwardDeleteWordSelection,\n    forwardDeleteWordSelection,\n} from './deleteSteps/deleteWordSelection';\nimport {\n    backwardDeleteCollapsedSelection,\n    forwardDeleteCollapsedSelection,\n} from './deleteSteps/deleteCollapsedSelection';\nimport type { DOMSelection, DeleteSelectionStep, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Do keyboard event handling for DELETE/BACKSPACE key\n * @param editor The editor object\n * @param rawEvent DOM keyboard event\n * @returns True if the event is handled by content model, otherwise false\n */\nexport function keyboardDelete(editor: IEditor, rawEvent: KeyboardEvent) {\n    let handled = false;\n    const selection = editor.getDOMSelection();\n\n    if (shouldDeleteWithContentModel(selection, rawEvent)) {\n        editor.formatContentModel(\n            (model, context) => {\n                const result = deleteSelection(\n                    model,\n                    getDeleteSteps(rawEvent, !!editor.getEnvironment().isMac),\n                    context\n                ).deleteResult;\n\n                handled = handleKeyboardEventResult(editor, model, rawEvent, result, context);\n                return handled;\n            },\n            {\n                rawEvent,\n                changeSource: ChangeSource.Keyboard,\n                getChangeData: () => rawEvent.which,\n                apiName: rawEvent.key == 'Delete' ? 'handleDeleteKey' : 'handleBackspaceKey',\n            }\n        );\n    }\n\n    return handled;\n}\n\nfunction getDeleteSteps(rawEvent: KeyboardEvent, isMac: boolean): (DeleteSelectionStep | null)[] {\n    const isForward = rawEvent.key == 'Delete';\n    const deleteAllSegmentBeforeStep =\n        shouldDeleteAllSegmentsBefore(rawEvent) && !isForward ? deleteAllSegmentBefore : null;\n    const deleteWordSelection = shouldDeleteWord(rawEvent, isMac)\n        ? isForward\n            ? forwardDeleteWordSelection\n            : backwardDeleteWordSelection\n        : null;\n    const deleteCollapsedSelection = isForward\n        ? forwardDeleteCollapsedSelection\n        : backwardDeleteCollapsedSelection;\n    const deleteQuote = !isForward ? deleteEmptyQuote : null;\n    return [\n        deleteAllSegmentBeforeStep,\n        deleteWordSelection,\n        deleteCollapsedSelection,\n        deleteList,\n        deleteQuote,\n    ];\n}\n\nfunction shouldDeleteWithContentModel(selection: DOMSelection | null, rawEvent: KeyboardEvent) {\n    if (!selection) {\n        return false; // Nothing to delete\n    } else if (selection.type != 'range' || !selection.range.collapsed) {\n        return true; // Selection is not collapsed, need to delete all selections\n    } else {\n        const range = selection.range;\n\n        // When selection is collapsed and is in middle of text node, no need to use Content Model to delete\n        return !(\n            isNodeOfType(range.startContainer, 'TEXT_NODE') &&\n            !isModifierKey(rawEvent) &&\n            (canDeleteBefore(rawEvent, range) || canDeleteAfter(rawEvent, range))\n        );\n    }\n}\n\nfunction canDeleteBefore(rawEvent: KeyboardEvent, range: Range) {\n    return rawEvent.key == 'Backspace' && range.startOffset > 1;\n}\n\nfunction canDeleteAfter(rawEvent: KeyboardEvent, range: Range) {\n    return (\n        rawEvent.key == 'Delete' &&\n        range.startOffset < (range.startContainer.nodeValue?.length ?? 0) - 1\n    );\n}\n","import { deleteEmptyQuote } from './deleteSteps/deleteEmptyQuote';\nimport { deleteSelection, isModifierKey } from 'roosterjs-content-model-core';\nimport { handleEnterOnList } from './inputSteps/handleEnterOnList';\nimport { normalizeContentModel } from 'roosterjs-content-model-dom';\nimport type { DOMSelection, IEditor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function keyboardInput(editor: IEditor, rawEvent: KeyboardEvent) {\n    const selection = editor.getDOMSelection();\n\n    if (shouldInputWithContentModel(selection, rawEvent)) {\n        editor.takeSnapshot();\n\n        editor.formatContentModel(\n            (model, context) => {\n                const result = deleteSelection(model, getInputSteps(selection, rawEvent), context);\n\n                // We have deleted selection then we will let browser to handle the input.\n                // With this combined operation, we don't wan to mass up the cached model so clear it\n                context.clearModelCache = true;\n\n                // Skip undo snapshot here and add undo snapshot before the operation so that we don't add another undo snapshot in middle of this replace operation\n                context.skipUndoSnapshot = true;\n\n                if (result.deleteResult == 'range') {\n                    // We have deleted something, next input should inherit the segment format from deleted content, so set pending format here\n                    context.newPendingFormat = result.insertPoint?.marker.format;\n\n                    normalizeContentModel(model);\n\n                    // Do not preventDefault since we still want browser to handle the final input for now\n                    return true;\n                } else {\n                    return false;\n                }\n            },\n            {\n                rawEvent,\n            }\n        );\n\n        return true;\n    }\n}\n\nfunction getInputSteps(selection: DOMSelection | null, rawEvent: KeyboardEvent) {\n    return shouldHandleEnterKey(selection, rawEvent) ? [handleEnterOnList, deleteEmptyQuote] : [];\n}\n\nfunction shouldInputWithContentModel(selection: DOMSelection | null, rawEvent: KeyboardEvent) {\n    if (!selection) {\n        return false; // Nothing to delete\n    } else if (\n        !isModifierKey(rawEvent) &&\n        (rawEvent.key == 'Enter' || rawEvent.key == 'Space' || rawEvent.key.length == 1)\n    ) {\n        return (\n            selection.type != 'range' ||\n            !selection.range.collapsed ||\n            shouldHandleEnterKey(selection, rawEvent)\n        );\n    } else {\n        return false;\n    }\n}\n\nconst shouldHandleEnterKey = (selection: DOMSelection | null, rawEvent: KeyboardEvent) => {\n    return selection && selection.type == 'range' && rawEvent.key == 'Enter' && !rawEvent.shiftKey;\n};\n","import { getOperationalBlocks, isBlockGroupOfType } from 'roosterjs-content-model-core';\nimport { handleTabOnList } from './tabUtils/handleTabOnList';\nimport { handleTabOnParagraph } from './tabUtils/handleTabOnParagraph';\nimport { setModelIndentation } from 'roosterjs-content-model-api';\nimport type {\n    ContentModelDocument,\n    ContentModelListItem,\n    IEditor,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function keyboardTab(editor: IEditor, rawEvent: KeyboardEvent) {\n    const selection = editor.getDOMSelection();\n\n    if (selection?.type == 'range') {\n        editor.formatContentModel(\n            model => {\n                return handleTab(model, rawEvent);\n            },\n            {\n                apiName: 'handleTabKey',\n            }\n        );\n\n        return true;\n    }\n}\n\n/**\n * If multiple blocks are selected, indent or outdent the selected blocks with setModelIndentation.\n * If only one block is selected, call handleTabOnParagraph or handleTabOnList to handle the tab key.\n */\nfunction handleTab(model: ContentModelDocument, rawEvent: KeyboardEvent) {\n    const blocks = getOperationalBlocks<ContentModelListItem>(model, ['ListItem'], ['TableCell']);\n    const block = blocks.length > 0 ? blocks[0].block : undefined;\n    if (blocks.length > 1) {\n        setModelIndentation(model, rawEvent.shiftKey ? 'outdent' : 'indent');\n        rawEvent.preventDefault();\n        return true;\n    } else if (block?.blockType === 'Paragraph') {\n        return handleTabOnParagraph(model, block, rawEvent);\n    } else if (isBlockGroupOfType<ContentModelListItem>(block, 'ListItem')) {\n        return handleTabOnList(model, block, rawEvent);\n    }\n    return false;\n}\n","import { handleTabOnParagraph } from './handleTabOnParagraph';\nimport { setModelIndentation } from 'roosterjs-content-model-api';\nimport type { ContentModelDocument, ContentModelListItem } from 'roosterjs-content-model-types';\n\n/**\n * 1. When the selection is collapsed and the cursor is at start of a list item, call setModelIndentation.\n * 2. Otherwise call handleTabOnParagraph.\n * @internal\n */\nexport function handleTabOnList(\n    model: ContentModelDocument,\n    listItem: ContentModelListItem,\n    rawEvent: KeyboardEvent\n) {\n    const selectedParagraph = findSelectedParagraph(listItem);\n    if (\n        !isMarkerAtStartOfBlock(listItem) &&\n        selectedParagraph.length == 1 &&\n        selectedParagraph[0].blockType === 'Paragraph'\n    ) {\n        return handleTabOnParagraph(model, selectedParagraph[0], rawEvent);\n    } else {\n        setModelIndentation(model, rawEvent.shiftKey ? 'outdent' : 'indent');\n        rawEvent.preventDefault();\n        return true;\n    }\n}\n\nfunction isMarkerAtStartOfBlock(listItem: ContentModelListItem) {\n    return (\n        listItem.blocks[0].blockType == 'Paragraph' &&\n        listItem.blocks[0].segments[0].segmentType == 'SelectionMarker'\n    );\n}\n\nfunction findSelectedParagraph(listItem: ContentModelListItem) {\n    return listItem.blocks.filter(\n        block =>\n            block.blockType == 'Paragraph' && block.segments.some(segment => segment.isSelected)\n    );\n}\n","import { createSelectionMarker, createText } from 'roosterjs-content-model-dom';\nimport { setModelIndentation } from 'roosterjs-content-model-api';\nimport type { ContentModelDocument, ContentModelParagraph } from 'roosterjs-content-model-types';\n\nconst tabSpaces = '';\nconst space = '';\n\n/**\n * @internal\n The handleTabOnParagraph function will handle the tab key in following scenarios:\n * 1. When the selection is collapsed and the cursor is at the end of a paragraph, add 4 spaces.\n * 2. When the selection is collapsed and the cursor is at the start of a paragraph, call setModelIndention function to indent the whole paragraph\n * 3. When the selection is collapsed and the cursor is at the middle of a paragraph, add 4 spaces.\n * 4. When the selection is not collapsed, replace the selected range with a single space.\n * 5. When the selection is not collapsed, but all segments are selected, call setModelIndention function to indent the whole paragraph\n The handleTabOnParagraph function will handle the shift + tab key in a indented paragraph in following scenarios:\n * 1. When the selection is collapsed and the cursor is at the end of a paragraph, remove 4 spaces.\n * 2. When the selection is collapsed and the cursor is at the start of a paragraph, call setModelIndention function to outdent the whole paragraph\n * 3. When the selection is collapsed and the cursor is at the middle of a paragraph, remove 4 spaces.\n * 4. When the selection is not collapsed, replace the selected range with a 4 space.\n * 5. When the selection is not collapsed, but all segments are selected, call setModelIndention function to outdent the whole paragraph\n */\nexport function handleTabOnParagraph(\n    model: ContentModelDocument,\n    paragraph: ContentModelParagraph,\n    rawEvent: KeyboardEvent\n) {\n    const selectedSegments = paragraph.segments.filter(segment => segment.isSelected);\n    const isCollapsed =\n        selectedSegments.length === 1 && selectedSegments[0].segmentType === 'SelectionMarker';\n    const isAllSelected = paragraph.segments.every(segment => segment.isSelected);\n    if ((paragraph.segments[0].segmentType === 'SelectionMarker' && isCollapsed) || isAllSelected) {\n        setModelIndentation(model, rawEvent.shiftKey ? 'outdent' : 'indent');\n    } else {\n        if (!isCollapsed) {\n            let firstSelectedSegmentIndex: number | undefined = undefined;\n            let lastSelectedSegmentIndex: number | undefined = undefined;\n\n            paragraph.segments.forEach((segment, index) => {\n                if (segment.isSelected) {\n                    if (!firstSelectedSegmentIndex) {\n                        firstSelectedSegmentIndex = index;\n                    }\n                    lastSelectedSegmentIndex = index;\n                }\n            });\n            if (firstSelectedSegmentIndex && lastSelectedSegmentIndex) {\n                const firstSelectedSegment = paragraph.segments[firstSelectedSegmentIndex];\n                const spaceText = createText(\n                    rawEvent.shiftKey ? tabSpaces : space,\n                    firstSelectedSegment.format\n                );\n                const marker = createSelectionMarker(firstSelectedSegment.format);\n                paragraph.segments.splice(\n                    firstSelectedSegmentIndex,\n                    lastSelectedSegmentIndex - firstSelectedSegmentIndex + 1,\n                    spaceText,\n                    marker\n                );\n            } else {\n                return false;\n            }\n        } else {\n            const markerIndex = paragraph.segments.findIndex(\n                segment => segment.segmentType === 'SelectionMarker'\n            );\n            if (!rawEvent.shiftKey) {\n                const markerFormat = paragraph.segments[markerIndex].format;\n                const tabText = createText(tabSpaces, markerFormat);\n                paragraph.segments.splice(markerIndex, 0, tabText);\n            } else {\n                const tabText = paragraph.segments[markerIndex - 1];\n                const tabSpacesLength = tabSpaces.length;\n                if (tabText.segmentType == 'Text') {\n                    const tabSpaceTextLength = tabText.text.length - tabSpacesLength;\n                    if (tabText.text === tabSpaces) {\n                        paragraph.segments.splice(markerIndex - 1, 1);\n                    } else if (tabText.text.substring(tabSpaceTextLength) === tabSpaces) {\n                        tabText.text = tabText.text.substring(0, tabSpaceTextLength);\n                    } else {\n                        return false;\n                    }\n                }\n            }\n        }\n    }\n\n    rawEvent.preventDefault();\n    return true;\n}\n","import { isGeneralSegment } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelParagraph,\n    ContentModelSegment,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport type BlockAndPath = {\n    /**\n     * The sibling block\n     */\n    block: ContentModelBlock;\n\n    /**\n     * Path of this sibling block\n     */\n    path: ContentModelBlockGroup[];\n\n    /**\n     * If the input block is under a general segment, it is possible there are sibling segments under the same paragraph.\n     * Use this property to return the sibling sibling under the same paragraph\n     */\n    siblingSegment?: ContentModelSegment;\n};\n\n/**\n * @internal\n */\nexport function getLeafSiblingBlock(\n    path: ContentModelBlockGroup[],\n    block: ContentModelBlock,\n    isNext: boolean\n): BlockAndPath | null {\n    const newPath = [...path];\n\n    while (newPath.length > 0) {\n        const group = newPath[0];\n        const index = group.blocks.indexOf(block);\n\n        if (index < 0) {\n            break;\n        }\n\n        let nextBlock = group.blocks[index + (isNext ? 1 : -1)];\n\n        if (nextBlock) {\n            while (nextBlock.blockType == 'BlockGroup') {\n                const child = nextBlock.blocks[isNext ? 0 : nextBlock.blocks.length - 1];\n\n                if (!child) {\n                    return { block: nextBlock, path: newPath };\n                } else if (child.blockType != 'BlockGroup') {\n                    newPath.unshift(nextBlock);\n                    return { block: child, path: newPath };\n                } else {\n                    newPath.unshift(nextBlock);\n                    nextBlock = child;\n                }\n            }\n\n            return { block: nextBlock, path: newPath };\n        } else if (isGeneralSegment(group)) {\n            // For general segment, we need to check if there is sibling segment under the same paragraph\n            // First let's find the parent paragraph of this segment\n            newPath.shift();\n\n            let segmentIndex = -1;\n            const segment = group;\n            const para = newPath[0]?.blocks.find(\n                x => x.blockType == 'Paragraph' && (segmentIndex = x.segments.indexOf(segment)) >= 0\n            ) as ContentModelParagraph;\n\n            if (para) {\n                // Now we have found the parent paragraph, so let's check if it has a sibling segment\n                const siblingSegment = para.segments[segmentIndex + (isNext ? 1 : -1)];\n\n                if (siblingSegment) {\n                    // Return this block, path and segment since we have found it\n                    return { block: para, path: newPath, siblingSegment };\n                } else {\n                    // No sibling segment, let's keep go upper level\n                    block = para;\n                }\n            } else {\n                // Parent sibling is not found (in theory this should never happen), just return null\n                break;\n            }\n        } else if (group.blockGroupType != 'Document' && group.blockGroupType != 'TableCell') {\n            newPath.shift();\n            block = group;\n        } else {\n            break;\n        }\n    }\n\n    return null;\n}\n","export { TableEditPlugin } from './tableEdit/TableEditPlugin';\nexport { PastePlugin } from './paste/PastePlugin';\nexport { EditPlugin } from './edit/EditPlugin';\nexport { AutoFormatPlugin, AutoFormatOptions } from './autoFormat/AutoFormatPlugin';\n\nexport {\n    ShortcutBold,\n    ShortcutItalic,\n    ShortcutUnderline,\n    ShortcutClearFormat,\n    ShortcutUndo,\n    ShortcutUndo2,\n    ShortcutRedo,\n    ShortcutRedoMacOS,\n    ShortcutBullet,\n    ShortcutNumbering,\n    ShortcutIncreaseFont,\n    ShortcutDecreaseFont,\n    ShortcutIndentList,\n    ShortcutOutdentList,\n} from './shortcut/shortcuts';\nexport { ShortcutPlugin } from './shortcut/ShortcutPlugin';\nexport { ShortcutKeyDefinition, ShortcutCommand } from './shortcut/ShortcutCommand';\nexport { ContextMenuPluginBase, ContextMenuOptions } from './contextMenuBase/ContextMenuPluginBase';\nexport { WatermarkPlugin } from './watermark/WatermarkPlugin';\nexport { WatermarkFormat } from './watermark/WatermarkFormat';\n","import { addParser } from '../utils/addParser';\nimport { isNodeOfType, moveChildNodes } from 'roosterjs-content-model-dom';\nimport { setProcessor } from '../utils/setProcessor';\nimport type { BeforePasteEvent, TrustedHTMLHandler } from 'roosterjs-content-model-types';\n\nconst LAST_TD_END_REGEX = /<\\/\\s*td\\s*>((?!<\\/\\s*tr\\s*>)[\\s\\S])*$/i;\nconst LAST_TR_END_REGEX = /<\\/\\s*tr\\s*>((?!<\\/\\s*table\\s*>)[\\s\\S])*$/i;\nconst LAST_TR_REGEX = /<tr[^>]*>[^<]*/i;\nconst LAST_TABLE_REGEX = /<table[^>]*>[^<]*/i;\nconst DEFAULT_BORDER_STYLE = 'solid 1px #d4d4d4';\n\n/**\n * @internal\n * Convert pasted content from Excel, add borders when source doc doesn't have a border\n * @param event The BeforePaste event\n */\n\nexport function processPastedContentFromExcel(\n    event: BeforePasteEvent,\n    trustedHTMLHandler: TrustedHTMLHandler,\n    allowExcelNoBorderTable?: boolean\n) {\n    const { fragment, htmlBefore, clipboardData } = event;\n    const html = clipboardData.html ? excelHandler(clipboardData.html, htmlBefore) : undefined;\n\n    if (html && clipboardData.html != html) {\n        const doc = new DOMParser().parseFromString(trustedHTMLHandler(html), 'text/html');\n        moveChildNodes(fragment, doc?.body);\n    }\n\n    // For Excel Online\n    const firstChild = fragment.firstChild;\n    if (\n        isNodeOfType(firstChild, 'ELEMENT_NODE') &&\n        firstChild.tagName == 'div' &&\n        firstChild.firstChild\n    ) {\n        const tableFound = Array.from(firstChild.childNodes).every((child: Node) => {\n            // Tables pasted from Excel Online should be of the format: 0 to N META tags and 1 TABLE tag\n            const tagName = isNodeOfType(child, 'ELEMENT_NODE') && child.tagName;\n\n            return tagName == 'META'\n                ? true\n                : tagName == 'TABLE'\n                ? child == firstChild.lastChild\n                : false;\n        });\n\n        // Extract Table from Div\n        if (tableFound && firstChild.lastChild) {\n            event.fragment.replaceChildren(firstChild.lastChild);\n        }\n    }\n\n    addParser(event.domToModelOption, 'tableCell', (format, element) => {\n        if (!allowExcelNoBorderTable && element.style.borderStyle === 'none') {\n            format.borderBottom = DEFAULT_BORDER_STYLE;\n            format.borderLeft = DEFAULT_BORDER_STYLE;\n            format.borderRight = DEFAULT_BORDER_STYLE;\n            format.borderTop = DEFAULT_BORDER_STYLE;\n        }\n    });\n\n    setProcessor(event.domToModelOption, 'child', (group, element, context) => {\n        const segmentFormat = { ...context.segmentFormat };\n        if (group.blockGroupType === 'TableCell' && group.format.textColor) {\n            context.segmentFormat.textColor = group.format.textColor;\n        }\n\n        context.defaultElementProcessors.child(group, element, context);\n\n        if (group.blockGroupType === 'TableCell' && group.format.textColor) {\n            context.segmentFormat = segmentFormat;\n            delete group.format.textColor;\n        }\n    });\n}\n\n/**\n * @internal Export for test only\n * @param html Source html\n */\n\nexport function excelHandler(html: string, htmlBefore: string): string {\n    if (html.match(LAST_TD_END_REGEX)) {\n        const trMatch = htmlBefore.match(LAST_TR_REGEX);\n        const tr = trMatch ? trMatch[0] : '<TR>';\n        html = tr + html + '</TR>';\n    }\n    if (html.match(LAST_TR_END_REGEX)) {\n        const tableMatch = htmlBefore.match(LAST_TABLE_REGEX);\n        const table = tableMatch ? tableMatch[0] : '<TABLE>';\n        html = table + html + '</TABLE>';\n    }\n\n    return html;\n}\n","import { addParser } from './utils/addParser';\nimport { BorderKeys } from 'roosterjs-content-model-dom';\nimport { deprecatedBorderColorParser } from './utils/deprecatedColorParser';\nimport { getPasteSource } from './pasteSourceValidations/getPasteSource';\nimport { parseLink } from './utils/linkParser';\nimport { PastePropertyNames } from './pasteSourceValidations/constants';\nimport { processPastedContentFromExcel } from './Excel/processPastedContentFromExcel';\nimport { processPastedContentFromPowerPoint } from './PowerPoint/processPastedContentFromPowerPoint';\nimport { processPastedContentFromWordDesktop } from './WordDesktop/processPastedContentFromWordDesktop';\nimport { processPastedContentWacComponents } from './WacComponents/processPastedContentWacComponents';\nimport type {\n    BorderFormat,\n    ContentModelBlockFormat,\n    ContentModelTableCellFormat,\n    EditorPlugin,\n    FormatParser,\n    IEditor,\n    PluginEvent,\n} from 'roosterjs-content-model-types';\n\n/**\n * Paste plugin, handles BeforePaste event and reformat some special content, including:\n * 1. Content copied from Word\n * 2. Content copied from Excel\n * 3. Content copied from Word Online or OneNote Online\n * 4. Content copied from Power Point\n */\nexport class PastePlugin implements EditorPlugin {\n    private editor: IEditor | null = null;\n\n    /**\n     * Construct a new instance of Paste class\n     * @param unknownTagReplacement Replace solution of unknown tags, default behavior is to replace with SPAN\n     * @param allowExcelNoBorderTable Allow table copied from Excel without border\n     */\n    constructor(private allowExcelNoBorderTable?: boolean) {}\n\n    /**\n     * Get name of this plugin\n     */\n    getName() {\n        return 'Paste';\n    }\n\n    /**\n     * The first method that editor will call to a plugin when editor is initializing.\n     * It will pass in the editor instance, plugin should take this chance to save the\n     * editor reference so that it can call to any editor method or format API later.\n     * @param editor The editor object\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n    }\n\n    /**\n     * The last method that editor will call to a plugin before it is disposed.\n     * Plugin can take this chance to clear the reference to editor. After this method is\n     * called, plugin should not call to any editor method since it will result in error.\n     */\n    dispose() {\n        this.editor = null;\n    }\n\n    /**\n     * Core method for a plugin. Once an event happens in editor, editor will call this\n     * method of each plugin to handle the event as long as the event is not handled\n     * exclusively by another plugin.\n     * @param event The event to handle:\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (!this.editor || event.eventType != 'beforePaste') {\n            return;\n        }\n\n        if (!event.domToModelOption) {\n            return;\n        }\n\n        const pasteSource = getPasteSource(event, false);\n        const pasteType = event.pasteType;\n\n        switch (pasteSource) {\n            case 'wordDesktop':\n                processPastedContentFromWordDesktop(event, this.editor.getTrustedHTMLHandler());\n                break;\n            case 'wacComponents':\n                processPastedContentWacComponents(event);\n                break;\n            case 'excelOnline':\n            case 'excelDesktop':\n                if (pasteType === 'normal' || pasteType === 'mergeFormat') {\n                    // Handle HTML copied from Excel\n                    processPastedContentFromExcel(\n                        event,\n                        this.editor.getTrustedHTMLHandler(),\n                        this.allowExcelNoBorderTable\n                    );\n                }\n                break;\n            case 'googleSheets':\n                event.domToModelOption.additionalAllowedTags.push(\n                    PastePropertyNames.GOOGLE_SHEET_NODE_NAME as Lowercase<string>\n                );\n                break;\n            case 'powerPointDesktop':\n                processPastedContentFromPowerPoint(event, this.editor.getTrustedHTMLHandler());\n                break;\n        }\n\n        addParser(event.domToModelOption, 'link', parseLink);\n        addParser(event.domToModelOption, 'tableCell', deprecatedBorderColorParser);\n        addParser(event.domToModelOption, 'tableCell', tableBorderParser);\n        addParser(event.domToModelOption, 'table', deprecatedBorderColorParser);\n\n        if (pasteType === 'mergeFormat') {\n            addParser(event.domToModelOption, 'block', blockElementParser);\n            addParser(event.domToModelOption, 'listLevel', blockElementParser);\n        }\n    }\n}\n\n/**\n * For block elements that have background color style, remove the background color when user selects the merge current format\n * paste option\n */\nconst blockElementParser: FormatParser<ContentModelBlockFormat> = (\n    format: ContentModelBlockFormat,\n    element: HTMLElement\n) => {\n    if (element.style.backgroundColor) {\n        delete format.backgroundColor;\n    }\n};\n\nconst ElementBorderKeys = new Map<\n    keyof BorderFormat,\n    {\n        c: keyof CSSStyleDeclaration;\n        s: keyof CSSStyleDeclaration;\n        w: keyof CSSStyleDeclaration;\n    }\n>([\n    ['borderTop', { w: 'borderTopWidth', s: 'borderTopStyle', c: 'borderTopColor' }],\n    ['borderRight', { w: 'borderRightWidth', s: 'borderRightStyle', c: 'borderRightColor' }],\n    ['borderBottom', { w: 'borderBottomWidth', s: 'borderBottomStyle', c: 'borderBottomColor' }],\n    ['borderLeft', { w: 'borderLeftWidth', s: 'borderLeftStyle', c: 'borderLeftColor' }],\n]);\n\nfunction tableBorderParser(format: ContentModelTableCellFormat, element: HTMLElement): void {\n    BorderKeys.forEach(key => {\n        if (!format[key]) {\n            const styleSet = ElementBorderKeys.get(key);\n            if (\n                styleSet &&\n                element.style[styleSet.w] &&\n                element.style[styleSet.s] &&\n                !element.style[styleSet.c]\n            ) {\n                format[key] = `${element.style[styleSet.w]} ${element.style[styleSet.s]}`;\n            }\n        }\n    });\n}\n","import { moveChildNodes } from 'roosterjs-content-model-dom';\nimport type { BeforePasteEvent, TrustedHTMLHandler } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Convert pasted content from PowerPoint\n * @param event The BeforePaste event\n */\n\nexport function processPastedContentFromPowerPoint(\n    event: BeforePasteEvent,\n    trustedHTMLHandler: TrustedHTMLHandler\n) {\n    const { fragment, clipboardData } = event;\n\n    if (clipboardData.html && !clipboardData.text && clipboardData.image) {\n        // It is possible that PowerPoint copied both image and HTML but not plain text.\n        // We always prefer HTML if any.\n        const doc = new DOMParser().parseFromString(\n            trustedHTMLHandler(clipboardData.html),\n            'text/html'\n        );\n\n        moveChildNodes(fragment, doc?.body);\n    }\n}\n","/**\n * @internal\n **/\nexport const WORD_ONLINE_TABLE_TEMP_ELEMENT_CLASSES: string[] = [\n    'TableInsertRowGapBlank',\n    'TableColumnResizeHandle',\n    'TableCellTopBorderHandle',\n    'TableCellLeftBorderHandle',\n    'TableHoverColumnHandle',\n    'TableHoverRowHandle',\n];\n/**\n * @internal\n **/\nexport const BULLET_LIST_STYLE: string = 'BulletListStyle';\n/**\n * @internal\n **/\nexport const NUMBER_LIST_STYLE: string = 'NumberListStyle';\n/**\n * @internal\n **/\nexport const IMAGE_BORDER: string = 'WACImageBorder';\n/**\n * @internal\n **/\nexport const IMAGE_CONTAINER: string = 'WACImageContainer';\n/**\n * @internal\n **/\nexport const OUTLINE_ELEMENT: string = 'OutlineElement';\n/**\n * @internal\n **/\nexport const PARAGRAPH: string = 'Paragraph';\n/**\n * @internal\n **/\nexport const LIST_CONTAINER_ELEMENT_CLASS_NAME: string = 'ListContainerWrapper';\n/**\n * @internal\n **/\nexport const COMMENT_HIGHLIGHT_CLASS: string = 'CommentHighlightRest';\n/**\n * @internal\n **/\nexport const COMMENT_HIGHLIGHT_CLICKED_CLASS: string = 'CommentHighlightClicked';\n/**\n * @internal\n **/\nexport const TEMP_ELEMENTS_CLASSES: string[] = [\n    ...WORD_ONLINE_TABLE_TEMP_ELEMENT_CLASSES,\n    'ListMarkerWrappingSpan',\n];\n/**\n * @internal\n **/\nexport const WAC_IDENTIFY_SELECTOR: string =\n    `ul[class^=\"${BULLET_LIST_STYLE}\"]>.${OUTLINE_ELEMENT},ol[class^=\"${NUMBER_LIST_STYLE}\"]>.${OUTLINE_ELEMENT},span.${IMAGE_CONTAINER},span.${IMAGE_BORDER},.${COMMENT_HIGHLIGHT_CLASS},.${COMMENT_HIGHLIGHT_CLICKED_CLASS},` +\n    WORD_ONLINE_TABLE_TEMP_ELEMENT_CLASSES.map(c => `table div[class^=\"${c}\"]`).join(',');\n","import { addParser } from '../utils/addParser';\nimport { createListLevel, parseFormat } from 'roosterjs-content-model-dom';\nimport { setProcessor } from '../utils/setProcessor';\nimport {\n    COMMENT_HIGHLIGHT_CLASS,\n    COMMENT_HIGHLIGHT_CLICKED_CLASS,\n    LIST_CONTAINER_ELEMENT_CLASS_NAME,\n    TEMP_ELEMENTS_CLASSES,\n    WAC_IDENTIFY_SELECTOR,\n} from './constants';\nimport type {\n    BeforePasteEvent,\n    ContentModelBlockFormat,\n    ContentModelBlockGroup,\n    ContentModelListItemLevelFormat,\n    ContentModelListLevel,\n    ContentModelSegmentFormat,\n    DomToModelContext,\n    DomToModelListFormat,\n    ElementProcessor,\n    FormatParser,\n} from 'roosterjs-content-model-types';\n\nconst LIST_ELEMENT_TAGS = ['UL', 'OL', 'LI'];\nconst LIST_ELEMENT_SELECTOR = LIST_ELEMENT_TAGS.join(',');\n\ninterface WacContext extends DomToModelListFormat {\n    /**\n     * Current list levels\n     */\n    currentListLevels?: ContentModelListLevel[];\n    /**\n     * Array to keep the start of the lists and determine if the start override should be set.\n     */\n    listItemThread?: number[];\n}\n\n/**\n * Wac components do not use sub and super tags, instead only add vertical align to a span.\n * This parser normalize the content for content model\n */\nconst wacSubSuperParser: FormatParser<ContentModelSegmentFormat> = (\n    format: ContentModelSegmentFormat,\n    element: HTMLElement\n): void => {\n    const verticalAlign = element.style.verticalAlign;\n    if (verticalAlign === 'super') {\n        format.superOrSubScriptSequence = 'super';\n    }\n    if (verticalAlign === 'sub') {\n        format.superOrSubScriptSequence = 'sub';\n    }\n};\n\n/**\n * This processor does:\n * 1) Remove the display and margin of the element.\n * 2) When an element should be ignored but should handle the child elements call the default child processor.\n * 3) Removes the End of Paragraph element to avoid empty lines, we should only remove this if the previous element of the EOP is an EmptyTextRun\n * 4) Finally call the default processor.\n * @returns\n */\nconst wacElementProcessor: ElementProcessor<HTMLElement> = (\n    group: ContentModelBlockGroup,\n    element: HTMLElement,\n    context: DomToModelContext\n): void => {\n    const elementTag = element.tagName;\n\n    if (element.matches(WAC_IDENTIFY_SELECTOR)) {\n        element.style.removeProperty('display');\n        element.style.removeProperty('margin');\n    }\n\n    if (element.classList.contains(LIST_CONTAINER_ELEMENT_CLASS_NAME)) {\n        context.elementProcessors.child(group, element, context);\n        return;\n    }\n\n    if (TEMP_ELEMENTS_CLASSES.some(className => element.classList.contains(className))) {\n        return;\n    } else if (shouldClearListContext(elementTag, element, context)) {\n        const { listFormat } = context;\n        listFormat.levels = [];\n        listFormat.listParent = undefined;\n    }\n\n    context.defaultElementProcessors.element(group, element, context);\n};\n\n/**\n * This processor calls the default list processor and then sets the correct list level and list bullet.\n */\nconst wacLiElementProcessor: ElementProcessor<HTMLLIElement> = (\n    group: ContentModelBlockGroup,\n    element: HTMLLIElement,\n    context: DomToModelContext\n): void => {\n    const level = parseInt(element.getAttribute('data-aria-level') ?? '');\n    const listFormat = context.listFormat as WacContext;\n    const listType =\n        listFormat.levels[context.listFormat.levels.length - 1]?.listType ||\n        (element.closest('ol,ul')?.tagName.toUpperCase() as 'UL' | 'OL');\n    const newLevel: ContentModelListLevel = createListLevel(listType, context.blockFormat);\n    parseFormat(element, context.formatParsers.listLevelThread, newLevel.format, context);\n    parseFormat(element, context.formatParsers.listLevel, newLevel.format, context);\n    context.listFormat.levels = listFormat.currentListLevels || context.listFormat.levels;\n\n    if (level > 0) {\n        if (level > context.listFormat.levels.length) {\n            while (level != context.listFormat.levels.length) {\n                context.listFormat.levels.push(newLevel);\n            }\n        } else {\n            context.listFormat.levels.splice(level, context.listFormat.levels.length - 1);\n            context.listFormat.levels[level - 1] = newLevel;\n        }\n    }\n\n    context.defaultElementProcessors.li?.(group, element, context);\n\n    const listParent = listFormat.listParent;\n    if (listParent) {\n        const lastblock = listParent.blocks[listParent.blocks.length - 1];\n        if (lastblock.blockType == 'BlockGroup' && lastblock.blockGroupType == 'ListItem') {\n            const currentLevel = lastblock.levels[lastblock.levels.length - 1];\n            updateStartOverride(currentLevel, element, context);\n        }\n    }\n\n    const newLevels: ContentModelListLevel[] = [];\n    listFormat.levels.forEach(v => {\n        const newValue: ContentModelListLevel = {\n            dataset: { ...v.dataset },\n            format: { ...v.format },\n            listType: v.listType,\n        };\n        newLevels.push(newValue);\n    });\n    listFormat.currentListLevels = newLevels;\n    listFormat.levels = [];\n};\n\n/**\n * This parsers does:\n * 1) Sets the display for dummy item to undefined when the current style is block.\n * 2) Removes the Margin Left\n */\nconst wacListItemParser: FormatParser<ContentModelListItemLevelFormat> = (\n    format: ContentModelListItemLevelFormat,\n    element: HTMLElement\n): void => {\n    if (element.style.display === 'block') {\n        format.displayForDummyItem = undefined;\n    }\n\n    format.marginLeft = undefined;\n};\n\n/**\n * Wac usually adds padding to lists which is unwanted so remove it.\n */\nconst wacListLevelParser: FormatParser<ContentModelListItemLevelFormat> = (\n    format: ContentModelListItemLevelFormat\n): void => {\n    format.marginLeft = undefined;\n    format.paddingLeft = undefined;\n};\n\n/**\n * This function returns whether we need to clear the list format.\n * Word Online wraps lists inside divs to have this structure:\n *\n *  <div class='ListContainerWrapper'>\n *      <ol>...</ol>\n *  </div>\n *  <div>\n *      <p>...</p>\n *  <div>\n *  <div class='ListContainerWrapper'>\n *      <ol>...</ol>\n *  </div>\n *\n *  So if a elements is not contained inside of a list we should clear the list context to prevent normal text to be\n *  transformed into list\n *  For the above scenario, if we do not clear the format, the content inside of the second div would be transformed to a list too.\n */\nfunction shouldClearListContext(\n    elementTag: string,\n    element: HTMLElement,\n    context: DomToModelContext\n) {\n    return (\n        context.listFormat.levels.length > 0 &&\n        LIST_ELEMENT_TAGS.every(tag => tag != elementTag) &&\n        !element.closest(LIST_ELEMENT_SELECTOR)\n    );\n}\n\nconst wacCommentParser: FormatParser<ContentModelSegmentFormat> = (\n    format: ContentModelSegmentFormat,\n    element: HTMLElement\n): void => {\n    if (\n        element.className.includes(COMMENT_HIGHLIGHT_CLASS) ||\n        element.className.includes(COMMENT_HIGHLIGHT_CLICKED_CLASS)\n    ) {\n        delete format.backgroundColor;\n    }\n};\n/**\n * @internal\n * Convert pasted content from Office Online\n * Once it is known that the document is from WAC\n * We need to remove the display property and margin from all the list item\n * @param ev BeforePasteEvent\n */\nexport function processPastedContentWacComponents(ev: BeforePasteEvent) {\n    addParser(ev.domToModelOption, 'segment', wacSubSuperParser);\n    addParser(ev.domToModelOption, 'listItemThread', wacListItemParser);\n    addParser(ev.domToModelOption, 'listLevel', wacListLevelParser);\n    addParser(ev.domToModelOption, 'container', wacContainerParser);\n    addParser(ev.domToModelOption, 'table', wacContainerParser);\n    addParser(ev.domToModelOption, 'segment', wacCommentParser);\n\n    setProcessor(ev.domToModelOption, 'element', wacElementProcessor);\n    setProcessor(ev.domToModelOption, 'li', wacLiElementProcessor);\n}\n\nconst wacContainerParser: FormatParser<ContentModelBlockFormat> = (\n    format: ContentModelBlockFormat,\n    element: HTMLElement\n) => {\n    if (element.style.marginLeft.startsWith('-')) {\n        delete format.marginLeft;\n    }\n};\n\nfunction updateStartOverride(\n    currentLevel: ContentModelListLevel | undefined,\n    element: HTMLLIElement,\n    ctx: DomToModelContext\n) {\n    if (!currentLevel || currentLevel.listType == 'UL') {\n        return;\n    }\n\n    const list = element.closest('ol');\n    const listFormat = ctx.listFormat as WacContext;\n    const [start, listLevel] = extractWordListMetadata(list, element);\n\n    if (!listFormat.listItemThread) {\n        listFormat.listItemThread = [];\n    }\n\n    const thread: number | undefined = listFormat.listItemThread[listLevel];\n    if (thread && start - thread != 1) {\n        currentLevel.format.startNumberOverride = start;\n    }\n    listFormat.listItemThread[listLevel] = start;\n}\nfunction extractWordListMetadata(\n    list: HTMLElement | null | undefined,\n    item: HTMLElement | null | undefined\n) {\n    const itemIndex =\n        item && Array.from(list?.querySelectorAll('li') || []).indexOf(item as HTMLLIElement);\n    const start =\n        parseInt(list?.getAttribute('start') || '1') + (itemIndex && itemIndex > 0 ? itemIndex : 0);\n    const listLevel = parseInt(item?.getAttribute('data-aria-level') || '');\n\n    return [start, listLevel];\n}\n","import { getObjectKeys } from 'roosterjs-content-model-dom';\nimport type { WordMetadata } from './WordMetadata';\nimport type { BeforePasteEvent } from 'roosterjs-content-model-types';\n\nconst FORMATING_REGEX = /[\\n\\t'{}\"]+/g;\n\n/**\n * @internal\n * Word Desktop content has a style tag that contains data for the lists.\n * So this function query that style tag and extract the data from the innerHTML, since it is not available from the HTMLStyleElement.sheet.\n *\n * The format is like:\n * example of style element content\n * @list l0:level1 {\n * styleTag: styleValue;\n * ...\n * }\n *\n * To extract the data:\n * 1. Substring the value of the style selector, using @ index and { index\n * 2. Substring the value of the style rules by Substring the content between { and }\n * 3. Split the value of the rules using ; as separator { styleTag: styleValue; styleTag1: StyleValue1 } = ['styleTag: styleValue',  'styleTag1: StyleValue1']\n * 4. Split the value of the rule  using : as separator: styleTag: styleValue = [styleTag, styleValue]\n * 5. Save data in record and only use the required information.\n *\n */\nexport function getStyleMetadata(\n    ev: BeforePasteEvent,\n    trustedHTMLHandler: (val: string) => string\n) {\n    const metadataMap: Map<string, WordMetadata> = new Map();\n    const doc = new DOMParser().parseFromString(trustedHTMLHandler(ev.htmlBefore), 'text/html');\n    const styles = doc.querySelectorAll('style');\n\n    styles.forEach(style => {\n        const text = style?.innerHTML.trim() || '';\n\n        let index = 0;\n        while (index >= 0) {\n            const indexAt = text.indexOf('@', index + 1);\n            const indexCurlyEnd = text.indexOf('}', indexAt);\n            const indexCurlyStart = text.indexOf('{', indexAt);\n            index = indexAt;\n\n            // 1.\n            const metadataName = text\n                .substring(indexAt + 1, indexCurlyStart)\n                .replace(FORMATING_REGEX, '')\n                .replace('list', '')\n                .trimRight()\n                .trimLeft();\n\n            // 2.\n            const dataName = text\n                .substring(indexCurlyStart, indexCurlyEnd + 1)\n                .trimLeft()\n                .trimRight();\n            const record: Record<string, string> = {};\n\n            // 3.\n            const entries = dataName.split(';');\n            entries.forEach(entry => {\n                // 4.\n                const [key, value] = entry.split(':');\n                if (key && value) {\n                    const formatedKey = key.replace(FORMATING_REGEX, '').trimRight().trimLeft();\n                    const formatedValue = value.replace(FORMATING_REGEX, '').trimRight().trimLeft();\n                    // 5.\n                    record[formatedKey] = formatedValue;\n                }\n            });\n\n            const data: WordMetadata = {\n                'mso-level-number-format': record['mso-level-number-format'],\n                'mso-level-start-at': record['mso-level-start-at'] || '1',\n                'mso-level-text': record['mso-level-text'],\n            };\n            if (getObjectKeys(data).some(key => !!data[key])) {\n                metadataMap.set(metadataName, data);\n            }\n        }\n    });\n    return metadataMap;\n}\n","import { addParser } from '../utils/addParser';\nimport { getStyleMetadata } from './getStyleMetadata';\nimport { getStyles } from '../utils/getStyles';\nimport { processWordComments } from './processWordComments';\nimport { processWordList } from './processWordLists';\nimport { removeNegativeTextIndentParser } from './removeNegativeTextIndentParser';\nimport { setProcessor } from '../utils/setProcessor';\nimport type { WordMetadata } from './WordMetadata';\nimport type {\n    BeforePasteEvent,\n    ContentModelListItemLevelFormat,\n    ContentModelTableFormat,\n    DomToModelContext,\n    ElementProcessor,\n    FormatParser,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Handles Pasted content when source is Word Desktop\n * @param ev BeforePasteEvent\n */\nexport function processPastedContentFromWordDesktop(\n    ev: BeforePasteEvent,\n    trustedHTMLHandler: (text: string) => string\n) {\n    const metadataMap: Map<string, WordMetadata> = getStyleMetadata(ev, trustedHTMLHandler);\n\n    setProcessor(ev.domToModelOption, 'element', wordDesktopElementProcessor(metadataMap));\n    addParser(ev.domToModelOption, 'block', removeNegativeTextIndentParser);\n    addParser(ev.domToModelOption, 'listLevel', listLevelParser);\n    addParser(ev.domToModelOption, 'container', wordTableParser);\n    addParser(ev.domToModelOption, 'table', wordTableParser);\n}\n\nconst wordDesktopElementProcessor = (\n    metadataKey: Map<string, WordMetadata>\n): ElementProcessor<HTMLElement> => {\n    return (group, element, context) => {\n        const styles = getStyles(element);\n        // Process Word Lists or Word Commands, otherwise use the default processor on this element.\n        if (\n            !(\n                processWordList(styles, group, element, context, metadataKey) ||\n                processWordComments(styles, element)\n            )\n        ) {\n            context.defaultElementProcessors.element(group, element, context);\n        }\n    };\n};\n\nfunction listLevelParser(\n    format: ContentModelListItemLevelFormat,\n    element: HTMLElement,\n    context: DomToModelContext,\n    defaultStyle: Readonly<Partial<CSSStyleDeclaration>>\n): void {\n    if (element.style.marginLeft != '') {\n        format.marginLeft = defaultStyle.marginLeft;\n    }\n\n    format.marginBottom = undefined;\n}\n\nconst wordTableParser: FormatParser<ContentModelTableFormat> = (format): void => {\n    if (format.marginLeft?.startsWith('-')) {\n        delete format.marginLeft;\n    }\n};\n","import { isElementOfType } from 'roosterjs-content-model-dom';\n\nconst MSO_COMMENT_ANCHOR_HREF_REGEX = /#_msocom_/;\nconst MSO_SPECIAL_CHARACTER = 'mso-special-character';\nconst MSO_SPECIAL_CHARACTER_COMMENT = 'comment';\nconst MSO_ELEMENT = 'mso-element';\nconst MSO_ELEMENT_COMMENT_LIST = 'comment-list';\n\n/**\n * @internal\n * Check whether the element contain Word attributes related to comments and if it does we should no process\n * this element.\n * @returns\n */\nexport function processWordComments(styles: Record<string, string>, element: HTMLElement) {\n    return (\n        styles[MSO_SPECIAL_CHARACTER] == MSO_SPECIAL_CHARACTER_COMMENT ||\n        (isElementOfType(element, 'a') && MSO_COMMENT_ANCHOR_HREF_REGEX.test(element.href)) ||\n        styles[MSO_ELEMENT] == MSO_ELEMENT_COMMENT_LIST\n    );\n}\n","import { getListStyleTypeFromString, updateListMetadata } from 'roosterjs-content-model-core';\nimport { removeNegativeTextIndentParser } from './removeNegativeTextIndentParser';\nimport type { WordMetadata } from './WordMetadata';\nimport {\n    addBlock,\n    createListItem,\n    createListLevel,\n    isEmpty,\n    parseFormat,\n} from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelListItem,\n    ContentModelListItemFormat,\n    ContentModelListItemLevelFormat,\n    ContentModelListLevel,\n    DomToModelContext,\n    DomToModelListFormat,\n} from 'roosterjs-content-model-types';\n\n/** Word list metadata style name */\nconst MSO_LIST = 'mso-list';\nconst MSO_LIST_IGNORE = 'ignore';\nconst WORD_FIRST_LIST = 'l0';\nconst TEMPLATE_VALUE_REGEX = /%[0-9a-zA-Z]+/g;\n\ninterface WordDesktopListFormat extends DomToModelListFormat {\n    wordLevel?: number | '';\n    wordList?: string;\n    wordKnownLevels?: Map<string, ContentModelListLevel[]>;\n}\n\ninterface WordListFormat extends ContentModelListItemFormat {\n    wordList?: string;\n}\n\nconst BULLET_METADATA = 'bullet';\n/**\n * @internal\n * @param styles\n * @param group\n * @param element\n * @param context\n * @returns\n */\nexport function processWordList(\n    styles: Record<string, string>,\n    group: ContentModelBlockGroup,\n    element: HTMLElement,\n    context: DomToModelContext,\n    metadata: Map<string, WordMetadata>\n) {\n    const listFormat = context.listFormat as WordDesktopListFormat;\n    if (!listFormat.wordKnownLevels) {\n        listFormat.wordKnownLevels = new Map<string, ContentModelListLevel[]>();\n    }\n    const wordListStyle = styles[MSO_LIST] || '';\n\n    // If the element contains Ignore style, do not process it,\n    // Usually this element contains the fake bullet used in Word Desktop.\n    if (wordListStyle.toLowerCase() === MSO_LIST_IGNORE) {\n        return true;\n    }\n\n    const [lNumber, level] = wordListStyle.split(' ');\n    // Try get the list metadata from word, which follows this format: l1 level1 lfo2\n    // If we are able to get the level property means we can process this element to be a list\n    listFormat.wordLevel = level && parseInt(level.substr('level'.length));\n\n    listFormat.wordList = lNumber || WORD_FIRST_LIST;\n    if (listFormat.levels.length == 0) {\n        listFormat.levels =\n            (listFormat.wordList && listFormat.wordKnownLevels.get(listFormat.wordList)) || [];\n    }\n\n    if (wordListStyle && group && typeof listFormat.wordLevel === 'number') {\n        const { wordLevel, wordList } = listFormat;\n        // Retrieve the Fake bullet on the element and also the list type\n        const listMetadata = metadata.get(`${lNumber}:${level}`);\n        const listType =\n            listMetadata?.['mso-level-number-format']?.toLowerCase() != BULLET_METADATA\n                ? 'OL'\n                : 'UL';\n\n        // Create the new level of the list item and parse the format\n        const newLevel: ContentModelListLevel = createListLevel(listType);\n        parseFormat(\n            element,\n            [...context.formatParsers.listLevel, wordListPaddingParser],\n            newLevel.format,\n            context\n        );\n\n        // If the list format is in a different level, update the array so we get the new item\n        // To be in the same level as the provided level metadata.\n        if (wordLevel > listFormat.levels.length) {\n            while (wordLevel != listFormat.levels.length) {\n                listFormat.levels.push(newLevel);\n            }\n        } else {\n            listFormat.levels.splice(wordLevel, listFormat.levels.length - 1);\n            listFormat.levels[wordLevel - 1] = newLevel;\n        }\n        (listFormat.levels[listFormat.levels.length - 1]\n            .format as WordListFormat).wordList = wordList;\n\n        listFormat.listParent = group;\n\n        processAsListItem(listFormat, context, element, group, listMetadata);\n\n        if (\n            listFormat.levels.length > 0 &&\n            listFormat.wordKnownLevels.get(wordList) != listFormat.levels\n        ) {\n            listFormat.wordKnownLevels.set(wordList, [...listFormat.levels]);\n        }\n        return true;\n    }\n\n    return false;\n}\n\nfunction processAsListItem(\n    listFormat: WordDesktopListFormat,\n    context: DomToModelContext,\n    element: HTMLElement,\n    group: ContentModelBlockGroup,\n    listMetadata: WordMetadata | undefined\n) {\n    const listLevel = listFormat.levels[listFormat.levels.length - 1];\n    const { listType } = listLevel;\n    const bullet = getBulletFromMetadata(listMetadata, listType);\n    if (bullet) {\n        updateListMetadata(listFormat.levels[listFormat.levels.length - 1], metadata =>\n            Object.assign({}, metadata, {\n                unorderedStyleType: listType == 'UL' ? bullet : undefined,\n                orderedStyleType: listType == 'OL' ? bullet : undefined,\n            })\n        );\n    }\n\n    const listItem = createListItem(listFormat.levels, context.segmentFormat);\n\n    parseFormat(element, context.formatParsers.segmentOnBlock, context.segmentFormat, context);\n    parseFormat(element, context.formatParsers.listItemElement, listItem.format, context);\n    parseFormat(element, [removeNegativeTextIndentParser], listItem.format, context);\n\n    if (listType == 'OL') {\n        setStartNumber(listItem, context, listMetadata);\n    }\n\n    context.elementProcessors.child(listItem, element, context);\n    addBlock(group, listItem);\n}\n\nfunction getBulletFromMetadata(listMetadata: WordMetadata | undefined, listType: 'OL' | 'UL') {\n    const templateType = listMetadata?.['mso-level-number-format'] || 'decimal';\n    let templateFinal: string;\n\n    if (listMetadata?.['mso-level-text']) {\n        let templateValue: string = '';\n        switch (templateType) {\n            case 'alpha-upper':\n                templateValue = 'UpperAlpha';\n                break;\n            case 'alpha-lower':\n                templateValue = 'LowerAlpha';\n                break;\n            case 'roman-lower':\n                templateValue = 'LowerRoman';\n                break;\n            case 'roman-upper':\n                templateValue = 'UpperRoman';\n                break;\n            default:\n                templateValue = 'Number';\n                break;\n        }\n        const template = (listMetadata['mso-level-text'] || '')\n            .replace('\\\\', '')\n            .replace('\"', '')\n            .replace(TEMPLATE_VALUE_REGEX, '${' + templateValue + '}');\n\n        templateFinal = '\"' + template + ' \"';\n    } else {\n        switch (templateType) {\n            case 'alpha-lower':\n                templateFinal = 'lower-alpha';\n                break;\n            case 'roman-lower':\n                templateFinal = 'lower-roman';\n                break;\n            case 'roman-upper':\n                templateFinal = 'upper-roman';\n                break;\n            default:\n                templateFinal = 'decimal';\n                break;\n        }\n    }\n\n    return getListStyleTypeFromString(listType, templateFinal);\n}\n\nfunction wordListPaddingParser(\n    format: ContentModelListItemLevelFormat,\n    element: HTMLElement\n): void {\n    if (element.style.marginLeft && element.style.marginLeft != '0in') {\n        format.paddingLeft = '0px';\n    }\n    if (element.style.marginRight && element.style.marginRight != '0in') {\n        format.paddingRight = '0px';\n    }\n}\n\nfunction setStartNumber(\n    listItem: ContentModelListItem,\n    context: DomToModelContext,\n    listMetadata: WordMetadata | undefined\n) {\n    const {\n        listParent,\n        wordList,\n        wordKnownLevels,\n        wordLevel,\n        levels,\n    } = context.listFormat as WordDesktopListFormat;\n\n    const block = getLastNotEmptyBlock(listParent);\n    if (\n        (block?.blockType != 'BlockGroup' ||\n            block.blockGroupType != 'ListItem' ||\n            (wordLevel &&\n                (block.levels[wordLevel]?.format as WordListFormat)?.wordList != wordList)) &&\n        wordList\n    ) {\n        const start = listMetadata?.['mso-level-start-at']\n            ? parseInt(listMetadata['mso-level-start-at'])\n            : NaN;\n        const knownLevel = wordKnownLevels?.get(wordList) || [];\n\n        if (start != undefined && !isNaN(start) && knownLevel.length != levels.length) {\n            listItem.levels[listItem.levels.length - 1].format.startNumberOverride = start;\n        }\n    }\n}\n\nfunction getLastNotEmptyBlock(listParent: ContentModelBlockGroup | undefined) {\n    for (let index = (listParent?.blocks.length || 0) - 1; index > 0; index--) {\n        const result = listParent?.blocks[index];\n        if (result && !isEmpty(result)) {\n            return result;\n        }\n    }\n\n    return undefined;\n}\n","import type { FormatParser, TextIndentFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const removeNegativeTextIndentParser: FormatParser<TextIndentFormat> = (format, element) => {\n    if (format.textIndent?.startsWith('-')) {\n        delete format.textIndent;\n    }\n};\n","/**\n * @internal\n */\nexport const PastePropertyNames = {\n    /**\n     * Node attribute used to identify if the content is from Google Sheets.\n     */\n    GOOGLE_SHEET_NODE_NAME: 'google-sheets-html-origin',\n\n    /**\n     * Name of the HTMLMeta Property that provides the Office App Source of the pasted content\n     */\n    PROG_ID_NAME: 'ProgId',\n\n    /**\n     * Name of the HTMLMeta Property that identifies pated content as from Excel Desktop\n     */\n    EXCEL_DESKTOP_ATTRIBUTE_NAME: 'xmlns:x',\n};\n","import { WAC_IDENTIFY_SELECTOR } from '../WacComponents/constants';\nimport type { GetSourceFunction } from './getPasteSource';\n\n/**\n * @internal\n * Check whether the fragment provided contain Wac Elements\n * @param props Properties related to the PasteEvent\n * @returns\n */\nexport const documentContainWacElements: GetSourceFunction = props => {\n    const { fragment } = props;\n    return !!fragment.querySelector(WAC_IDENTIFY_SELECTOR);\n};\n","import { documentContainWacElements } from './documentContainWacElements';\nimport { isExcelDesktopDocument } from './isExcelDesktopDocument';\nimport { isExcelOnlineDocument } from './isExcelOnlineDocument';\nimport { isGoogleSheetDocument } from './isGoogleSheetDocument';\nimport { isPowerPointDesktopDocument } from './isPowerPointDesktopDocument';\nimport { isWordDesktopDocument } from './isWordDesktopDocument';\nimport { shouldConvertToSingleImage } from './shouldConvertToSingleImage';\nimport type { BeforePasteEvent, ClipboardData } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport type GetSourceInputParams = {\n    htmlAttributes: Record<string, string>;\n    fragment: DocumentFragment;\n    shouldConvertSingleImage: boolean;\n    clipboardData: ClipboardData;\n};\n\n/**\n * @internal\n * Represent the types of sources to handle in the Paste Plugin\n */\nexport type KnownPasteSourceType =\n    | 'wordDesktop'\n    | 'excelDesktop'\n    | 'excelOnline'\n    | 'powerPointDesktop'\n    | 'googleSheets'\n    | 'wacComponents'\n    | 'default'\n    | 'singleImage';\n\n/**\n * @internal\n */\nexport type GetSourceFunction = (props: GetSourceInputParams) => boolean;\n\nconst getSourceFunctions = new Map<KnownPasteSourceType, GetSourceFunction>([\n    ['wordDesktop', isWordDesktopDocument],\n    ['excelDesktop', isExcelDesktopDocument],\n    ['excelOnline', isExcelOnlineDocument],\n    ['powerPointDesktop', isPowerPointDesktopDocument],\n    ['wacComponents', documentContainWacElements],\n    ['googleSheets', isGoogleSheetDocument],\n    ['singleImage', shouldConvertToSingleImage],\n]);\n\n/**\n * @internal\n * This function tries to get the source of the Pasted content\n * @param event the before paste event\n * @param shouldConvertSingleImage Whether convert single image is enabled.\n * @returns The Type of pasted content, if no type found will return {KnownSourceType.Default}\n */\nexport function getPasteSource(\n    event: BeforePasteEvent,\n    shouldConvertSingleImage: boolean\n): KnownPasteSourceType {\n    const { htmlAttributes, clipboardData, fragment } = event;\n\n    let result: KnownPasteSourceType | null = null;\n    const param: GetSourceInputParams = {\n        htmlAttributes,\n        fragment,\n        shouldConvertSingleImage,\n        clipboardData,\n    };\n\n    getSourceFunctions.forEach((func, key) => {\n        if (!result && func(param)) {\n            result = key;\n        }\n    });\n\n    return result ?? 'default';\n}\n","import { PastePropertyNames } from './constants';\nimport type { GetSourceFunction } from './getPasteSource';\n\nconst EXCEL_ATTRIBUTE_VALUE = 'urn:schemas-microsoft-com:office:excel';\n\n/**\n * @internal\n * Checks whether the Array provided contains strings that identify Excel Desktop documents\n * @param props Properties related to the PasteEvent\n * @returns\n */\nexport const isExcelDesktopDocument: GetSourceFunction = props => {\n    const { htmlAttributes } = props;\n    // The presence of this attribute confirms its origin from Excel Desktop\n    return htmlAttributes[PastePropertyNames.EXCEL_DESKTOP_ATTRIBUTE_NAME] == EXCEL_ATTRIBUTE_VALUE;\n};\n","import { PastePropertyNames } from './constants';\nimport type { GetSourceFunction } from './getPasteSource';\n\n// Excel Desktop also has this attribute\nconst EXCEL_ONLINE_ATTRIBUTE_VALUE = 'Excel.Sheet';\n\n/**\n * @internal\n * Checks whether the Array provided contains strings that identify Excel Online documents\n * @param props Properties related to the PasteEvent\n * @returns\n */\nexport const isExcelOnlineDocument: GetSourceFunction = props => {\n    const { htmlAttributes } = props;\n    // The presence of Excel.Sheet confirms its origin from Excel, the absence of EXCEL_DESKTOP_ATTRIBUTE_NAME confirms it is from the Online version\n    return (\n        htmlAttributes[PastePropertyNames.PROG_ID_NAME] == EXCEL_ONLINE_ATTRIBUTE_VALUE &&\n        htmlAttributes[PastePropertyNames.EXCEL_DESKTOP_ATTRIBUTE_NAME] == undefined\n    );\n};\n","import { PastePropertyNames } from './constants';\nimport type { GetSourceFunction } from './getPasteSource';\n\n/**\n * @internal\n * Checks whether the fragment provided contain elements from Google sheets\n * @param props Properties related to the PasteEvent\n * @returns\n */\nexport const isGoogleSheetDocument: GetSourceFunction = props => {\n    const { fragment } = props;\n    return !!fragment.querySelector(PastePropertyNames.GOOGLE_SHEET_NODE_NAME);\n};\n","import { PastePropertyNames } from './constants';\nimport type { GetSourceFunction } from './getPasteSource';\n\nconst POWERPOINT_ATTRIBUTE_VALUE = 'PowerPoint.Slide';\n\n/**\n * @internal\n * Checks whether the Array provided contains strings that identify Power Point Desktop documents\n * @param props Properties related to the PasteEvent\n * @returns\n */\nexport const isPowerPointDesktopDocument: GetSourceFunction = props => {\n    return props.htmlAttributes[PastePropertyNames.PROG_ID_NAME] == POWERPOINT_ATTRIBUTE_VALUE;\n};\n","import { PastePropertyNames } from './constants';\nimport type { GetSourceFunction } from './getPasteSource';\n\nconst WORD_ATTRIBUTE_NAME = 'xmlns:w';\nconst WORD_ATTRIBUTE_VALUE = 'urn:schemas-microsoft-com:office:word';\nconst WORD_PROG_ID = 'Word.Document';\n\n/**\n * @internal\n * Checks whether the Array provided contains strings that identify Word Desktop documents\n * @param props Properties related to the PasteEvent\n * @returns\n */\nexport const isWordDesktopDocument: GetSourceFunction = props => {\n    const { htmlAttributes } = props;\n    return (\n        htmlAttributes[WORD_ATTRIBUTE_NAME] == WORD_ATTRIBUTE_VALUE ||\n        htmlAttributes[PastePropertyNames.PROG_ID_NAME] == WORD_PROG_ID\n    );\n};\n","import type { GetSourceFunction } from './getPasteSource';\n\n/**\n * @internal\n * Checks whether the fragment only contains a single image to paste\n * and the editor have the ConvertSingleImageBody Experimental feature\n * @param props Properties related to the PasteEvent\n * @returns\n */\nexport const shouldConvertToSingleImage: GetSourceFunction = props => {\n    const { shouldConvertSingleImage, clipboardData } = props;\n    return (\n        shouldConvertSingleImage &&\n        clipboardData.htmlFirstLevelChildTags?.length == 1 &&\n        clipboardData.htmlFirstLevelChildTags[0] == 'IMG'\n    );\n};\n","import type {\n    ContentModelFormatMap,\n    DomToModelOption,\n    FormatParser,\n    ElementFormatParserPerCategory,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function addParser<TKey extends keyof ElementFormatParserPerCategory>(\n    domToModelOption: DomToModelOption,\n    entry: TKey,\n    additionalFormatParsers: FormatParser<ContentModelFormatMap[TKey]>\n) {\n    if (!domToModelOption.additionalFormatParsers) {\n        domToModelOption.additionalFormatParsers = {};\n    }\n    if (!domToModelOption.additionalFormatParsers[entry]) {\n        domToModelOption.additionalFormatParsers[entry] = [];\n    }\n\n    domToModelOption.additionalFormatParsers[entry]?.push(additionalFormatParsers);\n}\n","import { BorderKeys, DeprecatedColors } from 'roosterjs-content-model-dom';\nimport type { BorderFormat, FormatParser } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const deprecatedBorderColorParser: FormatParser<BorderFormat> = (\n    format: BorderFormat\n): void => {\n    BorderKeys.forEach(key => {\n        const value = format[key];\n        let color: string = '';\n        if (\n            value &&\n            DeprecatedColors.some(dColor => value.indexOf(dColor) > -1 && (color = dColor))\n        ) {\n            const newValue = value.replace(color, '').trimRight();\n            format[key] = newValue;\n        }\n    });\n};\n","/**\n * @internal\n * Get CSS styles of a given element in name-value pair format\n * @param element The element to get styles from\n */\nexport function getStyles(element: HTMLElement): Record<string, string> {\n    const result: Record<string, string> = {};\n    const style = element?.getAttribute('style') || '';\n    style.split(';').forEach(pair => {\n        const valueIndex = pair.indexOf(':');\n        const name = pair.slice(0, valueIndex);\n        const value = pair.slice(valueIndex + 1);\n        if (name && value) {\n            result[name.trim()] = value.trim();\n        }\n    });\n    return result;\n}\n","import { isElementOfType } from 'roosterjs-content-model-dom';\nimport type { ContentModelHyperLinkFormat, FormatParser } from 'roosterjs-content-model-types';\n\nconst SUPPORTED_PROTOCOLS = ['http:', 'https:', 'notes:', 'mailto:', 'onenote:'];\nconst INVALID_LINKS_REGEX = /^file:\\/\\/\\/[a-zA-Z\\/]/i;\n\n/**\n * @internal\n */\nexport const parseLink: FormatParser<ContentModelHyperLinkFormat> = (format, element) => {\n    if (!isElementOfType(element, 'a')) {\n        return;\n    }\n\n    let url: URL | undefined;\n    try {\n        url = new URL(element.href);\n    } catch {\n        url = undefined;\n    }\n\n    if (\n        (url && SUPPORTED_PROTOCOLS.indexOf(url.protocol) === -1) ||\n        INVALID_LINKS_REGEX.test(element.href)\n    ) {\n        element.removeAttribute('href');\n        format.href = '';\n    }\n};\n","import type { DomToModelOption, ElementProcessorMap } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function setProcessor<TKey extends keyof ElementProcessorMap>(\n    domToModelOption: DomToModelOption,\n    entry: TKey,\n    processorOverride: Partial<ElementProcessorMap>[TKey]\n) {\n    if (!domToModelOption.processorOverride) {\n        domToModelOption.processorOverride = {};\n    }\n\n    domToModelOption.processorOverride[entry] = processorOverride;\n}\n","import { getObjectKeys, isNodeOfType } from 'roosterjs-content-model-dom';\nimport type { CreateElementData } from './CreateElementData';\n\n/**\n * @internal\n * Create DOM element from the given CreateElementData\n * @param elementData The CreateElementData or an index of a known CreateElementData used for creating this element\n * @param document The document to create the element from\n * @returns The root DOM element just created\n */\nexport function createElement(elementData: CreateElementData, document: Document): Element | null {\n    if (!elementData || !elementData.tag) {\n        return null;\n    }\n\n    const { tag, namespace, className, style, dataset, attributes, children } = elementData;\n    const result = namespace\n        ? document.createElementNS(namespace, tag)\n        : document.createElement(tag);\n\n    if (style) {\n        result.setAttribute('style', style);\n    }\n\n    if (className) {\n        result.className = className;\n    }\n\n    if (dataset && isNodeOfType(result, 'ELEMENT_NODE')) {\n        getObjectKeys(dataset).forEach(datasetName => {\n            result.dataset[datasetName] = dataset[datasetName];\n        });\n    }\n\n    if (attributes) {\n        getObjectKeys(attributes).forEach(attrName => {\n            result.setAttribute(attrName, attributes[attrName]);\n        });\n    }\n\n    if (children) {\n        children.forEach(child => {\n            if (typeof child === 'string') {\n                result.appendChild(document.createTextNode(child));\n            } else if (child) {\n                const childElement = createElement(child, document);\n                if (childElement) {\n                    result.appendChild(childElement);\n                }\n            }\n        });\n    }\n\n    return result;\n}\n","import type { Disposable } from '../Disposable';\nimport type { DragAndDropHandler } from './DragAndDropHandler';\n\n/**\n * @internal\n */\ninterface MouseEventMoves {\n    MOUSEDOWN: string;\n    MOUSEMOVE: string;\n    MOUSEUP: string;\n}\n\n/**\n * @internal\n */\ninterface MouseEventInfo extends MouseEventMoves {\n    getPageXY: (e: MouseEvent) => number[];\n}\n\n/**\n * @internal\n * Compatible mouse event names for different platform\n */\ninterface TouchEventInfo extends MouseEventMoves {\n    getPageXY: (e: TouchEvent) => number[];\n}\n\n/**\n * Generate event names and getXY function based on different platforms to be compatible with desktop and mobile browsers\n */\nconst MOUSE_EVENT_INFO_DESKTOP: MouseEventInfo = (() => {\n    return {\n        MOUSEDOWN: 'mousedown',\n        MOUSEMOVE: 'mousemove',\n        MOUSEUP: 'mouseup',\n        getPageXY: getMouseEventPageXY,\n    };\n})();\n\nconst MOUSE_EVENT_INFO_MOBILE: TouchEventInfo = (() => {\n    return {\n        MOUSEDOWN: 'touchstart',\n        MOUSEMOVE: 'touchmove',\n        MOUSEUP: 'touchend',\n        getPageXY: getTouchEventPageXY,\n    };\n})();\n\nfunction getMouseEventPageXY(e: MouseEvent): [number, number] {\n    return [e.pageX, e.pageY];\n}\n\nfunction getTouchEventPageXY(e: TouchEvent): [number, number] {\n    let pageX = 0;\n    let pageY = 0;\n    if (e.targetTouches && e.targetTouches.length > 0) {\n        const touch = e.targetTouches[0];\n        pageX = touch.pageX;\n        pageY = touch.pageY;\n    }\n    return [pageX, pageY];\n}\n\n/**\n * @internal\n * A helper class to help manage drag and drop to an HTML element\n */\nexport class DragAndDropHelper<TContext, TInitValue> implements Disposable {\n    private initX: number = 0;\n    private initY: number = 0;\n    private initValue: TInitValue | undefined = undefined;\n    private dndMouse: MouseEventInfo | TouchEventInfo;\n\n    /**\n     * Create a new instance of DragAndDropHelper class\n     * @param trigger The trigger element. When user start drag on this element,\n     * events will be fired to the handler object\n     * @param context Context object that will be passed to handler function when event is fired,\n     * so that the handler object knows which element it is triggered from.\n     * @param onSubmit A callback that will be invoked when event handler in handler object returns true\n     * @param handler The event handler object, see DragAndDropHandler interface for more information\n     * @param zoomScale The zoom scale of the editor\n     * @param forceMobile A boolean to force the use of touch controls for the helper\n     */\n    constructor(\n        private trigger: HTMLElement,\n        private context: TContext,\n        private onSubmit: (context: TContext, trigger: HTMLElement) => void,\n        private handler: DragAndDropHandler<TContext, TInitValue>,\n        private zoomScale: number,\n        forceMobile?: boolean\n    ) {\n        this.dndMouse = forceMobile ? MOUSE_EVENT_INFO_MOBILE : MOUSE_EVENT_INFO_DESKTOP;\n        trigger.addEventListener(this.dndMouse.MOUSEDOWN, this.onMouseDown);\n    }\n\n    /**\n     * Dispose this object, remove all event listeners that has been attached\n     */\n    dispose() {\n        this.trigger.removeEventListener(this.dndMouse.MOUSEDOWN, this.onMouseDown);\n        this.removeDocumentEvents();\n    }\n\n    public get mouseType(): string {\n        return this.dndMouse == MOUSE_EVENT_INFO_MOBILE ? 'touch' : 'mouse';\n    }\n\n    private addDocumentEvents() {\n        const doc = this.trigger.ownerDocument;\n        doc.addEventListener(this.dndMouse.MOUSEMOVE, this.onMouseMove, true /*useCapture*/);\n        doc.addEventListener(this.dndMouse.MOUSEUP, this.onMouseUp, true /*useCapture*/);\n    }\n\n    private removeDocumentEvents() {\n        const doc = this.trigger.ownerDocument;\n        doc.removeEventListener(this.dndMouse.MOUSEMOVE, this.onMouseMove, true /*useCapture*/);\n        doc.removeEventListener(this.dndMouse.MOUSEUP, this.onMouseUp, true /*useCapture*/);\n    }\n\n    private onMouseDown = (e: Event) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.addDocumentEvents();\n        [this.initX, this.initY] = this.dndMouse.getPageXY(e as MouseEvent & TouchEvent);\n        this.initValue = this.handler.onDragStart?.(this.context, e as MouseEvent);\n    };\n\n    private onMouseMove = (e: Event) => {\n        e.preventDefault();\n        const [pageX, pageY] = this.dndMouse.getPageXY(e as MouseEvent & TouchEvent);\n        const deltaX = (pageX - this.initX) / this.zoomScale;\n        const deltaY = (pageY - this.initY) / this.zoomScale;\n        if (\n            this.initValue &&\n            this.handler.onDragging?.(this.context, e as MouseEvent, this.initValue, deltaX, deltaY)\n        ) {\n            this.onSubmit?.(this.context, this.trigger);\n        }\n    };\n\n    private onMouseUp = (e: Event) => {\n        e.preventDefault();\n        this.removeDocumentEvents();\n        if (this.handler.onDragEnd?.(this.context, e as MouseEvent, this.initValue)) {\n            this.onSubmit?.(this.context, this.trigger);\n        }\n    };\n}\n","import { normalizeRect } from 'roosterjs-content-model-dom';\nimport type { Rect } from 'roosterjs-content-model-types';\n\n/**\n * Get the intersected Rect of elements provided\n *\n * @example\n * The result of the following Elements Rects would be:\n    {\n        top: Element2.top,\n        bottom: Element1.bottom,\n        left: Element2.left,\n        right: Element2.right\n    }\n    +-------------------------+\n    | Element 1               |\n    |   +-----------------+   |\n    |   | Element2        |   |\n    |   |                 |   |\n    |   |                 |   |\n    +-------------------------+\n        |                 |\n        +-----------------+\n * @internal\n * @param elements Elements to use.\n * @param additionalRects additional rects to use\n * @returns If the Rect is valid return the rect, if not, return null.\n */\nexport function getIntersectedRect(\n    elements: HTMLElement[],\n    additionalRects: Rect[] = []\n): Rect | null {\n    const rects = elements\n        .map(element => normalizeRect(element.getBoundingClientRect()))\n        .concat(additionalRects)\n        .filter(element => !!element) as Rect[];\n\n    const result: Rect = {\n        top: Math.max(...rects.map(r => r.top)),\n        bottom: Math.min(...rects.map(r => r.bottom)),\n        left: Math.max(...rects.map(r => r.left)),\n        right: Math.min(...rects.map(r => r.right)),\n    };\n\n    return result.top < result.bottom && result.left < result.right ? result : null;\n}\n","import { cacheGetEventData } from 'roosterjs-content-model-core';\nimport type { ShortcutCommand, ShortcutKeyDefinition } from './ShortcutCommand';\nimport {\n    ShortcutBold,\n    ShortcutBullet,\n    ShortcutClearFormat,\n    ShortcutDecreaseFont,\n    ShortcutIncreaseFont,\n    ShortcutIndentList,\n    ShortcutItalic,\n    ShortcutNumbering,\n    ShortcutOutdentList,\n    ShortcutRedo,\n    ShortcutRedoMacOS,\n    ShortcutUnderline,\n    ShortcutUndo,\n    ShortcutUndo2,\n} from './shortcuts';\nimport type {\n    EditorPlugin,\n    IEditor,\n    KeyDownEvent,\n    PluginEvent,\n} from 'roosterjs-content-model-types';\n\nconst defaultShortcuts: ShortcutCommand[] = [\n    ShortcutBold,\n    ShortcutItalic,\n    ShortcutUnderline,\n    ShortcutClearFormat,\n    ShortcutUndo,\n    ShortcutUndo2,\n    ShortcutRedo,\n    ShortcutRedoMacOS,\n    ShortcutBullet,\n    ShortcutNumbering,\n    ShortcutIncreaseFont,\n    ShortcutDecreaseFont,\n    ShortcutIndentList,\n    ShortcutOutdentList,\n];\nconst CommandCacheKey = '__ShortcutCommandCache';\n\n/**\n * Shortcut plugin hook on the specified shortcut keys and trigger related format API\n */\nexport class ShortcutPlugin implements EditorPlugin {\n    private editor: IEditor | null = null;\n    private isMac = false;\n\n    /**\n     * Create a new instance of ShortcutPlugin\n     * @param [shortcuts=defaultShortcuts] Allowed commands\n     */\n    constructor(private shortcuts: ShortcutCommand[] = defaultShortcuts) {}\n\n    /**\n     * Get name of this plugin\n     */\n    getName() {\n        return 'Shortcut';\n    }\n\n    /**\n     * The first method that editor will call to a plugin when editor is initializing.\n     * It will pass in the editor instance, plugin should take this chance to save the\n     * editor reference so that it can call to any editor method or format API later.\n     * @param editor The editor object\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n        this.isMac = !!this.editor.getEnvironment().isMac;\n    }\n\n    /**\n     * The last method that editor will call to a plugin before it is disposed.\n     * Plugin can take this chance to clear the reference to editor. After this method is\n     * called, plugin should not call to any editor method since it will result in error.\n     */\n    dispose() {\n        this.editor = null;\n    }\n\n    /**\n     * Check if the plugin should handle the given event exclusively.\n     * Handle an event exclusively means other plugin will not receive this event in\n     * onPluginEvent method.\n     * If two plugins will return true in willHandleEventExclusively() for the same event,\n     * the final result depends on the order of the plugins are added into editor\n     * @param event The event to check:\n     */\n    willHandleEventExclusively(event: PluginEvent) {\n        return (\n            event.eventType == 'keyDown' &&\n            (event.rawEvent.ctrlKey || event.rawEvent.altKey || event.rawEvent.metaKey) &&\n            !!this.cacheGetCommand(event)\n        );\n    }\n\n    /**\n     * Core method for a plugin. Once an event happens in editor, editor will call this\n     * method of each plugin to handle the event as long as the event is not handled\n     * exclusively by another plugin.\n     * @param event The event to handle:\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (this.editor && event.eventType == 'keyDown') {\n            const command = this.cacheGetCommand(event);\n\n            if (command) {\n                command.onClick(this.editor);\n                event.rawEvent.preventDefault();\n            }\n        }\n    }\n\n    private cacheGetCommand(event: KeyDownEvent) {\n        return cacheGetEventData(event, CommandCacheKey, event => {\n            const editor = this.editor;\n\n            return (\n                editor &&\n                this.shortcuts.filter(\n                    command =>\n                        this.matchOS(command.environment) &&\n                        this.matchShortcut(command.shortcutKey, event.rawEvent)\n                )[0]\n            );\n        });\n    }\n\n    private matchOS(environment?: 'all' | 'mac' | 'nonMac') {\n        switch (environment) {\n            case 'mac':\n                return this.isMac;\n\n            case 'nonMac':\n                return !this.isMac;\n\n            default:\n                return true;\n        }\n    }\n\n    private matchShortcut(shortcutKey: ShortcutKeyDefinition, event: KeyboardEvent) {\n        const { ctrlKey, altKey, shiftKey, which, metaKey } = event;\n        const ctrlOrMeta = this.isMac ? metaKey : ctrlKey;\n        const matchModifier =\n            (shortcutKey.modifierKey == 'ctrl' && ctrlOrMeta && !altKey) ||\n            (shortcutKey.modifierKey == 'alt' && altKey && !ctrlOrMeta);\n\n        return matchModifier && shiftKey == shortcutKey.shiftKey && shortcutKey.which == which;\n    }\n}\n","import { redo, undo } from 'roosterjs-content-model-core';\nimport { setShortcutIndentationCommand } from './utils/setShortcutIndentationCommand';\nimport {\n    changeFontSize,\n    clearFormat,\n    toggleBold,\n    toggleBullet,\n    toggleItalic,\n    toggleNumbering,\n    toggleUnderline,\n} from 'roosterjs-content-model-api';\nimport type { ShortcutCommand } from './ShortcutCommand';\n\nconst enum Keys {\n    BACKSPACE = 8,\n    SPACE = 32,\n    B = 66,\n    I = 73,\n    U = 85,\n    Y = 89,\n    Z = 90,\n    COMMA = 188,\n    PERIOD = 190,\n    FORWARD_SLASH = 191,\n    ArrowRight = 39,\n    ArrowLeft = 37,\n}\n\n/**\n * Shortcut command for Bold\n * Windows: Ctrl + B\n * MacOS: Meta + B\n */\nexport const ShortcutBold: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'ctrl',\n        shiftKey: false,\n        which: Keys.B,\n    },\n    onClick: editor => toggleBold(editor),\n};\n\n/**\n * Shortcut command for Italic\n * Windows: Ctrl + I\n * MacOS: Meta + I\n */\nexport const ShortcutItalic: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'ctrl',\n        shiftKey: false,\n        which: Keys.I,\n    },\n    onClick: editor => toggleItalic(editor),\n};\n\n/**\n * Shortcut command for Underline\n * Windows: Ctrl + U\n * MacOS: Meta + U\n */\nexport const ShortcutUnderline: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'ctrl',\n        shiftKey: false,\n        which: Keys.U,\n    },\n    onClick: editor => toggleUnderline(editor),\n};\n\n/**\n * Shortcut command for Clear Format\n * Windows: Ctrl + Space\n * MacOS: Meta + Space\n */\nexport const ShortcutClearFormat: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'ctrl',\n        shiftKey: false,\n        which: Keys.SPACE,\n    },\n    onClick: editor => clearFormat(editor),\n};\n\n/**\n * Shortcut command for Undo 1\n * Windows: Ctrl + Z\n * MacOS: Meta + Z\n */\nexport const ShortcutUndo: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'ctrl',\n        shiftKey: false,\n        which: Keys.Z,\n    },\n    onClick: editor => undo(editor),\n};\n\n/**\n * Shortcut command for Undo 2\n * Windows: Alt + Backspace\n * MacOS: N/A\n */\nexport const ShortcutUndo2: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'alt',\n        shiftKey: false,\n        which: Keys.BACKSPACE,\n    },\n    onClick: editor => undo(editor),\n    environment: 'nonMac',\n};\n\n/**\n * Shortcut command for Redo 1\n * Windows: Ctrl + Y\n * MacOS: N/A\n */\nexport const ShortcutRedo: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'ctrl',\n        shiftKey: false,\n        which: Keys.Y,\n    },\n    onClick: editor => redo(editor),\n    environment: 'nonMac',\n};\n\n/**\n * Shortcut command for Redo 2\n * Windows: N/A\n * MacOS: Meta + Shift + Z\n */\nexport const ShortcutRedoMacOS: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'ctrl',\n        shiftKey: true,\n        which: Keys.Z,\n    },\n    onClick: editor => redo(editor),\n    environment: 'mac',\n};\n\n/**\n * Shortcut command for Bullet List\n * Windows: Ctrl + . (Period)\n * MacOS: Meta + . (Period)\n */\nexport const ShortcutBullet: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'ctrl',\n        shiftKey: false,\n        which: Keys.PERIOD,\n    },\n    onClick: editor => toggleBullet(editor),\n};\n\n/**\n * Shortcut command for Numbering List\n * Windows: Ctrl + / (Forward slash)\n * MacOS: Meta + / (Forward slash)\n */\nexport const ShortcutNumbering: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'ctrl',\n        shiftKey: false,\n        which: Keys.FORWARD_SLASH,\n    },\n    onClick: editor => toggleNumbering(editor),\n};\n\n/**\n * Shortcut command for Increase Font\n * Windows: Ctrl + Shift + . (Period)\n * MacOS: Meta + Shift + . (Period)\n */\nexport const ShortcutIncreaseFont: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'ctrl',\n        shiftKey: true,\n        which: Keys.PERIOD,\n    },\n    onClick: editor => changeFontSize(editor, 'increase'),\n};\n\n/**\n * Shortcut command for Decrease Font\n * Windows: Ctrl + Shift + , (Comma)\n * MacOS: Meta + Shift + , (Comma)\n */\nexport const ShortcutDecreaseFont: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'ctrl',\n        shiftKey: true,\n        which: Keys.COMMA,\n    },\n    onClick: editor => changeFontSize(editor, 'decrease'),\n};\n\n/**\n * Shortcut command for Intent list\n * Windows: Alt + Shift + Arrow Right\n * MacOS: Option + Shift+ Arrow Right\n */\nexport const ShortcutIndentList: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'alt',\n        shiftKey: true,\n        which: Keys.ArrowRight,\n    },\n    onClick: editor => {\n        setShortcutIndentationCommand(editor, 'indent');\n    },\n};\n\n/**\n * Shortcut command for Outdent list\n * Windows: Alt + Shift + Arrow Left\n * MacOS: Option + Shift+ Arrow Left\n */\nexport const ShortcutOutdentList: ShortcutCommand = {\n    shortcutKey: {\n        modifierKey: 'alt',\n        shiftKey: true,\n        which: Keys.ArrowLeft,\n    },\n    onClick: editor => {\n        setShortcutIndentationCommand(editor, 'outdent');\n    },\n};\n","import { getFirstSelectedListItem } from 'roosterjs-content-model-core';\nimport { setModelIndentation } from 'roosterjs-content-model-api';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function setShortcutIndentationCommand(editor: IEditor, operation: 'indent' | 'outdent') {\n    editor.formatContentModel(model => {\n        const listItem = getFirstSelectedListItem(model);\n\n        if (\n            listItem &&\n            listItem.blocks[0].blockType == 'Paragraph' &&\n            listItem.blocks[0].segments[0].segmentType == 'SelectionMarker'\n        ) {\n            setModelIndentation(model, operation);\n            return true;\n        }\n        return false;\n    });\n}\n","import { isNodeOfType, normalizeRect } from 'roosterjs-content-model-dom';\nimport { TableEditor } from './editors/TableEditor';\nimport type { EditorPlugin, IEditor, PluginEvent, Rect } from 'roosterjs-content-model-types';\n\nconst TABLE_RESIZER_LENGTH = 12;\n\n/**\n * TableEdit plugin, provides the ability to resize a table by drag-and-drop\n */\nexport class TableEditPlugin implements EditorPlugin {\n    private editor: IEditor | null = null;\n    private onMouseMoveDisposer: (() => void) | null = null;\n    private tableRectMap: { table: HTMLTableElement; rect: Rect }[] | null = null;\n    private tableEditor: TableEditor | null = null;\n\n    /**\n     * Construct a new instance of TableResize plugin\n     * @param anchorContainerSelector An optional selector string to specify the container to host the plugin.\n     * The container must not be affected by transform: scale(), otherwise the position calculation will be wrong.\n     * If not specified, the plugin will be inserted in document.body\n     */\n    constructor(private anchorContainerSelector?: string) {}\n\n    /**\n     * Get a friendly name of this plugin\n     */\n    getName() {\n        return 'TableEdit';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n        this.onMouseMoveDisposer = this.editor.attachDomEvent({\n            mousemove: { beforeDispatch: this.onMouseMove },\n        });\n        const scrollContainer = this.editor.getScrollContainer();\n        scrollContainer.addEventListener('mouseout', this.onMouseOut);\n    }\n\n    private onMouseOut = ({ relatedTarget, currentTarget }: MouseEvent) => {\n        const relatedTargetNode = relatedTarget as Node;\n        const currentTargetNode = currentTarget as Node;\n        if (\n            isNodeOfType(relatedTargetNode, 'ELEMENT_NODE') &&\n            isNodeOfType(currentTargetNode, 'ELEMENT_NODE') &&\n            this.tableEditor &&\n            !this.tableEditor.isOwnedElement(relatedTargetNode) &&\n            !currentTargetNode.contains(relatedTargetNode)\n        ) {\n            this.setTableEditor(null);\n        }\n    };\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        const scrollContainer = this.editor?.getScrollContainer();\n        scrollContainer?.removeEventListener('mouseout', this.onMouseOut);\n        this.onMouseMoveDisposer?.();\n        this.invalidateTableRects();\n        this.disposeTableEditor();\n        this.editor = null;\n        this.onMouseMoveDisposer = null;\n    }\n\n    /**\n     * Handle events triggered from editor\n     * @param event PluginEvent object\n     */\n    onPluginEvent(e: PluginEvent) {\n        switch (e.eventType) {\n            case 'input':\n            case 'contentChanged':\n            case 'scroll':\n            case 'zoomChanged':\n                this.setTableEditor(null);\n                this.invalidateTableRects();\n                break;\n        }\n    }\n\n    private onMouseMove = (event: Event) => {\n        const e = event as MouseEvent;\n\n        if (e.buttons > 0 || !this.editor) {\n            return;\n        }\n\n        this.ensureTableRects();\n\n        const editorWindow = this.editor.getDocument().defaultView || window;\n        const x = e.pageX - editorWindow.scrollX;\n        const y = e.pageY - editorWindow.scrollY;\n        let currentTable: HTMLTableElement | null = null;\n\n        //Find table in range of mouse\n        if (this.tableRectMap) {\n            for (let i = this.tableRectMap.length - 1; i >= 0; i--) {\n                const { table, rect } = this.tableRectMap[i];\n\n                if (\n                    x >= rect.left - TABLE_RESIZER_LENGTH &&\n                    x <= rect.right + TABLE_RESIZER_LENGTH &&\n                    y >= rect.top - TABLE_RESIZER_LENGTH &&\n                    y <= rect.bottom + TABLE_RESIZER_LENGTH\n                ) {\n                    currentTable = table;\n                    break;\n                }\n            }\n        }\n\n        this.setTableEditor(currentTable, e);\n        this.tableEditor?.onMouseMove(x, y);\n    };\n\n    /**\n     * @internal Public only for unit test\n     * @param table Table to use when setting the Editors\n     * @param event (Optional) Mouse event\n     */\n    public setTableEditor(table: HTMLTableElement | null, event?: MouseEvent) {\n        if (this.tableEditor && !this.tableEditor.isEditing() && table != this.tableEditor.table) {\n            this.disposeTableEditor();\n        }\n\n        if (!this.tableEditor && table && this.editor && table.rows.length > 0) {\n            // anchorContainerSelector is used to specify the container to host the plugin, which can be outside of the editor's div\n            const container = this.anchorContainerSelector\n                ? this.editor.getDocument().querySelector(this.anchorContainerSelector)\n                : undefined;\n\n            this.tableEditor = new TableEditor(\n                this.editor,\n                table,\n                this.invalidateTableRects,\n                isNodeOfType(container, 'ELEMENT_NODE') ? container : undefined,\n                event?.currentTarget\n            );\n        }\n    }\n\n    private invalidateTableRects = () => {\n        this.tableRectMap = null;\n    };\n\n    private disposeTableEditor() {\n        this.tableEditor?.dispose();\n        this.tableEditor = null;\n    }\n\n    private ensureTableRects() {\n        if (!this.tableRectMap && this.editor) {\n            this.tableRectMap = [];\n\n            const tables = this.editor.getDOMHelper().queryElements('table');\n            tables.forEach(table => {\n                if (table.isContentEditable) {\n                    const rect = normalizeRect(table.getBoundingClientRect());\n                    if (rect && this.tableRectMap) {\n                        this.tableRectMap.push({\n                            table,\n                            rect,\n                        });\n                    }\n                }\n            });\n        }\n    }\n}\n","import { createCellResizer } from './features/CellResizer';\nimport { createTableInserter } from './features/TableInserter';\nimport { createTableMover } from './features/TableMover';\nimport { createTableResizer } from './features/TableResizer';\nimport { disposeTableEditFeature } from './features/TableEditFeature';\nimport { isNodeOfType, normalizeRect } from 'roosterjs-content-model-dom';\nimport type { TableEditFeature } from './features/TableEditFeature';\nimport type { IEditor, TableSelection } from 'roosterjs-content-model-types';\n\nconst INSERTER_HOVER_OFFSET = 6;\nconst enum TOP_OR_SIDE {\n    top = 0,\n    side = 1,\n}\n/**\n * @internal\n *\n * A table has 6 hot areas to be resized/edited (take LTR example):\n *\n *   [6]  [                ]\n *       +[      1         ]+--------------------+\n *       |[                ]|                    |\n *      [ ]               [ ]                    |\n *      [ ]               [ ]                    |\n *      [2]               [3]                    |\n *      [ ]               [ ]                    |\n *      [ ][       4       ]|                    |\n *       +------------------+--------------------+\n *       |                  |                    |\n *       |                  |                    |\n *       |                  |                    |\n *       +------------------+--------------------+\n *                                                [5]\n *\n * 1 - Hover area to show insert column button\n * 2 - Hover area to show insert row button\n * 3 - Hover area to show vertical resizing bar\n * 4 - Hover area to show horizontal resizing bar\n * 5 - Hover area to show whole table resize handle\n * 6 - Hover area to show whole table mover handle\n *\n * When set a different current table or change current TD, we need to update these areas\n */\nexport class TableEditor {\n    // 1, 2 - Insert a column or a row\n    private horizontalInserter: TableEditFeature | null = null;\n    private verticalInserter: TableEditFeature | null = null;\n\n    // 3, 4 - Resize a column or a row from a cell\n    private horizontalResizer: TableEditFeature | null = null;\n    private verticalResizer: TableEditFeature | null = null;\n\n    // 5 - Resize whole table\n    private tableResizer: TableEditFeature | null = null;\n\n    // 6 - Move as well as select whole table\n    private tableMover: TableEditFeature | null = null;\n\n    private isRTL: boolean;\n    private range: Range | null = null;\n    private isCurrentlyEditing: boolean;\n\n    constructor(\n        private editor: IEditor,\n        public readonly table: HTMLTableElement,\n        private onChanged: () => void,\n        private anchorContainer?: HTMLElement,\n        private contentDiv?: EventTarget | null\n    ) {\n        this.isRTL = editor.getDocument().defaultView?.getComputedStyle(table).direction == 'rtl';\n        this.setEditorFeatures();\n        this.isCurrentlyEditing = false;\n    }\n\n    dispose() {\n        this.disposeTableResizer();\n        this.disposeCellResizers();\n        this.disposeTableInserter();\n        this.disposeTableMover();\n    }\n\n    isEditing(): boolean {\n        return this.isCurrentlyEditing;\n    }\n\n    isOwnedElement(node: Node) {\n        return [\n            this.tableResizer,\n            this.tableMover,\n            this.horizontalInserter,\n            this.verticalInserter,\n            this.horizontalResizer,\n            this.verticalResizer,\n        ]\n            .filter(feature => !!feature?.div)\n            .some(feature => feature?.div == node);\n    }\n\n    onMouseMove(x: number, y: number) {\n        // Get whole table rect\n        const tableRect = normalizeRect(this.table.getBoundingClientRect());\n\n        //console.log('>>>tableRect', tableRect);\n        if (!tableRect) {\n            return;\n        }\n\n        // Determine if cursor is on top or side\n        const topOrSide =\n            y <= tableRect.top + INSERTER_HOVER_OFFSET\n                ? TOP_OR_SIDE.top\n                : this.isRTL\n                ? x >= tableRect.right - INSERTER_HOVER_OFFSET\n                    ? TOP_OR_SIDE.side\n                    : undefined\n                : x <= tableRect.left + INSERTER_HOVER_OFFSET\n                ? TOP_OR_SIDE.side\n                : undefined;\n        const topOrSideBinary = topOrSide ? 1 : 0;\n\n        // i is row index, j is column index\n        for (let i = 0; i < this.table.rows.length; i++) {\n            const tr = this.table.rows[i];\n            let j = 0;\n            for (; j < tr.cells.length; j++) {\n                const td = tr.cells[j];\n                const tdRect = normalizeRect(td.getBoundingClientRect());\n\n                if (!tdRect || !tableRect) {\n                    continue;\n                }\n\n                // Determine the cell the cursor is in range of\n                // Offset is only used for first row and column\n                const lessThanBottom = y <= tdRect.bottom;\n                const lessThanRight = this.isRTL\n                    ? x <= tdRect.right + INSERTER_HOVER_OFFSET * topOrSideBinary\n                    : x <= tdRect.right;\n                const moreThanLeft = this.isRTL\n                    ? x >= tdRect.left\n                    : x >= tdRect.left - INSERTER_HOVER_OFFSET * topOrSideBinary;\n\n                if (lessThanBottom && lessThanRight && moreThanLeft) {\n                    if (i === 0 && topOrSide == TOP_OR_SIDE.top) {\n                        const center = (tdRect.left + tdRect.right) / 2;\n                        const isOnRightHalf = this.isRTL ? x < center : x > center;\n                        this.setInserterTd(\n                            isOnRightHalf ? td : tr.cells[j - 1],\n                            false /*isHorizontal*/\n                        );\n                    } else if (j === 0 && topOrSide == TOP_OR_SIDE.side) {\n                        const tdAbove = this.table.rows[i - 1]?.cells[0];\n                        const tdAboveRect = tdAbove\n                            ? normalizeRect(tdAbove.getBoundingClientRect())\n                            : null;\n\n                        const isTdNotAboveMerged = !tdAboveRect\n                            ? null\n                            : this.isRTL\n                            ? tdAboveRect.right === tdRect.right\n                            : tdAboveRect.left === tdRect.left;\n\n                        this.setInserterTd(\n                            y < (tdRect.top + tdRect.bottom) / 2 && isTdNotAboveMerged\n                                ? tdAbove\n                                : td,\n                            true /*isHorizontal*/\n                        );\n                    } else {\n                        this.setInserterTd(null);\n                    }\n\n                    this.setResizingTd(td);\n\n                    //Cell found\n                    break;\n                }\n            }\n\n            if (j < tr.cells.length) {\n                break;\n            }\n        }\n\n        // Create Mover and Resizer\n        this.setEditorFeatures();\n    }\n\n    private setEditorFeatures() {\n        if (!this.tableMover) {\n            this.tableMover = createTableMover(\n                this.table,\n                this.editor,\n                this.isRTL,\n                this.onSelect,\n                this.getOnMouseOut,\n                this.contentDiv,\n                this.anchorContainer\n            );\n        }\n\n        if (!this.tableResizer) {\n            this.tableResizer = createTableResizer(\n                this.table,\n                this.editor,\n                this.isRTL,\n                this.onStartTableResize,\n                this.onFinishEditing,\n                this.contentDiv,\n                this.anchorContainer\n            );\n        }\n    }\n\n    private setResizingTd(td: HTMLTableCellElement) {\n        if (this.horizontalResizer && this.horizontalResizer.node != td) {\n            this.disposeCellResizers();\n        }\n\n        if (!this.horizontalResizer && td) {\n            this.horizontalResizer = createCellResizer(\n                this.editor,\n                td,\n                this.table,\n                this.isRTL,\n                true /*isHorizontal*/,\n                this.onStartCellResize,\n                this.onFinishEditing,\n                this.anchorContainer\n            );\n            this.verticalResizer = createCellResizer(\n                this.editor,\n                td,\n                this.table,\n                this.isRTL,\n                false /*isHorizontal*/,\n                this.onStartCellResize,\n                this.onFinishEditing,\n                this.anchorContainer\n            );\n        }\n    }\n\n    /**\n     * create or remove TableInserter\n     * @param td td to attach to, set this to null to remove inserters (both horizontal and vertical)\n     */\n    private setInserterTd(td: HTMLTableCellElement | null, isHorizontal?: boolean) {\n        const inserter = isHorizontal ? this.horizontalInserter : this.verticalInserter;\n        if (td === null || (inserter && inserter.node != td)) {\n            this.disposeTableInserter();\n        }\n\n        if (!this.horizontalInserter && !this.verticalInserter && td) {\n            const newInserter = createTableInserter(\n                this.editor,\n                td,\n                this.table,\n                this.isRTL,\n                !!isHorizontal,\n                this.onInserted,\n                this.getOnMouseOut,\n                this.anchorContainer\n            );\n            if (isHorizontal) {\n                this.horizontalInserter = newInserter;\n            } else {\n                this.verticalInserter = newInserter;\n            }\n        }\n    }\n\n    private disposeTableResizer() {\n        if (this.tableResizer) {\n            disposeTableEditFeature(this.tableResizer);\n            this.tableResizer = null;\n        }\n    }\n\n    private disposeTableInserter() {\n        if (this.horizontalInserter) {\n            disposeTableEditFeature(this.horizontalInserter);\n            this.horizontalInserter = null;\n        }\n        if (this.verticalInserter) {\n            disposeTableEditFeature(this.verticalInserter);\n            this.verticalInserter = null;\n        }\n    }\n\n    private disposeCellResizers() {\n        if (this.horizontalResizer) {\n            disposeTableEditFeature(this.horizontalResizer);\n            this.horizontalResizer = null;\n        }\n        if (this.verticalResizer) {\n            disposeTableEditFeature(this.verticalResizer);\n            this.verticalResizer = null;\n        }\n    }\n\n    private disposeTableMover() {\n        if (this.tableMover) {\n            disposeTableEditFeature(this.tableMover);\n            this.tableMover = null;\n        }\n    }\n\n    private onFinishEditing = (): false => {\n        this.editor.focus();\n\n        if (this.range) {\n            this.editor.setDOMSelection({ type: 'range', range: this.range, isReverted: false });\n        }\n\n        this.editor.takeSnapshot(); // Pass in an empty callback to make sure ContentChangedEvent is triggered\n        this.onChanged();\n        this.isCurrentlyEditing = false;\n\n        return false;\n    };\n\n    private onStartTableResize = () => {\n        this.isCurrentlyEditing = true;\n        this.onStartResize();\n    };\n\n    private onStartCellResize = () => {\n        this.isCurrentlyEditing = true;\n        this.disposeTableResizer();\n        this.onStartResize();\n    };\n\n    private onStartResize() {\n        this.isCurrentlyEditing = true;\n        const range = this.editor.getDOMSelection();\n\n        if (range && range.type == 'range') {\n            this.range = range.range;\n        }\n\n        this.editor.takeSnapshot();\n    }\n\n    private onInserted = () => {\n        this.disposeTableResizer();\n        this.onFinishEditing();\n    };\n\n    /**\n     * Public only for testing purposes\n     * @param table the table to select\n     */\n    public onSelect = (table: HTMLTableElement) => {\n        this.editor.focus();\n\n        if (table) {\n            const selection: TableSelection = {\n                table: table,\n                firstRow: 0,\n                firstColumn: 0,\n                lastRow: table.rows.length - 1,\n                lastColumn: table.rows[table.rows.length - 1].cells.length - 1,\n                type: 'table',\n            };\n\n            this.editor.setDOMSelection(selection);\n        }\n    };\n\n    private getOnMouseOut = (feature: HTMLElement) => {\n        return (ev: MouseEvent) => {\n            if (\n                feature &&\n                ev.relatedTarget != feature &&\n                isNodeOfType(this.contentDiv as Node, 'ELEMENT_NODE') &&\n                isNodeOfType(ev.relatedTarget as Node, 'ELEMENT_NODE') &&\n                !(this.contentDiv == ev.relatedTarget)\n            ) {\n                this.dispose();\n            }\n        };\n    };\n}\n","import { createElement } from '../../../pluginUtils/CreateElement/createElement';\nimport { DragAndDropHelper } from '../../../pluginUtils/DragAndDrop/DragAndDropHelper';\nimport { isElementOfType, normalizeRect } from 'roosterjs-content-model-dom';\nimport {\n    getFirstSelectedTable,\n    MIN_ALLOWED_TABLE_CELL_WIDTH,\n    normalizeTable,\n} from 'roosterjs-content-model-core';\nimport type { DragAndDropHandler } from '../../../pluginUtils/DragAndDrop/DragAndDropHandler';\nimport type { ContentModelTable, IEditor } from 'roosterjs-content-model-types';\nimport type { TableEditFeature } from './TableEditFeature';\n\nconst CELL_RESIZER_WIDTH = 4;\n\n/**\n * @internal\n */\nexport function createCellResizer(\n    editor: IEditor,\n    td: HTMLTableCellElement,\n    table: HTMLTableElement,\n    isRTL: boolean,\n    isHorizontal: boolean,\n    onStart: () => void,\n    onEnd: () => false,\n    anchorContainer?: HTMLElement\n): TableEditFeature | null {\n    const document = td.ownerDocument;\n    const createElementData = {\n        tag: 'div',\n        style: `position: fixed; cursor: ${isHorizontal ? 'row' : 'col'}-resize; user-select: none`,\n    };\n    const zoomScale = editor.getDOMHelper().calculateZoomScale();\n\n    const div = createElement(createElementData, document) as HTMLDivElement;\n\n    (anchorContainer || document.body).appendChild(div);\n\n    const context: DragAndDropContext = { editor, td, table, isRTL, zoomScale, onStart };\n    const setPosition = isHorizontal ? setHorizontalPosition : setVerticalPosition;\n    setPosition(context, div);\n\n    const handler: DragAndDropHandler<DragAndDropContext, DragAndDropInitValue> = {\n        onDragStart,\n        // Horizontal modifies row height, vertical modifies column width\n        onDragging: isHorizontal ? onDraggingHorizontal : onDraggingVertical,\n        onDragEnd: onEnd,\n    };\n\n    const featureHandler = new DragAndDropHelper<DragAndDropContext, DragAndDropInitValue>(\n        div,\n        context,\n        setPosition,\n        handler,\n        zoomScale,\n        editor.getEnvironment().isMobileOrTablet\n    );\n\n    return { node: td, div, featureHandler };\n}\n\ninterface DragAndDropContext {\n    editor: IEditor;\n    td: HTMLTableCellElement;\n    table: HTMLTableElement;\n    isRTL: boolean;\n    zoomScale: number;\n    onStart: () => void;\n}\n\ninterface DragAndDropInitValue {\n    cmTable: ContentModelTable | undefined;\n    anchorColumn: number | undefined;\n    anchorRow: number | undefined;\n    anchorRowHeight: number;\n    allWidths: number[];\n}\n\nfunction onDragStart(context: DragAndDropContext, event: MouseEvent): DragAndDropInitValue {\n    const { td, onStart } = context;\n    const rect = normalizeRect(td.getBoundingClientRect());\n\n    // Get cell coordinates\n    const columnIndex = td.cellIndex;\n    const row =\n        td.parentElement && isElementOfType(td.parentElement, 'tr') ? td.parentElement : undefined;\n    const rowIndex = row?.rowIndex;\n\n    if (rowIndex == undefined) {\n        return {\n            cmTable: undefined,\n            anchorColumn: undefined,\n            anchorRow: undefined,\n            anchorRowHeight: -1,\n            allWidths: [],\n        }; // Just a fallback\n    }\n\n    const { editor, table } = context;\n\n    // Get current selection\n    const selection = editor.getDOMSelection();\n\n    // Select first cell of the table\n    editor.setDOMSelection({\n        type: 'table',\n        firstColumn: 0,\n        firstRow: 0,\n        lastColumn: 0,\n        lastRow: 0,\n        table: table,\n    });\n\n    // Get the table content model\n    const cmTable = getFirstSelectedTable(editor.getContentModelCopy('disconnected'))[0];\n\n    // Restore selection\n    editor.setDOMSelection(selection);\n\n    if (rect && cmTable) {\n        onStart();\n\n        return {\n            cmTable,\n            anchorColumn: columnIndex,\n            anchorRow: rowIndex,\n            anchorRowHeight: cmTable.rows[rowIndex].height,\n            allWidths: [...cmTable.widths],\n        };\n    } else {\n        return {\n            cmTable,\n            anchorColumn: undefined,\n            anchorRow: undefined,\n            anchorRowHeight: -1,\n            allWidths: [],\n        }; // Just a fallback\n    }\n}\n\nfunction onDraggingHorizontal(\n    context: DragAndDropContext,\n    event: MouseEvent,\n    initValue: DragAndDropInitValue,\n    deltaX: number,\n    deltaY: number\n) {\n    const { table } = context;\n    const { cmTable, anchorRow, anchorRowHeight } = initValue;\n\n    // Assign new widths and heights to the CM table\n    if (cmTable && anchorRow != undefined) {\n        // Modify the CM Table size\n        cmTable.rows[anchorRow].height = (anchorRowHeight ?? 0) + deltaY;\n\n        // Normalize the table\n        normalizeTable(cmTable);\n\n        // Writeback CM Table size changes to DOM Table\n        const tableRow = table.rows[anchorRow];\n        for (let col = 0; col < tableRow.cells.length; col++) {\n            const td = tableRow.cells[col];\n            td.style.height = cmTable.rows[anchorRow].height + 'px';\n        }\n\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction onDraggingVertical(\n    context: DragAndDropContext,\n    event: MouseEvent,\n    initValue: DragAndDropInitValue,\n    deltaX: number\n) {\n    const { table, isRTL } = context;\n    const { cmTable, anchorColumn, allWidths } = initValue;\n\n    // Assign new widths and heights to the CM table\n    if (cmTable && anchorColumn != undefined) {\n        // Modify the CM Table size\n        const lastColumn = anchorColumn == cmTable.widths.length - 1;\n        const change = deltaX * (isRTL ? -1 : 1);\n        // This is the last column\n        if (lastColumn) {\n            // Only the last column changes\n            cmTable.widths[anchorColumn] = allWidths[anchorColumn] + change;\n        } else {\n            // Any other two columns\n            const anchorChange = allWidths[anchorColumn] + change;\n            const nextAnchorChange = allWidths[anchorColumn + 1] - change;\n            if (\n                anchorChange < MIN_ALLOWED_TABLE_CELL_WIDTH ||\n                nextAnchorChange < MIN_ALLOWED_TABLE_CELL_WIDTH\n            ) {\n                return false;\n            }\n            cmTable.widths[anchorColumn] = anchorChange;\n            cmTable.widths[anchorColumn + 1] = nextAnchorChange;\n        }\n\n        // Normalize the table\n        normalizeTable(cmTable);\n\n        // Writeback CM Table size changes to DOM Table\n        for (let row = 0; row < table.rows.length; row++) {\n            const tableRow = table.rows[row];\n            for (let col = 0; col < tableRow.cells.length; col++) {\n                tableRow.cells[col].style.width = cmTable.widths[col] + 'px';\n            }\n        }\n\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction setHorizontalPosition(context: DragAndDropContext, trigger: HTMLElement) {\n    const { td } = context;\n    const rect = normalizeRect(td.getBoundingClientRect());\n    if (rect) {\n        trigger.id = 'horizontalResizer';\n        trigger.style.top = rect.bottom - CELL_RESIZER_WIDTH + 'px';\n        trigger.style.left = rect.left + 'px';\n        trigger.style.width = rect.right - rect.left + 'px';\n        trigger.style.height = CELL_RESIZER_WIDTH + 'px';\n    }\n}\n\nfunction setVerticalPosition(context: DragAndDropContext, trigger: HTMLElement) {\n    const { td, isRTL } = context;\n    const rect = normalizeRect(td.getBoundingClientRect());\n    if (rect) {\n        trigger.id = 'verticalResizer';\n        trigger.style.top = rect.top + 'px';\n        trigger.style.left = (isRTL ? rect.left : rect.right) - CELL_RESIZER_WIDTH + 1 + 'px';\n        trigger.style.width = CELL_RESIZER_WIDTH + 'px';\n        trigger.style.height = rect.bottom - rect.top + 'px';\n    }\n}\n","import type { Disposable } from '../../../pluginUtils/Disposable';\n\n/**\n * @internal\n */\nexport interface TableEditFeature {\n    node: Node;\n    div: HTMLDivElement | null;\n    featureHandler: Disposable | null;\n}\n\n/**\n * @internal\n */\nexport function disposeTableEditFeature(resizer: TableEditFeature | null) {\n    if (resizer) {\n        resizer.div?.parentNode?.removeChild(resizer.div);\n        resizer.div = null;\n        resizer.featureHandler?.dispose();\n        resizer.featureHandler = null;\n    }\n}\n","import { createElement } from '../../../pluginUtils/CreateElement/createElement';\nimport { getIntersectedRect } from '../../../pluginUtils/Rect/getIntersectedRect';\nimport { isElementOfType, normalizeRect } from 'roosterjs-content-model-dom';\nimport {\n    formatTableWithContentModel,\n    insertTableColumn,\n    insertTableRow,\n} from 'roosterjs-content-model-api';\nimport type { CreateElementData } from '../../../pluginUtils/CreateElement/CreateElementData';\nimport type { Disposable } from '../../../pluginUtils/Disposable';\nimport type { TableEditFeature } from './TableEditFeature';\nimport type { IEditor } from 'roosterjs-content-model-types';\n\nconst INSERTER_COLOR = '#4A4A4A';\nconst INSERTER_COLOR_DARK_MODE = 'white';\nconst INSERTER_SIDE_LENGTH = 12;\nconst INSERTER_BORDER_SIZE = 1;\n\n/**\n * @internal\n */\nexport function createTableInserter(\n    editor: IEditor,\n    td: HTMLTableCellElement,\n    table: HTMLTableElement,\n    isRTL: boolean,\n    isHorizontal: boolean,\n    onInsert: () => void,\n    getOnMouseOut: (feature: HTMLElement) => (ev: MouseEvent) => void,\n    anchorContainer?: HTMLElement\n): TableEditFeature | null {\n    const tdRect = normalizeRect(td.getBoundingClientRect());\n    const viewPort = editor.getVisibleViewport();\n    const tableRect = table && viewPort ? getIntersectedRect([table], [viewPort]) : null;\n\n    // set inserter position\n    if (tdRect && tableRect) {\n        const document = td.ownerDocument;\n        const createElementData = getInsertElementData(\n            isHorizontal,\n            editor.isDarkMode(),\n            isRTL,\n            editor.getDOMHelper().getDomStyle('backgroundColor') || 'white'\n        );\n\n        const div = createElement(createElementData, document) as HTMLDivElement;\n\n        if (isHorizontal) {\n            // tableRect.left/right is used because the Inserter is always intended to be on the side\n            div.id = 'horizontalInserter';\n            div.style.left = `${\n                isRTL\n                    ? tableRect.right\n                    : tableRect.left - (INSERTER_SIDE_LENGTH - 1 + 2 * INSERTER_BORDER_SIZE)\n            }px`;\n            div.style.top = `${tdRect.bottom - 8}px`;\n            (div.firstChild as HTMLElement).style.width = `${tableRect.right - tableRect.left}px`;\n        } else {\n            div.id = 'verticalInserter';\n            div.style.left = `${isRTL ? tdRect.left - 8 : tdRect.right - 8}px`;\n            // tableRect.top is used because the Inserter is always intended to be on top\n            div.style.top = `${\n                tableRect.top - (INSERTER_SIDE_LENGTH - 1 + 2 * INSERTER_BORDER_SIZE)\n            }px`;\n            (div.firstChild as HTMLElement).style.height = `${tableRect.bottom - tableRect.top}px`;\n        }\n\n        (anchorContainer || document.body).appendChild(div);\n\n        const handler = new TableInsertHandler(\n            div,\n            td,\n            table,\n            isHorizontal,\n            editor,\n            onInsert,\n            getOnMouseOut\n        );\n\n        return { div, featureHandler: handler, node: td };\n    }\n\n    return null;\n}\n\nclass TableInsertHandler implements Disposable {\n    private onMouseOutEvent: null | ((ev: MouseEvent) => void);\n    constructor(\n        private div: HTMLDivElement,\n        private td: HTMLTableCellElement,\n        private table: HTMLTableElement,\n        private isHorizontal: boolean,\n        private editor: IEditor,\n        private onInsert: () => void,\n        getOnMouseOut: (feature: HTMLElement) => (ev: MouseEvent) => void\n    ) {\n        this.div.addEventListener('click', this.insertTd);\n        this.onMouseOutEvent = getOnMouseOut(div);\n        this.div.addEventListener('mouseout', this.onMouseOutEvent);\n    }\n\n    dispose() {\n        this.div.removeEventListener('click', this.insertTd);\n\n        if (this.onMouseOutEvent) {\n            this.div.removeEventListener('mouseout', this.onMouseOutEvent);\n        }\n\n        this.onMouseOutEvent = null;\n    }\n\n    private insertTd = () => {\n        // Get cell coordinates\n        const columnIndex = this.td.cellIndex;\n        const row =\n            this.td.parentElement && isElementOfType(this.td.parentElement, 'tr')\n                ? this.td.parentElement\n                : undefined;\n        const rowIndex = row && row.rowIndex;\n\n        if (row?.cells == undefined || rowIndex == undefined) {\n            return;\n        }\n\n        // Insert row or column\n        formatTableWithContentModel(\n            this.editor,\n            'editTablePlugin',\n            tableModel => {\n                this.isHorizontal\n                    ? insertTableRow(tableModel, 'insertBelow')\n                    : insertTableColumn(tableModel, 'insertRight');\n            }, // Select cell to make insertion\n            {\n                type: 'table',\n                firstColumn: columnIndex,\n                firstRow: rowIndex,\n                lastColumn: columnIndex,\n                lastRow: rowIndex,\n                table: this.table,\n            }\n        );\n\n        this.onInsert();\n    };\n}\n\nfunction getInsertElementData(\n    isHorizontal: boolean,\n    isDark: boolean,\n    isRTL: boolean,\n    backgroundColor: string\n): CreateElementData {\n    const inserterColor = isDark ? INSERTER_COLOR_DARK_MODE : INSERTER_COLOR;\n    const outerDivStyle = `position: fixed; width: ${INSERTER_SIDE_LENGTH}px; height: ${INSERTER_SIDE_LENGTH}px; font-size: 16px; color: black; line-height: 8px; vertical-align: middle; text-align: center; cursor: pointer; border: solid ${INSERTER_BORDER_SIZE}px ${inserterColor}; border-radius: 50%; background-color: ${backgroundColor}`;\n    const leftOrRight = isRTL ? 'right' : 'left';\n    const childBaseStyles = `position: absolute; box-sizing: border-box; background-color: ${backgroundColor};`;\n    const childInfo: CreateElementData = {\n        tag: 'div',\n        style:\n            childBaseStyles +\n            (isHorizontal\n                ? `${leftOrRight}: 12px; top: 5px; height: 3px; border-top: 1px solid ${inserterColor}; border-bottom: 1px solid ${inserterColor}; border-right: 1px solid ${inserterColor}; border-left: 0px;`\n                : `left: 5px; top: 12px; width: 3px; border-left: 1px solid ${inserterColor}; border-right: 1px solid ${inserterColor}; border-bottom: 1px solid ${inserterColor}; border-top: 0px;`),\n    };\n\n    return {\n        tag: 'div',\n        style: outerDivStyle,\n        children: [childInfo, '+'],\n    };\n}\n","import { createElement } from '../../../pluginUtils/CreateElement/createElement';\nimport { DragAndDropHelper } from '../../../pluginUtils/DragAndDrop/DragAndDropHelper';\nimport { isNodeOfType, normalizeRect } from 'roosterjs-content-model-dom';\nimport type { DragAndDropHandler } from '../../../pluginUtils/DragAndDrop/DragAndDropHandler';\nimport type { IEditor, Rect } from 'roosterjs-content-model-types';\nimport type { TableEditFeature } from './TableEditFeature';\n\nconst TABLE_MOVER_LENGTH = 12;\nconst TABLE_MOVER_ID = '_Table_Mover';\n\n/**\n * @internal\n * Contains the function to select whole table\n * Moving behavior not implemented yet\n */\nexport function createTableMover(\n    table: HTMLTableElement,\n    editor: IEditor,\n    isRTL: boolean,\n    onFinishDragging: (table: HTMLTableElement) => void,\n    getOnMouseOut: (feature: HTMLElement) => (ev: MouseEvent) => void,\n    contentDiv?: EventTarget | null,\n    anchorContainer?: HTMLElement\n): TableEditFeature | null {\n    const rect = normalizeRect(table.getBoundingClientRect());\n\n    if (!isTableTopVisible(editor, rect, contentDiv as Node)) {\n        return null;\n    }\n\n    const zoomScale = editor.getDOMHelper().calculateZoomScale();\n    const document = table.ownerDocument;\n    const createElementData = {\n        tag: 'div',\n        style: 'position: fixed; cursor: all-scroll; user-select: none; border: 1px solid #808080',\n    };\n\n    const div = createElement(createElementData, document) as HTMLDivElement;\n\n    div.id = TABLE_MOVER_ID;\n    div.style.width = `${TABLE_MOVER_LENGTH}px`;\n    div.style.height = `${TABLE_MOVER_LENGTH}px`;\n\n    (anchorContainer || document.body).appendChild(div);\n\n    const context: TableMoverContext = {\n        table,\n        zoomScale,\n        rect,\n        isRTL,\n    };\n\n    setDivPosition(context, div);\n\n    const onDragEnd = (context: TableMoverContext, event: MouseEvent): false => {\n        if (event.target == div) {\n            onFinishDragging(context.table);\n        }\n        return false;\n    };\n\n    const featureHandler = new TableMoverFeature(\n        div,\n        context,\n        setDivPosition,\n        {\n            onDragEnd,\n        },\n        context.zoomScale,\n        getOnMouseOut\n    );\n\n    return { div, featureHandler, node: table };\n}\n\ninterface TableMoverContext {\n    table: HTMLTableElement;\n    zoomScale: number;\n    rect: Rect | null;\n    isRTL: boolean;\n}\n\ninterface TableMoverInitValue {\n    event: MouseEvent;\n}\n\nclass TableMoverFeature extends DragAndDropHelper<TableMoverContext, TableMoverInitValue> {\n    private onMouseOut: ((ev: MouseEvent) => void) | null;\n\n    constructor(\n        private div: HTMLElement,\n        context: TableMoverContext,\n        onSubmit: (\n            context: TableMoverContext,\n            trigger: HTMLElement,\n            container?: HTMLElement\n        ) => void,\n        handler: DragAndDropHandler<TableMoverContext, TableMoverInitValue>,\n        zoomScale: number,\n        getOnMouseOut: (feature: HTMLElement) => (ev: MouseEvent) => void,\n        forceMobile?: boolean | undefined,\n        container?: HTMLElement\n    ) {\n        super(div, context, onSubmit, handler, zoomScale, forceMobile);\n        this.onMouseOut = getOnMouseOut(div);\n        div.addEventListener('mouseout', this.onMouseOut);\n    }\n\n    dispose(): void {\n        super.dispose();\n        if (this.onMouseOut) {\n            this.div.removeEventListener('mouseout', this.onMouseOut);\n        }\n        this.onMouseOut = null;\n    }\n}\n\nfunction setDivPosition(context: TableMoverContext, trigger: HTMLElement) {\n    const { rect } = context;\n    if (rect) {\n        trigger.style.top = `${rect.top - TABLE_MOVER_LENGTH}px`;\n        trigger.style.left = `${rect.left - TABLE_MOVER_LENGTH - 2}px`;\n    }\n}\n\nfunction isTableTopVisible(editor: IEditor, rect: Rect | null, contentDiv?: Node | null): boolean {\n    const visibleViewport = editor.getVisibleViewport();\n    if (isNodeOfType(contentDiv, 'ELEMENT_NODE') && visibleViewport && rect) {\n        const containerRect = normalizeRect(contentDiv.getBoundingClientRect());\n\n        return !!containerRect && containerRect.top <= rect.top && visibleViewport.top <= rect.top;\n    }\n\n    return true;\n}\n","import { createElement } from '../../../pluginUtils/CreateElement/createElement';\nimport { DragAndDropHelper } from '../../../pluginUtils/DragAndDrop/DragAndDropHelper';\nimport { getFirstSelectedTable, normalizeTable } from 'roosterjs-content-model-core';\nimport { isNodeOfType, normalizeRect } from 'roosterjs-content-model-dom';\nimport type { ContentModelTable, IEditor, Rect } from 'roosterjs-content-model-types';\nimport type { TableEditFeature } from './TableEditFeature';\n\nconst TABLE_RESIZER_LENGTH = 12;\nconst TABLE_RESIZER_ID = '_Table_Resizer';\n\n/**\n * @internal\n */\nexport function createTableResizer(\n    table: HTMLTableElement,\n    editor: IEditor,\n    isRTL: boolean,\n    onStart: () => void,\n    onEnd: () => false,\n    contentDiv?: EventTarget | null,\n    anchorContainer?: HTMLElement\n): TableEditFeature | null {\n    const rect = normalizeRect(table.getBoundingClientRect());\n\n    if (!isTableBottomVisible(editor, rect, contentDiv as Node)) {\n        return null;\n    }\n\n    const document = table.ownerDocument;\n    const zoomScale = editor.getDOMHelper().calculateZoomScale();\n    const createElementData = {\n        tag: 'div',\n        style: `position: fixed; cursor: ${\n            isRTL ? 'ne' : 'nw'\n        }-resize; user-select: none; border: 1px solid #808080`,\n    };\n\n    const div = createElement(createElementData, document) as HTMLDivElement;\n\n    div.id = TABLE_RESIZER_ID;\n    div.style.width = `${TABLE_RESIZER_LENGTH}px`;\n    div.style.height = `${TABLE_RESIZER_LENGTH}px`;\n\n    (anchorContainer || document.body).appendChild(div);\n\n    const context: DragAndDropContext = {\n        isRTL,\n        table,\n        zoomScale,\n        onStart,\n        onEnd,\n        div,\n        editor,\n        contentDiv,\n    };\n\n    setDivPosition(context, div);\n\n    const featureHandler = new DragAndDropHelper<DragAndDropContext, DragAndDropInitValue>(\n        div,\n        context,\n        hideResizer, // Resizer is hidden while dragging only\n        {\n            onDragStart,\n            onDragging,\n            onDragEnd,\n        },\n        zoomScale,\n        editor.getEnvironment().isMobileOrTablet\n    );\n\n    return { node: table, div, featureHandler };\n}\n\ninterface DragAndDropContext {\n    table: HTMLTableElement;\n    isRTL: boolean;\n    zoomScale: number;\n    onStart: () => void;\n    onEnd: () => false;\n    div: HTMLDivElement;\n    editor: IEditor;\n    contentDiv?: EventTarget | null;\n}\n\ninterface DragAndDropInitValue {\n    originalRect: DOMRect;\n    originalHeights: number[];\n    originalWidths: number[];\n    cmTable: ContentModelTable | undefined;\n}\n\nfunction onDragStart(context: DragAndDropContext, event: MouseEvent) {\n    context.onStart();\n\n    const { editor, table } = context;\n\n    // Get current selection\n    const selection = editor.getDOMSelection();\n\n    // Select first cell of the table\n    editor.setDOMSelection({\n        type: 'table',\n        firstColumn: 0,\n        firstRow: 0,\n        lastColumn: 0,\n        lastRow: 0,\n        table: table,\n    });\n\n    // Get the table content model\n    const cmTable = getFirstSelectedTable(editor.getContentModelCopy('disconnected'))[0];\n\n    // Restore selection\n    editor.setDOMSelection(selection);\n\n    // Save original widths and heights\n    const heights: number[] = [];\n    cmTable?.rows.forEach(row => {\n        heights.push(row.height);\n    });\n    const widths: number[] = [];\n    cmTable?.widths.forEach(width => {\n        widths.push(width);\n    });\n\n    return {\n        originalRect: table.getBoundingClientRect(),\n        cmTable,\n        originalHeights: heights ?? [],\n        originalWidths: widths ?? [],\n    };\n}\n\nfunction onDragging(\n    context: DragAndDropContext,\n    event: MouseEvent,\n    initValue: DragAndDropInitValue,\n    deltaX: number,\n    deltaY: number\n) {\n    const { isRTL, zoomScale, table } = context;\n    const { originalRect, originalHeights, originalWidths, cmTable } = initValue;\n\n    const ratioX = 1.0 + (deltaX / originalRect.width) * zoomScale * (isRTL ? -1 : 1);\n    const ratioY = 1.0 + (deltaY / originalRect.height) * zoomScale;\n    const shouldResizeX = Math.abs(ratioX - 1.0) > 1e-3;\n    const shouldResizeY = Math.abs(ratioY - 1.0) > 1e-3;\n\n    // If the width of some external table is fixed, we need to make it resizable\n    table.style.setProperty('width', null);\n    // If the height of some external table is fixed, we need to make it resizable\n    table.style.setProperty('height', null);\n\n    // Assign new widths and heights to the CM table\n    if (cmTable && cmTable.rows && (shouldResizeX || shouldResizeY)) {\n        // Modify the CM Table size\n        for (let i = 0; i < cmTable.rows.length; i++) {\n            for (let j = 0; j < cmTable.rows[i].cells.length; j++) {\n                const cell = cmTable.rows[i].cells[j];\n                if (cell) {\n                    if (shouldResizeX && i == 0) {\n                        cmTable.widths[j] = (originalWidths[j] ?? 0) * ratioX;\n                    }\n                    if (shouldResizeY && j == 0) {\n                        cmTable.rows[i].height = (originalHeights[i] ?? 0) * ratioY;\n                    }\n                }\n            }\n        }\n\n        // Normalize the table\n        normalizeTable(cmTable);\n\n        // Writeback CM Table size changes to DOM Table\n        for (let row = 0; row < table.rows.length; row++) {\n            const tableRow = table.rows[row];\n\n            if (tableRow.cells.length == 0) {\n                // Skip empty row\n                continue;\n            }\n\n            for (let col = 0; col < tableRow.cells.length; col++) {\n                const td = tableRow.cells[col];\n                td.style.width = cmTable.widths[col] + 'px';\n                td.style.height = cmTable.rows[row].height + 'px';\n            }\n        }\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction onDragEnd(\n    context: DragAndDropContext,\n    event: MouseEvent,\n    initValue: DragAndDropInitValue | undefined\n) {\n    if (context.editor.isDisposed()) {\n        return false;\n    }\n    if (\n        isTableBottomVisible(\n            context.editor,\n            normalizeRect(context.table.getBoundingClientRect()),\n            context.contentDiv as Node\n        )\n    ) {\n        context.div.style.visibility = 'visible';\n        setDivPosition(context, context.div);\n    }\n    context.onEnd();\n    return false;\n}\n\nfunction setDivPosition(context: DragAndDropContext, trigger: HTMLElement) {\n    const { table, isRTL } = context;\n    const rect = normalizeRect(table.getBoundingClientRect());\n\n    if (rect) {\n        trigger.style.top = `${rect.bottom}px`;\n        trigger.style.left = isRTL\n            ? `${rect.left - TABLE_RESIZER_LENGTH - 2}px`\n            : `${rect.right}px`;\n    }\n}\n\nfunction hideResizer(context: DragAndDropContext, trigger: HTMLElement) {\n    trigger.style.visibility = 'hidden';\n}\n\nfunction isTableBottomVisible(\n    editor: IEditor,\n    rect: Rect | null,\n    contentDiv?: Node | null\n): boolean {\n    const visibleViewport = editor.getVisibleViewport();\n    if (isNodeOfType(contentDiv, 'ELEMENT_NODE') && visibleViewport && rect) {\n        const containerRect = normalizeRect(contentDiv.getBoundingClientRect());\n\n        return (\n            !!containerRect &&\n            containerRect.bottom >= rect.bottom &&\n            visibleViewport.bottom >= rect.bottom\n        );\n    }\n\n    return true;\n}\n","import { getObjectKeys } from 'roosterjs-content-model-dom';\nimport { isModelEmptyFast } from './isModelEmptyFast';\nimport type { WatermarkFormat } from './WatermarkFormat';\nimport type { EditorPlugin, IEditor, PluginEvent } from 'roosterjs-content-model-types';\n\nconst WATERMARK_CONTENT_KEY = '_WatermarkContent';\nconst styleMap: Record<keyof WatermarkFormat, string> = {\n    fontFamily: 'font-family',\n    fontSize: 'font-size',\n    textColor: 'color',\n};\n\n/**\n * A watermark plugin to manage watermark string for roosterjs\n */\nexport class WatermarkPlugin implements EditorPlugin {\n    private editor: IEditor | null = null;\n    private format: WatermarkFormat;\n    private isShowing = false;\n\n    /**\n     * Create an instance of Watermark plugin\n     * @param watermark The watermark string\n     */\n    constructor(private watermark: string, format?: WatermarkFormat) {\n        this.format = format || {\n            fontSize: '14px',\n            textColor: '#AAAAAA',\n        };\n    }\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'Watermark';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor;\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        this.editor = null;\n    }\n\n    /**\n     * Handle events triggered from editor\n     * @param event PluginEvent object\n     */\n    onPluginEvent(event: PluginEvent) {\n        const editor = this.editor;\n\n        if (\n            editor &&\n            (event.eventType == 'editorReady' ||\n                event.eventType == 'contentChanged' ||\n                event.eventType == 'input' ||\n                event.eventType == 'beforeDispose')\n        ) {\n            editor.formatContentModel(model => {\n                const isEmpty = isModelEmptyFast(model);\n\n                if (this.isShowing && !isEmpty) {\n                    this.hide(editor);\n                } else if (!this.isShowing && isEmpty) {\n                    this.show(editor);\n                }\n                return false;\n            });\n        }\n    }\n\n    protected show(editor: IEditor) {\n        let rule = `position: absolute; pointer-events: none; content: \"${this.watermark}\";`;\n\n        getObjectKeys(styleMap).forEach(x => {\n            if (this.format[x]) {\n                rule += `${styleMap[x]}: ${this.format[x]}!important;`;\n            }\n        });\n\n        editor.setEditorStyle(WATERMARK_CONTENT_KEY, rule, 'before');\n\n        this.isShowing = true;\n    }\n\n    protected hide(editor: IEditor) {\n        editor.setEditorStyle(WATERMARK_CONTENT_KEY, null);\n        this.isShowing = false;\n    }\n}\n","import type { ContentModelDocument } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * A fast way to check if content model is empty\n */\nexport function isModelEmptyFast(model: ContentModelDocument): boolean {\n    const firstBlock = model.blocks[0];\n\n    if (model.blocks.length > 1) {\n        return false; // Multiple blocks, treat as not empty\n    } else if (!firstBlock) {\n        return true; // No block, it is empty\n    } else if (firstBlock.blockType != 'Paragraph') {\n        return false; // First block is not paragraph, treat as not empty\n    } else if (firstBlock.segments.length == 0) {\n        return true; // No segment, it is empty\n    } else if (\n        firstBlock.segments.some(\n            x =>\n                x.segmentType == 'Entity' ||\n                x.segmentType == 'Image' ||\n                x.segmentType == 'General' ||\n                (x.segmentType == 'Text' && x.text)\n        )\n    ) {\n        return false; // Has meaningful segments, it is not empty\n    } else {\n        return firstBlock.segments.filter(x => x.segmentType == 'Br').length <= 1; // If there are more than one BR, it is not empty, otherwise it is empty\n    }\n}\n","import { Editor } from 'roosterjs-content-model-core';\nimport { EditPlugin, PastePlugin } from 'roosterjs-content-model-plugins';\nimport type {\n    ContentModelDocument,\n    EditorPlugin,\n    IEditor,\n    EditorOptions,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a new Editor instance using the given options\n * @param contentDiv The html div element needed for creating the editor\n * @param additionalPlugins The additional user defined plugins. Currently the default plugins that are already included are\n * PastePlugin, EditPlugin, user don't need to add those.\n * @param initialModel The initial content model to show in editor. It can't be removed by undo, user need to manually remove it if needed.\n * @returns The Editor instance\n */\nexport function createEditor(\n    contentDiv: HTMLDivElement,\n    additionalPlugins?: EditorPlugin[],\n    initialModel?: ContentModelDocument\n): IEditor {\n    const plugins = [new PastePlugin(), new EditPlugin(), ...(additionalPlugins ?? [])];\n\n    const options: EditorOptions = {\n        plugins: plugins,\n        initialModel,\n        defaultSegmentFormat: {\n            fontFamily: 'Calibri,Arial,Helvetica,sans-serif',\n            fontSize: '11pt',\n            textColor: '#000000',\n        },\n    };\n    return new Editor(contentDiv, options);\n}\n","export { createEditor } from './createEditor';\nexport * from 'roosterjs-content-model-types';\nexport * from 'roosterjs-content-model-dom';\nexport * from 'roosterjs-content-model-core';\nexport * from 'roosterjs-content-model-api';\nexport * from 'roosterjs-content-model-plugins';\n","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n  return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(5803);\n"],"names":["insertTable","formatTable","setTableCellShade","editTable","applyTableBorderFormat","toggleBullet","toggleNumbering","toggleBold","toggleItalic","toggleUnderline","toggleStrikethrough","toggleSubscript","toggleSuperscript","setBackgroundColor","setFontName","setFontSize","setTextColor","changeFontSize","applySegmentFormat","changeCapitalization","insertImage","setListStyle","setListStartNumber","setIndentation","setAlignment","setDirection","setHeadingLevel","toggleBlockQuote","setSpacing","setImageBorder","setImageBoxShadow","changeImage","get","getFormatState","clearFormat","insertLink","removeLink","adjustLinkSelection","setImageAltText","adjustImageSelection","setParagraphMargin","toggleCode","insertEntity","insertTableRow","insertTableColumn","formatTableWithContentModel","formatImageWithContentModel","formatParagraphWithContentModel","formatSegmentWithContentModel","setListType","findListItemsInSameThread","setModelIndentation","matchLink","ResultMap","left","ltr","rtl","center","right","justify","TableAlignMap","model","alignment","paragraphOrListItemOrTable","getOperationalBlocks","forEach","block","newAlignment","format","direction","blockType","alignTable","blockGroupType","blocks","b","textAlign","length","internalSetDirection","marginLeft","paddingLeft","setProperty","marginRight","paddingRight","rows","row","cells","cell","updateTableCellMetadata","metadata","borderOverride","storeBorderLeft","borderLeft","borderRight","applyTableFormat","undefined","key","value","isBlockGroupOfType","item","levels","level","isSelected","listItem","some","segments","segment","calculateMarginValue","isIndent","isRtl","originalValue","parseValueWithUnit","newValue","Math","ceil","floor","max","indentation","paragraphOrListItem","modifiedBlocks","parent","path","firstItem","pop","i","indexOf","isMultilevelSelection","lastLevel","newLevel","createListLevel","listType","updateListMetadata","applyListStyleFromLevel","startNumberOverride","push","currentBlock","currentParent","index","cachedElement","isQuote","tagName","formatLtr","formatRtl","paragraphOfQuote","every","blockAndParent","unwrapBlock","createFormatContainer","target","current","areSameFormats","canMergeQuote","wrapBlockStep1","wrapBlockStep2","clearContainerFormat","containerPathIndex","getClosestAncestorBlockGroupIndex","container","containerIndex","blockIndex","newContainer","splice","clearListFormat","clearBlockFormat","decorator","blocksToClear","segmentsToClear","tablesToClear","iterateSelections","tableContext","colIndex","rowIndex","isWholeTableSelected","isHeader","useBorderBox","find","x","clearTableCellFormat","includeListFormatHolder","marker","filter","segmentType","isOnlySelectionMarkerSelected","adjustWordSelection","isWholeBlockSelected","defaultSegmentFormat","link","textColor","code","clearSegmentsFormat","table","borderCollapse","updateTableMetadata","createTablesFormat","step1Result","blockToWrap","creator","canMerge","prevBlock","wrapper","createAndAdd","setParagraphNotImplicit","addBlock","unshift","nextBlock","entityModel","position","isBlock","focusAfterEntity","context","blockParent","deleteResult","Object","assign","deleteSelection","insertPoint","paragraph","normalizeContentModel","pathIndex","child","directChild","childIndex","blocksToInsert","nextParagraph","createParagraph","createBr","createSelectionMarker","setSelection","image","border","borderRadius","width","style","color","extractedBorder","extractBorderValues","borderColor","borderWidth","borderStyle","borderFormat","borderTop","borderBottom","httpExcludeRegEx","labelRegEx","domainPortWithUrlRegEx","domainPortRegEx","linkMatchRules","http","match","RegExp","except","normalizeUrl","url","test","https","mailto","notes","file","unc","ftp","news","telnet","gopher","wais","getObjectKeys","schema","rule","matches","scheme","originalUrl","normalizedUrl","findListItems","group","result","pushNullIfNecessary","last","areListTypesCompatible","listItems","currentIndex","compareToIndex","currentLevels","compareToLevels","currentLevel","hasStartNumberOverride","levelLength","slice","currentItem","items","isOrderedList","filterListItems","shouldIgnoreBlock","removeMargins","paragraphOrListItems","alreadyInExpectedType","existingListItems","itemIndex","marginBottom","segmentFormat","newListItem","createListItem","marginTop","fontFamily","fontSize","firstMatcher","siblingMatcher","first","paragraphs","getSelectedParagraphs","changed","p","findIndex","shouldSplitTrailingSpace","text","trimRight","isTrailingSpace","splitTextSegment","textSegment","trailingSpace","substring","newText","createText","trailingSpaceLink","underline","trailingSpaceSegment","_","__","lastTextSegment","findDelimiter","moveRightward","word","offset","char","isPunctuation","isSpace","found","newSegmentLeft","newSegmentRight","markerBlock","tempSegments","markerSelectionIndex","currentSegment","selection","firstColumn","addSegment","operation","TextAlignValueMap","alignCellLeft","alignCellCenter","alignCellRight","VerticalAlignValueMap","alignCellTop","alignCellMiddle","alignCellBottom","alignTableCellInternal","callback","sel","getSelectedCells","firstRow","lastRow","lastColumn","verticalAlign","vAlignOverride","firstCol","lastCol","noSpanAbove","spanAbove","noSpanLeft","spanLeft","noDifferentBelowSpan","map","spanCount","getBelowSpanCount","a","noDifferentRightSpan","col","getRightSpanCount","widths","j","columns","createTable","createTableCell","cellInNextCol","collapseTableSelection","cellInNextRow","createEmptyParagraph","newPara","br","firstCell","shift","insertLeft","clearSelectedCells","newCell","dataset","insertAbove","sourceRow","height","canMergeCells","mergingColIndex","newSelectedCol","mergingRowIndex","newSelectedRow","newWidth","belowRow","belowCell","newHeight","newRow","editor","focus","formatContentModel","setModelAlignment","apiName","setModelDirection","HeaderFontSizes","h1","h2","h3","h4","h5","h6","headingLevel","para","tag","parseInt","fontWeight","newPendingFormat","createParagraphDecorator","spacing","lineHeight","toString","DefaultQuoteFormatLtr","DefaultQuoteFormatRtl","BuildInQuoteFormat","quoteFormat","quoteFormatRtl","fullQuoteFormatLtr","fullQuoteFormatRtl","toggleModelBlockQuote","type","options","contentNode","wrapperDisplay","skipUndoSnapshot","initialEntityState","getDocument","createElement","display","appendChild","createEntity","takeSnapshot","insertEntityModel","newEntities","selectionOverride","changeSource","ChangeSource","InsertEntity","getChangeData","id","isReadonly","entityState","parseEntityFormat","entityType","state","clearModelFormat","pendingFormat","getPendingFormat","getContentModelCopy","manager","getSnapshotsManager","canUndo","hasNewContent","canMove","canRedo","isDarkMode","retrieveModelFormatState","adjustSegmentSelection","ref","getDOMSelection","readFile","dataUrl","isDisposed","originalSrc","updateImageMetadata","src","previousSrc","alt","triggerEvent","newSrc","insertImageWithSrc","createImage","backgroundColor","doc","createContentModelDocument","mergeModel","mergeFormat","imageFileOrSrc","altText","applyImageBorderFormat","boxShadow","margin","href","getSelectedSegments","firstSegment","join","URI_REGEX","MAILTO_REGEX","FTP_REGEX","anchorTitle","displayText","checkXss","trim","prefix","search","applyLinkPrefix","originalText","createLink","addLink","adjustTrailingSpaceSelection","CreateLink","onNodeCreated","modelElement","node","isChanged","getFirstSelectedListItem","newFormat","italic","strikethrough","superOrSubScriptSequence","capitalization","language","toLocaleLowerCase","toLocaleUpperCase","wordArray","split","charAt","regex","replace","FONT_SIZES","change","sizeInPt","newSize","pt","changeBase","fontSizes","min","getNewFontSize","setFontSizeInternal","changeFontSizeInternal","lastParagraph","lastSegmentIndex","fontName","isTurningOn","isBold","DefaultCode","addCode","applyBorderFormat","positions","pos","tableModel","getFirstSelectedTable","perimeter","Top","Bottom","Left","Right","operations","allBorders","leftBorder","rightBorder","topBorder","bottomBorder","singleCol","singleRow","modifyPerimeter","alignTableCellHorizontally","alignTableCellVertically","deleteTableColumn","deleteTableRow","deleteTable","mergeTableRow","mergeTableCells","mergeTableColumn","splitTableCellHorizontally","splitTableCellVertically","keepCellShade","insertPosition","createTableStructure","normalizeTable","firstBlock","hasSelectionInBlockGroup","setTableCellBackgroundColor","setStyleCallback","toggleStyleCallback","segmentHasStyleCallback","includingFormatHolder","afterFormatCallback","segmentAndParagraphs","getSelectedSegmentsAndParagraphs","isCollapsedSelection","formatsAndSegments","isTurningOff","hasSelectionInBlock","ensureFocusableParagraphForTable","hasMetadata","BulletListType","Min","Disc","Dash","Square","ShortArrow","LongArrow","UnfilledArrow","Hyphen","DoubleLongArrow","Circle","Max","AutoLink","Format","ImageResize","Paste","SetContent","Cut","Drop","SwitchToDarkMode","SwitchToLightMode","ListChain","Keyboard","NumberingListType","Decimal","DecimalDash","DecimalParenthesis","DecimalDoubleParenthesis","LowerAlpha","LowerAlphaParenthesis","LowerAlphaDoubleParenthesis","LowerAlphaDash","UpperAlpha","UpperAlphaParenthesis","UpperAlphaDoubleParenthesis","UpperAlphaDash","LowerRoman","LowerRomanParenthesis","LowerRomanDoubleParenthesis","LowerRomanDash","UpperRoman","UpperRomanParenthesis","UpperRomanDoubleParenthesis","UpperRomanDash","TableBorderFormat","Default","ListWithSideBorders","NoHeaderBorders","NoSideBorders","FirstColumnHeaderExternal","EspecialType1","EspecialType2","EspecialType3","Clear","addUndoSnapshot","core","canUndoByBackspace","entityStates","lifecycle","physicalRoot","undo","snapshot","shadowEditFragment","createSnapshotSelection","html","innerHTML","snapshotsManager","addSnapshot","attachDomEvent","eventMap","disposers","pluginEventType","beforeDispatch","eventName","onEvent","event","api","eventType","rawEvent","logicalRoot","addEventListener","removeEventListener","createContentModel","option","cache","textMutationObserver","flushMutations","cachedModel","cloneModel","includeCachedElement","saveIndex","editorContext","createEditorContext","settings","environment","domToModelSettings","domToModelContext","createDomToModelContext","builtIn","customized","createDomToModelContextWithConfig","calculated","domToContentModel","cachedSelection","darkColorHandler","domHelper","defaultFormat","addDelimiterForEntity","allowCacheElement","domIndexer","zoomScale","calculateZoomScale","getRootComputedStyleForContext","ownerDocument","element","defaultView","getComputedStyle","isRootRtl","checkRootRtl","hasFocus","setDOMSelection","handlePendingFormat","range","collapsed","posContainer","startContainer","posOffset","startOffset","getChangedEntities","entity","concat","deletedEntities","entry","formatter","newImages","clearModelCache","isNested","shouldAddSnapshot","viewport","getVisibleViewport","maxWidth","handleImages","setContentModel","ignoreSelection","eventData","contentModel","source","data","formatApiName","changedEntities","isSelectionReverted","rangeCount","getRangeAt","focusNode","endContainer","focusOffset","endOffset","getSelection","contains","commonAncestorContainer","isReverted","getNewSelection","scrollContainer","domEvent","elements","additionalRects","rects","normalizeRect","getBoundingClientRect","rect","top","r","bottom","getIntersectedRect","restoreUndoSnapshot","newContent","isRestoring","restoreSnapshotHTML","restoreSnapshotSelection","restoreSnapshotColors","modelToDomContext","createModelToDomContext","modelToDomSettings","createModelToDomContextWithConfig","contentModelToDom","DOM_SELECTION_CSS_KEY","HIDE_CURSOR_CSS_KEY","CARET_CSS_RULE","setRangeSelection","createRange","selectNode","collapse","addRangeToSelection","skipSelectionChangedEvent","skipReselectOnFocus","setEditorStyle","imageSelectionBorderColor","ensureUniqueId","tableSelectors","tableId","parseTableCells","selectors","cont","indexes","toArray","childNodes","isNodeOfType","el","start","end","tdCount","midElement","ind","middleElSelector","currentRow","cellIndex","selector","handleTableSelected","buildTableSelectors","newSelection","idPrefix","querySelectorAll","cssRule","subSelectors","maxRuleLength","styleElement","styleElements","head","roosterjsStyleKey","sheet","cssRules","deleteRule","rootSelector","maxLen","stringBuilder","len","subSelector","buildSelectors","insertRule","switchShadowEdit","editorCore","isOn","fragment","createDocumentFragment","clonedRoot","cloneNode","moveChildNodes","allowedEventsInShadowEdit","pluginEvent","broadcast","plugins","plugin","onPluginEvent","willHandleEventExclusively","handledExclusively","contentDiv","onMutation","isTextChangeOnly","updateCachedModel","invalidateCache","onNativeSelectionChange","this","disableCache","domIndexerImpl","createTextMutationObserver","getName","initialize","startObserving","dispose","stopObserving","getState","isInShadowEdit","forceUpdate","newRangeEx","areSameSelection","reconcileSelection","CachePlugin","disposer","onContextMenuEvent","e","mouseEvent","button","getFocusedNode","contextMenuProviders","provider","getContextMenuItems","isContextMenuProvider","contextmenu","getSelectionRootNode","ContextMenuPlugin","onPaste","clipboardData","isClipboardEvent","dataTransfer","preventDefault","extractClipboardItems","allowedCustomPasteType","then","paste","defaultPasteType","tempDiv","copy","onCutCopy","cut","parentNode","removeChild","isCut","pasteModel","preprocessTable","adjustSelectionForCopyCut","getTempDiv","selectionForCopy","newRange","elementToSelect","parentElement","childElementCount","domSelectionToRange","requestAnimationFrame","cleanUpAndRestoreSelection","deleteEmptyList","overflow","userSelect","contentEditable","body","div","selectionMarker","tableCtxt","includes","isElementOfType","wrap","isContentEditable","removeAttribute","onCreateCopyEntityNode","CopyPastePlugin","EventTypeMap","keydown","keyup","keypress","onDragStart","dragEvent","onDrop","onScroll","keyboardEventHandler","isCharacterValue","isCursorMovingKey","stopPropagation","isComposing","isInIME","inputEventHandler","onMouseDown","mouseUpEventListerAdded","onMouseUp","mouseDownX","pageX","mouseDownY","pageY","removeMouseUpEventListener","isClicking","onCompositionStart","onCompositionEnd","document","eventHandlers","input","mousedown","compositionstart","compositionend","dragstart","drop","DOMEventPlugin","ENTITY_ID_REGEX","entityMap","handleMouseUpEvent","handleContentChangedEvent","handleDelimiterKeyDownEvent","handleCompositionEndEvent","handleExtractContentWithDomEvent","getDOMHelper","isNodeInEditor","isEntityElement","modifiedEntities","isFakeEntity","entityFormat","className","generateEntityClassNames","eventResult","canPersist","shouldPersist","transformColor","getColorManager","mapEntry","isDeleted","handleDelimiterContentChangedEvent","findAllEntities","root","getAllEntityWrappers","exec","baseId","substr","newId","num","EntityPlugin","DefaultStyleKeyMap","lastCheckedNode","defaultFormatKeys","Set","add","checkAndApplyPendingFormat","clearPendingFormat","size","shouldApplyDefaultFormat","applyDefaultFormat","canApplyPendingFormat","applyPendingFormat","getAttribute","isBlockElement","FormatPlugin","ContentEditableAttributeName","initializer","adjustColor","doNotAdjustEditorColor","adjustContainerColor","inDarkMode","setColor","LifecyclePlugin","isSafari","isMac","getContainedTargetImage","previousSelection","firstChild","onFocus","onBlur","onSelectionChangeSafari","env","getEnvironment","blur","getClickingImage","selectImage","selectBeforeImage","isModifierKey","shiftKey","setStart","SelectionPlugin","Backspace","Delete","Enter","createSnapshotsManager","snapshots","lastKeyPress","ctrlKey","canUndoAutoComplete","onKeyDown","onKeyPress","clearRedoForInput","onContentChanged","onBeforeKeyboardEditing","evt","altKey","defaultPrevented","isCtrlOrMetaPressed","metaKey","clearRedo","UndoPlugin","createCachePlugin","createFormatPlugin","copyPaste","createCopyPastePlugin","createDOMEventPlugin","createLifecyclePlugin","createEntityPlugin","createSelectionPlugin","contextMenu","createContextMenuPlugin","createUndoPlugin","removeAllRanges","setBaseAndExtent","addRange","getNewPendingFormat","markerFormat","blockCount","isImplicit","previousBlock","previousSegment","subStr","sel1","sel2","r1","r2","isEmptyBlock","listItemIndex","isIndexedSegment","__roosterjsContentModel","Array","isArray","onSegment","segmentNode","reconcileNodeSelection","reconcileTextSelection","insertMarker","lastChild","isAfter","formatSegment","textNode","selectable","newSegments","txt","nodeValue","textSegments","middle","newLast","firstIndex","lastIndex","onParagraph","paragraphElement","previousText","nextSibling","onTable","tableElement","tableRows","oldSelection","marker1","marker2","DelimiterBefore","DelimiterAfter","DelimiterSelector","ZeroWidthSpace","preventTypeInDelimiter","entitySibling","classList","previousElementSibling","nextElementSibling","removeInvalidDelimiters","_path","_tableContext","_segments","nodes","isEntityDelimiter","sibling","checkEntity","remove","normalize","cn","textContent","Range","setEnd","deleteContents","removeDelimiterAttr","getFocusedElement","existingTextInDelimiter","textToCheck","closest","hasChildNodes","helper","queryElements","addDelimiters","addDelimitersIfNeeded","isEnter","blockEntityContainer","setStartAfter","setStartBefore","handleKeyDownInBlockDelimiter","handleEnterInlineEntity","w","selectionBlock","selectionBlockParent","markerIndex","segmentsAfterMarker","selectionBlockIndex","entities","onMutationInternal","mutations","firstTarget","mutation","observer","MutationObserver","observe","subtree","childList","attributes","characterData","disconnect","takeRecords","TextMutationObserverImpl","getTextContent","originalWidth","visualWidth","offsetWidth","round","setDomAttribute","name","setAttribute","getDomAttribute","getDomStyle","findClosestElementAncestor","startFrom","startElement","closestElement","activeElement","DOMHelperImpl","getDarkColor","knownColors","updateKnownColor","colorPair","darkModeColor","keys","reset","removeProperty","DarkColorHandlerImpl","cloneOptionCallback","colorHandler","createEditorCore","initialModel","createEmptyModel","getCore","disposeErrorHandler","mode","processorOverride","tableProcessor","reducedModelChildProcessor","restoreSnapshot","setDarkModeState","startShadowEdit","stopShadowEdit","getTrustedHTMLHandler","trustedHTMLHandler","getScrollContainer","Error","Editor","hasNewContentValue","totalSize","autoCompleteIndex","maxSize","step","newIndex","move","onChanged","isAutoCompleteSnapshot","currentSnapshot","isSameSnapshot","getSnapshotLength","removeCount","removedSize","SnapshotsManagerImpl","coreApiMap","createEditorEnvironment","navigator","userAgent","appVersion","createDomToModelSettings","createModelToDomSettings","isAndroid","isMobileOrTablet","getIsMobileOrTablet","defaultTrustHtmlHandler","getDarkColorFallback","corePlugins","createEditorCorePlugins","coreApiOverride","originalApi","createDarkColorHandler","createDOMHelper","getPluginState","tablePreProcessor","defaultDomToModelOptions","createDomToModelConfig","metadataAppliers","listItemMetadataApplier","listLevel","listLevelMetadataApplier","defaultModelToDomOptions","createModelToDomConfig","createModelFromHtml","exportContent","deleteSegment","deleteBlock","hasSelectionInSegment","MIN_ALLOWED_TABLE_CELL_WIDTH","combineBorderValue","normalizeText","createTableRanges","getSegmentTextFormat","cacheGetEventData","redo","getListStyleTypeFromString","isOptional","minValue","maxValue","allowNull","itemDef","minLength","maxLength","propertyDef","NumberDefinition","createNumberDefinition","ImageMetadataFormatDefinition","createObjectDefinition","widthPx","heightPx","leftPercent","rightPercent","topPercent","bottomPercent","angleRad","createStringDefinition","naturalHeight","naturalWidth","updateMetadata","DefaultOrderedListStyles","DefaultUnorderedListStyles","OrderedMapPlaceholderRegex","RomanValues","M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I","OrderedMap","UnorderedMap","convertDecimalsToAlpha","decimal","isLowerCase","alpha","String","fromCharCode","toLowerCase","convertDecimalsToRoman","romanValue","timesRomanCharAppear","repeat","listMetadataDefinition","orderedStyleType","unorderedStyleType","createBooleanDefinition","shouldApplyToItem","listStyleType","getRawListStyleType","depth","bullet","metadataDefinition","applierFunction","template","listNumber","listFormat","nodeStack","threadItemCounts","list","TableCellMetadataFormatDefinition","bgColorOverride","NullStringDefinition","BooleanDefinition","TableFormatDefinition","topBorderColor","bottomBorderColor","verticalBorderColor","hasHeaderRow","headerRowColor","hasFirstColumn","hasBandedColumns","hasBandedRows","bgColorEven","bgColorOdd","tableBorderFormat","DeleteSelectionIteratingOptions","contentUnderSelectedTableCell","contentUnderSelectedGeneralElement","createInsertPoint","formatContext","insertMarkerIndex","lastTableContext","isForward","array","deleteLength","deleteState","containerSizeFormatParser","BlockEntityClass","OneHundredPercent","InlineBlock","pasteBlockEntityParser","pasteDisplayFormatParser","DefaultStyleSanitizers","allowedTags","AllowedTags","additionalAllowedTags","disallowedTags","DisallowedTags","additionalDisallowedTags","styleSanitizers","attrSanitizers","attributeSanitizers","sanitizedElement","sanitizeElement","defaultElementProcessors","removeDisplayFlex","processor","createSanitizedElement","span","pasteTextProcessor","whiteSpace","blockFormat","isWhiteSpacePreserved","selectionRootNode","startNode","createNodeStack","stackChild","getRegularSelectionOffsets","nodeStartOffset","nodeEndOffset","getChildIndex","handleRegularSelection","processChildNode","selectionRoot","isInSelection","shouldUseTableProcessor","entityProcessor","iterateElements","transformer","includeSelf","isHTMLElement","htmlElement","nodeType","Node","ELEMENT_NODE","rootNode","toDarkMode","getColor","backColor","BorderStyles","BorderSizeRegex","combinedBorder","v","getter","eventDataCache","hasOwnProperty","CursorMovingKeys","isCtrlKey","isAltKey","isMetaKey","has","letterSpacing","removeUndefinedValues","textFormat","FileReader","onload","onerror","readAsDataURL","SPACES_REGEX","charCodeAt","trs","tr","sourceCol","targetCol","td","colSpan","rowSpan","mergeValue","isFirst","parseFn","val","formatState","firstTableContext","px","isFirstImage","isFirstSegment","retrieveStructureFormat","isMultilineSelection","validHeadingLevel","retrieveParagraphFormat","modelFormat","mergedFormat","superOrSubscript","retrieveSegmentFormat","canUnlink","canAddImageAltText","imageFormat","canMergeTableCell","tableFormat","isInTable","tableHasHeader","retrieveTableFormat","parseFloat","cloneModelWithFormat","cloneModelWithDataset","cloneBlockBase","cloneBlockGroupBase","handleCachedElement","zeroFontSize","cloneFormatContainer","cloneGeneralBlock","formatHolder","cloneSelectionMarker","cloneListLevel","cloneListItem","divider","cloneDivider","cloneEntity","newParagraph","cloneSegmentBase","general","cloneGeneralSegment","title","isSelectedAsImageSelection","cloneSegment","cloneParagraph","from","cloneTableCell","cloneTableRow","cloneTable","cloneBlock","newSegment","newModel","DOMParser","parseFromString","createDomToModelContextForSanitizing","retrieveCssRules","convertInlineCss","parseFormat","formatParsers","segmentOnBlock","contentModelToText","blockGroupTypes","stopTypes","boldStyle","HeadingTags","mergeParagraph","markerPosition","mergeToCurrentParagraph","splitParagraph","segmentIndex","sourceKeys","mergeTable","newTable","k","leftCell","aboveCell","oldCell","newMarker","insertBlock","mergeList","newList","listParent","newParaFormat","paraIndex","applyDefaultFormatOption","mergeBlockFormat","mergeSegmentFormat","targetformat","sourceFormat","createDOMFromHtml","pasteType","modelBeforePaste","rawHtml","htmlFromClipboard","retrieveHtmlInfo","sourceFragment","createPasteFragment","generatePasteOptionFromPlugins","globalCssRules","mergePasteContent","selections","collectSelections","deepFirst","findSequence","removeUnmeaningfulSelections","groupIndex","checkFirstParagraph","allSegments","resultPath","blockToDelete","replacement","segmentToDelete","preserveWhiteSpace","isBackward","normalizeSingleSegment","normalizePreviousSegment","deleteSingleChar","additionalSteps","deleteExpandedSelection","isValidDeleteSelectionContext","mergeParagraphAfterDelete","internalIterateSelections","treatAllAsSelect","hasSelectedSegment","hasUnselectedSegment","newPath","handleGeneralContent","handleGeneralElement","setSelectionToBlockGroup","handleSelection","isGeneralSegment","setIsSelected","findCell","currentCell","setSelectionToTable","segmentsToDelete","setSelectionToSegment","setSelectionToBlock","DEFAULT_FORMAT","effectiveMetadata","metaOverrides","removeCellShade","overrides","bgColorOverrides","vAlignOverrides","borderOverrides","updateOverrides","clearCache","transparentBorderMatrix","BorderFormatters","alwaysUseTransparent","BorderKeys","getBorderStyleFromColor","formatCells","setBorderColor","setFirstColumnFormat","setHeaderRowFormat","hasSelection","getTableCellWidth","tryMoveBlocks","targetCell","sourceCell","s","White","Black","shouldRemoveColor","cellBackgroundColor","lightness","calculateLightness","colorValues","parseColor","red","green","blue","isColorOverride","applyToSegments","setAdaptiveCellColor","removeAdaptiveCellColor","styles","styleNode","ruleIndex","CSSRule","STYLE_RULE","selectorText","cssText","DefaultSanitizingOption","formatParserOverride","additionalFormatParsers","defaultOption","additionalSanitizingOption","sanitizingOption","createPasteEntityProcessor","createPasteGeneralProcessor","getPath","previousSibling","isPreviousText","c","normalizeTableTree","isDOMChanged","tbody","insertBefore","colgroups","thead","querySelector","colgroup","imageId","ContentHandlers","customValues","linkPreview","JSON","parse","types","files","pasteNativeEvent","Promise","all","kind","resolve","getAsFile","textType","getAllowedCustomType","getAsString","imageDataUri","rootComputedStyle","documentElement","rootFontSize","img","line","lines","initialOffset","tIndex","lineBefore","lineAfter","tabCount","fill","transformTabCharacters","createTextNode","htmlBefore","htmlAfter","htmlAttributes","domToModelOption","EmptySegmentFormat","CloneOption","shouldMergeTable","customizedMerge","clonedModel","selectedSegment","mergeOption","START_FRAGMENT","END_FRAGMENT","retrieveMetadata","attr","meta","content","startIndex","endIndex","lastIndexOf","retrieveHtmlStrings","htmlFirstLevelChildTags","topLevelTags","retrieveTopLevelTags","BlockEntityContainer","tryGetEntityElement","getEntityWrapperForReuse","isBlockEntityContainer","tryGetEntityFromContainer","entityId","refNode","currentNode","next","originalEntityElement","reuseCachedElement","markerNode","replaceChild","getPositionFromPath","snapshotSelection","domSelection","startPos","endPos","VARIABLE_REGEX","VARIABLE_PREFIX","AllowedAttributes","DefaultStyleValue","padding","float","orphans","widows","attribute","sanitizer","processStyles","pairs","pair","valueIndex","isCssVariable","processCssVariable","sanitizedValue","startsWith","newChild","defaultContentModelFormatMap","blockquote","pre","blockElement","defaultHTMLStyleMap","address","article","aside","dd","dl","dt","em","fontStyle","fieldset","figcaption","figure","footer","form","header","hr","li","main","nav","ol","paddingInlineStart","textDecoration","section","strike","strong","sub","sup","boxSizing","th","u","ul","config","blockDecorator","elementProcessors","defaultProcessorMap","buildFormatParsers","defaultFormatParsers","additionalParsersArray","combinedOverrides","defaultFormatKeysPerCategory","reduce","formatKey","parsers","linkProcessor","knownElementProcessor","brProcessor","codeProcessor","font","fontProcessor","imageProcessor","headingProcessor","hrProcessor","listItemProcessor","listProcessor","pProcessor","formatContainerProcessor","generalProcessor","textProcessor","elementProcessor","childProcessor","delimiter","delimiterProcessor","SegmentDecoratorTags","isSegmentDecorator","ContextStyles","addSelectionMarker","stackFormat","tryGetProcessorForEntity","tryGetProcessorForDelimiter","isBlockEntity","FontSizes","intSize","Number","isNaN","getDefaultStyle","formatContainer","shouldFallbackToParagraph","generalBlockProcessor","createGeneralBlock","isSelectedBefore","generalSegmentProcessor","createGeneralSegment","addDecorators","blockProcessor","createDivider","FormatContainerTriggerStyles","ByPassFormatContainerTags","defaultStyle","bgcolor","getPropertyValue","shouldUseFormatContainer","segmentUnderLink","hasAttribute","listItemElement","listItemThread","currentBlocks","lastItem","listLevelThread","originalListParent","calcSizes","lastPos","tableSelection","hasTableSelection","tableBorder","columnPositions","hasColGroup","colFormat","tableColumn","processColGroup","rowPositions","tableRow","parentTag","hasSelectionBeforeCell","colEnd","rowEnd","needCalcWidth","needCalcHeight","segmentOnTableCell","cellFormat","tableCell","hasTd","spannedRow","hasSelectionAfterCell","heights","internalTextProcessor","offsets","txtStartOffset","txtEndOffset","ensureParagraph","subText","addTextSegment","textModel","hasSpacesOnly","parser","lastPara","formatFromParagraph","f1","f2","keys1","keys2","currentContainer","BLOCK_DISPLAY_STYLES","SkippedStylesForBlockOnSegmentOnSegment","SkippedStylesForTable","stackFormatInternal","processType","textIndent","isTextIndentApplied","linkFormat","codeFormat","decoratorFormat","stackLinkInternal","stackCodeInternal","ENTITY_INFO_NAME","ENTITY_TYPE_PREFIX","ENTITY_ID_PREFIX","ENTITY_READONLY_PREFIX","DELIMITER_BEFORE","DELIMITER_AFTER","isDelimiter","insertDelimiter","isEntity","parseEntityClassName","entityWrapper","delimiterAfter","delimiterBefore","applyFormat","formatAppliers","obj","expectedType","WHITESPACE_PRE_VALUES","EditingInfoDatasetName","definition","metadataString","validate","stringify","def","n1","n2","abs","keepExistingChildren","newElement","clientRect","collection","call","wrapperTag","directionFormatHandler","dir","apply","displayFormatHandler","htmlAlignFormatHandler","htmlAlign","calcAlign","lineHeightFormatHandler","MarginKeys","marginFormatHandler","implicitFormat","PaddingKeys","AlternativeKeyLtr","AlternativeKeyRtl","paddingFormatHandler","alterativeKey","defaultValue","textAlignFormatHandler","flexDirection","alignSelf","textIndentFormatHandler","whiteSpaceFormatHandler","shouldSetValue","backgroundColorFormatHandler","borderBoxFormatHandler","BorderWidthKeys","BorderRadiusKeys","AllKeys","borderFormatHandler","defaultWidth","boxShadowFormatHandler","datasetFormatHandler","floatFormatHandler","idFormatHandler","PercentageRegex","tryParseSize","attrName","attrValue","sizeFormatHandler","maxHeight","minWidth","minHeight","verticalAlignFormatHandler","wordBreakFormatHandler","wordBreak","defaultFormatHandlerMap","bold","boldFormatHandler","borderBox","fontFamilyFormatHandler","fontSizeFormatHandler","entityFormatHandler","italicFormatHandler","letterSpacingFormatHandler","linkFormatHandler","listItemThreadFormatHandler","listLevelThreadFormatHandler","listStyle","listStyleFormatHandler","strikeFormatHandler","superOrSubScript","superOrSubScriptFormatHandler","tableLayout","tableLayoutFormatHandler","tableSpacing","tableSpacingFormatHandler","textColorFormatHandler","textColorOnTableCell","textColorOnTableCellFormatHandler","underlineFormatHandler","styleBasedSegmentFormats","elementBasedSegmentFormats","sharedBlockFormats","sharedContainerFormats","styleBasedSegment","elementBasedSegment","tableCellBorder","defaultFormatAppliers","isLiUnderOl","defaultStyles","displayForDummyItem","startNumber","listStylePosition","blockFontWeight","wrapAllChildNodes","isSuperOrSubScript","contextFont","knownFontSize","KnownFontSizes","isRemUnit","endsWith","existingFontSize","normalizeFontSize","small","medium","large","rel","anchorId","relationship","anchorClass","reverse","implicitColor","BorderCollapsed","BorderSeparate","borderSeparate","borderSpacing","DeprecatedColors","HEX3_REGEX","HEX6_REGEX","RGB_REGEX","RGBA_REGEX","isBackground","darkColor","rgbSearch","rgbCurrent","lightModeColor","findLightColorFromDarkColor","existingKey","fallbackColor","COLOR_VAR_PREFIX","initial","align","MarginValueRegex","getFontSize","currentSizeOrElement","styleInPt","ptToPx","currentSizePxOrElement","resultUnit","numStr","unit","normalValue","existingValue","normalizeParagraph","isEmpty","lastSegment","lastBlock","SPACE_TEXT_REGEX","isBlockEmpty","isBlockGroupEmpty","isSegmentEmpty","isBlockGroup","isSegment","secondLast","noMarkerSegments","normalizeAllSegments","prev","removeEmptyLinks","removeEmptySegments","formatsToMoveUp","firstFormat","internalMoveUpSegmentFormat","moveUpSegmentFormat","SPACE","NONE_BREAK_SPACE","LEADING_SPACE_REGEX","TRAILING_SPACE_REGEX","resetNormalizeSegmentContext","ignoreLeadingSpaces","ignoreTrailingSpaces","lastInlineSegment","normalizeSegment","normalizeTextSegments","normalizeLastTextSegment","groupToUnwrap","rowCount","spanLeftOrColSpan","spanAboveOrRowSpan","calcPosition","modelHandlers","blockGroupChildren","startPosition","endPosition","imageSelection","extractSelectionRange","regularSelection","defaultContentModelHandlers","modelHandlerOverride","buildFormatAppliers","formatApplierOverride","additionalFormatAppliers","defaultModelHandlers","additionalAppliersArray","appliers","handleBlock","handleBlockGroupChildren","handleBr","entityBlock","handleEntityBlock","entitySegment","handleEntitySegment","generalBlock","handleGeneralBlock","generalSegment","handleGeneralSegment","handleDivider","handleImage","handleList","handleListItem","handleParagraph","handleFormatContainer","handleSegment","segmentDecorator","handleSegmentDecorator","handleTable","handleText","handlers","childBlock","segmentNodes","handleSegmentCommon","getSegmentFormat","isCursorAroundEntity","isContained","elementToReuse","after","before","PreChildFormat","imageModel","widthNum","heightNum","layer","stackLevel","itemLevel","editingInfo","applyMetadata","unwrap","needParagraphWrapper","formatOnWrapper","handleSegments","optimize","codeNode","tableNode","applier","OptimizeTags","hasSameAttributes","element1","element2","attr1","attr2","removeUnnecessarySpan","mergeNode","newNode","containerNode","tagNameOrFormat","contentModelToTextArray","textArray","separator","DefaultOptions","autoBullet","autoNumbering","autoUnlink","autoLink","handleKeyDownEvent","handledByEditFeature","keyboardListTrigger","createLinkAfterSpace","unlink","AutoFormatPlugin","getLinkSegment","selectedSegmentsAndParagraphs","linkSegment","selectedParagraph","letter","toUpperCase","listIndex","indexNumber","convertAlphaToDecimals","shouldSearchForBullet","shouldSearchForNumbering","listMarkerSegment","listMarker","bulletType","bulletListType","styleType","previousList","getPreviousListLevel","previousIndex","getPreviousListIndex","previousListStyle","getPreviousListStyle","numberingType","getNumberingListStyle","isNewList","previousListItem","listBlockIndex","NumberingTypes","Character","characters","lowerRomanTypes","upperRomanTypes","numberingTriggers","lowerRomanNumbers","upperRomanNumbers","numberingListTypes","DecimalsTypes","LowerAlphaTypes","UpperAlphaTypes","LowerRomanTypes","UpperRomanTypes","textBeforeCursor","previousListIndex","trigger","isDoubleParenthesis","getIndex","isContinuosList","canAppendList","isValidNumbering","numbering","separatorCharacter","identifyNumberingType","identifyNumberingListType","_context","getListTypeStyle","segmentsAndParagraphs","triggerList","isMenuShowing","onDismiss","dismiss","allowDefaultMenu","initContainer","render","y","ContextMenuPluginBase","shouldHandleNextInputEvent","beforeinput","handleBeforeInputEvent","keyboardDelete","keyboardTab","keyboardInput","InputEvent","handled","inputType","KeyboardEvent","keyCode","which","EditPlugin","deleteAllSegmentBefore","getDeleteCollapsedSelection","segmentsWithoutBr","fixupBr","shouldOutdentParagraph","lastInPath","getRoot","getLeafSiblingBlock","siblingSegment","forwardDeleteCollapsedSelection","backwardDeleteCollapsedSelection","deleteEmptyQuote","quote","quoteBlockIndex","blockQuote","isEmptyQuote","isSelectionOnEmptyLine","insertNewLine","quoteLength","deleteList","DeleteWordState","getDeleteWordSelection","deleteNext","iterator","forward","punctuation","space","iterateSegments","curr","done","forwardDeleteWordSelection","backwardDeleteWordSelection","handleEnterOnList","nextListItem","isEmptyListItem","createNewListItem","createNewParagraph","createNewListLevel","canDeleteBefore","canDeleteAfter","shouldDeleteWithContentModel","deleteAllSegmentBeforeStep","shouldDeleteAllSegmentsBefore","deleteWordSelection","shouldDeleteWord","deleteCollapsedSelection","deleteQuote","getDeleteSteps","handleKeyboardEventResult","shouldHandleEnterKey","shouldInputWithContentModel","getInputSteps","handleTabOnParagraph","handleTabOnList","handleTab","findSelectedParagraph","isMarkerAtStartOfBlock","tabSpaces","selectedSegments","isCollapsed","isAllSelected","tabText","tabSpaceTextLength","firstSelectedSegment","spaceText","isNext","TableEditPlugin","PastePlugin","ShortcutBold","ShortcutItalic","ShortcutUnderline","ShortcutClearFormat","ShortcutUndo","ShortcutUndo2","ShortcutRedo","ShortcutRedoMacOS","ShortcutBullet","ShortcutNumbering","ShortcutIncreaseFont","ShortcutDecreaseFont","ShortcutIndentList","ShortcutOutdentList","ShortcutPlugin","WatermarkPlugin","LAST_TD_END_REGEX","LAST_TR_END_REGEX","LAST_TR_REGEX","LAST_TABLE_REGEX","DEFAULT_BORDER_STYLE","excelHandler","trMatch","tableMatch","allowExcelNoBorderTable","replaceChildren","addParser","setProcessor","pasteSource","getPasteSource","processPastedContentFromWordDesktop","processPastedContentWacComponents","processPastedContentFromExcel","PastePropertyNames","GOOGLE_SHEET_NODE_NAME","processPastedContentFromPowerPoint","parseLink","deprecatedBorderColorParser","tableBorderParser","blockElementParser","ElementBorderKeys","Map","styleSet","WORD_ONLINE_TABLE_TEMP_ELEMENT_CLASSES","BULLET_LIST_STYLE","NUMBER_LIST_STYLE","IMAGE_BORDER","IMAGE_CONTAINER","OUTLINE_ELEMENT","PARAGRAPH","LIST_CONTAINER_ELEMENT_CLASS_NAME","COMMENT_HIGHLIGHT_CLASS","COMMENT_HIGHLIGHT_CLICKED_CLASS","TEMP_ELEMENTS_CLASSES","WAC_IDENTIFY_SELECTOR","LIST_ELEMENT_TAGS","LIST_ELEMENT_SELECTOR","wacSubSuperParser","wacElementProcessor","elementTag","shouldClearListContext","wacLiElementProcessor","currentListLevels","lastblock","ctx","extractWordListMetadata","thread","updateStartOverride","newLevels","wacListItemParser","wacListLevelParser","wacCommentParser","ev","wacContainerParser","FORMATING_REGEX","metadataMap","indexAt","indexCurlyEnd","indexCurlyStart","metadataName","trimLeft","dataName","record","formatedKey","formatedValue","set","getStyleMetadata","wordDesktopElementProcessor","removeNegativeTextIndentParser","listLevelParser","wordTableParser","metadataKey","getStyles","processWordList","processWordComments","MSO_COMMENT_ANCHOR_HREF_REGEX","TEMPLATE_VALUE_REGEX","wordListPaddingParser","wordKnownLevels","wordListStyle","lNumber","wordLevel","wordList","listMetadata","templateFinal","templateType","templateValue","getBulletFromMetadata","getLastNotEmptyBlock","NaN","knownLevel","setStartNumber","processAsListItem","PROG_ID_NAME","EXCEL_DESKTOP_ATTRIBUTE_NAME","documentContainWacElements","props","getSourceFunctions","isWordDesktopDocument","isExcelDesktopDocument","isExcelOnlineDocument","isPowerPointDesktopDocument","isGoogleSheetDocument","shouldConvertToSingleImage","shouldConvertSingleImage","param","func","dColor","SUPPORTED_PROTOCOLS","INVALID_LINKS_REGEX","URL","protocol","elementData","namespace","children","createElementNS","datasetName","childElement","MOUSE_EVENT_INFO_DESKTOP","MOUSEDOWN","MOUSEMOVE","MOUSEUP","getPageXY","MOUSE_EVENT_INFO_MOBILE","targetTouches","touch","onSubmit","handler","forceMobile","initX","initY","initValue","addDocumentEvents","dndMouse","onMouseMove","deltaX","deltaY","onDragging","removeDocumentEvents","onDragEnd","DragAndDropHelper","defaultShortcuts","shortcuts","cacheGetCommand","command","onClick","matchOS","matchShortcut","shortcutKey","ctrlOrMeta","modifierKey","Keys","setShortcutIndentationCommand","anchorContainerSelector","onMouseMoveDisposer","tableRectMap","tableEditor","onMouseOut","relatedTargetNode","currentTargetNode","isOwnedElement","setTableEditor","buttons","ensureTableRects","editorWindow","window","scrollX","scrollY","currentTable","invalidateTableRects","mousemove","disposeTableEditor","isEditing","TableEditor","currentTarget","TOP_OR_SIDE","anchorContainer","horizontalInserter","verticalInserter","horizontalResizer","verticalResizer","tableResizer","tableMover","onFinishEditing","isCurrentlyEditing","onStartTableResize","onStartResize","onStartCellResize","disposeTableResizer","onInserted","onSelect","getOnMouseOut","feature","relatedTarget","isRTL","setEditorFeatures","disposeCellResizers","disposeTableInserter","disposeTableMover","tableRect","topOrSide","topOrSideBinary","tdRect","lessThanBottom","lessThanRight","moreThanLeft","isOnRightHalf","setInserterTd","tdAbove","tdAboveRect","isTdNotAboveMerged","setResizingTd","createTableMover","createTableResizer","createCellResizer","isHorizontal","inserter","newInserter","createTableInserter","disposeTableEditFeature","onStart","columnIndex","cmTable","anchorColumn","anchorRow","anchorRowHeight","allWidths","onDraggingHorizontal","onDraggingVertical","anchorChange","nextAnchorChange","setHorizontalPosition","CELL_RESIZER_WIDTH","setVerticalPosition","onEnd","createElementData","setPosition","featureHandler","resizer","onInsert","viewPort","isDark","inserterColor","getInsertElementData","TableInsertHandler","insertTd","onMouseOutEvent","onFinishDragging","visibleViewport","containerRect","isTableTopVisible","TABLE_MOVER_LENGTH","setDivPosition","TableMoverFeature","TABLE_RESIZER_LENGTH","originalRect","originalHeights","originalWidths","ratioX","ratioY","shouldResizeX","shouldResizeY","isTableBottomVisible","visibility","hideResizer","WATERMARK_CONTENT_KEY","styleMap","watermark","isShowing","isModelEmptyFast","hide","show","additionalPlugins","createEditor","extendStatics","d","setPrototypeOf","__proto__","prototype","__extends","TypeError","constructor","create","__assign","t","n","arguments","__rest","getOwnPropertySymbols","propertyIsEnumerable","__decorate","decorators","desc","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__param","paramIndex","__esDecorate","ctor","descriptorIn","contextIn","initializers","extraInitializers","accept","f","descriptor","access","addInitializer","init","__runInitializers","thisArg","useValue","__propKey","__setFunctionName","description","configurable","__metadata","metadataValue","__awaiter","_arguments","P","generator","reject","fulfilled","rejected","__generator","g","label","sent","trys","ops","verb","Symbol","op","__createBinding","o","m","k2","__esModule","writable","enumerable","__exportStar","__values","__read","ar","error","__spread","__spreadArrays","il","jl","__spreadArray","to","pack","l","__await","__asyncGenerator","asyncIterator","q","resume","fulfill","settle","__asyncDelegator","__asyncValues","__makeTemplateObject","cooked","raw","__setModuleDefault","__importStar","mod","__importDefault","default","__classPrivateFieldGet","receiver","__classPrivateFieldSet","__classPrivateFieldIn","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","prop","toStringTag","__webpack_exports__"],"sourceRoot":""}