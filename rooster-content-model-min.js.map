{"version":3,"file":"rooster-content-model-min.js","mappings":"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","sources":["webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/config/defaultContentModelFormatMap.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/config/defaultHTMLStyleMap.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/context/createDomToModelContext.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/context/defaultProcessors.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/domToContentModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/blockProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/brProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/childProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/codeProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/delimiterProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/elementProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/entityProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/fontProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/formatContainerProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/generalProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/headingProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/hrProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/imageProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/knownElementProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/linkProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/listItemProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/listProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/pProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/tableProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/processors/textProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/utils/addSelectionMarker.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/utils/areSameFormats.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/utils/getBoundingClientRect.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/utils/getDefaultStyle.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/utils/getRegularSelectionOffsets.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/utils/isBlockElement.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/utils/parseFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domToModel/utils/stackFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domUtils/entityUtils.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domUtils/getObjectKeys.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domUtils/isElementOfType.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domUtils/isNodeOfType.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domUtils/metadata/updateListMetadata.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domUtils/metadata/updateMetadata.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domUtils/moveChildNodes.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/domUtils/toArray.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/block/directionFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/block/displayFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/block/htmlAlignFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/block/lineHeightFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/block/marginFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/block/paddingFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/block/textAlignFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/block/whiteSpaceFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/common/backgroundColorFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/common/borderBoxFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/common/borderFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/common/boxShadowFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/common/datasetFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/common/floatFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/common/idFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/common/sizeFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/common/verticalAlignFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/common/wordBreakFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/defaultFormatHandlers.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/entity/entityFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/list/listItemMetadataFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/list/listItemThreadFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/list/listLevelMetadataFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/list/listLevelThreadFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/list/listStylePositionFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/segment/boldFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/segment/fontFamilyFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/segment/fontSizeFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/segment/italicFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/segment/letterSpacingFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/segment/linkFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/segment/strikeFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/segment/superOrSubScriptFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/segment/textColorFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/segment/underlineFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/table/tableLayoutFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/table/tableSpacingFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/table/textColorOnTableCellFormatHandler.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/utils/color.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/utils/dir.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/formatHandlers/utils/parseValueWithUnit.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/index.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/block/setParagraphNotImplicit.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/addBlock.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/addDecorators.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/addSegment.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/applySegmentFormatToElement.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/ensureParagraph.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/hasSpacesOnly.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/isEmpty.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/isGeneralSegment.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/isWhiteSpacePreserved.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/normalizeContentModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/normalizeParagraph.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/normalizeSegment.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/common/unwrapBlock.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createBr.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createContentModelDocument.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createDivider.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createEntity.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createFormatContainer.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createGeneralBlock.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createGeneralSegment.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createImage.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createListItem.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createListLevel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createParagraph.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createParagraphDecorator.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createSelectionMarker.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createTable.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createTableCell.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelApi/creators/createText.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/contentModelToDom.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/context/createModelToDomContext.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/context/defaultContentModelHandlers.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleBlock.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleBlockGroupChildren.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleBr.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleDivider.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleEntity.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleFormatContainer.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleGeneralModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleImage.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleList.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleListItem.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleParagraph.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleSegment.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleSegmentDecorator.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleTable.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/handlers/handleText.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/optimizers/mergeNode.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/optimizers/optimize.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/optimizers/removeUnnecessarySpan.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/utils/applyFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/utils/handleSegmentCommon.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/utils/reuseCachedElement.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-dom/lib/modelToDom/utils/stackFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/domUtils/borderValues.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/domUtils/metadata/updateImageMetadata.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/domUtils/metadata/updateTableCellMetadata.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/domUtils/metadata/updateTableMetadata.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/domUtils/stringUtil.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/ContentModelEditor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/coreApi/createContentModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/coreApi/createEditorContext.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/coreApi/getDOMSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/coreApi/setContentModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/coreApi/setDOMSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/coreApi/switchShadowEdit.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/corePlugins/ContentModelCachePlugin.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/corePlugins/ContentModelCopyPastePlugin.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/corePlugins/ContentModelEditPlugin.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/corePlugins/ContentModelFormatPlugin.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/corePlugins/ContentModelTypeInContainerPlugin.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/createContentModelEditorCore.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/isContentModelEditor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/overrides/tablePreProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/plugins/PastePlugin/ContentModelPastePlugin.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/plugins/PastePlugin/Excel/processPastedContentFromExcel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/plugins/PastePlugin/PowerPoint/processPastedContentFromPowerPoint.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/plugins/PastePlugin/WacComponents/processPastedContentWacComponents.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/plugins/PastePlugin/WordDesktop/processPastedContentFromWordDesktop.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/plugins/PastePlugin/WordDesktop/processWordComments.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/plugins/PastePlugin/WordDesktop/processWordLists.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/plugins/PastePlugin/utils/addParser.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/plugins/PastePlugin/utils/deprecatedColorParser.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/plugins/PastePlugin/utils/linkParser.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/plugins/PastePlugin/utils/setProcessor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/utils/contentModelDomIndexer.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/editor/utils/handleKeyboardEventCommon.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/index.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/block/getLeafSiblingBlock.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/block/setModelAlignment.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/block/setModelDirection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/block/setModelIndentation.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/block/toggleModelBlockQuote.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/common/clearModelFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/common/cloneModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/common/getClosestAncestorBlockGroupIndex.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/common/isBlockGroupOfType.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/common/mergeModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/common/retrieveModelFormatState.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/common/wrapBlock.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/edit/deleteSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/edit/deleteSteps/deleteAllSegmentBefore.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/edit/deleteSteps/deleteCollapsedSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/edit/deleteSteps/deleteWordSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/edit/utils/createInsertPoint.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/edit/utils/deleteBlock.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/edit/utils/deleteExpandedSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/edit/utils/deleteSegment.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/edit/utils/deleteSingleChar.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/entity/insertEntityModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/format/pendingFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/image/applyImageBorderFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/list/findListItemsInSameThread.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/list/setListType.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/selection/adjustSegmentSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/selection/adjustWordSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/selection/areSameRangeEx.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/selection/collapseTableSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/selection/collectSelections.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/selection/getSelectionRootNode.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/selection/iterateSelections.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/selection/setSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/alignTable.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/alignTableCell.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/applyTableFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/canMergeCells.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/createTableStructure.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/deleteTable.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/deleteTableColumn.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/deleteTableRow.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/ensureFocusableParagraphForTable.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/getSelectedCells.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/insertTableColumn.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/insertTableRow.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/mergeTableCells.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/mergeTableColumn.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/mergeTableRow.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/normalizeTable.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/setTableCellBackgroundColor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/splitTableCellHorizontally.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/modelApi/table/splitTableCellVertically.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/block/setAlignment.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/block/setDirection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/block/setHeadingLevel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/block/setIndentation.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/block/setParagraphMargin.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/block/setSpacing.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/block/toggleBlockQuote.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/editing/keyboardDelete.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/entity/insertEntity.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/format/applyDefaultFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/format/applyPendingFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/format/clearFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/format/getFormatState.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/image/adjustImageSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/image/changeImage.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/image/insertImage.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/image/setImageAltText.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/image/setImageBorder.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/image/setImageBoxShadow.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/link/adjustLinkSelection.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/link/insertLink.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/link/removeLink.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/list/setListStartNumber.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/list/setListStyle.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/list/toggleBullet.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/list/toggleNumbering.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/applySegmentFormat.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/changeCapitalization.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/changeFontSize.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/setBackgroundColor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/setFontName.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/setFontSize.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/setTextColor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/toggleBold.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/toggleCode.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/toggleItalic.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/toggleStrikethrough.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/toggleSubscript.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/toggleSuperscript.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/segment/toggleUnderline.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/selection/getSelectedSegments.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/selection/hasSelectionInBlock.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/selection/hasSelectionInBlockGroup.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/selection/hasSelectionInSegment.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/table/editTable.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/table/formatTable.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/table/insertTable.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/table/setTableCellShade.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/utils/formatImageWithContentModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/utils/formatParagraphWithContentModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/utils/formatSegmentWithContentModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/utils/formatWithContentModel.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model-editor/lib/publicApi/utils/paste.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model/lib/createContentModelEditor.ts","webpack://roosterjsContentModel/./packages-content-model/roosterjs-content-model/lib/index.ts","webpack://roosterjsContentModel/external var \"roosterjs\"","webpack://roosterjsContentModel/./node_modules/tslib/tslib.es6.mjs","webpack://roosterjsContentModel/webpack/bootstrap","webpack://roosterjsContentModel/webpack/runtime/define property getters","webpack://roosterjsContentModel/webpack/runtime/hasOwnProperty shorthand","webpack://roosterjsContentModel/webpack/runtime/make namespace object","webpack://roosterjsContentModel/webpack/startup"],"sourcesContent":["import type { DefaultImplicitFormatMap } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * A map from tag name to its default implicit formats\n */\nexport const defaultContentModelFormatMap: DefaultImplicitFormatMap = {\n    a: {\n        underline: true,\n    },\n    blockquote: {\n        marginTop: '1em',\n        marginBottom: '1em',\n        marginLeft: '40px',\n        marginRight: '40px',\n    },\n    code: {\n        fontFamily: 'monospace',\n    },\n    h1: {\n        fontWeight: 'bold',\n        fontSize: '2em',\n    },\n    h2: {\n        fontWeight: 'bold',\n        fontSize: '1.5em',\n    },\n    h3: {\n        fontWeight: 'bold',\n        fontSize: '1.17em',\n    },\n    h4: {\n        fontWeight: 'bold',\n        fontSize: '1em', // Set this default value here to overwrite existing font size when change heading level\n    },\n    h5: {\n        fontWeight: 'bold',\n        fontSize: '0.83em',\n    },\n    h6: {\n        fontWeight: 'bold',\n        fontSize: '0.67em',\n    },\n    p: {\n        marginTop: '1em',\n        marginBottom: '1em',\n    },\n    pre: {\n        fontFamily: 'monospace',\n        whiteSpace: 'pre',\n        marginTop: '1em',\n        marginBottom: '1em',\n    },\n};\n","import type { DefaultStyleMap } from 'roosterjs-content-model-types';\n\nconst blockElement: Partial<CSSStyleDeclaration> = {\n    display: 'block',\n};\n\n/**\n * @internal\n */\nexport const defaultHTMLStyleMap: DefaultStyleMap = {\n    address: blockElement,\n    article: blockElement,\n    aside: blockElement,\n    b: {\n        fontWeight: 'bold',\n    },\n    blockquote: {\n        display: 'block',\n        marginTop: '1em',\n        marginBottom: '1em',\n        marginLeft: '40px',\n        marginRight: '40px',\n    },\n    br: blockElement,\n    center: {\n        display: 'block',\n        textAlign: 'center',\n    },\n    dd: blockElement,\n    div: blockElement,\n    dl: blockElement,\n    dt: blockElement,\n    em: {\n        fontStyle: 'italic',\n    },\n    fieldset: blockElement,\n    figcaption: blockElement,\n    figure: blockElement,\n    footer: blockElement,\n    form: blockElement,\n    h1: {\n        display: 'block',\n        fontWeight: 'bold',\n        fontSize: '2em',\n    },\n    h2: {\n        display: 'block',\n        fontWeight: 'bold',\n        fontSize: '1.5em',\n    },\n    h3: {\n        display: 'block',\n        fontWeight: 'bold',\n        fontSize: '1.17em',\n    },\n    h4: {\n        display: 'block',\n        fontWeight: 'bold',\n    },\n    h5: {\n        display: 'block',\n        fontWeight: 'bold',\n        fontSize: '0.83em',\n    },\n    h6: {\n        display: 'block',\n        fontWeight: 'bold',\n        fontSize: '0.67em',\n    },\n    header: blockElement,\n    hr: blockElement,\n    i: {\n        fontStyle: 'italic',\n    },\n    li: {\n        display: 'list-item',\n    },\n    main: blockElement,\n    nav: blockElement,\n    ol: blockElement,\n    p: {\n        display: 'block',\n        marginTop: '1em',\n        marginBottom: '1em',\n    },\n    pre: {\n        display: 'block',\n        fontFamily: 'monospace',\n        whiteSpace: 'pre',\n        marginTop: '1em',\n        marginBottom: '1em',\n    },\n    s: {\n        textDecoration: 'line-through',\n    },\n    section: blockElement,\n    strike: {\n        textDecoration: 'line-through',\n    },\n    strong: {\n        fontWeight: 'bold',\n    },\n    sub: {\n        verticalAlign: 'sub',\n        fontSize: 'smaller',\n    },\n    sup: {\n        verticalAlign: 'super',\n        fontSize: 'smaller',\n    },\n    table: {\n        display: 'table',\n        boxSizing: 'border-box',\n    },\n    td: {\n        display: 'table-cell',\n    },\n    th: {\n        display: 'table-cell',\n    },\n    u: {\n        textDecoration: 'underline',\n    },\n    ul: blockElement,\n};\n","import { defaultProcessorMap } from './defaultProcessors';\nimport { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport {\n    defaultFormatKeysPerCategory,\n    defaultFormatParsers,\n} from '../../formatHandlers/defaultFormatHandlers';\nimport type {\n    ContentModelBlockFormat,\n    DomToModelContext,\n    DomToModelDecoratorContext,\n    DomToModelFormatContext,\n    DomToModelOption,\n    DomToModelSelectionContext,\n    DomToModelSettings,\n    EditorContext,\n    FormatParser,\n    FormatParsers,\n    FormatParsersPerCategory,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create context object for DOM to Content Model conversion\n * @param editorContext Context of editor\n * @param options Option array to customize the DOM to Model conversion behavior\n */\nexport function createDomToModelContext(\n    editorContext?: EditorContext,\n    ...options: (DomToModelOption | undefined)[]\n): DomToModelContext {\n    return createDomToModelContextWithConfig(createDomToModelConfig(options), editorContext);\n}\n\n/**\n * Create context object for DOM to Content Model conversion with an existing configure\n * @param config A full config object to define how to convert DOM tree to Content Model\n * @param editorContext Context of editor\n */\nexport function createDomToModelContextWithConfig(\n    config: DomToModelSettings,\n    editorContext?: EditorContext\n) {\n    return Object.assign(\n        {},\n        editorContext,\n        createDomToModelSelectionContext(),\n        createDomToModelFormatContext(editorContext?.isRootRtl),\n        createDomToModelDecoratorContext(),\n        config\n    );\n}\n\nfunction createDomToModelSelectionContext(): DomToModelSelectionContext {\n    return { isInSelection: false };\n}\n\nfunction createDomToModelFormatContext(isRootRtl?: boolean): DomToModelFormatContext {\n    const blockFormat: ContentModelBlockFormat = isRootRtl ? { direction: 'rtl' } : {};\n\n    return {\n        blockFormat,\n        segmentFormat: {},\n\n        listFormat: {\n            levels: [],\n            threadItemCounts: [],\n        },\n    };\n}\n\nfunction createDomToModelDecoratorContext(): DomToModelDecoratorContext {\n    return {\n        link: {\n            format: {},\n            dataset: {},\n        },\n        code: {\n            format: {},\n        },\n        blockDecorator: {\n            format: {},\n            tagName: '',\n        },\n    };\n}\n\n/**\n * Create Dom to Content Model Config object\n * @param options All customizations of content model creation\n */\nexport function createDomToModelConfig(\n    options: (DomToModelOption | undefined)[]\n): DomToModelSettings {\n    return {\n        elementProcessors: Object.assign(\n            {},\n            defaultProcessorMap,\n            ...options.map(x => x?.processorOverride)\n        ),\n        formatParsers: buildFormatParsers(\n            options.map(x => x?.formatParserOverride),\n            options.map(x => x?.additionalFormatParsers)\n        ),\n        defaultElementProcessors: defaultProcessorMap,\n        defaultFormatParsers,\n    };\n}\n\n/**\n * @internal Export for test only\n * Build format parsers used by DOM to Content Model conversion\n * @param override\n * @param additionalParsersArray\n * @returns\n */\nexport function buildFormatParsers(\n    overrides: (Partial<FormatParsers> | undefined)[] = [],\n    additionalParsersArray: (Partial<FormatParsersPerCategory> | undefined)[] = []\n): FormatParsersPerCategory {\n    const combinedOverrides = Object.assign({}, ...overrides);\n\n    return getObjectKeys(defaultFormatKeysPerCategory).reduce((result, key) => {\n        const value = defaultFormatKeysPerCategory[key]\n            .map(\n                formatKey =>\n                    (combinedOverrides[formatKey] === undefined\n                        ? defaultFormatParsers[formatKey]\n                        : combinedOverrides[formatKey]) as FormatParser<any>\n            )\n            .concat(\n                ...additionalParsersArray.map(\n                    parsers => (parsers?.[key] ?? []) as FormatParser<any>[]\n                )\n            );\n\n        result[key] = value;\n\n        return result;\n    }, {} as FormatParsersPerCategory);\n}\n","import { brProcessor } from '../processors/brProcessor';\nimport { childProcessor } from '../processors/childProcessor';\nimport { codeProcessor } from '../processors/codeProcessor';\nimport { delimiterProcessor } from '../processors/delimiterProcessor';\nimport { elementProcessor } from '../processors/elementProcessor';\nimport { entityProcessor } from '../processors/entityProcessor';\nimport { fontProcessor } from '../processors/fontProcessor';\nimport { formatContainerProcessor } from '../processors/formatContainerProcessor';\nimport { generalProcessor } from '../processors/generalProcessor';\nimport { headingProcessor } from '../processors/headingProcessor';\nimport { hrProcessor } from '../processors/hrProcessor';\nimport { imageProcessor } from '../processors/imageProcessor';\nimport { knownElementProcessor } from '../processors/knownElementProcessor';\nimport { linkProcessor } from '../processors/linkProcessor';\nimport { listItemProcessor } from '../processors/listItemProcessor';\nimport { listProcessor } from '../processors/listProcessor';\nimport { pProcessor } from '../processors/pProcessor';\nimport { tableProcessor } from '../processors/tableProcessor';\nimport { textProcessor } from '../processors/textProcessor';\nimport type { ElementProcessorMap } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const defaultProcessorMap: ElementProcessorMap = {\n    a: linkProcessor,\n    b: knownElementProcessor,\n    blockquote: knownElementProcessor,\n    br: brProcessor,\n    code: codeProcessor,\n    div: knownElementProcessor,\n    em: knownElementProcessor,\n    font: fontProcessor,\n    i: knownElementProcessor,\n    img: imageProcessor,\n    h1: headingProcessor,\n    h2: headingProcessor,\n    h3: headingProcessor,\n    h4: headingProcessor,\n    h5: headingProcessor,\n    h6: headingProcessor,\n    hr: hrProcessor,\n    li: listItemProcessor,\n    ol: listProcessor,\n    p: pProcessor,\n    pre: formatContainerProcessor,\n    s: knownElementProcessor,\n    section: knownElementProcessor,\n    span: knownElementProcessor,\n    strike: knownElementProcessor,\n    strong: knownElementProcessor,\n    sub: knownElementProcessor,\n    sup: knownElementProcessor,\n    table: tableProcessor,\n    u: knownElementProcessor,\n    ul: listProcessor,\n\n    '*': generalProcessor,\n    '#text': textProcessor,\n    element: elementProcessor,\n    entity: entityProcessor,\n    child: childProcessor,\n    delimiter: delimiterProcessor,\n};\n","import { createContentModelDocument } from '../modelApi/creators/createContentModelDocument';\nimport { normalizeContentModel } from '../modelApi/common/normalizeContentModel';\nimport type {\n    ContentModelDocument,\n    DOMSelection,\n    DomToModelContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create Content Model from DOM tree in this editor\n * @param root Root element of DOM tree to create Content Model from\n * @param context Context object for DOM to Content Model conversion\n * @param selection Selection that already exists in content\n * @returns A ContentModelDocument object that contains all the models created from the give root element\n */\nexport function domToContentModel(\n    root: HTMLElement | DocumentFragment,\n    context: DomToModelContext,\n    selection?: DOMSelection\n): ContentModelDocument {\n    const model = createContentModelDocument(context.defaultFormat);\n\n    context.selection = selection;\n    context.elementProcessors.child(model, root, context);\n\n    normalizeContentModel(model);\n\n    return model;\n}\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { ContextStyles } from './formatContainerProcessor';\nimport { createParagraph } from '../../modelApi/creators/createParagraph';\nimport { parseFormat } from '../utils/parseFormat';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelSegmentFormat,\n    DomToModelContext,\n} from 'roosterjs-content-model-types';\n\nconst SegmentDecoratorTags = ['A', 'CODE'];\n\n/**\n * @internal\n */\nexport function blockProcessor(\n    group: ContentModelBlockGroup,\n    element: HTMLElement,\n    context: DomToModelContext,\n    segmentFormat?: ContentModelSegmentFormat\n) {\n    const decorator = context.blockDecorator.tagName ? context.blockDecorator : undefined;\n    const isSegmentDecorator = SegmentDecoratorTags.indexOf(element.tagName) >= 0;\n\n    parseFormat(element, context.formatParsers.block, context.blockFormat, context);\n\n    const blockFormat = { ...context.blockFormat };\n\n    parseFormat(element, context.formatParsers.container, blockFormat, context);\n\n    ContextStyles.forEach(style => {\n        if (blockFormat[style]) {\n            context.blockFormat[style] = blockFormat[style];\n        }\n    });\n\n    if (!isSegmentDecorator) {\n        const paragraph = createParagraph(\n            false /*isImplicit*/,\n            blockFormat,\n            segmentFormat,\n            decorator\n        );\n\n        addBlock(group, paragraph);\n    }\n\n    context.elementProcessors.child(group, element, context);\n}\n","import { addSegment } from '../../modelApi/common/addSegment';\nimport { createBr } from '../../modelApi/creators/createBr';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const brProcessor: ElementProcessor<HTMLBRElement> = (group, element, context) => {\n    const br = createBr(context.segmentFormat);\n\n    if (context.isInSelection) {\n        br.isSelected = true;\n    }\n\n    const paragraph = addSegment(group, br, context.blockFormat);\n    context.domIndexer?.onSegment(element, paragraph, [br]);\n};\n","import { addSelectionMarker } from '../utils/addSelectionMarker';\nimport { getRegularSelectionOffsets } from '../utils/getRegularSelectionOffsets';\nimport { isNodeOfType } from '../../domUtils/isNodeOfType';\nimport type {\n    ContentModelBlockGroup,\n    DomToModelContext,\n    ElementProcessor,\n} from 'roosterjs-content-model-types';\n\n/**\n * Content Model Element Processor for child elements\n * @param group The parent block group\n * @param parent Parent DOM node to process\n * @param context DOM to Content Model context\n */\nexport const childProcessor: ElementProcessor<ParentNode> = (\n    group: ContentModelBlockGroup,\n    parent: ParentNode,\n    context: DomToModelContext\n) => {\n    const [nodeStartOffset, nodeEndOffset] = getRegularSelectionOffsets(context, parent);\n    let index = 0;\n\n    for (let child = parent.firstChild; child; child = child.nextSibling) {\n        handleRegularSelection(index, context, group, nodeStartOffset, nodeEndOffset);\n\n        processChildNode(group, child, context);\n\n        index++;\n    }\n\n    handleRegularSelection(index, context, group, nodeStartOffset, nodeEndOffset);\n};\n\n/**\n * Helper function for processing child node\n * @param group The parent block group\n * @param parent Parent DOM node to process\n * @param context DOM to Content Model context\n *\n */\nexport function processChildNode(\n    group: ContentModelBlockGroup,\n    child: Node,\n    context: DomToModelContext\n) {\n    if (isNodeOfType(child, 'ELEMENT_NODE') && child.style.display != 'none') {\n        context.elementProcessors.element(group, child, context);\n    } else if (isNodeOfType(child, 'TEXT_NODE')) {\n        context.elementProcessors['#text'](group, child, context);\n    }\n}\n\n/**\n * Helper function to handle regular (range based) selection when process child node\n * @param index Index of current child node in its parent\n * @param context DOM to Content Model context\n * @param group The parent block group\n * @param nodeStartOffset Start offset of current regular selection\n * @param nodeEndOffset  End offset of current regular selection\n */\nexport function handleRegularSelection(\n    index: number,\n    context: DomToModelContext,\n    group: ContentModelBlockGroup,\n    nodeStartOffset: number,\n    nodeEndOffset: number\n) {\n    if (index == nodeStartOffset) {\n        context.isInSelection = true;\n\n        addSelectionMarker(group, context);\n    }\n\n    if (index == nodeEndOffset && context.selection?.type == 'range') {\n        if (!context.selection.range.collapsed) {\n            addSelectionMarker(group, context);\n        }\n        context.isInSelection = false;\n    }\n}\n","import { knownElementProcessor } from './knownElementProcessor';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const codeProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    stackFormat(context, { code: 'codeDefault' }, () => {\n        parseFormat(element, context.formatParsers.code, context.code.format, context);\n\n        knownElementProcessor(group, element, context);\n    });\n};\n","import { getRegularSelectionOffsets } from '../utils/getRegularSelectionOffsets';\nimport { handleRegularSelection } from './childProcessor';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * @param group\n * @param element\n * @param context\n */\nexport const delimiterProcessor: ElementProcessor<Node> = (group, element, context) => {\n    let index = 0;\n    const [nodeStartOffset, nodeEndOffset] = getRegularSelectionOffsets(context, element);\n\n    for (let child = element.firstChild; child; child = child.nextSibling) {\n        handleRegularSelection(index, context, group, nodeStartOffset, nodeEndOffset);\n\n        delimiterProcessor(group, child, context);\n        index++;\n    }\n\n    handleRegularSelection(index, context, group, nodeStartOffset, nodeEndOffset);\n};\n","import { getDelimiterFromElement } from 'roosterjs-editor-dom';\nimport { isEntityElement } from '../../domUtils/entityUtils';\nimport type {\n    DomToModelContext,\n    ElementProcessor,\n    ElementProcessorMap,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * @param group\n * @param element\n * @param context\n */\nexport const elementProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const tagName = element.tagName.toLowerCase() as keyof ElementProcessorMap;\n    const processor = (tryGetProcessorForEntity(element, context) ||\n        tryGetProcessorForDelimiter(element, context) ||\n        context.elementProcessors[tagName] ||\n        (tagName.indexOf(':') >= 0 && context.elementProcessors.child) ||\n        context.elementProcessors['*']) as ElementProcessor<Node>;\n    processor(group, element, context);\n};\n\nfunction tryGetProcessorForEntity(element: HTMLElement, context: DomToModelContext) {\n    return isEntityElement(element) || element.contentEditable == 'false' // For readonly element, treat as an entity\n        ? context.elementProcessors.entity\n        : null;\n}\n\nfunction tryGetProcessorForDelimiter(element: Node, context: DomToModelContext) {\n    return getDelimiterFromElement(element) ? context.elementProcessors.delimiter : null;\n}\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { addSegment } from '../../modelApi/common/addSegment';\nimport { createEntity } from '../../modelApi/creators/createEntity';\nimport { isBlockElement } from '../utils/isBlockElement';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * Content Model Element Processor for entity\n * @param group The parent block group\n * @param parent Parent DOM node to process\n * @param context DOM to Content Model context\n */\nexport const entityProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const isBlockEntity = isBlockElement(element, context);\n\n    stackFormat(\n        context,\n        { segment: isBlockEntity ? 'empty' : undefined, paragraph: 'empty' },\n        () => {\n            const entityModel = createEntity(element, true /*isReadonly*/, context.segmentFormat);\n\n            parseFormat(element, context.formatParsers.entity, entityModel.entityFormat, context);\n\n            // TODO: Need to handle selection for editable entity\n            if (context.isInSelection) {\n                entityModel.isSelected = true;\n            }\n\n            if (isBlockEntity) {\n                addBlock(group, entityModel);\n            } else {\n                const paragraph = addSegment(group, entityModel);\n                context.domIndexer?.onSegment(element, paragraph, [entityModel]);\n            }\n        }\n    );\n};\n","import { isBlockElement } from '../utils/isBlockElement';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\nconst FontSizes = ['10px', '13px', '16px', '18px', '24px', '32px', '48px'];\n\nfunction getFontSize(size: string | null) {\n    const intSize = parseInt(size || '');\n\n    if (Number.isNaN(intSize)) {\n        return undefined;\n    } else if (intSize < 1) {\n        return FontSizes[0];\n    } else if (intSize > FontSizes.length) {\n        return FontSizes[FontSizes.length - 1];\n    } else {\n        return FontSizes[intSize - 1];\n    }\n}\n\n/**\n * @internal\n */\nexport const fontProcessor: ElementProcessor<HTMLFontElement> = (group, element, context) => {\n    stackFormat(\n        context,\n        {\n            segment: isBlockElement(element, context) ? 'shallowCloneForBlock' : 'shallowClone',\n        },\n        () => {\n            const fontFamily = element.getAttribute('face');\n            const fontSize = getFontSize(element.getAttribute('size'));\n            const textColor = element.getAttribute('color');\n            const format = context.segmentFormat;\n\n            if (fontFamily) {\n                format.fontFamily = fontFamily;\n            }\n\n            if (fontSize) {\n                format.fontSize = fontSize;\n            }\n\n            if (textColor) {\n                format.textColor = textColor;\n            }\n\n            parseFormat(element, context.formatParsers.segment, context.segmentFormat, context);\n\n            context.elementProcessors.child(group, element, context);\n        }\n    );\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { createFormatContainer } from '../../modelApi/creators/createFormatContainer';\nimport { createParagraph } from '../../modelApi/creators/createParagraph';\nimport { getDefaultStyle } from '../utils/getDefaultStyle';\nimport { parseFormat } from '../utils/parseFormat';\nimport { setParagraphNotImplicit } from '../../modelApi/block/setParagraphNotImplicit';\nimport { stackFormat } from '../utils/stackFormat';\nimport type {\n    ContentModelFormatContainer,\n    ContentModelFormatContainerFormat,\n    ContentModelParagraph,\n    ElementProcessor,\n    MarginFormat,\n    PaddingFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const ContextStyles: (keyof (MarginFormat & PaddingFormat))[] = [\n    'marginLeft',\n    'marginRight',\n    'paddingLeft',\n    'paddingRight',\n];\n\n/**\n * @internal\n */\nexport const formatContainerProcessor: ElementProcessor<HTMLElement> = (\n    group,\n    element,\n    context\n) => {\n    stackFormat(context, { segment: 'shallowCloneForBlock', paragraph: 'shallowClone' }, () => {\n        parseFormat(element, context.formatParsers.block, context.blockFormat, context);\n        parseFormat(element, context.formatParsers.segmentOnBlock, context.segmentFormat, context);\n\n        const format: ContentModelFormatContainerFormat = {\n            ...context.blockFormat,\n        };\n\n        parseFormat(element, context.formatParsers.container, format, context);\n\n        const tagName =\n            getDefaultStyle(element, context).display == 'block'\n                ? element.tagName.toLowerCase()\n                : 'div';\n        const formatContainer = createFormatContainer(tagName, format);\n\n        // It is possible to inherit margin left/right styles from parent DIV or other containers,\n        // since we are going into a deeper level of format container now,\n        // the container will render these styles so no need to keep them in context format\n        ContextStyles.forEach(style => {\n            delete context.blockFormat[style];\n        });\n\n        context.elementProcessors.child(formatContainer, element, context);\n\n        if (element.style.fontSize && parseInt(element.style.fontSize) == 0) {\n            formatContainer.zeroFontSize = true;\n        }\n\n        if (shouldFallbackToParagraph(formatContainer)) {\n            // For DIV container that only has one paragraph child, container style can be merged into paragraph\n            // and no need to have this container\n            const paragraph = formatContainer.blocks[0] as ContentModelParagraph;\n\n            if (formatContainer.zeroFontSize) {\n                paragraph.segmentFormat = Object.assign({}, paragraph.segmentFormat, {\n                    fontSize: '0',\n                });\n            }\n\n            Object.assign(paragraph.format, formatContainer.format);\n            setParagraphNotImplicit(paragraph);\n            addBlock(group, paragraph);\n        } else {\n            addBlock(group, formatContainer);\n        }\n    });\n\n    addBlock(group, createParagraph(true /*isImplicit*/, context.blockFormat));\n};\n\nfunction shouldFallbackToParagraph(formatContainer: ContentModelFormatContainer) {\n    const firstChild = formatContainer.blocks[0];\n\n    return (\n        formatContainer.tagName == 'div' &&\n        formatContainer.blocks.length == 1 &&\n        firstChild.blockType == 'Paragraph' &&\n        firstChild.isImplicit\n    );\n}\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { addDecorators } from '../../modelApi/common/addDecorators';\nimport { addSegment } from '../../modelApi/common/addSegment';\nimport { createGeneralBlock } from '../../modelApi/creators/createGeneralBlock';\nimport { createGeneralSegment } from '../../modelApi/creators/createGeneralSegment';\nimport { isBlockElement } from '../utils/isBlockElement';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\nconst generalBlockProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const block = createGeneralBlock(element);\n    const isSelectedBefore = context.isInSelection;\n\n    stackFormat(\n        context,\n        {\n            segment: 'empty',\n            paragraph: 'empty',\n            link: 'empty',\n        },\n        () => {\n            addBlock(group, block);\n\n            context.elementProcessors.child(block, element, context);\n        }\n    );\n\n    if (isSelectedBefore && context.isInSelection) {\n        block.isSelected = true;\n    }\n};\n\nconst generalSegmentProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const segment = createGeneralSegment(element, context.segmentFormat);\n    const isSelectedBefore = context.isInSelection;\n\n    addDecorators(segment, context);\n    const paragraph = addSegment(group, segment);\n    context.domIndexer?.onSegment(element, paragraph, [segment]);\n\n    stackFormat(\n        context,\n        {\n            segment:\n                'empty' /*clearFormat, General segment will include all properties and styles when generate back to HTML, so no need to carry over existing segment format*/,\n        },\n        () => {\n            context.elementProcessors.child(segment, element, context);\n        }\n    );\n\n    if (isSelectedBefore && context.isInSelection) {\n        segment.isSelected = true;\n    }\n};\n\n/**\n * @internal\n */\nexport const generalProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const processor = isBlockElement(element, context)\n        ? generalBlockProcessor\n        : generalSegmentProcessor;\n\n    processor(group, element, context);\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { blockProcessor } from './blockProcessor';\nimport { createParagraph } from '../../modelApi/creators/createParagraph';\nimport { createParagraphDecorator } from '../../modelApi/creators/createParagraphDecorator';\nimport { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ContentModelSegmentFormat, ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const headingProcessor: ElementProcessor<HTMLHeadingElement> = (group, element, context) => {\n    stackFormat(\n        context,\n        { segment: 'shallowCloneForBlock', paragraph: 'shallowClone', blockDecorator: 'empty' },\n        () => {\n            const segmentFormat: ContentModelSegmentFormat = {};\n\n            parseFormat(element, context.formatParsers.segmentOnBlock, segmentFormat, context);\n\n            // These formats are already declared on heading element, no need to keep them in context.\n            // And we should not duplicate them in context, either. Because when we want to turn off heading,\n            // inner text should not keep those text format from heading.\n            getObjectKeys(segmentFormat).forEach(key => {\n                delete context.segmentFormat[key];\n            });\n\n            context.blockDecorator = createParagraphDecorator(element.tagName, segmentFormat);\n\n            blockProcessor(group, element, context);\n        }\n    );\n\n    addBlock(group, createParagraph(true /*isImplicit*/, context.blockFormat));\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { createDivider } from '../../modelApi/creators/createDivider';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const hrProcessor: ElementProcessor<HTMLHRElement> = (group, element, context) => {\n    stackFormat(\n        context,\n        {\n            paragraph: 'shallowClone',\n        },\n        () => {\n            parseFormat(element, context.formatParsers.divider, context.blockFormat, context);\n\n            const hr = createDivider('hr', context.blockFormat);\n\n            if (element.size) {\n                hr.size = element.size;\n            }\n\n            if (context.isInSelection) {\n                hr.isSelected = true;\n            }\n\n            addBlock(group, hr);\n        }\n    );\n};\n","import { addDecorators } from '../../modelApi/common/addDecorators';\nimport { addSegment } from '../../modelApi/common/addSegment';\nimport { createImage } from '../../modelApi/creators/createImage';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ContentModelImageFormat, ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const imageProcessor: ElementProcessor<HTMLImageElement> = (group, element, context) => {\n    stackFormat(context, { segment: 'shallowClone' }, () => {\n        const imageFormat: ContentModelImageFormat = context.segmentFormat;\n\n        parseFormat(element, context.formatParsers.segment, imageFormat, context);\n        parseFormat(element, context.formatParsers.image, imageFormat, context);\n        parseFormat(element, context.formatParsers.block, context.blockFormat, context);\n\n        const image = createImage(element.src, imageFormat);\n        const alt = element.alt;\n        const title = element.title;\n\n        parseFormat(element, context.formatParsers.dataset, image.dataset, context);\n        addDecorators(image, context);\n\n        if (alt) {\n            image.alt = alt;\n        }\n        if (title) {\n            image.title = title;\n        }\n        if (context.isInSelection) {\n            image.isSelected = true;\n        }\n        if (context.selection?.type == 'image' && context.selection.image == element) {\n            image.isSelectedAsImageSelection = true;\n            image.isSelected = true;\n        }\n\n        const paragraph = addSegment(group, image);\n        context.domIndexer?.onSegment(element, paragraph, [image]);\n    });\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { blockProcessor } from './blockProcessor';\nimport { createParagraph } from '../../modelApi/creators/createParagraph';\nimport { formatContainerProcessor } from './formatContainerProcessor';\nimport { getDefaultStyle } from '../utils/getDefaultStyle';\nimport { isBlockElement } from '../utils/isBlockElement';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type {\n    ContentModelSegmentFormat,\n    DomToModelContext,\n    ElementProcessor,\n} from 'roosterjs-content-model-types';\n\nconst FormatContainerTriggerStyles: (keyof CSSStyleDeclaration)[] = [\n    'marginBottom',\n    'marginTop',\n    'paddingBottom',\n    'paddingTop',\n    'paddingLeft',\n    'paddingRight',\n    'borderTopWidth',\n    'borderBottomWidth',\n    'borderLeftWidth',\n    'borderRightWidth',\n    'width',\n    'height',\n    'maxWidth',\n    'maxHeight',\n    'minWidth',\n    'minHeight',\n];\nconst ByPassFormatContainerTags = ['H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'P', 'A'];\nconst SegmentDecoratorTags = ['A', 'CODE'];\n\n/**\n * @internal\n */\nexport const knownElementProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    const isBlock = isBlockElement(element, context);\n\n    if (\n        (isBlock || element.style.display == 'inline-block') && // For inline-block here, we will also check if it should be represented as Format Container\n        shouldUseFormatContainer(element, context)\n    ) {\n        formatContainerProcessor(group, element, context);\n    } else if (isBlock) {\n        const decorator = context.blockDecorator.tagName ? context.blockDecorator : undefined;\n        const isSegmentDecorator = SegmentDecoratorTags.indexOf(element.tagName) >= 0;\n\n        stackFormat(context, { segment: 'shallowCloneForBlock', paragraph: 'shallowClone' }, () => {\n            const segmentFormat: ContentModelSegmentFormat = {};\n\n            parseFormat(element, context.formatParsers.segmentOnBlock, segmentFormat, context);\n            Object.assign(context.segmentFormat, segmentFormat);\n\n            blockProcessor(group, element, context, segmentFormat);\n        });\n\n        if (isBlock && !isSegmentDecorator) {\n            addBlock(\n                group,\n                createParagraph(\n                    true /*isImplicit*/,\n                    context.blockFormat,\n                    undefined /*segmentFormat*/,\n                    decorator\n                )\n            );\n        }\n    } else {\n        stackFormat(\n            context,\n            {\n                segment: 'shallowClone',\n                paragraph: 'shallowClone',\n                link: 'cloneFormat',\n            },\n            () => {\n                parseFormat(element, context.formatParsers.segment, context.segmentFormat, context);\n\n                if (context.link.format.href && element.tagName != 'A') {\n                    parseFormat(\n                        element,\n                        context.formatParsers.segmentUnderLink,\n                        context.link.format,\n                        context\n                    );\n                }\n\n                context.elementProcessors.child(group, element, context);\n            }\n        );\n    }\n};\n\nfunction shouldUseFormatContainer(element: HTMLElement, context: DomToModelContext) {\n    // For those tags that we know we should not use format container, just return false\n    if (ByPassFormatContainerTags.indexOf(element.tagName) >= 0) {\n        return false;\n    }\n\n    const style = element.style;\n    const defaultStyle = getDefaultStyle(element, context);\n\n    const bgcolor = style.getPropertyValue('background-color');\n\n    // For block element with background, we need to use format container\n    if (bgcolor && bgcolor != 'transparent') {\n        return true;\n    }\n\n    // For block element with positive value of border width or top/bottom margin/padding,\n    // we need to use format container\n    if (\n        FormatContainerTriggerStyles.some(\n            key => parseInt((style[key] as string) || (defaultStyle[key] as string) || '') > 0\n        )\n    ) {\n        return true;\n    }\n\n    // For margin left/right with value \"auto\", we need to use format container\n    if (style.marginLeft == 'auto' || style.marginRight == 'auto') {\n        return true;\n    }\n\n    // For element with \"align\" attribute, we need to use format container\n    if (element.getAttribute('align')) {\n        return true;\n    }\n\n    return false;\n}\n","import { knownElementProcessor } from './knownElementProcessor';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const linkProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    if (element.hasAttribute('href')) {\n        stackFormat(context, { link: 'linkDefault' }, () => {\n            parseFormat(element, context.formatParsers.link, context.link.format, context);\n            parseFormat(element, context.formatParsers.dataset, context.link.dataset, context);\n\n            knownElementProcessor(group, element, context);\n        });\n    } else {\n        // A tag without href, can be treated as normal SPAN tag\n        knownElementProcessor(group, element, context);\n    }\n};\n","import { createListItem } from '../../modelApi/creators/createListItem';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const listItemProcessor: ElementProcessor<HTMLLIElement> = (group, element, context) => {\n    const { listFormat } = context;\n\n    if (listFormat.listParent && listFormat.levels.length > 0) {\n        stackFormat(\n            context,\n            {\n                segment: 'shallowCloneForBlock',\n            },\n            () => {\n                parseFormat(\n                    element,\n                    context.formatParsers.segmentOnBlock,\n                    context.segmentFormat,\n                    context\n                );\n\n                const listItem = createListItem(listFormat.levels, context.segmentFormat);\n                parseFormat(\n                    element,\n                    context.formatParsers.listItemElement,\n                    listItem.format,\n                    context\n                );\n\n                listFormat.listParent!.blocks.push(listItem);\n\n                parseFormat(\n                    element,\n                    context.formatParsers.listItem,\n                    listItem.levels[listItem.levels.length - 1].format,\n                    context\n                );\n\n                context.elementProcessors.child(listItem, element, context);\n\n                const firstChild = listItem.blocks[0];\n\n                if (\n                    listItem.blocks.length == 1 &&\n                    firstChild.blockType == 'Paragraph' &&\n                    firstChild.isImplicit\n                ) {\n                    Object.assign(listItem.format, firstChild.format);\n                    firstChild.format = {};\n                }\n            }\n        );\n    } else {\n        const currentBlocks = listFormat.listParent?.blocks;\n        const lastItem = currentBlocks?.[currentBlocks?.length - 1];\n\n        context.elementProcessors['*'](\n            lastItem?.blockType == 'BlockGroup' ? lastItem : group,\n            element,\n            context\n        );\n    }\n};\n","import { createListLevel } from '../../modelApi/creators/createListLevel';\nimport { listLevelMetadataFormatHandler } from '../../formatHandlers/list/listLevelMetadataFormatHandler';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport { updateListMetadata } from '../../domUtils/metadata/updateListMetadata';\nimport type { ContentModelListLevel, ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const listProcessor: ElementProcessor<HTMLOListElement | HTMLUListElement> = (\n    group,\n    element,\n    context\n) => {\n    stackFormat(\n        context,\n        {\n            segment: 'shallowCloneForBlock',\n            paragraph: 'shallowCloneForGroup',\n        },\n        () => {\n            const level: ContentModelListLevel = createListLevel(\n                element.tagName as 'OL' | 'UL',\n                context.blockFormat\n            );\n            const { listFormat } = context;\n\n            parseFormat(element, context.formatParsers.dataset, level.dataset, context);\n            parseFormat(element, context.formatParsers.listLevel, level.format, context);\n\n            // TODO: Move this out into roosterjs-content-model-editor package\n            updateListMetadata(level, metadata => {\n                metadata = metadata || {};\n                parseFormat(element, [listLevelMetadataFormatHandler.parse], metadata, context);\n\n                if (\n                    typeof metadata.orderedStyleType == 'undefined' &&\n                    typeof metadata.unorderedStyleType == 'undefined'\n                ) {\n                    metadata = null;\n                }\n\n                return metadata;\n            });\n\n            parseFormat(element, context.formatParsers.segment, context.segmentFormat, context);\n\n            const originalListParent = listFormat.listParent;\n\n            listFormat.listParent = listFormat.listParent || group;\n            listFormat.levels.push(level);\n\n            try {\n                context.elementProcessors.child(group, element, context);\n            } finally {\n                listFormat.levels.pop();\n                listFormat.listParent = originalListParent;\n            }\n        }\n    );\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { blockProcessor } from './blockProcessor';\nimport { createParagraph } from '../../modelApi/creators/createParagraph';\nimport { createParagraphDecorator } from '../../modelApi/creators/createParagraphDecorator';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type { ContentModelSegmentFormat, ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const pProcessor: ElementProcessor<HTMLElement> = (group, element, context) => {\n    stackFormat(\n        context,\n        { blockDecorator: 'empty', segment: 'shallowCloneForBlock', paragraph: 'shallowClone' },\n        () => {\n            context.blockDecorator = createParagraphDecorator(element.tagName);\n\n            const segmentFormat: ContentModelSegmentFormat = {};\n\n            parseFormat(element, context.formatParsers.segmentOnBlock, segmentFormat, context);\n            Object.assign(context.segmentFormat, segmentFormat);\n\n            blockProcessor(group, element, context, segmentFormat);\n        }\n    );\n\n    addBlock(group, createParagraph(true /*isImplicit*/, context.blockFormat));\n};\n","import { addBlock } from '../../modelApi/common/addBlock';\nimport { createTable } from '../../modelApi/creators/createTable';\nimport { createTableCell } from '../../modelApi/creators/createTableCell';\nimport { getBoundingClientRect } from '../utils/getBoundingClientRect';\nimport { isElementOfType } from '../../domUtils/isElementOfType';\nimport { isNodeOfType } from '../../domUtils/isNodeOfType';\nimport { parseFormat } from '../utils/parseFormat';\nimport { stackFormat } from '../utils/stackFormat';\nimport type {\n    ContentModelTableCellFormat,\n    DatasetFormat,\n    ElementProcessor,\n} from 'roosterjs-content-model-types';\n\n/**\n * Content Model Element Processor for table\n *\n * For Table with merged/splitted cells, HTML uses colSpan and rowSpan attributes to specify how it should be rendered.\n * To make it easier to edit a table, we will use a different way to describe table.\n *\n * 1. For a m * n table (m rows, n columns), we always create a m * n array for the cells.\n * 2. For a regular table cell, it is mapped to one item of this array\n * 3. For a merged/splitted table cell, it will has colSpan/rowSpan value. We also created TableCell model for those spanned\n * cells, and use \"spanLeft\" and \"spanAbove\" to mark its state\n * 4. When edit table, we always edit on this mapped m * n array because it always has an item for each cell\n * 5. When write back to DOM, we create TD/TH elements for those non-spanned cells, and mark its colSpan/rowSpan value according\n * its neighbour cell's spanLeft/spanAbove attribute\n * @param group The parent block group\n * @param parent Parent DOM node to process\n * @param context DOM to Content Model context\n */\nexport const tableProcessor: ElementProcessor<HTMLTableElement> = (\n    group,\n    tableElement,\n    context\n) => {\n    stackFormat(\n        context,\n        { segment: 'shallowCloneForBlock', paragraph: 'shallowCloneForGroup' },\n        () => {\n            parseFormat(tableElement, context.formatParsers.block, context.blockFormat, context);\n\n            const table = createTable(tableElement.rows.length, context.blockFormat);\n            const tableSelection = context.selection?.type == 'table' ? context.selection : null;\n            const selectedTable = tableSelection?.table;\n            const hasTableSelection = selectedTable == tableElement;\n\n            if (context.allowCacheElement) {\n                table.cachedElement = tableElement;\n            }\n\n            context.domIndexer?.onTable(tableElement, table);\n\n            parseFormat(tableElement, context.formatParsers.table, table.format, context);\n            parseFormat(tableElement, context.formatParsers.tableBorder, table.format, context);\n            parseFormat(\n                tableElement,\n                context.formatParsers.segmentOnBlock,\n                context.segmentFormat,\n                context\n            );\n            parseFormat(tableElement, context.formatParsers.dataset, table.dataset, context);\n            addBlock(group, table);\n\n            const columnPositions: number[] = [0];\n            const rowPositions: number[] = [0];\n            const zoomScale = context.zoomScale || 1;\n\n            for (let row = 0; row < tableElement.rows.length; row++) {\n                const tr = tableElement.rows[row];\n                const tableRow = table.rows[row];\n\n                const tbody = tr.parentNode;\n\n                if (\n                    isNodeOfType(tbody, 'ELEMENT_NODE') &&\n                    (isElementOfType(tbody, 'tbody') ||\n                        isElementOfType(tbody, 'thead') ||\n                        isElementOfType(tbody, 'tfoot'))\n                ) {\n                    parseFormat(tbody, context.formatParsers.tableRow, tableRow.format, context);\n                } else if (context.allowCacheElement) {\n                    tableRow.cachedElement = tr;\n                }\n\n                parseFormat(tr, context.formatParsers.tableRow, tableRow.format, context);\n\n                stackFormat(context, { paragraph: 'shallowClone', segment: 'shallowClone' }, () => {\n                    const parent = tr.parentElement;\n                    const parentTag = parent?.tagName;\n\n                    if (\n                        parent &&\n                        (parentTag == 'TBODY' || parentTag == 'THEAD' || parentTag == 'TFOOT')\n                    ) {\n                        // If there is TBODY around TR, retrieve format from TBODY first, in case some format are declared there\n                        parseFormat(\n                            parent,\n                            context.formatParsers.block,\n                            context.blockFormat,\n                            context\n                        );\n                        parseFormat(\n                            parent,\n                            context.formatParsers.segmentOnBlock,\n                            context.segmentFormat,\n                            context\n                        );\n                    }\n\n                    parseFormat(tr, context.formatParsers.block, context.blockFormat, context);\n                    parseFormat(\n                        tr,\n                        context.formatParsers.segmentOnBlock,\n                        context.segmentFormat,\n                        context\n                    );\n\n                    for (\n                        let sourceCol = 0, targetCol = 0;\n                        sourceCol < tr.cells.length;\n                        sourceCol++\n                    ) {\n                        for (; tableRow.cells[targetCol]; targetCol++) {}\n\n                        const td = tr.cells[sourceCol];\n                        const hasSelectionBeforeCell = context.isInSelection;\n                        const colEnd = targetCol + td.colSpan;\n                        const rowEnd = row + td.rowSpan;\n                        const needCalcWidth = columnPositions[colEnd] === undefined;\n                        const needCalcHeight = rowPositions[rowEnd] === undefined;\n\n                        if (needCalcWidth || needCalcHeight) {\n                            const rect = getBoundingClientRect(td);\n\n                            if (rect.width > 0 || rect.height > 0) {\n                                if (needCalcWidth) {\n                                    columnPositions[colEnd] =\n                                        columnPositions[targetCol] + rect.width / zoomScale;\n                                }\n\n                                if (needCalcHeight) {\n                                    rowPositions[rowEnd] =\n                                        rowPositions[row] + rect.height / zoomScale;\n                                }\n                            }\n                        }\n\n                        stackFormat(\n                            context,\n                            { paragraph: 'shallowClone', segment: 'shallowClone' },\n                            () => {\n                                parseFormat(\n                                    td,\n                                    context.formatParsers.block,\n                                    context.blockFormat,\n                                    context\n                                );\n                                parseFormat(\n                                    td,\n                                    context.formatParsers.segmentOnTableCell,\n                                    context.segmentFormat,\n                                    context\n                                );\n\n                                const cellFormat: ContentModelTableCellFormat = {\n                                    ...context.blockFormat,\n                                };\n                                const dataset: DatasetFormat = {};\n\n                                parseFormat(\n                                    td,\n                                    context.formatParsers.tableCell,\n                                    cellFormat,\n                                    context\n                                );\n                                parseFormat(\n                                    td,\n                                    context.formatParsers.tableBorder,\n                                    cellFormat,\n                                    context\n                                );\n                                parseFormat(td, context.formatParsers.dataset, dataset, context);\n\n                                for (\n                                    let colSpan = 1;\n                                    colSpan <= td.colSpan;\n                                    colSpan++, targetCol++\n                                ) {\n                                    for (let rowSpan = 1; rowSpan <= td.rowSpan; rowSpan++) {\n                                        const hasTd = colSpan == 1 && rowSpan == 1;\n                                        const cell = createTableCell(\n                                            colSpan > 1,\n                                            rowSpan > 1,\n                                            td.tagName == 'TH',\n                                            cellFormat\n                                        );\n\n                                        cell.dataset = { ...dataset };\n\n                                        const spannedRow = table.rows[row + rowSpan - 1];\n\n                                        if (spannedRow) {\n                                            spannedRow.cells[targetCol] = cell;\n                                        }\n\n                                        if (hasTd) {\n                                            if (context.allowCacheElement) {\n                                                cell.cachedElement = td;\n                                            }\n\n                                            const { listParent, levels } = context.listFormat;\n\n                                            context.listFormat.listParent = undefined;\n                                            context.listFormat.levels = [];\n\n                                            try {\n                                                context.elementProcessors.child(cell, td, context);\n                                            } finally {\n                                                context.listFormat.listParent = listParent;\n                                                context.listFormat.levels = levels;\n                                            }\n                                        }\n\n                                        const hasSelectionAfterCell = context.isInSelection;\n\n                                        if (\n                                            (hasSelectionBeforeCell && hasSelectionAfterCell) ||\n                                            (hasTableSelection &&\n                                                tableSelection &&\n                                                row >= tableSelection.firstRow &&\n                                                row <= tableSelection.lastRow &&\n                                                targetCol >= tableSelection.firstColumn &&\n                                                targetCol <= tableSelection.lastColumn)\n                                        ) {\n                                            cell.isSelected = true;\n                                        }\n                                    }\n                                }\n                            }\n                        );\n                    }\n                });\n\n                for (let col = 0; col < tableRow.cells.length; col++) {\n                    if (!tableRow.cells[col]) {\n                        tableRow.cells[col] = createTableCell(\n                            false,\n                            false,\n                            false,\n                            context.blockFormat\n                        );\n                    }\n                }\n            }\n\n            table.widths = calcSizes(columnPositions);\n\n            const heights = calcSizes(rowPositions);\n\n            table.rows.forEach((row, i) => {\n                if (heights[i] > 0) {\n                    row.height = heights[i];\n                }\n            });\n        }\n    );\n};\n\nfunction calcSizes(positions: number[]): number[] {\n    const result: number[] = [];\n    let lastPos = positions[positions.length - 1];\n\n    for (let i = positions.length - 2; i >= 0; i--) {\n        if (positions[i] === undefined) {\n            result[i] = 0;\n        } else {\n            result[i] = lastPos - positions[i];\n            lastPos = positions[i];\n        }\n    }\n\n    return result;\n}\n","import { addDecorators } from '../../modelApi/common/addDecorators';\nimport { addSegment } from '../../modelApi/common/addSegment';\nimport { addSelectionMarker } from '../utils/addSelectionMarker';\nimport { createText } from '../../modelApi/creators/createText';\nimport { ensureParagraph } from '../../modelApi/common/ensureParagraph';\nimport { getRegularSelectionOffsets } from '../utils/getRegularSelectionOffsets';\nimport { hasSpacesOnly } from '../../modelApi/common/hasSpacesOnly';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelParagraph,\n    ContentModelText,\n    DomToModelContext,\n    ElementProcessor,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const textProcessor: ElementProcessor<Text> = (\n    group: ContentModelBlockGroup,\n    textNode: Text,\n    context: DomToModelContext\n) => {\n    let txt = textNode.nodeValue || '';\n    const offsets = getRegularSelectionOffsets(context, textNode);\n    const txtStartOffset = offsets[0];\n    let txtEndOffset = offsets[1];\n    const segments: (ContentModelText | undefined)[] = [];\n    const paragraph = ensureParagraph(group, context.blockFormat);\n\n    if (txtStartOffset >= 0) {\n        const subText = txt.substring(0, txtStartOffset);\n        segments.push(addTextSegment(group, subText, paragraph, context));\n        context.isInSelection = true;\n\n        addSelectionMarker(group, context);\n\n        txt = txt.substring(txtStartOffset);\n        txtEndOffset -= txtStartOffset;\n    }\n\n    if (txtEndOffset >= 0) {\n        const subText = txt.substring(0, txtEndOffset);\n        segments.push(addTextSegment(group, subText, paragraph, context));\n\n        if (\n            context.selection &&\n            (context.selection.type != 'range' || !context.selection.range.collapsed)\n        ) {\n            addSelectionMarker(group, context);\n        }\n\n        context.isInSelection = false;\n        txt = txt.substring(txtEndOffset);\n    }\n\n    segments.push(addTextSegment(group, txt, paragraph, context));\n    context.domIndexer?.onSegment(\n        textNode,\n        paragraph,\n        segments.filter((x): x is ContentModelText => !!x)\n    );\n};\n\n// When we see these values of white-space style, need to preserve spaces and line-breaks and let browser handle it for us.\nconst WhiteSpaceValuesNeedToHandle = ['pre', 'pre-wrap', 'pre-line', 'break-spaces'];\n\nfunction addTextSegment(\n    group: ContentModelBlockGroup,\n    text: string,\n    paragraph: ContentModelParagraph,\n    context: DomToModelContext\n): ContentModelText | undefined {\n    let textModel: ContentModelText | undefined;\n\n    if (text) {\n        if (\n            !hasSpacesOnly(text) ||\n            (paragraph?.segments.length ?? 0) > 0 ||\n            WhiteSpaceValuesNeedToHandle.indexOf(paragraph?.format.whiteSpace || '') >= 0\n        ) {\n            textModel = createText(text, context.segmentFormat);\n\n            if (context.isInSelection) {\n                textModel.isSelected = true;\n            }\n\n            addDecorators(textModel, context);\n\n            addSegment(group, textModel, context.blockFormat);\n        }\n    }\n\n    return textModel;\n}\n","import { addDecorators } from '../../modelApi/common/addDecorators';\nimport { addSegment } from '../../modelApi/common/addSegment';\nimport { createSelectionMarker } from '../../modelApi/creators/createSelectionMarker';\nimport type { ContentModelBlockGroup, DomToModelContext } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function addSelectionMarker(group: ContentModelBlockGroup, context: DomToModelContext) {\n    const marker = createSelectionMarker(context.segmentFormat);\n\n    addDecorators(marker, context);\n\n    addSegment(group, marker, context.blockFormat);\n}\n","import { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport type { ContentModelFormatBase } from 'roosterjs-content-model-types';\n\n/**\n * Check if the two given formats object are equal. This is a check to value but not to reference\n * @param f1 The first format object to check\n * @param f2 The second format object to check\n */\nexport function areSameFormats<T extends ContentModelFormatBase>(f1: T, f2: T) {\n    if (f1 == f2) {\n        return true;\n    } else {\n        const keys1 = getObjectKeys(f1);\n        const keys2 = getObjectKeys(f2);\n\n        return keys1.length == keys2.length && keys1.every(key => f1[key] == f2[key]);\n    }\n}\n","/**\n * @internal\n */\nexport function getBoundingClientRect(element: Element): DOMRect {\n    return element.getBoundingClientRect();\n}\n","import { defaultHTMLStyleMap } from '../../config/defaultHTMLStyleMap';\nimport type { DefaultStyleMap, DomToModelContext } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Get default CSS style of given element\n * @param element The element to get default style from\n * @param context The context of DOM to Content Model conversion\n * @returns A valid CSS style object\n */\nexport function getDefaultStyle(\n    element: HTMLElement,\n    context: DomToModelContext\n): Partial<CSSStyleDeclaration> {\n    const tag = element.tagName.toLowerCase() as keyof DefaultStyleMap;\n\n    return defaultHTMLStyleMap[tag] || {};\n}\n","import type { DomToModelContext } from 'roosterjs-content-model-types';\n\n/**\n * Get offset numbers of a regular (range based) selection.\n * If the selection start/end position is not in the given node, it will return -1 for the related value\n * @param context DOM to Content Model context used for retrieve the selection\n * @param currentContainer The container node to check\n * @returns a tuple of start and end offsets. -1 means selection is not directly under the given node\n */\nexport function getRegularSelectionOffsets(\n    context: DomToModelContext,\n    currentContainer: Node\n): [number, number] {\n    const range = context.selection?.type == 'range' ? context.selection.range : null;\n\n    const startOffset = range?.startContainer == currentContainer ? range.startOffset : -1;\n    const endOffset = range?.endContainer == currentContainer ? range.endOffset! : -1;\n\n    return [startOffset, endOffset];\n}\n","import { getDefaultStyle } from './getDefaultStyle';\nimport type { DomToModelContext } from 'roosterjs-content-model-types';\n\nconst BLOCK_DISPLAY_STYLES = ['block', 'list-item', 'table', 'table-cell', 'flex'];\n\n/**\n * @internal\n * Check if the given element will be layout as a block\n * @param element The element to check\n * @param context The context of DOM to Content Model conversion\n */\nexport function isBlockElement(element: HTMLElement, context: DomToModelContext): boolean {\n    const display = element.style.display || getDefaultStyle(element, context).display || '';\n\n    return BLOCK_DISPLAY_STYLES.indexOf(display) >= 0;\n}\n","import { getDefaultStyle } from './getDefaultStyle';\nimport type {\n    ContentModelFormatBase,\n    DomToModelContext,\n    FormatParser,\n} from 'roosterjs-content-model-types';\n\n/**\n * Parse formats of the given HTML element using specified format parsers\n * @param element The element to parse format from\n * @param parsers The parses we are using to parse format\n * @param format The format object to hold result format\n * @param context DOM to Content Model context\n */\nexport function parseFormat<T extends ContentModelFormatBase>(\n    element: HTMLElement,\n    parsers: (FormatParser<T> | null)[],\n    format: T,\n    context: DomToModelContext\n) {\n    const defaultStyle = getDefaultStyle(element, context);\n\n    parsers.forEach(parser => {\n        parser?.(format, element, context, defaultStyle);\n    });\n}\n","import { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelCode,\n    ContentModelFormatBase,\n    ContentModelLink,\n    ContentModelParagraphDecorator,\n    ContentModelSegmentFormat,\n    DomToModelContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport interface StackFormatOptions {\n    segment?: 'shallowClone' | 'shallowCloneForBlock' | 'empty';\n    paragraph?: 'shallowClone' | 'shallowCloneForGroup' | 'empty';\n    blockDecorator?: 'empty';\n    link?: 'linkDefault' | 'cloneFormat' | 'empty';\n    code?: 'codeDefault' | 'empty';\n}\n\n// Some styles, such as background color, won't be inherited by block element if it was originally\n// declared from an inline element. So we need to skip them.\n// e.g.\n// <span style=\"background-color: red\">\n//   line 1       <---------------------------- in red here\n//   <div>line 2</div>  <---------------------- not in red here\n// </span>\nconst SkippedStylesForBlock: (keyof ContentModelSegmentFormat)[] = ['backgroundColor'];\nconst SkippedStylesForTable: (keyof ContentModelBlockFormat)[] = [\n    'marginLeft',\n    'marginRight',\n    'paddingLeft',\n    'paddingRight',\n];\n\n/**\n * @internal\n */\nexport function stackFormat(\n    context: DomToModelContext,\n    options: StackFormatOptions,\n    callback: () => void\n) {\n    const {\n        segmentFormat,\n        blockFormat,\n        link: linkFormat,\n        code: codeFormat,\n        blockDecorator: decoratorFormat,\n    } = context;\n    const { segment, paragraph, link, code, blockDecorator } = options;\n\n    try {\n        context.segmentFormat = stackFormatInternal(segmentFormat, segment);\n        context.blockFormat = stackFormatInternal(blockFormat, paragraph);\n        context.link = stackLinkInternal(linkFormat, link);\n        context.code = stackCodeInternal(codeFormat, code);\n        context.blockDecorator = stackDecoratorInternal(decoratorFormat, blockDecorator);\n\n        callback();\n    } finally {\n        context.segmentFormat = segmentFormat;\n        context.blockFormat = blockFormat;\n        context.link = linkFormat;\n        context.code = codeFormat;\n        context.blockDecorator = decoratorFormat;\n    }\n}\n\nfunction stackLinkInternal(\n    linkFormat: ContentModelLink,\n    link?: 'linkDefault' | 'cloneFormat' | 'empty'\n) {\n    switch (link) {\n        case 'linkDefault':\n            return {\n                format: {\n                    underline: true,\n                },\n                dataset: {},\n            };\n\n        case 'empty':\n            return {\n                format: {},\n                dataset: {},\n            };\n\n        case 'cloneFormat':\n        default:\n            return {\n                dataset: linkFormat.dataset,\n                format: { ...linkFormat.format },\n            };\n    }\n}\n\nfunction stackCodeInternal(codeFormat: ContentModelCode, code?: 'codeDefault' | 'empty') {\n    switch (code) {\n        case 'codeDefault':\n            return {\n                format: {\n                    fontFamily: 'monospace',\n                },\n            };\n        case 'empty':\n            return {\n                format: {},\n            };\n        default:\n            return codeFormat;\n    }\n}\n\nfunction stackDecoratorInternal(\n    format: ContentModelParagraphDecorator,\n    decorator?: 'decoratorDefault' | 'empty'\n) {\n    switch (decorator) {\n        case 'empty':\n            return {\n                format: {},\n                tagName: '',\n            };\n        default:\n            return format;\n    }\n}\n\nfunction stackFormatInternal<T extends ContentModelFormatBase>(\n    format: T,\n    processType?: 'shallowClone' | 'shallowCloneForBlock' | 'shallowCloneForGroup' | 'empty'\n): T | {} {\n    switch (processType) {\n        case 'empty':\n            return {};\n\n        case undefined:\n            return format;\n\n        default:\n            const result = { ...format };\n\n            getObjectKeys(format).forEach(key => {\n                if (\n                    (processType == 'shallowCloneForBlock' &&\n                        SkippedStylesForBlock.indexOf(key as keyof ContentModelSegmentFormat) >=\n                            0) ||\n                    (processType == 'shallowCloneForGroup' &&\n                        SkippedStylesForTable.indexOf(key as keyof ContentModelBlockFormat) >= 0)\n                ) {\n                    delete result[key];\n                }\n            });\n\n            return result;\n    }\n}\n","import { isNodeOfType } from './isNodeOfType';\nimport type { ContentModelEntityFormat } from 'roosterjs-content-model-types';\n\nconst ENTITY_INFO_NAME = '_Entity';\nconst ENTITY_TYPE_PREFIX = '_EType_';\nconst ENTITY_ID_PREFIX = '_EId_';\nconst ENTITY_READONLY_PREFIX = '_EReadonly_';\n\n/**\n * @internal\n */\nexport function isEntityElement(node: Node): boolean {\n    return isNodeOfType(node, 'ELEMENT_NODE') && node.classList.contains(ENTITY_INFO_NAME);\n}\n\n/**\n * @internal\n */\nexport function parseEntityClassName(\n    className: string,\n    format: ContentModelEntityFormat\n): boolean | undefined {\n    if (className == ENTITY_INFO_NAME) {\n        return true;\n    } else if (className.indexOf(ENTITY_TYPE_PREFIX) == 0) {\n        format.entityType = className.substring(ENTITY_TYPE_PREFIX.length);\n    } else if (className.indexOf(ENTITY_ID_PREFIX) == 0) {\n        format.id = className.substring(ENTITY_ID_PREFIX.length);\n    } else if (className.indexOf(ENTITY_READONLY_PREFIX) == 0) {\n        format.isReadonly = className.substring(ENTITY_READONLY_PREFIX.length) == '1';\n    }\n}\n\n/**\n * @internal\n */\nexport function generateEntityClassNames(format: ContentModelEntityFormat): string {\n    return format.isFakeEntity\n        ? ''\n        : `${ENTITY_INFO_NAME} ${ENTITY_TYPE_PREFIX}${format.entityType ?? ''} ${\n              format.id ? `${ENTITY_ID_PREFIX}${format.id} ` : ''\n          }${ENTITY_READONLY_PREFIX}${format.isReadonly ? '1' : '0'}`;\n}\n","/**\n * Provide a strong-typed version of Object.keys()\n * @param obj The source object\n * @returns Array of keys\n */\nexport function getObjectKeys<T extends string | number | symbol>(\n    obj: Record<T, any> | Partial<Record<T, any>>\n): T[] {\n    return Object.keys(obj) as T[];\n}\n","/**\n * Check if the given element is of the type that we are checking according to its tag name\n * @param element The element to check\n * @param tag The HTML tag name to check\n * @returns True if the element has the given tag, otherwise false\n */\nexport function isElementOfType<Tag extends keyof HTMLElementTagNameMap>(\n    element: HTMLElement,\n    tag: Tag\n): element is HTMLElementTagNameMap[Tag] {\n    return element?.tagName?.toLocaleLowerCase() == tag;\n}\n","/**\n * A type map from node type number to its type declaration. This is used by utility function isNodeOfType()\n */\nexport interface NodeTypeMap {\n    /**\n     * Attribute node\n     */\n    ATTRIBUTE_NODE: Attr;\n\n    /**\n     * Comment node\n     */\n    COMMENT_NODE: Comment;\n\n    /**\n     * DocumentFragment node\n     */\n    DOCUMENT_FRAGMENT_NODE: DocumentFragment;\n\n    /**\n     * Document node\n     */\n    DOCUMENT_NODE: Document;\n\n    /**\n     * DocumentType node\n     */\n    DOCUMENT_TYPE_NODE: DocumentType;\n\n    /**\n     * HTMLElement node\n     */\n    ELEMENT_NODE: HTMLElement;\n\n    /**\n     * ProcessingInstruction node\n     */\n    PROCESSING_INSTRUCTION_NODE: ProcessingInstruction;\n\n    /**\n     * Text node\n     */\n    TEXT_NODE: Text;\n}\n\n/**\n * Type checker for Node. Return true if it of the specified node type\n * @param node The node to check\n * @param expectedType The type to check\n */\nexport function isNodeOfType<T extends keyof NodeTypeMap>(\n    node: Node | null | undefined,\n    expectedType: T\n): node is NodeTypeMap[T] {\n    return !!node && node.nodeType == Node[expectedType];\n}\n","import { BulletListType, NumberingListType } from 'roosterjs-editor-types';\nimport { createNumberDefinition, createObjectDefinition } from 'roosterjs-editor-dom';\nimport { updateMetadata } from './updateMetadata';\nimport type { ContentModelWithDataset, ListMetadataFormat } from 'roosterjs-content-model-types';\n\nconst ListStyleDefinitionMetadata = createObjectDefinition<ListMetadataFormat>(\n    {\n        orderedStyleType: createNumberDefinition(\n            true /** isOptional */,\n            undefined /** value **/,\n            NumberingListType.Min,\n            NumberingListType.Max\n        ),\n        unorderedStyleType: createNumberDefinition(\n            true /** isOptional */,\n            undefined /** value **/,\n            BulletListType.Min,\n            BulletListType.Max\n        ),\n    },\n    true /** isOptional */,\n    true /** allowNull */\n);\n\n/**\n * Update list metadata with a callback\n * @param list The list Content Model (metadata holder)\n * @param callback The callback function used for updating metadata\n */\nexport function updateListMetadata(\n    list: ContentModelWithDataset<ListMetadataFormat>,\n    callback?: (format: ListMetadataFormat | null) => ListMetadataFormat | null\n): ListMetadataFormat | null {\n    return updateMetadata(list, callback, ListStyleDefinitionMetadata);\n}\n","import { validate } from 'roosterjs-editor-dom';\nimport type { ContentModelWithDataset } from 'roosterjs-content-model-types';\nimport type { Definition } from 'roosterjs-editor-types';\n\nconst EditingInfoDatasetName = 'editingInfo';\n\n/**\n * Update metadata of the given model\n * @param model The model to update metadata to\n * @param callback A callback function to update metadata\n * @param definition @optional Metadata definition used for verify the metadata object\n * @returns The metadata object if any, or null\n */\nexport function updateMetadata<T>(\n    model: ContentModelWithDataset<T>,\n    callback?: (metadata: T | null) => T | null,\n    definition?: Definition<T>\n): T | null {\n    const metadataString = model.dataset[EditingInfoDatasetName];\n    let obj: T | null = null;\n\n    try {\n        obj = JSON.parse(metadataString) as T;\n    } catch {}\n\n    if (definition && !validate(obj, definition)) {\n        obj = null;\n    }\n\n    if (callback) {\n        obj = callback(obj);\n\n        if (!obj) {\n            delete model.dataset[EditingInfoDatasetName];\n        } else if (!definition || validate(obj, definition)) {\n            model.dataset[EditingInfoDatasetName] = JSON.stringify(obj);\n        }\n    }\n\n    return obj;\n}\n\n/**\n * Check if the given model has metadata\n * @param model The content model to check\n */\nexport function hasMetadata<T>(model: ContentModelWithDataset<T> | HTMLElement): boolean {\n    return !!model.dataset[EditingInfoDatasetName];\n}\n","/**\n * Replace all child nodes of the given target node to the child nodes of source node.\n * @param target Target node, all child nodes of this node will be removed if keepExistingChildren is not set to true\n * @param source (Optional) source node, all child nodes of this node will be move to target node\n * @param keepExistingChildren (Optional) When set to true, all existing child nodes of target will be kept\n */\nexport function moveChildNodes(target: Node, source?: Node, keepExistingChildren?: boolean) {\n    if (!target) {\n        return;\n    }\n\n    while (!keepExistingChildren && target.firstChild) {\n        target.removeChild(target.firstChild);\n    }\n\n    while (source?.firstChild) {\n        target.appendChild(source.firstChild);\n    }\n}\n\n/**\n * Wrap all child nodes of the given parent element using a new element with the given tag name\n * @param parent The parent element\n * @param tagName The tag name of new wrapper\n * @returns New wrapper element\n */\nexport function wrapAllChildNodes<T extends keyof HTMLElementTagNameMap>(\n    parent: HTMLElement,\n    tagName: T\n): HTMLElementTagNameMap[T] {\n    const newElement = parent.ownerDocument.createElement(tagName);\n\n    moveChildNodes(newElement, parent);\n    parent.appendChild(newElement);\n\n    return newElement;\n}\n","/**\n * Convert a named node map to an array\n * @param collection The map to convert\n */\nexport default function toArray(collection: NamedNodeMap): Attr[];\n\n/**\n * Convert a named node map to an array\n * @param collection The map to convert\n */\nexport default function toArray(collection: DataTransferItemList): DataTransferItem[];\n\n/**\n * Convert a collection to an array\n * @param collection The collection to convert\n */\nexport default function toArray<T extends Node>(collection: NodeListOf<T>): T[];\n\n/**\n * Convert a collection to an array\n * @param collection The collection to convert\n */\nexport default function toArray<T extends Element>(collection: HTMLCollectionOf<T>): T[];\n\n/**\n * Convert an array to an array.\n * This is to satisfy typescript compiler. For some cases the object can be a collection at runtime,\n * but the declaration is an array. e.g. ClipboardData.types\n * @param array The array to convert\n */\nexport default function toArray<T>(array: readonly T[]): T[];\n\nexport default function toArray(collection: any): any[] {\n    return [].slice.call(collection);\n}\n","import type { DirectionFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const directionFormatHandler: FormatHandler<DirectionFormat> = {\n    parse: (format, element, _, defaultStyle) => {\n        const dir = element.style.direction || element.dir || defaultStyle.direction;\n\n        if (dir) {\n            format.direction = dir == 'rtl' ? 'rtl' : 'ltr';\n        }\n    },\n    apply: (format, element) => {\n        if (format.direction) {\n            element.style.direction = format.direction;\n        }\n    },\n};\n","import type { DisplayFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const displayFormatHandler: FormatHandler<DisplayFormat> = {\n    parse: (format, element) => {\n        const display = element.style.display;\n\n        if (display) {\n            format.display = display;\n        }\n    },\n    apply: (format, element) => {\n        if (format.display) {\n            element.style.display = format.display;\n        }\n    },\n};\n","import { calcAlign, ResultMap } from '../utils/dir';\nimport { directionFormatHandler } from './directionFormatHandler';\nimport type {\n    DirectionFormat,\n    HtmlAlignFormat,\n    TextAlignFormat,\n} from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const htmlAlignFormatHandler: FormatHandler<\n    DirectionFormat & HtmlAlignFormat & TextAlignFormat\n> = {\n    parse: (format, element, context, defaultStyle) => {\n        directionFormatHandler.parse(format, element, context, defaultStyle);\n\n        const htmlAlign = element.getAttribute('align');\n\n        if (htmlAlign) {\n            format.htmlAlign = calcAlign(htmlAlign, format.direction);\n            delete format.textAlign;\n            delete context.blockFormat.textAlign;\n        }\n    },\n    apply: (format, element) => {\n        const dir: 'ltr' | 'rtl' = format.direction == 'rtl' ? 'rtl' : 'ltr';\n\n        if (format.htmlAlign) {\n            element.setAttribute('align', ResultMap[format.htmlAlign][dir]);\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { LineHeightFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const lineHeightFormatHandler: FormatHandler<LineHeightFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const lineHeight = element.style.lineHeight || defaultStyle.lineHeight;\n\n        if (lineHeight && lineHeight != 'inherit') {\n            format.lineHeight = lineHeight;\n        }\n    },\n    apply: (format, element) => {\n        if (format.lineHeight) {\n            element.style.lineHeight = format.lineHeight;\n        }\n    },\n};\n","import { parseValueWithUnit } from '../utils/parseValueWithUnit';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { MarginFormat } from 'roosterjs-content-model-types';\n\nconst MarginKeys: (keyof MarginFormat & keyof CSSStyleDeclaration)[] = [\n    'marginTop',\n    'marginRight',\n    'marginBottom',\n    'marginLeft',\n];\n\n/**\n * @internal\n */\nexport const marginFormatHandler: FormatHandler<MarginFormat> = {\n    parse: (format, element, _, defaultStyle) => {\n        MarginKeys.forEach(key => {\n            const value = element.style[key] || defaultStyle[key];\n\n            if (value) {\n                switch (key) {\n                    case 'marginTop':\n                    case 'marginBottom':\n                        format[key] = value;\n                        break;\n\n                    case 'marginLeft':\n                    case 'marginRight':\n                        format[key] = format[key]\n                            ? parseValueWithUnit(format[key] || '', element) +\n                              parseValueWithUnit(value, element) +\n                              'px'\n                            : value;\n                        break;\n                }\n            }\n        });\n    },\n    apply: (format, element, context) => {\n        MarginKeys.forEach(key => {\n            const value = format[key];\n\n            if (value != context.implicitFormat[key]) {\n                element.style[key] = value || '0';\n            }\n        });\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { PaddingFormat } from 'roosterjs-content-model-types';\n\nconst PaddingKeys: (keyof PaddingFormat & keyof CSSStyleDeclaration)[] = [\n    'paddingTop',\n    'paddingRight',\n    'paddingBottom',\n    'paddingLeft',\n];\n\n/**\n * @internal\n */\nexport const paddingFormatHandler: FormatHandler<PaddingFormat> = {\n    parse: (format, element) => {\n        PaddingKeys.forEach(key => {\n            const value = element.style[key];\n\n            if (value) {\n                format[key] = value;\n            }\n        });\n    },\n    apply: (format, element) => {\n        PaddingKeys.forEach(key => {\n            const value = format[key];\n            if (value) {\n                element.style[key] = value;\n            }\n        });\n    },\n};\n","import { calcAlign, ResultMap } from '../utils/dir';\nimport { directionFormatHandler } from './directionFormatHandler';\nimport type { DirectionFormat, TextAlignFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const textAlignFormatHandler: FormatHandler<DirectionFormat & TextAlignFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        directionFormatHandler.parse(format, element, context, defaultStyle);\n\n        let textAlign = element.style.textAlign || defaultStyle.textAlign;\n\n        if (\n            element.tagName == 'LI' &&\n            element.parentElement?.style.display === 'flex' &&\n            element.parentElement.style.flexDirection === 'column' &&\n            element.style.alignSelf\n        ) {\n            // For LI element with flex style applied, we use its \"align-self\" style value instead since LI has a different implementation for align\n            textAlign = element.style.alignSelf;\n        }\n\n        if (textAlign) {\n            format.textAlign = calcAlign(textAlign, format.direction);\n        }\n    },\n    apply: (format, element) => {\n        const dir: 'ltr' | 'rtl' = format.direction == 'rtl' ? 'rtl' : 'ltr';\n\n        if (format.textAlign) {\n            const parent = element.parentElement;\n            const parentTag = parent?.tagName;\n\n            if (element.tagName == 'LI' && parent && (parentTag == 'OL' || parentTag == 'UL')) {\n                element.style.alignSelf = format.textAlign;\n                element.parentElement.style.flexDirection = 'column';\n                element.parentElement.style.display = 'flex';\n            } else {\n                element.style.textAlign = ResultMap[format.textAlign][dir];\n            }\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { WhiteSpaceFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const whiteSpaceFormatHandler: FormatHandler<WhiteSpaceFormat> = {\n    parse: (format, element, _, defaultStyle) => {\n        const whiteSpace = element.style.whiteSpace || defaultStyle.whiteSpace;\n\n        if (whiteSpace) {\n            format.whiteSpace = whiteSpace;\n        }\n    },\n    apply: (format, element, context) => {\n        const whiteSpace = context.implicitFormat.whiteSpace;\n        if (format.whiteSpace != whiteSpace) {\n            element.style.whiteSpace = format.whiteSpace || 'normal';\n        }\n    },\n};\n","import { getColor, setColor } from '../utils/color';\nimport type { BackgroundColorFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const backgroundColorFormatHandler: FormatHandler<BackgroundColorFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const backgroundColor =\n            getColor(\n                element,\n                true /*isBackground*/,\n                context.darkColorHandler,\n                !!context.isDarkMode\n            ) || defaultStyle.backgroundColor;\n\n        if (backgroundColor) {\n            format.backgroundColor = backgroundColor;\n        }\n    },\n    apply: (format, element, context) => {\n        if (format.backgroundColor) {\n            setColor(\n                element,\n                format.backgroundColor,\n                true /*isBackground*/,\n                context.darkColorHandler,\n                !!context.isDarkMode\n            );\n        }\n    },\n};\n","import type { BorderBoxFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const borderBoxFormatHandler: FormatHandler<BorderBoxFormat> = {\n    parse: (format, element) => {\n        if (element.style?.boxSizing == 'border-box') {\n            format.useBorderBox = true;\n        }\n    },\n    apply: (format, element) => {\n        if (format.useBorderBox) {\n            element.style.boxSizing = 'border-box';\n        }\n    },\n};\n","import type { BorderFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * Keys of border items\n */\nexport const BorderKeys: (keyof BorderFormat & keyof CSSStyleDeclaration)[] = [\n    'borderTop',\n    'borderRight',\n    'borderBottom',\n    'borderLeft',\n    'borderRadius',\n];\n\n/**\n * @internal\n */\nexport const borderFormatHandler: FormatHandler<BorderFormat> = {\n    parse: (format, element) => {\n        BorderKeys.forEach(key => {\n            const value = element.style[key];\n\n            if (value) {\n                format[key] = value == 'none' ? '' : value;\n            }\n        });\n    },\n    apply: (format, element) => {\n        BorderKeys.forEach(key => {\n            const value = format[key];\n\n            if (value) {\n                element.style[key] = value;\n            }\n        });\n    },\n};\n","import type { BoxShadowFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const boxShadowFormatHandler: FormatHandler<BoxShadowFormat> = {\n    parse: (format, element) => {\n        if (element.style?.boxShadow) {\n            format.boxShadow = element.style.boxShadow;\n        }\n    },\n    apply: (format, element) => {\n        if (format.boxShadow) {\n            element.style.boxShadow = format.boxShadow;\n        }\n    },\n};\n","import { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport type { DatasetFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const datasetFormatHandler: FormatHandler<DatasetFormat> = {\n    parse: (format, element) => {\n        const dataset = element.dataset;\n\n        getObjectKeys(dataset).forEach(key => {\n            format[key] = dataset[key] || '';\n        });\n    },\n\n    apply: (format, element) => {\n        getObjectKeys(format).forEach(key => {\n            element.dataset[key] = format[key];\n        });\n    },\n};\n","import type { FloatFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const floatFormatHandler: FormatHandler<FloatFormat> = {\n    parse: (format, element) => {\n        const float = element.style.float || element.getAttribute('align');\n\n        if (float) {\n            format.float = float;\n        }\n    },\n    apply: (format, element) => {\n        if (format.float) {\n            element.style.float = format.float;\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { IdFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const idFormatHandler: FormatHandler<IdFormat> = {\n    parse: (format, element) => {\n        if (element.id) {\n            format.id = element.id;\n        }\n    },\n    apply: (format, element) => {\n        if (format.id) {\n            element.id = format.id;\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { SizeFormat } from 'roosterjs-content-model-types';\n\nconst PercentageRegex = /[\\d\\.]+%/;\n\n/**\n * @internal\n */\nexport const sizeFormatHandler: FormatHandler<SizeFormat> = {\n    parse: (format, element, context) => {\n        const width = element.style.width || tryParseSize(element, 'width');\n        const height = element.style.height || tryParseSize(element, 'height');\n        const maxWidth = element.style.maxWidth;\n        const maxHeight = element.style.maxHeight;\n        const minWidth = element.style.minWidth;\n        const minHeight = element.style.minHeight;\n\n        if (width) {\n            format.width = width;\n        }\n        if (height) {\n            format.height = height;\n        }\n        if (maxWidth) {\n            format.maxWidth = maxWidth;\n        }\n        if (maxHeight) {\n            format.maxHeight = maxHeight;\n        }\n        if (minWidth) {\n            format.minWidth = minWidth;\n        }\n        if (minHeight) {\n            format.minHeight = minHeight;\n        }\n    },\n    apply: (format, element) => {\n        if (format.width) {\n            element.style.width = format.width;\n        }\n        if (format.height) {\n            element.style.height = format.height;\n        }\n        if (format.maxWidth) {\n            element.style.maxWidth = format.maxWidth;\n        }\n        if (format.maxHeight) {\n            element.style.maxHeight = format.maxHeight;\n        }\n        if (format.minWidth) {\n            element.style.minWidth = format.minWidth;\n        }\n        if (format.minHeight) {\n            element.style.minHeight = format.minHeight;\n        }\n    },\n};\n\nfunction tryParseSize(element: HTMLElement, attrName: 'width' | 'height'): string | undefined {\n    const attrValue = element.getAttribute(attrName);\n    const value = parseInt(attrValue || '');\n\n    return attrValue && PercentageRegex.test(attrValue)\n        ? attrValue\n        : Number.isNaN(value)\n        ? undefined\n        : value + 'px';\n}\n","import type { FormatHandler } from '../FormatHandler';\nimport type { VerticalAlignFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const verticalAlignFormatHandler: FormatHandler<VerticalAlignFormat> = {\n    parse: (format, element) => {\n        const align = element.style.verticalAlign || element.getAttribute('valign');\n\n        switch (align) {\n            case 'baseline':\n            case 'initial':\n            case 'super':\n            case 'sub':\n            case 'text-top':\n            case 'text-bottom':\n            case 'top':\n                format.verticalAlign = 'top';\n                break;\n\n            case 'bottom':\n                format.verticalAlign = 'bottom';\n                break;\n\n            case 'middle':\n                format.verticalAlign = 'middle';\n                break;\n        }\n    },\n    apply: (format, element) => {\n        if (format.verticalAlign) {\n            element.style.verticalAlign = format.verticalAlign;\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { WordBreakFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const wordBreakFormatHandler: FormatHandler<WordBreakFormat> = {\n    parse: (format, element, _, defaultStyle) => {\n        const wordBreak = element.style.wordBreak || defaultStyle.wordBreak;\n\n        if (wordBreak) {\n            format.wordBreak = wordBreak;\n        }\n    },\n    apply: (format, element) => {\n        if (format.wordBreak) {\n            element.style.wordBreak = format.wordBreak;\n        }\n    },\n};\n","import { backgroundColorFormatHandler } from './common/backgroundColorFormatHandler';\nimport { boldFormatHandler } from './segment/boldFormatHandler';\nimport { borderBoxFormatHandler } from './common/borderBoxFormatHandler';\nimport { borderFormatHandler } from './common/borderFormatHandler';\nimport { boxShadowFormatHandler } from './common/boxShadowFormatHandler';\nimport { datasetFormatHandler } from './common/datasetFormatHandler';\nimport { directionFormatHandler } from './block/directionFormatHandler';\nimport { displayFormatHandler } from './block/displayFormatHandler';\nimport { entityFormatHandler } from './entity/entityFormatHandler';\nimport { floatFormatHandler } from './common/floatFormatHandler';\nimport { fontFamilyFormatHandler } from './segment/fontFamilyFormatHandler';\nimport { fontSizeFormatHandler } from './segment/fontSizeFormatHandler';\nimport { getObjectKeys } from '../domUtils/getObjectKeys';\nimport { htmlAlignFormatHandler } from './block/htmlAlignFormatHandler';\nimport { idFormatHandler } from './common/idFormatHandler';\nimport { italicFormatHandler } from './segment/italicFormatHandler';\nimport { letterSpacingFormatHandler } from './segment/letterSpacingFormatHandler';\nimport { lineHeightFormatHandler } from './block/lineHeightFormatHandler';\nimport { linkFormatHandler } from './segment/linkFormatHandler';\nimport { listItemThreadFormatHandler } from './list/listItemThreadFormatHandler';\nimport { listLevelThreadFormatHandler } from './list/listLevelThreadFormatHandler';\nimport { listStylePositionFormatHandler } from './list/listStylePositionFormatHandler';\nimport { marginFormatHandler } from './block/marginFormatHandler';\nimport { paddingFormatHandler } from './block/paddingFormatHandler';\nimport { sizeFormatHandler } from './common/sizeFormatHandler';\nimport { strikeFormatHandler } from './segment/strikeFormatHandler';\nimport { superOrSubScriptFormatHandler } from './segment/superOrSubScriptFormatHandler';\nimport { tableLayoutFormatHandler } from './table/tableLayoutFormatHandler';\nimport { tableSpacingFormatHandler } from './table/tableSpacingFormatHandler';\nimport { textAlignFormatHandler } from './block/textAlignFormatHandler';\nimport { textColorFormatHandler } from './segment/textColorFormatHandler';\nimport { textColorOnTableCellFormatHandler } from './table/textColorOnTableCellFormatHandler';\nimport { underlineFormatHandler } from './segment/underlineFormatHandler';\nimport { verticalAlignFormatHandler } from './common/verticalAlignFormatHandler';\nimport { whiteSpaceFormatHandler } from './block/whiteSpaceFormatHandler';\nimport { wordBreakFormatHandler } from './common/wordBreakFormatHandler';\nimport type { FormatHandler } from './FormatHandler';\nimport type {\n    ContentModelFormatMap,\n    FormatApplier,\n    FormatAppliers,\n    FormatHandlerTypeMap,\n    FormatKey,\n    FormatParser,\n    FormatParsers,\n} from 'roosterjs-content-model-types';\n\ntype FormatHandlers = {\n    [Key in FormatKey]: FormatHandler<FormatHandlerTypeMap[Key]>;\n};\n\nconst defaultFormatHandlerMap: FormatHandlers = {\n    backgroundColor: backgroundColorFormatHandler,\n    bold: boldFormatHandler,\n    border: borderFormatHandler,\n    borderBox: borderBoxFormatHandler,\n    boxShadow: boxShadowFormatHandler,\n    dataset: datasetFormatHandler,\n    direction: directionFormatHandler,\n    display: displayFormatHandler,\n    float: floatFormatHandler,\n    fontFamily: fontFamilyFormatHandler,\n    fontSize: fontSizeFormatHandler,\n    entity: entityFormatHandler,\n    htmlAlign: htmlAlignFormatHandler,\n    id: idFormatHandler,\n    italic: italicFormatHandler,\n    letterSpacing: letterSpacingFormatHandler,\n    lineHeight: lineHeightFormatHandler,\n    link: linkFormatHandler,\n    listItemThread: listItemThreadFormatHandler,\n    listLevelThread: listLevelThreadFormatHandler,\n    listStylePosition: listStylePositionFormatHandler,\n    margin: marginFormatHandler,\n    padding: paddingFormatHandler,\n    size: sizeFormatHandler,\n    strike: strikeFormatHandler,\n    superOrSubScript: superOrSubScriptFormatHandler,\n    tableLayout: tableLayoutFormatHandler,\n    tableSpacing: tableSpacingFormatHandler,\n    textAlign: textAlignFormatHandler,\n    textColor: textColorFormatHandler,\n    textColorOnTableCell: textColorOnTableCellFormatHandler,\n    underline: underlineFormatHandler,\n    verticalAlign: verticalAlignFormatHandler,\n    whiteSpace: whiteSpaceFormatHandler,\n    wordBreak: wordBreakFormatHandler,\n};\n\nconst styleBasedSegmentFormats: (keyof FormatHandlerTypeMap)[] = [\n    'letterSpacing',\n    'fontFamily',\n    'fontSize',\n];\n\nconst elementBasedSegmentFormats: (keyof FormatHandlerTypeMap)[] = [\n    'strike',\n    'underline',\n    'superOrSubScript',\n    'italic',\n    'bold',\n];\nconst sharedBlockFormats: (keyof FormatHandlerTypeMap)[] = [\n    'direction',\n    'textAlign',\n    'lineHeight',\n    'whiteSpace',\n];\nconst sharedContainerFormats: (keyof FormatHandlerTypeMap)[] = [\n    'backgroundColor',\n    'margin',\n    'padding',\n    'border',\n];\n\n/**\n * @internal\n */\nexport const defaultFormatKeysPerCategory: {\n    [key in keyof ContentModelFormatMap]: (keyof FormatHandlerTypeMap)[];\n} = {\n    block: sharedBlockFormats,\n    listItem: ['listItemThread'],\n    listItemElement: [...sharedBlockFormats, 'direction', 'textAlign', 'lineHeight', 'margin'],\n    listLevel: [\n        'listLevelThread',\n        'direction',\n        'textAlign',\n        'margin',\n        'padding',\n        'listStylePosition',\n        'backgroundColor',\n    ],\n    styleBasedSegment: [...styleBasedSegmentFormats, 'textColor', 'backgroundColor', 'lineHeight'],\n    elementBasedSegment: elementBasedSegmentFormats,\n    segment: [\n        ...styleBasedSegmentFormats,\n        ...elementBasedSegmentFormats,\n        'textColor',\n        'backgroundColor',\n        'lineHeight',\n    ],\n    segmentOnBlock: [...styleBasedSegmentFormats, ...elementBasedSegmentFormats, 'textColor'],\n    segmentOnTableCell: [\n        ...styleBasedSegmentFormats,\n        ...elementBasedSegmentFormats,\n        'textColorOnTableCell',\n    ],\n    tableCell: [\n        'border',\n        'backgroundColor',\n        'padding',\n        'verticalAlign',\n        'wordBreak',\n        'textColor',\n        'htmlAlign',\n        'size',\n    ],\n    tableRow: ['backgroundColor'],\n    table: [\n        'id',\n        'border',\n        'backgroundColor',\n        'display',\n        'htmlAlign',\n        'margin',\n        'size',\n        'tableLayout',\n    ],\n    tableBorder: ['borderBox', 'tableSpacing'],\n    tableCellBorder: ['borderBox'],\n    image: [\n        'id',\n        'size',\n        'margin',\n        'padding',\n        'borderBox',\n        'border',\n        'boxShadow',\n        'display',\n        'float',\n        'verticalAlign',\n    ],\n    link: [\n        'link',\n        'textColor',\n        'underline',\n        'display',\n        'margin',\n        'padding',\n        'backgroundColor',\n        'border',\n        'size',\n        'textAlign',\n    ],\n    segmentUnderLink: ['textColor'],\n    code: ['fontFamily', 'display'],\n    dataset: ['dataset'],\n    divider: [...sharedBlockFormats, ...sharedContainerFormats, 'display', 'size', 'htmlAlign'],\n    container: [...sharedContainerFormats, 'htmlAlign', 'size', 'display'],\n    entity: ['entity'],\n};\n\n/**\n * @internal\n */\nexport const defaultFormatParsers: FormatParsers = getObjectKeys(defaultFormatHandlerMap).reduce(\n    (result, key) => {\n        result[key] = defaultFormatHandlerMap[key].parse as FormatParser<any>;\n        return result;\n    },\n    <FormatParsers>{}\n);\n\n/**\n * @internal\n */\nexport const defaultFormatAppliers: FormatAppliers = getObjectKeys(defaultFormatHandlerMap).reduce(\n    (result, key) => {\n        result[key] = defaultFormatHandlerMap[key].apply as FormatApplier<any>;\n        return result;\n    },\n    <FormatAppliers>{}\n);\n","import { generateEntityClassNames, parseEntityClassName } from '../../domUtils/entityUtils';\nimport type { EntityInfoFormat, IdFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const entityFormatHandler: FormatHandler<EntityInfoFormat & IdFormat> = {\n    parse: (format, element) => {\n        let isEntity = false;\n\n        element.classList.forEach(name => {\n            isEntity = parseEntityClassName(name, format) || isEntity;\n        });\n\n        if (!isEntity) {\n            format.isFakeEntity = true;\n            format.isReadonly = !element.isContentEditable;\n        }\n    },\n\n    apply: (format, element) => {\n        if (!format.isFakeEntity) {\n            element.className = generateEntityClassNames(format);\n        }\n\n        if (format.isReadonly) {\n            element.contentEditable = 'false';\n        } else {\n            element.removeAttribute('contenteditable');\n        }\n    },\n};\n","import { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport { isNodeOfType } from '../../domUtils/isNodeOfType';\nimport { OrderedMap, UnorderedMap } from './listLevelMetadataFormatHandler';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { ListMetadataFormat } from 'roosterjs-content-model-types';\n\nconst OrderedMapPlaceholderRegex = /\\$\\{(\\w+)\\}/;\nconst DefaultOrderedListStyles = ['decimal', 'lower-alpha', 'lower-roman'];\nconst DefaultUnorderedListStyles = ['disc', 'circle', 'square'];\nconst CharCodeOfA = 65;\nconst RomanValues: Record<string, number> = {\n    M: 1000,\n    CM: 900,\n    D: 500,\n    CD: 400,\n    C: 100,\n    XC: 90,\n    L: 50,\n    XL: 40,\n    X: 10,\n    IX: 9,\n    V: 5,\n    IV: 4,\n    I: 1,\n};\n\n/**\n * @internal\n */\nexport const listItemMetadataFormatHandler: FormatHandler<ListMetadataFormat> = {\n    parse: () => {\n        // TODO: Handle list style override\n    },\n    apply: (format, element, context) => {\n        const parent = element.parentNode;\n        const depth = context.listFormat.nodeStack.length - 2; // Minus two for the parent element and convert length to index\n\n        if (depth >= 0 && isNodeOfType(parent, 'ELEMENT_NODE') && !parent.style.listStyleType) {\n            const parentTag = parent.tagName;\n            const style =\n                parentTag == 'OL'\n                    ? getOrderedListStyleValue(\n                          OrderedMap[format.orderedStyleType!],\n                          context.listFormat.threadItemCounts[depth]\n                      ) ?? DefaultOrderedListStyles[depth % DefaultOrderedListStyles.length]\n                    : UnorderedMap[format.unorderedStyleType!] ??\n                      DefaultUnorderedListStyles[depth % DefaultUnorderedListStyles.length];\n\n            if (style && (depth > 0 || (style != 'decimal' && style != 'disc'))) {\n                element.style.listStyleType = style;\n            }\n        }\n    },\n};\n\n/**\n * @internal\n * Export for test only\n */\nexport function getOrderedListStyleValue(\n    template: string | undefined,\n    listNumber: number\n): string | undefined {\n    return template\n        ? template.replace(OrderedMapPlaceholderRegex, (match, subStr) => {\n              switch (subStr) {\n                  case 'Number':\n                      return listNumber + '';\n                  case 'LowerAlpha':\n                      return convertDecimalsToAlpha(listNumber, true /*isLowerCase*/);\n                  case 'UpperAlpha':\n                      return convertDecimalsToAlpha(listNumber, false /*isLowerCase*/);\n                  case 'LowerRoman':\n                      return convertDecimalsToRoman(listNumber, true /*isLowerCase*/);\n                  case 'UpperRoman':\n                      return convertDecimalsToRoman(listNumber, false /*isLowerCase*/);\n              }\n\n              return '';\n          })\n        : undefined;\n}\n\nfunction convertDecimalsToAlpha(decimal: number, isLowerCase?: boolean): string {\n    let alpha = '';\n    decimal--;\n\n    while (decimal >= 0) {\n        alpha = String.fromCharCode((decimal % 26) + CharCodeOfA) + alpha;\n        decimal = Math.floor(decimal / 26) - 1;\n    }\n    return isLowerCase ? alpha.toLowerCase() : alpha;\n}\n\nfunction convertDecimalsToRoman(decimal: number, isLowerCase?: boolean) {\n    let romanValue = '';\n    for (const i of getObjectKeys(RomanValues)) {\n        const timesRomanCharAppear = Math.floor(decimal / RomanValues[i]);\n        decimal = decimal - timesRomanCharAppear * RomanValues[i];\n        romanValue = romanValue + i.repeat(timesRomanCharAppear);\n    }\n    return isLowerCase ? romanValue.toLocaleLowerCase() : romanValue;\n}\n","import { isElementOfType } from '../../domUtils/isElementOfType';\nimport { isNodeOfType } from '../../domUtils/isNodeOfType';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { ListThreadFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const listItemThreadFormatHandler: FormatHandler<ListThreadFormat> = {\n    parse: (format, element, context, defaultStyles) => {\n        const { listFormat } = context;\n        const depth = listFormat.levels.length;\n        const display = element.style.display || defaultStyles.display;\n\n        if (display && display != 'list-item') {\n            format.displayForDummyItem = display;\n        } else if (isLiUnderOl(element) && depth > 0) {\n            listFormat.threadItemCounts[depth - 1]++;\n            listFormat.threadItemCounts.splice(depth);\n            listFormat.levels.forEach(level => {\n                // Delete restart number so next list item doesn't need to have this value.\n                // Then it will be treated as a continuous list item to the previous one\n                delete level.format.startNumberOverride;\n            });\n        }\n    },\n    apply: (format, element, context) => {\n        if (format.displayForDummyItem) {\n            element.style.display = format.displayForDummyItem;\n        } else if (isLiUnderOl(element)) {\n            const { listFormat } = context;\n            const { threadItemCounts } = listFormat;\n            const index = listFormat.nodeStack.length - 2; // The first one is always the parent of list, then minus another 1 to convert length to index\n\n            if (index >= 0) {\n                threadItemCounts.splice(index + 1);\n                threadItemCounts[index] = (threadItemCounts[index] ?? 0) + 1;\n            }\n        }\n    },\n};\n\nfunction isLiUnderOl(element: HTMLElement) {\n    return (\n        isElementOfType(element, 'li') &&\n        isNodeOfType(element.parentNode, 'ELEMENT_NODE') &&\n        isElementOfType(element.parentNode, 'ol')\n    );\n}\n","import { BulletListType, NumberingListType } from 'roosterjs-editor-types';\nimport { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport { isElementOfType } from '../../domUtils/isElementOfType';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { ListMetadataFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const OrderedMap: Record<NumberingListType, string> = {\n    [NumberingListType.Decimal]: 'decimal',\n    [NumberingListType.DecimalDash]: '\"${Number}- \"',\n    [NumberingListType.DecimalParenthesis]: '\"${Number}) \"',\n    [NumberingListType.DecimalDoubleParenthesis]: '\"(${Number}) \"',\n    [NumberingListType.LowerAlpha]: 'lower-alpha',\n    [NumberingListType.LowerAlphaDash]: '\"${LowerAlpha}- \"',\n    [NumberingListType.LowerAlphaParenthesis]: '\"${LowerAlpha}) \"',\n    [NumberingListType.LowerAlphaDoubleParenthesis]: '\"(${LowerAlpha}) \"',\n    [NumberingListType.UpperAlpha]: 'upper-alpha',\n    [NumberingListType.UpperAlphaDash]: '\"${UpperAlpha}- \"',\n    [NumberingListType.UpperAlphaParenthesis]: '\"${UpperAlpha}) \"',\n    [NumberingListType.UpperAlphaDoubleParenthesis]: '\"(${UpperAlpha}) \"',\n    [NumberingListType.LowerRoman]: 'lower-roman',\n    [NumberingListType.LowerRomanDash]: '\"${LowerRoman}- \"',\n    [NumberingListType.LowerRomanParenthesis]: '\"${LowerRoman}) \"',\n    [NumberingListType.LowerRomanDoubleParenthesis]: '\"(${LowerRoman}) \"',\n    [NumberingListType.UpperRoman]: 'upper-roman',\n    [NumberingListType.UpperRomanDash]: '\"${UpperRoman}- \"',\n    [NumberingListType.UpperRomanParenthesis]: '\"${UpperRoman}) \"',\n    [NumberingListType.UpperRomanDoubleParenthesis]: '\"(${UpperRoman}) \"',\n};\n\n/**\n * @internal\n */\nexport const UnorderedMap: Record<BulletListType, string> = {\n    [BulletListType.Disc]: 'disc',\n    [BulletListType.Square]: '\" \"',\n    [BulletListType.Circle]: 'circle',\n    [BulletListType.Dash]: '\"- \"',\n    [BulletListType.LongArrow]: '\" \"',\n    [BulletListType.DoubleLongArrow]: '\" \"',\n    [BulletListType.ShortArrow]: '\" \"',\n    [BulletListType.UnfilledArrow]: '\" \"',\n    [BulletListType.Hyphen]: '\" \"',\n};\n\nconst OLTypeToStyleMap: Record<string, string> = {\n    '1': 'decimal',\n    a: 'lower-alpha',\n    A: 'upper-alpha',\n    i: 'lower-roman',\n    I: 'upper-roman',\n};\n\n/**\n * @internal\n */\nexport const listLevelMetadataFormatHandler: FormatHandler<ListMetadataFormat> = {\n    parse: (format, element) => {\n        const listStyle =\n            element.style.listStyleType ||\n            (isElementOfType(element, 'ol') && OLTypeToStyleMap[element.type]);\n        const tag = element.tagName;\n\n        if (listStyle) {\n            if (tag == 'OL' && format.orderedStyleType === undefined) {\n                const value = getKeyFromValue(OrderedMap, listStyle);\n                format.orderedStyleType =\n                    typeof value === 'undefined' ? undefined : parseInt(value);\n            } else if (tag == 'UL' && format.unorderedStyleType === undefined) {\n                const value = getKeyFromValue(UnorderedMap, listStyle);\n                format.unorderedStyleType =\n                    typeof value === 'undefined' ? undefined : parseInt(value);\n            }\n        }\n    },\n    apply: (format, element) => {\n        const tag = element.tagName;\n        const listType =\n            tag == 'OL'\n                ? OrderedMap[format.orderedStyleType!]\n                : UnorderedMap[format.unorderedStyleType!];\n\n        if (listType && listType.indexOf('\"') < 0) {\n            element.style.listStyleType = listType;\n        }\n    },\n};\n\nfunction getKeyFromValue<K extends string | number, V>(\n    map: Record<K, V>,\n    value: V | undefined\n): string | undefined {\n    const result =\n        value === undefined ? undefined : getObjectKeys(map).filter(key => map[key] == value)[0];\n\n    // During run time the key is always string\n    return (result as any) as string | undefined;\n}\n","import { isElementOfType } from '../../domUtils/isElementOfType';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { ListThreadFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const listLevelThreadFormatHandler: FormatHandler<ListThreadFormat> = {\n    parse: (format, element, context) => {\n        if (isElementOfType(element, 'ol')) {\n            const { listFormat } = context;\n            const { threadItemCounts, levels } = listFormat;\n            const depth = levels.length;\n\n            if (\n                typeof threadItemCounts[depth] === 'number' &&\n                element.start != threadItemCounts[depth] + 1\n            ) {\n                format.startNumberOverride = element.start;\n            }\n\n            threadItemCounts[depth] = element.start - 1;\n        }\n    },\n    apply: (format, element, context) => {\n        const {\n            listFormat: { threadItemCounts, nodeStack },\n        } = context;\n        const depth = nodeStack.length - 1; // The first one is always the parent of list\n\n        if (depth >= 0 && isElementOfType(element, 'ol')) {\n            const startNumber = format.startNumberOverride;\n\n            if (typeof startNumber === 'number') {\n                threadItemCounts[depth] = startNumber - 1;\n            } else if (typeof threadItemCounts[depth] != 'number') {\n                threadItemCounts[depth] = 0;\n            }\n\n            threadItemCounts.splice(depth + 1);\n            element.start = threadItemCounts[depth] + 1;\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { ListStylePositionFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const listStylePositionFormatHandler: FormatHandler<ListStylePositionFormat> = {\n    parse: (format, element) => {\n        const listStylePosition = element.style.listStylePosition;\n\n        if (listStylePosition) {\n            format.listStylePosition = listStylePosition;\n        }\n    },\n    apply: (format, element) => {\n        if (format.listStylePosition) {\n            element.style.listStylePosition = format.listStylePosition;\n        }\n    },\n};\n","import { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type { BoldFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const boldFormatHandler: FormatHandler<BoldFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const fontWeight = element.style.fontWeight || defaultStyle.fontWeight;\n\n        if (fontWeight) {\n            format.fontWeight = fontWeight;\n        }\n    },\n    apply: (format, element, context) => {\n        if (typeof format.fontWeight === 'undefined') {\n            return;\n        }\n\n        const blockFontWeight = context.implicitFormat.fontWeight;\n\n        if (\n            (blockFontWeight && blockFontWeight != format.fontWeight) ||\n            (!blockFontWeight && format.fontWeight && format.fontWeight != 'normal')\n        ) {\n            if (format.fontWeight == 'bold') {\n                wrapAllChildNodes(element, 'b');\n            } else {\n                element.style.fontWeight = format.fontWeight || 'normal';\n            }\n        }\n    },\n};\n","import type { FontFamilyFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const fontFamilyFormatHandler: FormatHandler<FontFamilyFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const fontFamily = element.style.fontFamily || defaultStyle.fontFamily;\n\n        if (fontFamily && fontFamily != 'inherit') {\n            format.fontFamily = fontFamily;\n        }\n    },\n    apply: (format, element, context) => {\n        if (format.fontFamily && format.fontFamily != context.implicitFormat.fontFamily) {\n            element.style.fontFamily = format.fontFamily;\n        }\n    },\n};\n","import { isSuperOrSubScript } from './superOrSubScriptFormatHandler';\nimport { parseValueWithUnit } from '../utils/parseValueWithUnit';\nimport type { FontSizeFormat } from 'roosterjs-content-model-types';\nimport type { FormatHandler } from '../FormatHandler';\n\n/**\n * @internal\n */\nexport const fontSizeFormatHandler: FormatHandler<FontSizeFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const fontSize = element.style.fontSize || defaultStyle.fontSize;\n        const verticalAlign = element.style.verticalAlign || defaultStyle.verticalAlign;\n\n        // when font size is 'smaller' and the style is for superscript/subscript,\n        // the font size will be handled by superOrSubScript handler\n        if (fontSize && !isSuperOrSubScript(fontSize, verticalAlign) && fontSize != 'inherit') {\n            if (element.style.fontSize) {\n                format.fontSize = normalizeFontSize(fontSize, context.segmentFormat.fontSize);\n            } else if (defaultStyle.fontSize) {\n                format.fontSize = fontSize;\n            }\n        }\n    },\n    apply: (format, element, context) => {\n        if (format.fontSize && format.fontSize != context.implicitFormat.fontSize) {\n            element.style.fontSize = format.fontSize;\n        }\n    },\n};\n\n// https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\nconst KnownFontSizes: Record<string, string> = {\n    'xx-small': '6.75pt',\n    'x-small': '7.5pt',\n    small: '9.75pt',\n    medium: '12pt',\n    large: '13.5pt',\n    'x-large': '18pt',\n    'xx-large': '24pt',\n    'xxx-large': '36pt',\n};\n\nfunction normalizeFontSize(fontSize: string, contextFont: string | undefined): string | undefined {\n    const knownFontSize = KnownFontSizes[fontSize];\n\n    if (knownFontSize) {\n        return knownFontSize;\n    } else if (\n        fontSize == 'smaller' ||\n        fontSize == 'larger' ||\n        fontSize.endsWith('em') ||\n        fontSize.endsWith('%')\n    ) {\n        if (!contextFont) {\n            return undefined;\n        } else {\n            const existingFontSize = parseValueWithUnit(contextFont, undefined /*element*/, 'px');\n\n            if (existingFontSize) {\n                switch (fontSize) {\n                    case 'smaller':\n                        return Math.round((existingFontSize * 500) / 6) / 100 + 'px';\n                    case 'larger':\n                        return Math.round((existingFontSize * 600) / 5) / 100 + 'px';\n                    default:\n                        return parseValueWithUnit(fontSize, existingFontSize, 'px') + 'px';\n                }\n            }\n        }\n    } else if (fontSize == 'inherit' || fontSize == 'revert' || fontSize == 'unset') {\n        return undefined;\n    } else {\n        return fontSize;\n    }\n}\n","import { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { ItalicFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const italicFormatHandler: FormatHandler<ItalicFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const fontStyle = element.style.fontStyle || defaultStyle.fontStyle;\n\n        if (fontStyle == 'italic' || fontStyle == 'oblique') {\n            format.italic = true;\n        } else if (fontStyle == 'initial' || fontStyle == 'normal') {\n            format.italic = false;\n        }\n    },\n    apply: (format, element, context) => {\n        if (typeof format.italic === 'undefined') {\n            return;\n        }\n\n        const implicitItalic = context.implicitFormat.italic;\n\n        if (!!implicitItalic != !!format.italic) {\n            if (format.italic) {\n                wrapAllChildNodes(element, 'i');\n            } else {\n                element.style.fontStyle = 'normal';\n            }\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { LetterSpacingFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const letterSpacingFormatHandler: FormatHandler<LetterSpacingFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const letterSpacing = element.style.letterSpacing || defaultStyle.letterSpacing;\n\n        if (letterSpacing) {\n            format.letterSpacing = letterSpacing;\n        }\n    },\n    apply: (format, element, context) => {\n        if (format.letterSpacing) {\n            element.style.letterSpacing = format.letterSpacing;\n        }\n    },\n};\n","import { isElementOfType } from '../../domUtils/isElementOfType';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { LinkFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const linkFormatHandler: FormatHandler<LinkFormat> = {\n    parse: (format, element) => {\n        if (isElementOfType(element, 'a')) {\n            const name = element.name;\n            const href = element.getAttribute('href'); // Use getAttribute to get original HREF but not the resolved absolute url\n            const target = element.target;\n            const rel = element.rel;\n            const id = element.id;\n            const className = element.className;\n            const title = element.title;\n\n            if (name) {\n                format.name = name;\n            }\n\n            if (href) {\n                format.href = href;\n            }\n\n            if (target) {\n                format.target = target;\n            }\n\n            if (id) {\n                format.anchorId = id;\n            }\n\n            if (rel) {\n                format.relationship = rel;\n            }\n\n            if (title) {\n                format.anchorTitle = title;\n            }\n\n            if (className) {\n                format.anchorClass = className;\n            }\n        }\n    },\n    apply: (format, element) => {\n        if (isElementOfType(element, 'a') && format.href) {\n            element.href = format.href;\n\n            if (format.name) {\n                element.name = format.name;\n            }\n\n            if (format.target) {\n                element.target = format.target;\n            }\n\n            if (format.anchorId) {\n                element.id = format.anchorId;\n            }\n\n            if (format.anchorClass) {\n                element.className = format.anchorClass;\n            }\n\n            if (format.anchorTitle) {\n                element.title = format.anchorTitle;\n            }\n\n            if (format.relationship) {\n                element.rel = format.relationship;\n            }\n        }\n    },\n};\n","import { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { StrikeFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const strikeFormatHandler: FormatHandler<StrikeFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const textDecoration = element.style.textDecoration || defaultStyle.textDecoration;\n\n        if (textDecoration?.indexOf('line-through')! >= 0) {\n            format.strikethrough = true;\n        }\n    },\n    apply: (format, element) => {\n        if (format.strikethrough) {\n            wrapAllChildNodes(element, 's');\n        }\n    },\n};\n","import { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { SuperOrSubScriptFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const superOrSubScriptFormatHandler: FormatHandler<SuperOrSubScriptFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const verticalAlign = element.style.verticalAlign || defaultStyle.verticalAlign;\n        const fontSize = element.style.fontSize || defaultStyle.fontSize;\n\n        if (isSuperOrSubScript(fontSize, verticalAlign)) {\n            format.superOrSubScriptSequence = (format.superOrSubScriptSequence || '')\n                .split(' ')\n                .concat(verticalAlign)\n                .join(' ')\n                .trim();\n        }\n    },\n    apply: (format, element) => {\n        if (format.superOrSubScriptSequence) {\n            format.superOrSubScriptSequence\n                .split(' ')\n                .reverse()\n                .forEach(value => {\n                    const tagName = value == 'super' ? 'sup' : value == 'sub' ? 'sub' : null;\n\n                    if (tagName) {\n                        wrapAllChildNodes(element, tagName);\n                    }\n                });\n        }\n    },\n};\n\n/**\n * @internal\n */\nexport function isSuperOrSubScript(\n    fontSize: string | undefined,\n    verticalAlign: string | undefined\n): verticalAlign is 'sub' | 'super' {\n    return fontSize == 'smaller' && (verticalAlign == 'sub' || verticalAlign == 'super');\n}\n","import { getColor, setColor } from '../utils/color';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { TextColorFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const textColorFormatHandler: FormatHandler<TextColorFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const textColor =\n            getColor(\n                element,\n                false /*isBackground*/,\n                context.darkColorHandler,\n                !!context.isDarkMode\n            ) || defaultStyle.color;\n\n        if (textColor && textColor != 'inherit') {\n            format.textColor = textColor;\n        }\n    },\n    apply: (format, element, context) => {\n        const implicitColor = context.implicitFormat.textColor;\n\n        if (format.textColor && format.textColor != implicitColor) {\n            setColor(\n                element,\n                format.textColor,\n                false /*isBackground*/,\n                context.darkColorHandler,\n                !!context.isDarkMode\n            );\n        }\n    },\n};\n","import { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type { FormatHandler } from '../FormatHandler';\nimport type { UnderlineFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const underlineFormatHandler: FormatHandler<UnderlineFormat> = {\n    parse: (format, element, context, defaultStyle) => {\n        const textDecoration = element.style.textDecoration || defaultStyle.textDecoration;\n\n        if (textDecoration?.indexOf('underline')! >= 0) {\n            format.underline = true;\n        } else if (element.tagName == 'A' && textDecoration == 'none') {\n            format.underline = false;\n        }\n    },\n    apply: (format, element, context) => {\n        if (typeof format.underline === 'undefined') {\n            return;\n        }\n\n        const blockUnderline = context.implicitFormat.underline;\n\n        if (!!blockUnderline != !!format.underline) {\n            if (format.underline) {\n                wrapAllChildNodes(element, 'u');\n            } else {\n                element.style.textDecoration = 'none';\n            }\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { TableLayoutFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const tableLayoutFormatHandler: FormatHandler<TableLayoutFormat> = {\n    parse: (format, element) => {\n        const tableLayout = element.style.tableLayout;\n        if (tableLayout && tableLayout != 'inherit') {\n            format.tableLayout = tableLayout;\n        }\n    },\n    apply: (format, element) => {\n        if (format.tableLayout) {\n            element.style.tableLayout = format.tableLayout;\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { SpacingFormat } from 'roosterjs-content-model-types';\n\nconst BorderCollapsed = 'collapse';\n\n/**\n * @internal\n */\nexport const tableSpacingFormatHandler: FormatHandler<SpacingFormat> = {\n    parse: (format, element) => {\n        if (element.style.borderCollapse == BorderCollapsed) {\n            format.borderCollapse = true;\n        }\n    },\n    apply: (format, element) => {\n        if (format.borderCollapse) {\n            element.style.borderCollapse = BorderCollapsed;\n            element.style.borderSpacing = '0';\n            element.style.boxSizing = 'border-box';\n        }\n    },\n};\n","import type { FormatHandler } from '../FormatHandler';\nimport type { TextColorFormat } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const textColorOnTableCellFormatHandler: FormatHandler<TextColorFormat> = {\n    parse: (format, element) => {\n        if (element.style.color) {\n            // Delete color from format since text color on TD/TH will be handled by separate code\n            // and text color on segment format context need to be reset so that it will not inherit\n            // value outer container\n            delete format.textColor;\n        }\n    },\n    apply: () => {},\n};\n","import type { DarkColorHandler } from 'roosterjs-editor-types';\n\n/**\n * List of deprecated colors\n */\nexport const DeprecatedColors: string[] = [\n    'inactiveborder',\n    'activeborder',\n    'inactivecaptiontext',\n    'inactivecaption',\n    'activecaption',\n    'appworkspace',\n    'infobackground',\n    'background',\n    'buttonhighlight',\n    'buttonshadow',\n    'captiontext',\n    'infotext',\n    'menutext',\n    'menu',\n    'scrollbar',\n    'threeddarkshadow',\n    'threedface',\n    'threedhighlight',\n    'threedlightshadow',\n    'threedfhadow',\n    'windowtext',\n    'windowframe',\n    'window',\n];\n\n/**\n * @internal\n */\nexport function getColor(\n    element: HTMLElement,\n    isBackground: boolean,\n    darkColorHandler: DarkColorHandler | undefined | null,\n    isDarkMode: boolean\n): string | undefined {\n    let color: string | undefined;\n\n    if (!color) {\n        color =\n            (darkColorHandler &&\n                tryGetFontColor(element, isDarkMode, darkColorHandler, isBackground)) ||\n            (isBackground ? element.style.backgroundColor : element.style.color) ||\n            element.getAttribute(isBackground ? 'bgcolor' : 'color') ||\n            undefined;\n    }\n\n    if (color && DeprecatedColors.indexOf(color) > -1) {\n        color = undefined;\n    }\n\n    if (darkColorHandler) {\n        color = darkColorHandler.parseColorValue(color).lightModeColor;\n    }\n\n    return color;\n}\n\n/**\n * @internal\n */\nexport function setColor(\n    element: HTMLElement,\n    lightModeColor: string,\n    isBackground: boolean,\n    darkColorHandler: DarkColorHandler | undefined | null,\n    isDarkMode: boolean\n) {\n    const effectiveColor = darkColorHandler\n        ? darkColorHandler.registerColor(lightModeColor, isDarkMode)\n        : lightModeColor;\n\n    if (isBackground) {\n        element.style.backgroundColor = effectiveColor;\n    } else {\n        element.style.color = effectiveColor;\n    }\n}\n\n/**\n * There is a known issue that when input with IME in Chrome, it is possible Chrome insert a new FONT tag with colors.\n * If editor is in dark mode, this color will cause the FONT tag doesn't have light mode color info so that after convert\n * to light mode the color will be wrong.\n * To workaround it, we check if this is a known color (for light mode with VariableBasedDarkColor enabled, all used colors\n * are stored in darkColorHandler), then use the related light mode color instead.\n */\nfunction tryGetFontColor(\n    element: HTMLElement,\n    isDarkMode: boolean,\n    darkColorHandler: DarkColorHandler,\n    isBackground: boolean\n) {\n    let darkColor: string | null;\n\n    return element.tagName == 'FONT' &&\n        !element.style.getPropertyValue(isBackground ? 'background-color' : 'color') &&\n        isDarkMode &&\n        (darkColor = element.getAttribute(isBackground ? 'bgcolor' : 'color'))\n        ? darkColorHandler.findLightColorFromDarkColor(darkColor)\n        : null;\n}\n","/**\n * @internal\n */\nexport const ResultMap = {\n    start: {\n        ltr: 'left',\n        rtl: 'right',\n    },\n    center: {\n        ltr: 'center',\n        rtl: 'center',\n    },\n    end: {\n        ltr: 'right',\n        rtl: 'left',\n    },\n    initial: {\n        ltr: 'initial',\n        rtl: 'initial',\n    },\n    justify: {\n        ltr: 'justify',\n        rtl: 'justify',\n    },\n};\n\n/**\n * @internal\n */\nexport function calcAlign(align: string, dir?: 'ltr' | 'rtl') {\n    switch (align) {\n        case 'center':\n            return 'center';\n\n        case 'left':\n            return dir == 'rtl' ? 'end' : 'start';\n\n        case 'right':\n            return dir == 'rtl' ? 'start' : 'end';\n\n        case 'start':\n        case 'end':\n            return align;\n\n        case 'justify':\n        case 'initial':\n            return align;\n\n        default:\n            return undefined;\n    }\n}\n","const MarginValueRegex = /(-?\\d+(\\.\\d+)?)([a-z]+|%)/;\n\n/**\n * Parse unit value with its unit\n * @param value The source value to parse\n * @param currentSizePxOrElement The source element which has this unit value, or current font size (in px) from context.\n * @param resultUnit Unit for result, can be px or pt. @default px\n */\nexport function parseValueWithUnit(\n    value: string = '',\n    currentSizePxOrElement?: number | HTMLElement,\n    resultUnit: 'px' | 'pt' = 'px'\n): number {\n    const match = MarginValueRegex.exec(value);\n    let result = 0;\n\n    if (match) {\n        const [_, numStr, __, unit] = match;\n        const num = parseFloat(numStr);\n\n        switch (unit) {\n            case 'px':\n                result = num;\n                break;\n            case 'pt':\n                result = ptToPx(num);\n                break;\n            case 'em':\n                result = getFontSize(currentSizePxOrElement) * num;\n                break;\n            case 'ex':\n                result = (getFontSize(currentSizePxOrElement) * num) / 2;\n                break;\n            case '%':\n                result = (getFontSize(currentSizePxOrElement) * num) / 100;\n                break;\n            default:\n                // TODO: Support more unit if need\n                break;\n        }\n    }\n\n    if (result > 0 && resultUnit == 'pt') {\n        result = pxToPt(result);\n    }\n\n    return result;\n}\n\nfunction getFontSize(currentSizeOrElement?: number | HTMLElement): number {\n    if (typeof currentSizeOrElement === 'undefined') {\n        return 0;\n    } else if (typeof currentSizeOrElement === 'number') {\n        return currentSizeOrElement;\n    } else {\n        const styleInPt =\n            currentSizeOrElement.ownerDocument.defaultView?.getComputedStyle(currentSizeOrElement)\n                .fontSize ?? '';\n        const floatInPt = parseFloat(styleInPt);\n        const floatInPx = ptToPx(floatInPt);\n\n        return floatInPx;\n    }\n}\n\nfunction ptToPx(pt: number): number {\n    return Math.round((pt * 4000) / 3) / 1000;\n}\n\nfunction pxToPt(px: number) {\n    return Math.round((px * 3000) / 4) / 1000;\n}\n","export { domToContentModel } from './domToModel/domToContentModel';\nexport { contentModelToDom } from './modelToDom/contentModelToDom';\n\nexport {\n    childProcessor,\n    handleRegularSelection,\n    processChildNode,\n} from './domToModel/processors/childProcessor';\nexport { entityProcessor } from './domToModel/processors/entityProcessor';\nexport { tableProcessor } from './domToModel/processors/tableProcessor';\nexport { getRegularSelectionOffsets } from './domToModel/utils/getRegularSelectionOffsets';\nexport { parseFormat } from './domToModel/utils/parseFormat';\nexport { areSameFormats } from './domToModel/utils/areSameFormats';\n\nexport { updateMetadata, hasMetadata } from './domUtils/metadata/updateMetadata';\nexport { updateListMetadata } from './domUtils/metadata/updateListMetadata';\nexport { isNodeOfType, NodeTypeMap } from './domUtils/isNodeOfType';\nexport { isElementOfType } from './domUtils/isElementOfType';\nexport { getObjectKeys } from './domUtils/getObjectKeys';\nexport { default as toArray } from './domUtils/toArray';\nexport { moveChildNodes, wrapAllChildNodes } from './domUtils/moveChildNodes';\n\nexport { createBr } from './modelApi/creators/createBr';\nexport { createListItem } from './modelApi/creators/createListItem';\nexport { createFormatContainer } from './modelApi/creators/createFormatContainer';\nexport { createParagraph } from './modelApi/creators/createParagraph';\nexport { createSelectionMarker } from './modelApi/creators/createSelectionMarker';\nexport { createTable } from './modelApi/creators/createTable';\nexport { createTableCell } from './modelApi/creators/createTableCell';\nexport { createText } from './modelApi/creators/createText';\nexport { createImage } from './modelApi/creators/createImage';\nexport { createContentModelDocument } from './modelApi/creators/createContentModelDocument';\nexport { createParagraphDecorator } from './modelApi/creators/createParagraphDecorator';\nexport { createGeneralSegment } from './modelApi/creators/createGeneralSegment';\nexport { createGeneralBlock } from './modelApi/creators/createGeneralBlock';\nexport { createEntity } from './modelApi/creators/createEntity';\nexport { createDivider } from './modelApi/creators/createDivider';\nexport { createListLevel } from './modelApi/creators/createListLevel';\n\nexport { addBlock } from './modelApi/common/addBlock';\nexport { addCode } from './modelApi/common/addDecorators';\nexport { addLink } from './modelApi/common/addDecorators';\nexport { ensureParagraph } from './modelApi/common/ensureParagraph';\n\nexport { normalizeContentModel } from './modelApi/common/normalizeContentModel';\nexport { isGeneralSegment } from './modelApi/common/isGeneralSegment';\nexport { unwrapBlock } from './modelApi/common/unwrapBlock';\nexport { addSegment } from './modelApi/common/addSegment';\nexport { isWhiteSpacePreserved } from './modelApi/common/isWhiteSpacePreserved';\nexport { normalizeSingleSegment } from './modelApi/common/normalizeSegment';\nexport { applySegmentFormatToElement } from './modelApi/common/applySegmentFormatToElement';\n\nexport { setParagraphNotImplicit } from './modelApi/block/setParagraphNotImplicit';\n\nexport { parseValueWithUnit } from './formatHandlers/utils/parseValueWithUnit';\nexport { BorderKeys } from './formatHandlers/common/borderFormatHandler';\nexport { DeprecatedColors } from './formatHandlers/utils/color';\n\nexport {\n    createDomToModelContext,\n    createDomToModelContextWithConfig,\n    createDomToModelConfig,\n} from './domToModel/context/createDomToModelContext';\nexport {\n    createModelToDomContext,\n    createModelToDomContextWithConfig,\n    createModelToDomConfig,\n} from './modelToDom/context/createModelToDomContext';\n","import type { ContentModelBlock } from 'roosterjs-content-model-types';\n\n/**\n * For a given block, if it is a paragraph, set it to be not-implicit\n * @param block The block to check\n */\nexport function setParagraphNotImplicit(block: ContentModelBlock) {\n    if (block.blockType == 'Paragraph' && block.isImplicit) {\n        block.isImplicit = false;\n    }\n}\n","import type { ContentModelBlock, ContentModelBlockGroup } from 'roosterjs-content-model-types';\n\n/**\n * Add a given block to block group\n * @param group The block group to add block into\n * @param block The block to add\n */\nexport function addBlock(group: ContentModelBlockGroup, block: ContentModelBlock) {\n    group.blocks.push(block);\n}\n","import type {\n    ContentModelCode,\n    ContentModelLink,\n    ContentModelSegment,\n    DomToModelDecoratorContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function addLink(segment: ContentModelSegment, link: ContentModelLink) {\n    if (link.format.href) {\n        segment.link = {\n            format: { ...link.format },\n            dataset: { ...link.dataset },\n        };\n    }\n}\n\n/**\n * Add a code decorator into segment if any\n * @param segment The segment to add decorator to\n * @param code The code decorator to add\n */\nexport function addCode(segment: ContentModelSegment, code: ContentModelCode) {\n    if (code.format.fontFamily) {\n        segment.code = {\n            format: { ...code.format },\n        };\n    }\n}\n\n/**\n * @internal\n */\nexport function addDecorators(segment: ContentModelSegment, context: DomToModelDecoratorContext) {\n    addLink(segment, context.link);\n    addCode(segment, context.code);\n}\n","import { ensureParagraph } from './ensureParagraph';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelBlockGroup,\n    ContentModelParagraph,\n    ContentModelSegment,\n} from 'roosterjs-content-model-types';\n\n/**\n * Add a given segment into a paragraph from its parent group. If the last block of the given group is not paragraph, create a new paragraph.\n * @param group The parent block group of the paragraph to add segment into\n * @param newSegment The segment to add\n * @param blockFormat The block format used for creating a new paragraph when need\n * @returns The parent paragraph where the segment is added to\n */\nexport function addSegment(\n    group: ContentModelBlockGroup,\n    newSegment: ContentModelSegment,\n    blockFormat?: ContentModelBlockFormat\n): ContentModelParagraph {\n    const paragraph = ensureParagraph(group, blockFormat);\n    const lastSegment = paragraph.segments[paragraph.segments.length - 1];\n\n    if (newSegment.segmentType == 'SelectionMarker') {\n        if (!lastSegment || !lastSegment.isSelected) {\n            paragraph.segments.push(newSegment);\n        }\n    } else {\n        if (newSegment.isSelected && lastSegment?.segmentType == 'SelectionMarker') {\n            paragraph.segments.pop();\n        }\n\n        paragraph.segments.push(newSegment);\n    }\n\n    return paragraph;\n}\n","import { applyFormat } from '../../modelToDom/utils/applyFormat';\nimport { createModelToDomContext } from '../../modelToDom/context/createModelToDomContext';\nimport type { ContentModelSegmentFormat } from 'roosterjs-content-model-types';\n\n/**\n * Format an existing HTML element using Segment Format\n * @param element The element to format\n * @param format The format to apply\n */\nexport function applySegmentFormatToElement(\n    element: HTMLElement,\n    format: ContentModelSegmentFormat\n) {\n    const context = createModelToDomContext();\n    applyFormat(element, context.formatAppliers.segment, format, context);\n}\n","import { addBlock } from './addBlock';\nimport { createParagraph } from '../creators/createParagraph';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelBlockGroup,\n    ContentModelParagraph,\n} from 'roosterjs-content-model-types';\n\n/**\n * Ensure there is a Paragraph that can insert segments in a Content Model Block Group\n * @param group The parent block group of the target paragraph\n * @param blockFormat Format of the paragraph. This is only used if we need to create a new paragraph\n */\nexport function ensureParagraph(\n    group: ContentModelBlockGroup,\n    blockFormat?: ContentModelBlockFormat\n): ContentModelParagraph {\n    const lastBlock = group.blocks[group.blocks.length - 1];\n\n    if (lastBlock?.blockType == 'Paragraph') {\n        return lastBlock;\n    } else {\n        const paragraph = createParagraph(true, blockFormat);\n        addBlock(group, paragraph);\n\n        return paragraph;\n    }\n}\n","// A regex to match text that only has space and CR\n// We use real space char \" \" (\\u0020) here but not \"\\s\" since \"\\s\" will also match \"&nbsp;\" (\\u00A0) which is something we need to keep\nconst SPACE_TEXT_REGEX = /^[\\r\\n\\t ]*$/;\n\n/**\n * @internal\n * Check if the given string only has space, including line breaks.\n * @param txt The string to check\n */\nexport function hasSpacesOnly(txt: string): boolean {\n    return SPACE_TEXT_REGEX.test(txt);\n}\n","import type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelSegment,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function isBlockEmpty(block: ContentModelBlock): boolean {\n    switch (block.blockType) {\n        case 'Paragraph':\n            return block.segments.length == 0;\n\n        case 'Table':\n            return block.rows.every(row => row.cells.length == 0);\n\n        case 'BlockGroup':\n            return isBlockGroupEmpty(block);\n\n        case 'Entity':\n            return false;\n\n        default:\n            return false;\n    }\n}\n\n/**\n * @internal\n */\nexport function isBlockGroupEmpty(group: ContentModelBlockGroup): boolean {\n    switch (group.blockGroupType) {\n        case 'FormatContainer':\n            // Format Container of DIV is a container for style, so we always treat it as not empty\n            return group.tagName == 'div' ? false : group.blocks.every(isBlockEmpty);\n\n        case 'ListItem':\n            return group.blocks.every(isBlockEmpty);\n\n        case 'Document':\n        case 'General':\n        case 'TableCell':\n            return false;\n\n        default:\n            return true;\n    }\n}\n\n/**\n * @internal\n */\nexport function isSegmentEmpty(segment: ContentModelSegment): boolean {\n    switch (segment.segmentType) {\n        case 'Text':\n            return !segment.text;\n\n        case 'Image':\n            return !segment.src;\n\n        default:\n            return false;\n    }\n}\n\n/**\n * @internal\n */\nexport function isEmpty(\n    model: ContentModelBlock | ContentModelBlockGroup | ContentModelSegment\n): boolean {\n    if (isBlockGroup(model)) {\n        return isBlockGroupEmpty(model);\n    } else if (isBlock(model)) {\n        return isBlockEmpty(model);\n    } else if (isSegment(model)) {\n        return isSegmentEmpty(model);\n    }\n\n    return false;\n}\n\nfunction isSegment(\n    model: ContentModelBlock | ContentModelBlockGroup | ContentModelSegment\n): model is ContentModelSegment {\n    return typeof (<ContentModelSegment>model).segmentType === 'string';\n}\n\nfunction isBlock(\n    model: ContentModelBlock | ContentModelBlockGroup | ContentModelSegment\n): model is ContentModelBlock {\n    return typeof (<ContentModelBlock>model).blockType === 'string';\n}\n\nfunction isBlockGroup(\n    model: ContentModelBlock | ContentModelBlockGroup | ContentModelSegment\n): model is ContentModelBlockGroup {\n    return typeof (<ContentModelBlockGroup>model).blockGroupType === 'string';\n}\n","import type {\n    ContentModelBlockGroup,\n    ContentModelGeneralSegment,\n} from 'roosterjs-content-model-types';\n\n/**\n * Check if the given block group is a general segment\n * @param group The group to check\n */\nexport function isGeneralSegment(\n    group: ContentModelBlockGroup | ContentModelGeneralSegment\n): group is ContentModelGeneralSegment {\n    return (\n        group.blockGroupType == 'General' &&\n        (<ContentModelGeneralSegment>group).segmentType == 'General'\n    );\n}\n","import type { ContentModelParagraph } from 'roosterjs-content-model-types';\n\n// According to https://developer.mozilla.org/en-US/docs/Web/CSS/white-space, these style values will need to preserve white spaces\nconst WHITESPACE_PRE_VALUES = ['pre', 'pre-wrap', 'break-spaces'];\n\n/**\n * Check if we have white-space to be preserved for a given paragraph\n * @param paragraph The paragraph to check\n */\nexport function isWhiteSpacePreserved(paragraph: ContentModelParagraph): boolean {\n    return (\n        (paragraph.format.whiteSpace &&\n            WHITESPACE_PRE_VALUES.indexOf(paragraph.format.whiteSpace) >= 0) ||\n        false\n    );\n}\n","import { isBlockEmpty } from './isEmpty';\nimport { normalizeParagraph } from './normalizeParagraph';\nimport { unwrapBlock } from './unwrapBlock';\nimport type { ContentModelBlockGroup } from 'roosterjs-content-model-types';\n\n/**\n * For a given content model, normalize it to make the model be consistent.\n * This process includes:\n * - For a list item without any list level, unwrap the list item\n * - For a paragraph, make sure it has BR at the end if it is an empty paragraph\n * - For text segments under paragraph, make sure its space values are correct (use nbsp to replace space when necessary)\n * - For an empty block, remove it\n * @param group The root level block group of content model to normalize\n */\nexport function normalizeContentModel(group: ContentModelBlockGroup) {\n    for (let i = group.blocks.length - 1; i >= 0; i--) {\n        const block = group.blocks[i];\n\n        switch (block.blockType) {\n            case 'BlockGroup':\n                if (block.blockGroupType == 'ListItem' && block.levels.length == 0) {\n                    i += block.blocks.length;\n                    unwrapBlock(group, block);\n                } else {\n                    normalizeContentModel(block);\n                }\n                break;\n            case 'Paragraph':\n                normalizeParagraph(block);\n                break;\n            case 'Table':\n                for (let r = 0; r < block.rows.length; r++) {\n                    for (let c = 0; c < block.rows[r].cells.length; c++) {\n                        if (block.rows[r].cells[c]) {\n                            normalizeContentModel(block.rows[r].cells[c]);\n                        }\n                    }\n                }\n                break;\n        }\n\n        if (isBlockEmpty(block)) {\n            group.blocks.splice(i, 1);\n        }\n    }\n}\n","import { areSameFormats } from '../../domToModel/utils/areSameFormats';\nimport { createBr } from '../creators/createBr';\nimport { isSegmentEmpty } from './isEmpty';\nimport { isWhiteSpacePreserved } from './isWhiteSpacePreserved';\nimport { normalizeAllSegments } from './normalizeSegment';\nimport type { ContentModelParagraph } from 'roosterjs-content-model-types';\n/**\n * @internal\n */\nexport function normalizeParagraph(paragraph: ContentModelParagraph) {\n    const segments = paragraph.segments;\n\n    if (!paragraph.isImplicit && segments.length > 0) {\n        const last = segments[segments.length - 1];\n        const secondLast = segments[segments.length - 2];\n\n        if (\n            last.segmentType == 'SelectionMarker' &&\n            (!secondLast || secondLast.segmentType == 'Br')\n        ) {\n            segments.push(createBr(last.format));\n        } else if (segments.length > 1 && segments[segments.length - 1].segmentType == 'Br') {\n            const noMarkerSegments = segments.filter(x => x.segmentType != 'SelectionMarker');\n\n            // When there is content with a <BR> tag at the end, we can remove the BR.\n            // But if there are more than one <BR> at the end, do not remove them.\n            if (\n                noMarkerSegments.length > 1 &&\n                noMarkerSegments[noMarkerSegments.length - 2].segmentType != 'Br'\n            ) {\n                segments.pop();\n            }\n        }\n    }\n\n    if (!isWhiteSpacePreserved(paragraph)) {\n        normalizeAllSegments(paragraph);\n    }\n\n    removeEmptyLinks(paragraph);\n\n    removeEmptySegments(paragraph);\n}\n\nfunction removeEmptySegments(block: ContentModelParagraph) {\n    for (let j = block.segments.length - 1; j >= 0; j--) {\n        if (isSegmentEmpty(block.segments[j])) {\n            block.segments.splice(j, 1);\n        }\n    }\n}\n\nfunction removeEmptyLinks(paragraph: ContentModelParagraph) {\n    const marker = paragraph.segments.find(x => x.segmentType == 'SelectionMarker');\n    if (marker) {\n        const markerIndex = paragraph.segments.indexOf(marker);\n        const prev = paragraph.segments[markerIndex - 1];\n        const next = paragraph.segments[markerIndex + 1];\n        if (\n            (prev &&\n                !prev.link &&\n                areSameFormats(prev.format, marker.format) &&\n                (!next || (!next.link && areSameFormats(next.format, marker.format))) &&\n                marker.link) ||\n            (!prev &&\n                marker.link &&\n                next &&\n                !next.link &&\n                areSameFormats(next.format, marker.format))\n        ) {\n            delete marker.link;\n        }\n    }\n}\n","import { hasSpacesOnly } from './hasSpacesOnly';\nimport type {\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelText,\n} from 'roosterjs-content-model-types';\n\nconst SPACE = '\\u0020';\nconst NONE_BREAK_SPACE = '\\u00A0';\nconst LEADING_SPACE_REGEX = /^\\u0020+/;\nconst TRAILING_SPACE_REGEX = /\\u0020+$/;\n\n/**\n * @internal\n */\nexport function normalizeAllSegments(paragraph: ContentModelParagraph) {\n    const context = resetNormalizeSegmentContext();\n\n    paragraph.segments.forEach(segment => {\n        normalizeSegment(segment, context);\n    });\n\n    normalizeTextSegments(context.textSegments, context.lastInlineSegment);\n    normalizeLastTextSegment(context.lastTextSegment, context.lastInlineSegment);\n}\n\n/**\n * Normalize a given segment, make sure its spaces are correctly represented by space and non-break space\n * @param segment The segment to normalize\n * @param ignoreTrailingSpaces Whether we should ignore the trailing space of the text segment @default false\n */\nexport function normalizeSingleSegment(\n    segment: ContentModelSegment,\n    ignoreTrailingSpaces: boolean = false\n) {\n    const context = resetNormalizeSegmentContext();\n\n    context.ignoreTrailingSpaces = ignoreTrailingSpaces;\n    normalizeSegment(segment, context);\n}\n\n/**\n * @internal Export for test only\n */\nexport interface NormalizeSegmentContext {\n    textSegments: ContentModelText[];\n    ignoreLeadingSpaces: boolean;\n    ignoreTrailingSpaces: boolean;\n    lastTextSegment: ContentModelText | undefined;\n    lastInlineSegment: ContentModelSegment | undefined;\n}\n\n/**\n * @internal Export for test only\n */\nexport function createNormalizeSegmentContext(): NormalizeSegmentContext {\n    return resetNormalizeSegmentContext();\n}\n\nfunction resetNormalizeSegmentContext(\n    context?: Partial<NormalizeSegmentContext>\n): NormalizeSegmentContext {\n    return Object.assign(context ?? {}, {\n        textSegments: [],\n        ignoreLeadingSpaces: true,\n        ignoreTrailingSpaces: true,\n        lastInlineSegment: undefined,\n        lastTextSegment: undefined,\n    });\n}\n\n/**\n * @internal Export for test only\n */\nexport function normalizeSegment(segment: ContentModelSegment, context: NormalizeSegmentContext) {\n    switch (segment.segmentType) {\n        case 'Br':\n            normalizeTextSegments(context.textSegments, context.lastInlineSegment);\n            normalizeLastTextSegment(context.lastTextSegment, context.lastInlineSegment);\n\n            // Line ends, reset all states\n            resetNormalizeSegmentContext(context);\n            break;\n\n        case 'Entity':\n        case 'General':\n        case 'Image':\n            // Here \"inline segment\" means a segment showing some content inline such as text, image, or other inline HTML elements\n            // BR will end current line, so it is not treated as \"inline\" here.\n            // We will do some normalization to the trailing spaces for non-inline-segments\n            context.lastInlineSegment = segment;\n            context.ignoreLeadingSpaces = false;\n            break;\n\n        case 'Text':\n            context.textSegments.push(segment);\n            context.lastInlineSegment = segment;\n            context.lastTextSegment = segment;\n\n            const first = segment.text.substring(0, 1);\n            const last = segment.text.substr(-1);\n\n            if (!hasSpacesOnly(segment.text)) {\n                if (first == SPACE) {\n                    // 1. Multiple leading space => single &nbsp; or empty (depends on if previous segment ends with space)\n                    segment.text = segment.text.replace(\n                        LEADING_SPACE_REGEX,\n                        context.ignoreLeadingSpaces ? '' : NONE_BREAK_SPACE\n                    );\n                }\n\n                if (last == SPACE) {\n                    // 2. Multiple trailing space => single space\n                    segment.text = segment.text.replace(\n                        TRAILING_SPACE_REGEX,\n                        context.ignoreTrailingSpaces ? SPACE : NONE_BREAK_SPACE\n                    );\n                }\n            }\n\n            context.ignoreLeadingSpaces = last == SPACE;\n\n            break;\n    }\n}\n\nfunction normalizeTextSegments(\n    segments: ContentModelText[],\n    lastInlineSegment: ContentModelSegment | undefined\n) {\n    segments.forEach(segment => {\n        // 3. Segment ends with &nbsp; replace it with space if the previous char is not space so that next segment can wrap\n        // Only do this for segments that is not the last one since the last space will be removed in step 4\n        if (segment != lastInlineSegment) {\n            const text = segment.text;\n\n            if (\n                text.substr(-1) == NONE_BREAK_SPACE &&\n                text.length > 1 &&\n                text.substr(-2, 1) != SPACE\n            ) {\n                segment.text = text.substring(0, text.length - 1) + SPACE;\n            }\n        }\n    });\n}\n\nfunction normalizeLastTextSegment(\n    segment: ContentModelText | undefined,\n    lastInlineSegment: ContentModelSegment | undefined\n) {\n    if (segment && segment == lastInlineSegment && segment?.text.substr(-1) == SPACE) {\n        // 4. last text segment of the paragraph, remove trailing space\n        segment.text = segment.text.replace(TRAILING_SPACE_REGEX, '');\n    }\n}\n","import { setParagraphNotImplicit } from '../block/setParagraphNotImplicit';\nimport type { ContentModelBlock, ContentModelBlockGroup } from 'roosterjs-content-model-types';\n\n/**\n * Unwrap a given block group, move its child blocks to be under its parent group\n * @param parent Parent block group of the unwrapping group\n * @param groupToUnwrap  The block group to unwrap\n */\nexport function unwrapBlock(\n    parent: ContentModelBlockGroup | null,\n    groupToUnwrap: ContentModelBlockGroup & ContentModelBlock\n) {\n    const index = parent?.blocks.indexOf(groupToUnwrap) ?? -1;\n\n    if (index >= 0) {\n        groupToUnwrap.blocks.forEach(setParagraphNotImplicit);\n\n        parent?.blocks.splice(index, 1, ...groupToUnwrap.blocks);\n    }\n}\n","import type { ContentModelBr, ContentModelSegmentFormat } from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelBr model\n * @param format @optional The format of this model\n */\nexport function createBr(format?: ContentModelSegmentFormat): ContentModelBr {\n    return {\n        segmentType: 'Br',\n        format: format ? { ...format } : {},\n    };\n}\n","import type {\n    ContentModelDocument,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelDocument model\n * @param defaultFormat @optional Default format of this model\n */\nexport function createContentModelDocument(\n    defaultFormat?: ContentModelSegmentFormat\n): ContentModelDocument {\n    const result: ContentModelDocument = {\n        blockGroupType: 'Document',\n        blocks: [],\n    };\n\n    if (defaultFormat) {\n        result.format = defaultFormat;\n    }\n\n    return result;\n}\n","import type { ContentModelBlockFormat, ContentModelDivider } from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelDivider model\n * @param tagName Tag name of this divider. Currently only hr and div are supported\n * @param format @optional The format of this model\n */\nexport function createDivider(\n    tagName: 'hr' | 'div',\n    format?: ContentModelBlockFormat\n): ContentModelDivider {\n    return {\n        blockType: 'Divider',\n        tagName,\n        format: format ? { ...format } : {},\n    };\n}\n","import type { ContentModelEntity, ContentModelSegmentFormat } from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelEntity model\n * @param wrapper Wrapper element of this entity\n * @param isReadonly Whether this is a readonly entity @default true\n * @param segmentFormat @optional Segment format of this entity\n * @param type @optional Type of this entity\n * @param id @optional Id of this entity\n */\nexport function createEntity(\n    wrapper: HTMLElement,\n    isReadonly: boolean = true,\n    segmentFormat?: ContentModelSegmentFormat,\n    type?: string,\n    id?: string\n): ContentModelEntity {\n    return {\n        segmentType: 'Entity',\n        blockType: 'Entity',\n        format: { ...segmentFormat },\n        entityFormat: {\n            id,\n            entityType: type,\n            isReadonly,\n        },\n        wrapper,\n    };\n}\n","import type {\n    ContentModelFormatContainer,\n    ContentModelFormatContainerFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelFormatContainer model\n * @param tag Tag name of this format container, in lower case\n * @param format @optional The format of this model\n */\nexport function createFormatContainer(\n    tag: Lowercase<string>,\n    format?: ContentModelFormatContainerFormat\n): ContentModelFormatContainer {\n    return {\n        blockType: 'BlockGroup',\n        blockGroupType: 'FormatContainer',\n        tagName: tag,\n        blocks: [],\n        format: { ...(format || {}) },\n    };\n}\n","import type { ContentModelGeneralBlock } from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelGeneralBlock model\n * @param element Original element of this model\n */\nexport function createGeneralBlock(element: HTMLElement): ContentModelGeneralBlock {\n    return {\n        blockType: 'BlockGroup',\n        blockGroupType: 'General',\n        element: element,\n        blocks: [],\n        format: {},\n    };\n}\n","import type {\n    ContentModelGeneralSegment,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelGeneralSegment model\n * @param element The original DOM element\n * @param format @optional The format of this model\n */\nexport function createGeneralSegment(\n    element: HTMLElement,\n    format?: ContentModelSegmentFormat\n): ContentModelGeneralSegment {\n    return {\n        blockType: 'BlockGroup',\n        blockGroupType: 'General',\n        segmentType: 'General',\n        format: format ? { ...format } : {},\n        blocks: [],\n        element: element,\n    };\n}\n","import type { ContentModelImage, ContentModelImageFormat } from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelImage model\n * @param src Image source\n * @param format @optional The format of this model\n */\nexport function createImage(src: string, format?: ContentModelImageFormat): ContentModelImage {\n    return {\n        segmentType: 'Image',\n        src: src,\n        format: format ? { ...format } : {},\n        dataset: {},\n    };\n}\n","import { createListLevel } from './createListLevel';\nimport { createSelectionMarker } from './createSelectionMarker';\nimport type {\n    ContentModelListItem,\n    ContentModelListLevel,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelListItem model\n * @param levels Existing list levels\n * @param format @optional The format of this model\n */\nexport function createListItem(\n    levels: ContentModelListLevel[],\n    format?: ContentModelSegmentFormat\n): ContentModelListItem {\n    return {\n        blockType: 'BlockGroup',\n        blockGroupType: 'ListItem',\n        blocks: [],\n        levels: levels\n            ? levels.map(level => createListLevel(level.listType, level.format, level.dataset))\n            : [],\n        formatHolder: createSelectionMarker(format),\n        format: {},\n    };\n}\n","import type {\n    ContentModelListItemLevelFormat,\n    ContentModelListLevel,\n    DatasetFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelListLevel model\n * @param listType Tag name of the list, either OL or UL\n * @param format @optional The format of this model\n * @param dataset @optional The dataset of this model\n */\nexport function createListLevel(\n    listType: 'OL' | 'UL',\n    format?: ContentModelListItemLevelFormat,\n    dataset?: DatasetFormat\n): ContentModelListLevel {\n    return {\n        listType,\n        format: { ...format },\n        dataset: { ...dataset },\n    };\n}\n","import type {\n    ContentModelBlockFormat,\n    ContentModelParagraph,\n    ContentModelParagraphDecorator,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelParagraph model\n * @param isImplicit @optional Whether this is an implicit paragraph. An implicit paragraph is a paragraph that will not render with DOM element container\n * @param blockFormat @optional Format of this paragraph\n * @param segmentFormat @optional Segment format applied to this block\n * @param decorator @optional Decorator of this paragraph\n */\nexport function createParagraph(\n    isImplicit?: boolean,\n    blockFormat?: ContentModelBlockFormat,\n    segmentFormat?: ContentModelSegmentFormat,\n    decorator?: ContentModelParagraphDecorator\n): ContentModelParagraph {\n    const result: ContentModelParagraph = {\n        blockType: 'Paragraph',\n        segments: [],\n        format: blockFormat ? { ...blockFormat } : {},\n    };\n\n    if (segmentFormat && Object.keys(segmentFormat).length > 0) {\n        result.segmentFormat = { ...segmentFormat };\n    }\n\n    if (isImplicit) {\n        result.isImplicit = true;\n    }\n\n    if (decorator) {\n        result.decorator = {\n            tagName: decorator.tagName,\n            format: { ...decorator.format },\n        };\n    }\n\n    return result;\n}\n","import type {\n    ContentModelParagraphDecorator,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelParagraphDecorator model\n * @param tagName Tag name of this decorator\n * @param format @optional The format of this model\n */\nexport function createParagraphDecorator(\n    tagName: string,\n    format?: ContentModelSegmentFormat\n): ContentModelParagraphDecorator {\n    return {\n        tagName: tagName.toLocaleLowerCase(),\n        format: { ...(format || {}) },\n    };\n}\n","import type {\n    ContentModelSegmentFormat,\n    ContentModelSelectionMarker,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelSelectionMarker model\n * @param format @optional The format of this model\n */\nexport function createSelectionMarker(\n    format?: ContentModelSegmentFormat\n): ContentModelSelectionMarker {\n    return {\n        segmentType: 'SelectionMarker',\n        isSelected: true,\n        format: format ? { ...format } : {},\n    };\n}\n","import type {\n    ContentModelTable,\n    ContentModelTableFormat,\n    ContentModelTableRow,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelTable model\n * @param rowCount Count of rows of this table\n * @param format @optional The format of this model\n */\nexport function createTable(rowCount: number, format?: ContentModelTableFormat): ContentModelTable {\n    const rows: ContentModelTableRow[] = [];\n\n    for (let i = 0; i < rowCount; i++) {\n        rows.push({\n            height: 0,\n            format: {},\n            cells: [],\n        });\n    }\n\n    return {\n        blockType: 'Table',\n        rows,\n        format: { ...(format || {}) },\n        widths: [],\n        dataset: {},\n    };\n}\n","import type {\n    ContentModelTableCell,\n    ContentModelTableCellFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelTableCell model\n * @param spanLeftOrColSpan @optional Whether this is a table cell merged with its left cell, or colspan number @default false\n * @param spanAboveOrRowSpan Whether this is a table cell merged with its upper cell, or rowSpan number @default false\n * @param isHeader @optional Whether this is a header cell @default false\n * @param format @optional The format of this model\n */\nexport function createTableCell(\n    spanLeftOrColSpan?: boolean | number,\n    spanAboveOrRowSpan?: boolean | number,\n    isHeader?: boolean,\n    format?: ContentModelTableCellFormat\n): ContentModelTableCell {\n    const spanLeft =\n        typeof spanLeftOrColSpan === 'number' ? spanLeftOrColSpan > 1 : !!spanLeftOrColSpan;\n    const spanAbove =\n        typeof spanAboveOrRowSpan === 'number' ? spanAboveOrRowSpan > 1 : !!spanAboveOrRowSpan;\n    return {\n        blockGroupType: 'TableCell',\n        blocks: [],\n        format: format ? { ...format } : {},\n        spanLeft,\n        spanAbove,\n        isHeader: !!isHeader,\n        dataset: {},\n    };\n}\n","import { addCode, addLink } from '../common/addDecorators';\nimport type {\n    ContentModelCode,\n    ContentModelLink,\n    ContentModelSegmentFormat,\n    ContentModelText,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create a ContentModelText model\n * @param text Text of this model\n * @param format @optional The format of this model\n * @param link @optional The link decorator\n * @param code @option The code decorator\n */\nexport function createText(\n    text: string,\n    format?: ContentModelSegmentFormat,\n    link?: ContentModelLink,\n    code?: ContentModelCode\n): ContentModelText {\n    const result: ContentModelText = {\n        segmentType: 'Text',\n        text: text,\n        format: format ? { ...format } : {},\n    };\n\n    if (link) {\n        addLink(result, link);\n    }\n\n    if (code) {\n        addCode(result, code);\n    }\n\n    return result;\n}\n","import toArray from '../domUtils/toArray';\nimport { isNodeOfType } from '../domUtils/isNodeOfType';\nimport type {\n    ContentModelDocument,\n    DOMSelection,\n    ModelToDomBlockAndSegmentNode,\n    ModelToDomContext,\n    OnNodeCreated,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create DOM tree fragment from Content Model document\n * @param doc Document object of the target DOM tree\n * @param root Target node that will become the container of new DOM tree.\n * When a DOM node with existing node is passed, it will be merged with content model so that unchanged blocks\n * won't be touched.\n * @param model The content model document to generate DOM tree from\n * @param context The context object for Content Model to DOM conversion\n * @param onNodeCreated Callback invoked when a DOM node is created\n * @returns The selection range created in DOM tree from this model, or null when there is no selection\n */\nexport function contentModelToDom(\n    doc: Document,\n    root: Node,\n    model: ContentModelDocument,\n    context: ModelToDomContext,\n    onNodeCreated?: OnNodeCreated\n): DOMSelection | null {\n    context.onNodeCreated = onNodeCreated;\n\n    context.modelHandlers.blockGroupChildren(doc, root, model, context);\n\n    const range = extractSelectionRange(doc, context);\n\n    root.normalize();\n\n    return range;\n}\n\nfunction extractSelectionRange(doc: Document, context: ModelToDomContext): DOMSelection | null {\n    const {\n        regularSelection: { start, end },\n        tableSelection,\n        imageSelection,\n    } = context;\n\n    let startPosition: { container: Node; offset: number } | undefined;\n    let endPosition: { container: Node; offset: number } | undefined;\n\n    if (imageSelection) {\n        return imageSelection;\n    } else if (\n        (startPosition = start && calcPosition(start)) &&\n        (endPosition = end && calcPosition(end))\n    ) {\n        const range = doc.createRange();\n\n        range.setStart(startPosition.container, startPosition.offset);\n        range.setEnd(endPosition.container, endPosition.offset);\n\n        return {\n            type: 'range',\n            range,\n        };\n    } else if (tableSelection) {\n        return tableSelection;\n    } else {\n        return null;\n    }\n}\n\nfunction calcPosition(\n    pos: ModelToDomBlockAndSegmentNode\n): { container: Node; offset: number } | undefined {\n    let result: { container: Node; offset: number } | undefined;\n\n    if (pos.block) {\n        if (!pos.segment) {\n            result = { container: pos.block, offset: 0 };\n        } else if (isNodeOfType(pos.segment, 'TEXT_NODE')) {\n            result = { container: pos.segment, offset: pos.segment.nodeValue?.length || 0 };\n        } else if (pos.segment.parentNode) {\n            result = {\n                container: pos.segment.parentNode,\n                offset:\n                    toArray(pos.segment.parentNode.childNodes as NodeListOf<Node>).indexOf(\n                        pos.segment\n                    ) + 1,\n            };\n        }\n    }\n\n    if (result && isNodeOfType(result.container, 'DOCUMENT_FRAGMENT_NODE')) {\n        const childNodes = result.container.childNodes;\n\n        if (childNodes.length > result.offset) {\n            result = { container: childNodes[result.offset], offset: 0 };\n        } else if (result.container.lastChild) {\n            const container = result.container.lastChild;\n            result = {\n                container,\n                offset: isNodeOfType(container, 'TEXT_NODE')\n                    ? container.nodeValue?.length ?? 0\n                    : container.childNodes.length,\n            };\n        } else {\n            result = undefined;\n        }\n    }\n\n    return result;\n}\n","import { defaultContentModelHandlers } from './defaultContentModelHandlers';\nimport { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport {\n    defaultFormatAppliers,\n    defaultFormatKeysPerCategory,\n} from '../../formatHandlers/defaultFormatHandlers';\nimport type {\n    EditorContext,\n    FormatApplier,\n    FormatAppliers,\n    FormatAppliersPerCategory,\n    ModelToDomContext,\n    ModelToDomFormatContext,\n    ModelToDomOption,\n    ModelToDomSelectionContext,\n    ModelToDomSettings,\n} from 'roosterjs-content-model-types';\n\n/**\n * Create context object fro Content Model to DOM conversion\n * @param editorContext Context of editor\n * @param options Option array to customize the Model to DOM conversion behavior\n */\nexport function createModelToDomContext(\n    editorContext?: EditorContext,\n    ...options: (ModelToDomOption | undefined)[]\n): ModelToDomContext {\n    return createModelToDomContextWithConfig(createModelToDomConfig(options), editorContext);\n}\n\n/**\n * Create context object for Content Model to DOM conversion with an existing configure\n * @param config A full config object to define how to convert Content Model to DOM tree\n * @param editorContext Context of editor\n */\nexport function createModelToDomContextWithConfig(\n    config: ModelToDomSettings,\n    editorContext?: EditorContext\n) {\n    return Object.assign(\n        {},\n        editorContext,\n        createModelToDomSelectionContext(),\n        createModelToDomFormatContext(),\n        config\n    );\n}\n\nfunction createModelToDomSelectionContext(): ModelToDomSelectionContext {\n    return {\n        regularSelection: {\n            current: {\n                block: null,\n                segment: null,\n            },\n        },\n    };\n}\n\nfunction createModelToDomFormatContext(): ModelToDomFormatContext {\n    return {\n        listFormat: {\n            threadItemCounts: [],\n            nodeStack: [],\n        },\n        implicitFormat: {},\n    };\n}\n\n/**\n * Create Content Model to DOM Config object\n * @param options All customizations of DOM creation\n */\nexport function createModelToDomConfig(\n    options: (ModelToDomOption | undefined)[]\n): ModelToDomSettings {\n    return {\n        modelHandlers: Object.assign(\n            {},\n            defaultContentModelHandlers,\n            ...options.map(x => x?.modelHandlerOverride)\n        ),\n        formatAppliers: buildFormatAppliers(\n            options.map(x => x?.formatApplierOverride),\n            options.map(x => x?.additionalFormatAppliers)\n        ),\n        defaultModelHandlers: defaultContentModelHandlers,\n        defaultFormatAppliers,\n    };\n}\n\n/**\n * @internal Export for test only\n * Build format appliers used by Content Model to DOM conversion\n */\nexport function buildFormatAppliers(\n    overrides: (Partial<FormatAppliers> | undefined)[] = [],\n    additionalAppliersArray: (Partial<FormatAppliersPerCategory> | undefined)[] = []\n): FormatAppliersPerCategory {\n    const combinedOverrides = Object.assign({}, ...overrides);\n\n    return getObjectKeys(defaultFormatKeysPerCategory).reduce((result, key) => {\n        const value = defaultFormatKeysPerCategory[key]\n            .map(\n                formatKey =>\n                    (combinedOverrides[formatKey] === undefined\n                        ? defaultFormatAppliers[formatKey]\n                        : combinedOverrides[formatKey]) as FormatApplier<any>\n            )\n            .concat(\n                ...additionalAppliersArray.map(\n                    appliers => (appliers?.[key] ?? []) as FormatApplier<any>[]\n                )\n            );\n\n        result[key] = value;\n\n        return result;\n    }, {} as FormatAppliersPerCategory);\n}\n","import { handleBlock } from '../handlers/handleBlock';\nimport { handleBlockGroupChildren } from '../handlers/handleBlockGroupChildren';\nimport { handleBr } from '../handlers/handleBr';\nimport { handleDivider } from '../handlers/handleDivider';\nimport { handleEntityBlock, handleEntitySegment } from '../handlers/handleEntity';\nimport { handleFormatContainer } from '../handlers/handleFormatContainer';\nimport { handleGeneralBlock, handleGeneralSegment } from '../handlers/handleGeneralModel';\nimport { handleImage } from '../handlers/handleImage';\nimport { handleList } from '../handlers/handleList';\nimport { handleListItem } from '../handlers/handleListItem';\nimport { handleParagraph } from '../handlers/handleParagraph';\nimport { handleSegment } from '../handlers/handleSegment';\nimport { handleSegmentDecorator } from '../handlers/handleSegmentDecorator';\nimport { handleTable } from '../handlers/handleTable';\nimport { handleText } from '../handlers/handleText';\nimport type { ContentModelHandlerMap } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const defaultContentModelHandlers: ContentModelHandlerMap = {\n    block: handleBlock,\n    blockGroupChildren: handleBlockGroupChildren,\n    br: handleBr,\n    entityBlock: handleEntityBlock,\n    entitySegment: handleEntitySegment,\n    generalBlock: handleGeneralBlock,\n    generalSegment: handleGeneralSegment,\n    divider: handleDivider,\n    image: handleImage,\n    list: handleList,\n    listItem: handleListItem,\n    paragraph: handleParagraph,\n    formatContainer: handleFormatContainer,\n    segment: handleSegment,\n    segmentDecorator: handleSegmentDecorator,\n    table: handleTable,\n    text: handleText,\n};\n","import type {\n    ContentModelBlock,\n    ContentModelBlockHandler,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleBlock: ContentModelBlockHandler<ContentModelBlock> = (\n    doc: Document,\n    parent: Node,\n    block: ContentModelBlock,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    const handlers = context.modelHandlers;\n\n    switch (block.blockType) {\n        case 'Table':\n            refNode = handlers.table(doc, parent, block, context, refNode);\n            break;\n        case 'Paragraph':\n            refNode = handlers.paragraph(doc, parent, block, context, refNode);\n            break;\n        case 'Entity':\n            refNode = handlers.entityBlock(doc, parent, block, context, refNode);\n            break;\n        case 'Divider':\n            refNode = handlers.divider(doc, parent, block, context, refNode);\n            break;\n        case 'BlockGroup':\n            switch (block.blockGroupType) {\n                case 'General':\n                    refNode = handlers.generalBlock(doc, parent, block, context, refNode);\n                    break;\n\n                case 'FormatContainer':\n                    refNode = handlers.formatContainer(doc, parent, block, context, refNode);\n                    break;\n\n                case 'ListItem':\n                    refNode = handlers.listItem(doc, parent, block, context, refNode);\n                    break;\n            }\n\n            break;\n    }\n\n    return refNode;\n};\n","import type {\n    ContentModelBlockGroup,\n    ContentModelHandler,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleBlockGroupChildren: ContentModelHandler<ContentModelBlockGroup> = (\n    doc: Document,\n    parent: Node,\n    group: ContentModelBlockGroup,\n    context: ModelToDomContext\n) => {\n    const { listFormat } = context;\n    const nodeStack = listFormat.nodeStack;\n    let refNode: Node | null = parent.firstChild;\n\n    try {\n        group.blocks.forEach((childBlock, index) => {\n            // When process list, we need a node stack.\n            // When there are two continuous lists, they should share the same stack\n            // so that list items with same type/threadId can be merged into the same list element\n            // In other cases, clear the stack so that two separate lists won't share the same list element\n            if (\n                index == 0 ||\n                childBlock.blockType != 'BlockGroup' ||\n                childBlock.blockGroupType != 'ListItem'\n            ) {\n                listFormat.nodeStack = [];\n            }\n\n            refNode = context.modelHandlers.block(doc, parent, childBlock, context, refNode);\n        });\n\n        // Remove all rest node if any since they don't appear in content model\n        while (refNode) {\n            const next = refNode.nextSibling;\n\n            refNode.parentNode?.removeChild(refNode);\n            refNode = next;\n        }\n    } finally {\n        listFormat.nodeStack = nodeStack;\n    }\n};\n","import { handleSegmentCommon } from '../utils/handleSegmentCommon';\nimport type { ContentModelBr, ContentModelSegmentHandler } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleBr: ContentModelSegmentHandler<ContentModelBr> = (\n    doc,\n    parent,\n    segment,\n    context,\n    segmentNodes\n) => {\n    const br = doc.createElement('br');\n    const element = doc.createElement('span');\n    element.appendChild(br);\n    parent.appendChild(element);\n\n    handleSegmentCommon(doc, br, element, segment, context, segmentNodes);\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { reuseCachedElement } from '../utils/reuseCachedElement';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelDivider,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleDivider: ContentModelBlockHandler<ContentModelDivider> = (\n    doc: Document,\n    parent: Node,\n    divider: ContentModelDivider,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    let element = context.allowCacheElement ? divider.cachedElement : undefined;\n\n    if (element) {\n        refNode = reuseCachedElement(parent, element, refNode);\n    } else {\n        element = doc.createElement(divider.tagName);\n\n        if (context.allowCacheElement) {\n            divider.cachedElement = element;\n        }\n\n        parent.insertBefore(element, refNode);\n\n        applyFormat(element, context.formatAppliers.divider, divider.format, context);\n\n        if (divider.size) {\n            element.setAttribute('size', divider.size);\n        }\n    }\n\n    context.onNodeCreated?.(divider, element);\n\n    return refNode;\n};\n","import { addDelimiters, wrap } from 'roosterjs-editor-dom';\nimport { applyFormat } from '../utils/applyFormat';\nimport { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport { reuseCachedElement } from '../utils/reuseCachedElement';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelEntity,\n    ContentModelSegmentHandler,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleEntityBlock: ContentModelBlockHandler<ContentModelEntity> = (\n    _,\n    parent,\n    entityModel,\n    context,\n    refNode\n) => {\n    const { entityFormat, wrapper } = entityModel;\n\n    applyFormat(wrapper, context.formatAppliers.entity, entityFormat, context);\n\n    refNode = reuseCachedElement(parent, wrapper, refNode);\n    context.onNodeCreated?.(entityModel, wrapper);\n\n    return refNode;\n};\n\n/**\n * @internal\n */\nexport const handleEntitySegment: ContentModelSegmentHandler<ContentModelEntity> = (\n    _,\n    parent,\n    entityModel,\n    context,\n    newSegments\n) => {\n    const { entityFormat, wrapper, format } = entityModel;\n\n    parent.appendChild(wrapper);\n    newSegments?.push(wrapper);\n\n    if (getObjectKeys(format).length > 0) {\n        const span = wrap(wrapper, 'span');\n\n        applyFormat(span, context.formatAppliers.segment, format, context);\n    }\n\n    applyFormat(wrapper, context.formatAppliers.entity, entityFormat, context);\n\n    if (context.addDelimiterForEntity && entityFormat.isReadonly) {\n        const [after, before] = addDelimiters(wrapper);\n\n        newSegments?.push(after, before);\n        context.regularSelection.current.segment = after;\n    } else {\n        context.regularSelection.current.segment = wrapper;\n    }\n\n    context.onNodeCreated?.(entityModel, wrapper);\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { isBlockGroupEmpty } from '../../modelApi/common/isEmpty';\nimport { reuseCachedElement } from '../utils/reuseCachedElement';\nimport { stackFormat } from '../utils/stackFormat';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelBlockHandler,\n    ContentModelFormatContainer,\n    ContentModelSegmentFormat,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\nconst PreChildFormat: ContentModelSegmentFormat & ContentModelBlockFormat = {\n    fontFamily: 'monospace',\n    whiteSpace: 'pre',\n};\n\n/**\n * @internal\n */\nexport const handleFormatContainer: ContentModelBlockHandler<ContentModelFormatContainer> = (\n    doc: Document,\n    parent: Node,\n    container: ContentModelFormatContainer,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    let element = context.allowCacheElement ? container.cachedElement : undefined;\n\n    if (element) {\n        refNode = reuseCachedElement(parent, element, refNode);\n\n        context.modelHandlers.blockGroupChildren(doc, element, container, context);\n    } else if (!isBlockGroupEmpty(container)) {\n        const containerNode = doc.createElement(container.tagName);\n\n        if (context.allowCacheElement) {\n            container.cachedElement = containerNode;\n        }\n\n        parent.insertBefore(containerNode, refNode);\n\n        stackFormat(context, container.tagName, () => {\n            applyFormat(containerNode, context.formatAppliers.container, container.format, context);\n            applyFormat(\n                containerNode,\n                context.formatAppliers.segmentOnBlock,\n                container.format,\n                context\n            );\n\n            applyFormat(containerNode, context.formatAppliers.container, container.format, context);\n        });\n\n        if (container.tagName == 'pre') {\n            stackFormat(context, PreChildFormat, () => {\n                context.modelHandlers.blockGroupChildren(doc, containerNode, container, context);\n            });\n        } else {\n            context.modelHandlers.blockGroupChildren(doc, containerNode, container, context);\n        }\n\n        element = containerNode;\n    }\n\n    if (element) {\n        context.onNodeCreated?.(container, element);\n    }\n\n    return refNode;\n};\n","import { handleSegmentCommon } from '../utils/handleSegmentCommon';\nimport { isNodeOfType } from '../../domUtils/isNodeOfType';\nimport { reuseCachedElement } from '../utils/reuseCachedElement';\nimport { wrap } from 'roosterjs-editor-dom';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelGeneralBlock,\n    ContentModelGeneralSegment,\n    ContentModelSegmentHandler,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleGeneralBlock: ContentModelBlockHandler<ContentModelGeneralBlock> = (\n    doc,\n    parent,\n    group,\n    context,\n    refNode\n) => {\n    let node: Node = group.element;\n\n    if (refNode && node.parentNode == parent) {\n        refNode = reuseCachedElement(parent, node, refNode);\n    } else {\n        node = node.cloneNode();\n        group.element = node as HTMLElement;\n\n        parent.insertBefore(node, refNode);\n    }\n\n    context.onNodeCreated?.(group, node);\n    context.modelHandlers.blockGroupChildren(doc, node, group, context);\n\n    return refNode;\n};\n\n/**\n * @internal\n */\nexport const handleGeneralSegment: ContentModelSegmentHandler<ContentModelGeneralSegment> = (\n    doc,\n    parent,\n    group,\n    context,\n    segmentNodes\n) => {\n    const node = group.element.cloneNode() as HTMLElement;\n    group.element = node;\n    parent.appendChild(node);\n\n    if (isNodeOfType(node, 'ELEMENT_NODE')) {\n        const element = wrap(node, 'span');\n\n        handleSegmentCommon(doc, node, element, group, context, segmentNodes);\n        context.onNodeCreated?.(group, node);\n    }\n\n    context.modelHandlers.blockGroupChildren(doc, node, group, context);\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { handleSegmentCommon } from '../utils/handleSegmentCommon';\nimport { parseValueWithUnit } from '../../formatHandlers/utils/parseValueWithUnit';\nimport type { ContentModelImage, ContentModelSegmentHandler } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleImage: ContentModelSegmentHandler<ContentModelImage> = (\n    doc,\n    parent,\n    imageModel,\n    context,\n    segmentNodes\n) => {\n    const img = doc.createElement('img');\n    const element = document.createElement('span');\n\n    parent.appendChild(element);\n    element.appendChild(img);\n\n    img.src = imageModel.src;\n\n    if (imageModel.alt) {\n        img.alt = imageModel.alt;\n    }\n\n    if (imageModel.title) {\n        img.title = imageModel.title;\n    }\n\n    applyFormat(img, context.formatAppliers.image, imageModel.format, context);\n    applyFormat(img, context.formatAppliers.dataset, imageModel.dataset, context);\n\n    const { width, height } = imageModel.format;\n    const widthNum = width ? parseValueWithUnit(width) : 0;\n    const heightNum = height ? parseValueWithUnit(height) : 0;\n\n    if (widthNum > 0) {\n        img.width = widthNum;\n    }\n\n    if (heightNum > 0) {\n        img.height = heightNum;\n    }\n\n    if (imageModel.isSelectedAsImageSelection) {\n        context.imageSelection = {\n            type: 'image',\n            image: img,\n        };\n    }\n\n    handleSegmentCommon(doc, img, element, imageModel, context, segmentNodes);\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { listLevelMetadataFormatHandler } from '../../formatHandlers/list/listLevelMetadataFormatHandler';\nimport { updateListMetadata } from '../../domUtils/metadata/updateListMetadata';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelListItem,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleList: ContentModelBlockHandler<ContentModelListItem> = (\n    doc: Document,\n    parent: Node,\n    listItem: ContentModelListItem,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    let layer = 0;\n    const { nodeStack } = context.listFormat;\n\n    if (nodeStack.length == 0) {\n        nodeStack.push({\n            node: parent,\n        });\n    }\n\n    // Skip existing list levels that has same properties so we can reuse them\n    for (; layer < listItem.levels.length && layer + 1 < nodeStack.length; layer++) {\n        const stackLevel = nodeStack[layer + 1];\n        const itemLevel = listItem.levels[layer];\n\n        if (\n            stackLevel.listType != itemLevel.listType ||\n            stackLevel.dataset?.editingInfo != itemLevel.dataset.editingInfo ||\n            (itemLevel.listType == 'OL' && typeof itemLevel.format.startNumberOverride === 'number')\n        ) {\n            break;\n        }\n    }\n\n    // Cut off remained list levels that we can't reuse\n    nodeStack.splice(layer + 1);\n\n    // Create new list levels that are after reused ones\n    for (; layer < listItem.levels.length; layer++) {\n        const level = listItem.levels[layer];\n        const newList = doc.createElement(level.listType || 'UL');\n        const lastParent = nodeStack[nodeStack.length - 1].node;\n\n        lastParent.insertBefore(newList, layer == 0 ? refNode : null);\n\n        applyFormat(newList, context.formatAppliers.listLevel, level.format, context);\n\n        // TODO: Move this out into roosterjs-content-model-editor package\n        updateListMetadata(level, metadata => {\n            applyFormat(newList, [listLevelMetadataFormatHandler.apply], metadata || {}, context);\n\n            if (\n                metadata &&\n                typeof metadata.orderedStyleType == 'undefined' &&\n                typeof metadata.unorderedStyleType == 'undefined'\n            ) {\n                metadata = null;\n            }\n\n            return metadata;\n        });\n        applyFormat(newList, context.formatAppliers.dataset, level.dataset, context);\n\n        nodeStack.push({ node: newList, ...level });\n\n        context.onNodeCreated?.(level, newList);\n    }\n\n    return refNode;\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { listItemMetadataFormatHandler } from '../../formatHandlers/list/listItemMetadataFormatHandler';\nimport { setParagraphNotImplicit } from '../../modelApi/block/setParagraphNotImplicit';\nimport { unwrap } from 'roosterjs-editor-dom';\nimport { updateListMetadata } from '../../domUtils/metadata/updateListMetadata';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelListItem,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleListItem: ContentModelBlockHandler<ContentModelListItem> = (\n    doc: Document,\n    parent: Node,\n    listItem: ContentModelListItem,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    refNode = context.modelHandlers.list(doc, parent, listItem, context, refNode);\n\n    const { nodeStack } = context.listFormat;\n\n    const listParent = nodeStack?.[nodeStack?.length - 1]?.node || parent;\n    const li = doc.createElement('li');\n    const level = listItem.levels[listItem.levels.length - 1];\n\n    // It is possible listParent is the same with parent param.\n    // This happens when outdent a list item to cause it has no list level\n    listParent.insertBefore(li, refNode?.parentNode == listParent ? refNode : null);\n\n    if (level) {\n        applyFormat(li, context.formatAppliers.listItemElement, listItem.format, context);\n        applyFormat(li, context.formatAppliers.segment, listItem.formatHolder.format, context);\n        applyFormat(li, context.formatAppliers.listItem, level.format, context);\n\n        // TODO: Move this out into roosterjs-content-model-editor package\n        updateListMetadata(level, metadata => {\n            applyFormat(li, [listItemMetadataFormatHandler.apply], metadata || {}, context);\n\n            return metadata;\n        });\n\n        context.modelHandlers.blockGroupChildren(doc, li, listItem, context);\n    } else {\n        // There is no level for this list item, that means it should be moved out of the list\n        // For each paragraph, make it not implicit so it will have a DIV around it, to avoid more paragraphs connected together\n        listItem.blocks.forEach(setParagraphNotImplicit);\n\n        context.modelHandlers.blockGroupChildren(doc, li, listItem, context);\n\n        unwrap(li);\n    }\n\n    context.onNodeCreated?.(listItem, li);\n\n    return refNode;\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { getObjectKeys } from '../../domUtils/getObjectKeys';\nimport { optimize } from '../optimizers/optimize';\nimport { reuseCachedElement } from '../utils/reuseCachedElement';\nimport { stackFormat } from '../utils/stackFormat';\nimport { unwrap } from 'roosterjs-editor-dom';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelParagraph,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\nconst DefaultParagraphTag = 'div';\n\n/**\n * @internal\n */\nexport const handleParagraph: ContentModelBlockHandler<ContentModelParagraph> = (\n    doc: Document,\n    parent: Node,\n    paragraph: ContentModelParagraph,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    let container = context.allowCacheElement ? paragraph.cachedElement : undefined;\n\n    if (container) {\n        refNode = reuseCachedElement(parent, container, refNode);\n    } else {\n        stackFormat(context, paragraph.decorator?.tagName || null, () => {\n            const needParagraphWrapper =\n                !paragraph.isImplicit ||\n                !!paragraph.decorator ||\n                (getObjectKeys(paragraph.format).length > 0 &&\n                    paragraph.segments.some(segment => segment.segmentType != 'SelectionMarker'));\n            const formatOnWrapper = needParagraphWrapper\n                ? {\n                      ...(paragraph.decorator?.format || {}),\n                      ...paragraph.segmentFormat,\n                  }\n                : {};\n\n            container = doc.createElement(paragraph.decorator?.tagName || DefaultParagraphTag);\n\n            parent.insertBefore(container, refNode);\n\n            context.regularSelection.current = {\n                block: needParagraphWrapper ? container : container.parentNode,\n                segment: null,\n            };\n\n            const handleSegments = () => {\n                const parent = container;\n\n                if (parent) {\n                    const firstSegment = paragraph.segments[0];\n\n                    if (firstSegment?.segmentType == 'SelectionMarker') {\n                        // Make sure there is a segment created before selection marker.\n                        // If selection marker is the first selected segment in a paragraph, create a dummy text node,\n                        // so after rewrite, the regularSelection object can have a valid segment object set to the text node.\n                        context.modelHandlers.text(\n                            doc,\n                            parent,\n                            {\n                                ...firstSegment,\n                                segmentType: 'Text',\n                                text: '',\n                            },\n                            context,\n                            []\n                        );\n                    }\n\n                    paragraph.segments.forEach(segment => {\n                        const newSegments: Node[] = [];\n                        context.modelHandlers.segment(doc, parent, segment, context, newSegments);\n\n                        newSegments.forEach(node => {\n                            context.domIndexer?.onSegment(node, paragraph, [segment]);\n                        });\n                    });\n                }\n            };\n\n            if (needParagraphWrapper) {\n                stackFormat(context, formatOnWrapper, handleSegments);\n\n                applyFormat(container, context.formatAppliers.block, paragraph.format, context);\n                applyFormat(container, context.formatAppliers.container, paragraph.format, context);\n                applyFormat(\n                    container,\n                    context.formatAppliers.segmentOnBlock,\n                    formatOnWrapper,\n                    context\n                );\n            } else {\n                handleSegments();\n            }\n\n            optimize(container);\n\n            // It is possible the next sibling node is changed during processing child segments\n            // e.g. When this paragraph is an implicit paragraph and it contains an inline entity segment\n            // The segment will be appended to container as child then the container will be removed\n            // since this paragraph it is implicit. In that case container.nextSibling will become original\n            // inline entity's next sibling. So reset refNode to its real next sibling (after change) here\n            // to make sure the value is correct.\n            refNode = container.nextSibling;\n\n            if (container) {\n                context.onNodeCreated?.(paragraph, container);\n                context.domIndexer?.onParagraph(container);\n            }\n\n            if (needParagraphWrapper) {\n                if (context.allowCacheElement) {\n                    paragraph.cachedElement = container;\n                }\n            } else {\n                unwrap(container);\n                container = undefined;\n            }\n        });\n    }\n\n    return refNode;\n};\n","import type {\n    ContentModelSegment,\n    ContentModelSegmentHandler,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleSegment: ContentModelSegmentHandler<ContentModelSegment> = (\n    doc,\n    parent,\n    segment,\n    context,\n    segmentNodes\n) => {\n    const regularSelection = context.regularSelection;\n\n    // If start position is not set yet, and current segment is in selection, set start position\n    if (segment.isSelected && !regularSelection.start) {\n        regularSelection.start = {\n            ...regularSelection.current,\n        };\n    }\n\n    switch (segment.segmentType) {\n        case 'Text':\n            context.modelHandlers.text(doc, parent, segment, context, segmentNodes);\n            break;\n\n        case 'Br':\n            context.modelHandlers.br(doc, parent, segment, context, segmentNodes);\n            break;\n\n        case 'Image':\n            context.modelHandlers.image(doc, parent, segment, context, segmentNodes);\n            break;\n\n        case 'General':\n            context.modelHandlers.generalSegment(doc, parent, segment, context, segmentNodes);\n            break;\n\n        case 'Entity':\n            context.modelHandlers.entitySegment(doc, parent, segment, context, segmentNodes);\n            break;\n    }\n\n    // If end position is not set, or it is not finalized, and current segment is still in selection, set end position\n    // If there is other selection, we will overwrite regularSelection.end when we process that segment\n    if (segment.isSelected && regularSelection.start) {\n        regularSelection.end = {\n            ...regularSelection.current,\n        };\n    }\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { isNodeOfType } from '../../domUtils/isNodeOfType';\nimport { stackFormat } from '../utils/stackFormat';\nimport { wrapAllChildNodes } from '../../domUtils/moveChildNodes';\nimport type {\n    ContentModelSegment,\n    ContentModelSegmentHandler,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleSegmentDecorator: ContentModelSegmentHandler<ContentModelSegment> = (\n    _,\n    parent,\n    segment,\n    context,\n    segmentNodes\n) => {\n    const { code, link } = segment;\n\n    if (isNodeOfType(parent, 'ELEMENT_NODE')) {\n        if (link) {\n            stackFormat(context, 'a', () => {\n                const a = wrapAllChildNodes(parent, 'a');\n\n                applyFormat(a, context.formatAppliers.link, link.format, context);\n                applyFormat(a, context.formatAppliers.dataset, link.dataset, context);\n\n                segmentNodes?.push(a);\n                context.onNodeCreated?.(link, a);\n            });\n        }\n\n        if (code) {\n            stackFormat(context, 'code', () => {\n                const codeNode = wrapAllChildNodes(parent, 'code');\n\n                applyFormat(codeNode, context.formatAppliers.code, code.format, context);\n\n                segmentNodes?.push(codeNode);\n                context.onNodeCreated?.(code, codeNode);\n            });\n        }\n    }\n};\n","import { applyFormat } from '../utils/applyFormat';\nimport { hasMetadata } from '../../domUtils/metadata/updateMetadata';\nimport { isBlockEmpty } from '../../modelApi/common/isEmpty';\nimport { moveChildNodes } from '../../domUtils/moveChildNodes';\nimport { reuseCachedElement } from '../utils/reuseCachedElement';\nimport type {\n    ContentModelBlockHandler,\n    ContentModelTable,\n    ModelToDomContext,\n    TableSelection,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleTable: ContentModelBlockHandler<ContentModelTable> = (\n    doc: Document,\n    parent: Node,\n    table: ContentModelTable,\n    context: ModelToDomContext,\n    refNode: Node | null\n) => {\n    if (isBlockEmpty(table)) {\n        // Empty table, do not create TABLE element and just return\n        return refNode;\n    }\n\n    let tableNode = context.allowCacheElement ? table.cachedElement : undefined;\n\n    if (tableNode) {\n        refNode = reuseCachedElement(parent, tableNode, refNode);\n\n        moveChildNodes(tableNode);\n    } else {\n        tableNode = doc.createElement('table');\n\n        if (context.allowCacheElement) {\n            table.cachedElement = tableNode;\n        }\n\n        parent.insertBefore(tableNode, refNode);\n\n        applyFormat(tableNode, context.formatAppliers.block, table.format, context);\n        applyFormat(tableNode, context.formatAppliers.table, table.format, context);\n        applyFormat(tableNode, context.formatAppliers.tableBorder, table.format, context);\n        applyFormat(tableNode, context.formatAppliers.dataset, table.dataset, context);\n    }\n\n    context.onNodeCreated?.(table, tableNode);\n\n    const tbody = doc.createElement('tbody');\n    tableNode.appendChild(tbody);\n\n    for (let row = 0; row < table.rows.length; row++) {\n        const tableRow = table.rows[row];\n\n        if (tableRow.cells.length == 0) {\n            // Skip empty row\n            continue;\n        }\n\n        const tr = (context.allowCacheElement && tableRow.cachedElement) || doc.createElement('tr');\n        tbody.appendChild(tr);\n        moveChildNodes(tr);\n\n        if (!tableRow.cachedElement) {\n            if (context.allowCacheElement) {\n                tableRow.cachedElement = tr;\n            }\n\n            applyFormat(tr, context.formatAppliers.tableRow, tableRow.format, context);\n        }\n\n        context.onNodeCreated?.(tableRow, tr);\n\n        for (let col = 0; col < tableRow.cells.length; col++) {\n            const cell = tableRow.cells[col];\n\n            if (cell.isSelected) {\n                const tableSelection: TableSelection = context.tableSelection || {\n                    type: 'table',\n                    table: tableNode,\n                    firstColumn: col,\n                    lastColumn: col,\n                    firstRow: row,\n                    lastRow: row,\n                };\n\n                if (tableSelection.table == tableNode) {\n                    tableSelection.lastColumn = Math.max(tableSelection.lastColumn, col);\n                    tableSelection.lastRow = Math.max(tableSelection.lastRow, row);\n                }\n\n                context.tableSelection = tableSelection;\n            }\n\n            if (!cell.spanAbove && !cell.spanLeft) {\n                const td =\n                    (context.allowCacheElement && cell.cachedElement) ||\n                    doc.createElement(cell.isHeader ? 'th' : 'td');\n\n                tr.appendChild(td);\n\n                let rowSpan = 1;\n                let colSpan = 1;\n                let width = table.widths[col];\n                let height = tableRow.height;\n\n                for (; table.rows[row + rowSpan]?.cells[col]?.spanAbove; rowSpan++) {\n                    height += table.rows[row + rowSpan].height;\n                }\n                for (; tableRow.cells[col + colSpan]?.spanLeft; colSpan++) {\n                    width += table.widths[col + colSpan];\n                }\n\n                if (rowSpan > 1) {\n                    td.rowSpan = rowSpan;\n                }\n\n                if (colSpan > 1) {\n                    td.colSpan = colSpan;\n                }\n\n                if (!cell.cachedElement || (cell.format.useBorderBox && hasMetadata(table))) {\n                    if (width > 0 && !td.style.width) {\n                        td.style.width = width + 'px';\n                    }\n\n                    if (height > 0 && !td.style.height) {\n                        td.style.height = height + 'px';\n                    }\n                }\n\n                if (!cell.cachedElement) {\n                    if (context.allowCacheElement) {\n                        cell.cachedElement = td;\n                    }\n\n                    applyFormat(td, context.formatAppliers.block, cell.format, context);\n                    applyFormat(td, context.formatAppliers.tableCell, cell.format, context);\n                    applyFormat(td, context.formatAppliers.tableCellBorder, cell.format, context);\n                    applyFormat(td, context.formatAppliers.dataset, cell.dataset, context);\n                }\n\n                context.modelHandlers.blockGroupChildren(doc, td, cell, context);\n\n                context.onNodeCreated?.(cell, td);\n            }\n        }\n    }\n\n    context.domIndexer?.onTable(tableNode, table);\n\n    return refNode;\n};\n","import { handleSegmentCommon } from '../utils/handleSegmentCommon';\nimport type { ContentModelSegmentHandler, ContentModelText } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const handleText: ContentModelSegmentHandler<ContentModelText> = (\n    doc,\n    parent,\n    segment,\n    context,\n    segmentNodes\n) => {\n    const txt = doc.createTextNode(segment.text);\n    const element = doc.createElement('span');\n\n    parent.appendChild(element);\n    element.appendChild(txt);\n\n    handleSegmentCommon(doc, txt, element, segment, context, segmentNodes);\n};\n","import { isNodeOfType } from '../../domUtils/isNodeOfType';\n\nconst OptimizeTags = ['SPAN', 'B', 'EM', 'I', 'U', 'SUB', 'SUP', 'STRIKE', 'S', 'A', 'CODE'];\n\n/**\n * @internal\n */\nexport function mergeNode(root: Node) {\n    for (let child = root.firstChild; child; ) {\n        const next = child.nextSibling;\n\n        if (\n            next &&\n            isNodeOfType(child, 'ELEMENT_NODE') &&\n            isNodeOfType(next, 'ELEMENT_NODE') &&\n            child.tagName == next.tagName &&\n            OptimizeTags.indexOf(child.tagName) >= 0 &&\n            hasSameAttributes(child, next)\n        ) {\n            while (next.firstChild) {\n                child.appendChild(next.firstChild);\n            }\n\n            next.parentNode!.removeChild(next);\n        } else {\n            child = next;\n        }\n    }\n}\n\nfunction hasSameAttributes(element1: HTMLElement, element2: HTMLElement) {\n    const attr1 = element1.attributes;\n    const attr2 = element2.attributes;\n\n    if (attr1.length != attr2.length) {\n        return false;\n    }\n\n    for (let i = 0; i < attr1.length; i++) {\n        if (attr1[i].name != attr2[i].name || attr1[i].value != attr2[i].value) {\n            return false;\n        }\n    }\n\n    return true;\n}\n","import { isEntityElement } from '../../domUtils/entityUtils';\nimport { mergeNode } from './mergeNode';\nimport { removeUnnecessarySpan } from './removeUnnecessarySpan';\n\n/**\n * @internal\n */\nexport function optimize(root: Node) {\n    /**\n     * Do no do any optimization to entity\n     */\n    if (isEntityElement(root)) {\n        return;\n    }\n\n    removeUnnecessarySpan(root);\n    mergeNode(root);\n\n    for (let child = root.firstChild; child; child = child.nextSibling) {\n        optimize(child);\n    }\n}\n","import { isNodeOfType } from '../../domUtils/isNodeOfType';\n\n/**\n * @internal\n */\nexport function removeUnnecessarySpan(root: Node) {\n    for (let child = root.firstChild; child; ) {\n        if (\n            isNodeOfType(child, 'ELEMENT_NODE') &&\n            child.tagName == 'SPAN' &&\n            child.attributes.length == 0\n        ) {\n            const node = child;\n            let refNode = child.nextSibling;\n            child = child.nextSibling;\n\n            while (node.lastChild) {\n                const newNode = node.lastChild;\n                root.insertBefore(newNode, refNode);\n                refNode = newNode;\n            }\n\n            root.removeChild(node);\n        } else {\n            child = child.nextSibling;\n        }\n    }\n}\n","import type {\n    ContentModelFormatBase,\n    FormatApplier,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Apply formats to the given HTML element using specified appliers\n * @param element The element to apply formats to\n * @param appliers The appliers we are using to apply formats\n * @param format The format object we get format info from\n * @param context Content Model to DOM context\n */\nexport function applyFormat<T extends ContentModelFormatBase>(\n    element: HTMLElement,\n    appliers: (FormatApplier<T> | null)[],\n    format: T,\n    context: ModelToDomContext\n) {\n    appliers.forEach(applier => {\n        applier?.(format, element, context);\n    });\n}\n","import { applyFormat } from './applyFormat';\nimport type { ContentModelSegment, ModelToDomContext } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function handleSegmentCommon(\n    doc: Document,\n    segmentNode: Node,\n    containerNode: HTMLElement,\n    segment: ContentModelSegment,\n    context: ModelToDomContext,\n    segmentNodes: Node[]\n) {\n    if (!segmentNode.firstChild) {\n        context.regularSelection.current.segment = segmentNode;\n    }\n\n    applyFormat(containerNode, context.formatAppliers.styleBasedSegment, segment.format, context);\n\n    segmentNodes?.push(segmentNode);\n    context.modelHandlers.segmentDecorator(doc, containerNode, segment, context, segmentNodes);\n\n    applyFormat(containerNode, context.formatAppliers.elementBasedSegment, segment.format, context);\n\n    context.onNodeCreated?.(segment, segmentNode);\n}\n","import { isEntityElement } from '../../domUtils/entityUtils';\n\n/**\n * @internal\n */\nexport function reuseCachedElement(parent: Node, element: Node, refNode: Node | null): Node | null {\n    if (element.parentNode == parent) {\n        // Remove nodes before the one we are hitting since they don't appear in Content Model at this position.\n        // But we don't want to touch entity since it would better to keep entity at its place unless it is removed\n        // In that case we will remove it after we have handled all other nodes\n        while (refNode && refNode != element && !isEntityElement(refNode)) {\n            const next = refNode.nextSibling;\n\n            refNode.parentNode?.removeChild(refNode);\n            refNode = next;\n        }\n\n        if (refNode && refNode == element) {\n            refNode = refNode.nextSibling;\n        } else {\n            parent.insertBefore(element, refNode);\n        }\n    } else {\n        parent.insertBefore(element, refNode);\n    }\n\n    return refNode;\n}\n\n/**\n * @internal\n */\nexport function removeNode(node: Node): Node | null {\n    const next = node.nextSibling;\n    node.parentNode?.removeChild(node);\n\n    return next;\n}\n","import { defaultContentModelFormatMap } from '../../config/defaultContentModelFormatMap';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelSegmentFormat,\n    ModelToDomContext,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function stackFormat(\n    context: ModelToDomContext,\n    tagNameOrFormat: string | (ContentModelSegmentFormat & ContentModelBlockFormat) | null,\n    callback: () => void\n) {\n    const newFormat =\n        typeof tagNameOrFormat === 'string'\n            ? defaultContentModelFormatMap[tagNameOrFormat]\n            : tagNameOrFormat;\n\n    if (newFormat) {\n        const implicitFormat = context.implicitFormat;\n\n        try {\n            context.implicitFormat = {\n                ...implicitFormat,\n                ...newFormat,\n            };\n\n            callback();\n        } finally {\n            context.implicitFormat = implicitFormat;\n        }\n    } else {\n        callback();\n    }\n}\n","import type { Border } from '../publicTypes/interface/Border';\n\nconst BorderStyles = [\n    'none',\n    'hidden',\n    'dotted',\n    'dashed',\n    'solid',\n    'double',\n    'groove',\n    'ridge',\n    'inset',\n    'outset',\n];\nconst BorderSizeRegex = /^(thin|medium|thick|[\\d\\.]+\\w*)$/;\n\n/**\n * Extract an integrated border string with border width, style, color to value tuple\n * @param combinedBorder The integrated border style string\n * @returns An array with the splitted values\n */\nexport function extractBorderValues(combinedBorder?: string): Border {\n    const result: Border = {};\n    const values = (combinedBorder || '').replace(/, /g, ',').split(' ');\n\n    values.forEach(v => {\n        if (BorderStyles.indexOf(v) >= 0 && !result.style) {\n            result.style = v;\n        } else if (BorderSizeRegex.test(v) && !result.width) {\n            result.width = v;\n        } else if (v && !result.color) {\n            result.color = v; // TODO: Do we need to use a regex to match all possible colors?\n        }\n    });\n\n    return result;\n}\n\n/**\n * Combine border value array back to string\n * @param values Input string values\n * @param initialValue Initial value for those items without valid value\n */\nexport function combineBorderValue(value: Border): string {\n    return [value.width || '', value.style || '', value.color || ''].join(' ').trim() || 'none';\n}\n","import { updateMetadata } from 'roosterjs-content-model-dom';\nimport type { ContentModelImage, ImageMetadataFormat } from 'roosterjs-content-model-types';\nimport {\n    createNumberDefinition,\n    createObjectDefinition,\n    createStringDefinition,\n} from 'roosterjs-editor-dom';\n\nconst NumberDefinition = createNumberDefinition();\n\nconst ImageMetadataFormatDefinition = createObjectDefinition<Required<ImageMetadataFormat>>({\n    widthPx: NumberDefinition,\n    heightPx: NumberDefinition,\n    leftPercent: NumberDefinition,\n    rightPercent: NumberDefinition,\n    topPercent: NumberDefinition,\n    bottomPercent: NumberDefinition,\n    angleRad: NumberDefinition,\n    src: createStringDefinition(),\n    naturalHeight: NumberDefinition,\n    naturalWidth: NumberDefinition,\n});\n\n/**\n * Update image metadata with a callback\n * @param image The image Content Model\n * @param callback The callback function used for updating metadata\n */\nexport function updateImageMetadata(\n    image: ContentModelImage,\n    callback?: (format: ImageMetadataFormat | null) => ImageMetadataFormat | null\n): ImageMetadataFormat | null {\n    return updateMetadata(image, callback, ImageMetadataFormatDefinition);\n}\n","import { createBooleanDefinition, createObjectDefinition } from 'roosterjs-editor-dom';\nimport { updateMetadata } from 'roosterjs-content-model-dom';\nimport type { ContentModelTableCell } from 'roosterjs-content-model-types';\nimport type { TableCellMetadataFormat } from 'roosterjs-editor-types';\n\nconst TableCellMetadataFormatDefinition = createObjectDefinition<Required<TableCellMetadataFormat>>(\n    {\n        bgColorOverride: createBooleanDefinition(true /** isOptional */),\n        vAlignOverride: createBooleanDefinition(true /** isOptional */),\n    },\n    false /* isOptional */,\n    true /** allowNull */\n);\n\n/**\n * Update table cell metadata with a callback\n * @param cell The table cell Content Model\n * @param callback The callback function used for updating metadata\n */\nexport function updateTableCellMetadata(\n    cell: ContentModelTableCell,\n    callback?: (format: TableCellMetadataFormat | null) => TableCellMetadataFormat | null\n): TableCellMetadataFormat | null {\n    return updateMetadata(cell, callback, TableCellMetadataFormatDefinition);\n}\n","import { TableBorderFormat } from 'roosterjs-editor-types';\nimport { updateMetadata } from 'roosterjs-content-model-dom';\nimport type { ContentModelTable, TableMetadataFormat } from 'roosterjs-content-model-types';\nimport {\n    createBooleanDefinition,\n    createNumberDefinition,\n    createObjectDefinition,\n    createStringDefinition,\n} from 'roosterjs-editor-dom';\n\nconst NullStringDefinition = createStringDefinition(\n    false /** isOptional */,\n    undefined /** value */,\n    true /** allowNull */\n);\n\nconst BooleanDefinition = createBooleanDefinition(false /** isOptional */);\n\nconst TableFormatDefinition = createObjectDefinition<Required<TableMetadataFormat>>(\n    {\n        topBorderColor: NullStringDefinition,\n        bottomBorderColor: NullStringDefinition,\n        verticalBorderColor: NullStringDefinition,\n        hasHeaderRow: BooleanDefinition,\n        headerRowColor: NullStringDefinition,\n        hasFirstColumn: BooleanDefinition,\n        hasBandedColumns: BooleanDefinition,\n        hasBandedRows: BooleanDefinition,\n        bgColorEven: NullStringDefinition,\n        bgColorOdd: NullStringDefinition,\n        tableBorderFormat: createNumberDefinition(\n            false /** isOptional */,\n            undefined /* value */,\n            TableBorderFormat.DEFAULT /* first table border format, TODO: Use Min/Max to specify valid values */,\n            TableBorderFormat.CLEAR /* last table border format, , TODO: Use Min/Max to specify valid values */\n        ),\n        verticalAlign: NullStringDefinition,\n    },\n    false /* isOptional */,\n    true /** allowNull */\n);\n\n/**\n * Update table metadata with a callback\n * @param table The table Content Model\n * @param callback The callback function used for updating metadata\n */\nexport function updateTableMetadata(\n    table: ContentModelTable,\n    callback?: (format: TableMetadataFormat | null) => TableMetadataFormat | null\n): TableMetadataFormat | null {\n    return updateMetadata(table, callback, TableFormatDefinition);\n}\n","const SPACES_REGEX = /[\\u2000\\u2009\\u200a\\u200b\\u202f\\u205f\\u3000\\s\\t\\r\\n]/gm;\nconst PUNCTUATIONS = '.,?!:\"()[]\\\\/';\n\n/**\n * @internal\n * Check if the given character is punctuation\n * @param char The character to check\n */\nexport function isPunctuation(char: string) {\n    return PUNCTUATIONS.indexOf(char) >= 0;\n}\n\n/**\n * @internal\n * Check if the give character is a space. A space can be normal ASCII pace (32) or non-break space (160) or other kinds of spaces\n * such as ZeroWidthSpace, ...\n * @param char The character to check\n */\nexport function isSpace(char: string) {\n    const code = char?.charCodeAt(0) ?? 0;\n    return code == 160 || code == 32 || SPACES_REGEX.test(char);\n}\n\n/**\n * @internal\n * Normalize spaces of the given string. After normalization, all leading (for forward) or trailing (for backward) spaces\n * will be replaces with non-break space (160)\n * @param txt The string to normalize\n * @param isForward Whether normalize forward or backward\n */\nexport function normalizeText(txt: string, isForward: boolean): string {\n    return txt.replace(isForward ? /^\\u0020+/ : /\\u0020+$/, '\\u00A0');\n}\n","import { createContentModelEditorCore } from './createContentModelEditorCore';\nimport { EditorBase } from 'roosterjs-editor-core';\nimport type { ContentModelEditorCore } from '../publicTypes/ContentModelEditorCore';\nimport type {\n    ContentModelEditorOptions,\n    IContentModelEditor,\n} from '../publicTypes/IContentModelEditor';\nimport type {\n    ContentModelDocument,\n    DOMSelection,\n    DomToModelOption,\n    ModelToDomOption,\n    OnNodeCreated,\n} from 'roosterjs-content-model-types';\n\n/**\n * Editor for Content Model.\n * (This class is still under development, and may still be changed in the future with some breaking changes)\n */\nexport default class ContentModelEditor\n    extends EditorBase<ContentModelEditorCore, ContentModelEditorOptions>\n    implements IContentModelEditor {\n    /**\n     * Creates an instance of Editor\n     * @param contentDiv The DIV HTML element which will be the container element of editor\n     * @param options An optional options object to customize the editor\n     */\n    constructor(contentDiv: HTMLDivElement, options: ContentModelEditorOptions = {}) {\n        super(contentDiv, options, createContentModelEditorCore);\n\n        if (options.cacheModel) {\n            // Create an initial content model to cache\n            // TODO: Once we have standalone editor and get rid of `ensureTypeInContainer` function, we can set init content\n            // using content model and cache the model directly\n            this.createContentModel();\n        }\n    }\n\n    /**\n     * Create Content Model from DOM tree in this editor\n     * @param option The option to customize the behavior of DOM to Content Model conversion\n     */\n    createContentModel(\n        option?: DomToModelOption,\n        selectionOverride?: DOMSelection\n    ): ContentModelDocument {\n        const core = this.getCore();\n\n        return core.api.createContentModel(core, option, selectionOverride);\n    }\n\n    /**\n     * Set content with content model\n     * @param model The content model to set\n     * @param option Additional options to customize the behavior of Content Model to DOM conversion\n     * @param onNodeCreated An optional callback that will be called when a DOM node is created\n     */\n    setContentModel(\n        model: ContentModelDocument,\n        option?: ModelToDomOption,\n        onNodeCreated?: OnNodeCreated\n    ): DOMSelection | null {\n        const core = this.getCore();\n\n        return core.api.setContentModel(core, model, option, onNodeCreated);\n    }\n\n    /**\n     * Get current DOM selection\n     */\n    getDOMSelection(): DOMSelection | null {\n        const core = this.getCore();\n\n        return core.api.getDOMSelection(core);\n    }\n\n    /**\n     * Set DOMSelection into editor content.\n     * This is the replacement of IEditor.select.\n     * @param selection The selection to set\n     */\n    setDOMSelection(selection: DOMSelection) {\n        const core = this.getCore();\n\n        core.api.setDOMSelection(core, selection);\n    }\n}\n","import { cloneModel } from '../../modelApi/common/cloneModel';\nimport type { DOMSelection, DomToModelOption } from 'roosterjs-content-model-types';\nimport {\n    createDomToModelContext,\n    createDomToModelContextWithConfig,\n    domToContentModel,\n} from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelEditorCore,\n    CreateContentModel,\n} from '../../publicTypes/ContentModelEditorCore';\n\n/**\n * @internal\n * Create Content Model from DOM tree in this editor\n * @param core The editor core object\n * @param option The option to customize the behavior of DOM to Content Model conversion\n * @param selectionOverride When passed, use this selection range instead of current selection in editor\n */\nexport const createContentModel: CreateContentModel = (core, option, selectionOverride) => {\n    let cachedModel = selectionOverride ? null : core.cache.cachedModel;\n\n    if (cachedModel && core.lifecycle.shadowEditFragment) {\n        // When in shadow edit, use a cloned model so we won't pollute the cached one\n        cachedModel = cloneModel(cachedModel, { includeCachedElement: true });\n    }\n\n    if (cachedModel) {\n        return cachedModel;\n    } else {\n        const selection = selectionOverride || core.api.getDOMSelection(core) || undefined;\n        const model = internalCreateContentModel(core, selection, option);\n\n        if (!option && !selectionOverride) {\n            core.cache.cachedModel = model;\n            core.cache.cachedSelection = selection;\n        }\n\n        return model;\n    }\n};\n\nfunction internalCreateContentModel(\n    core: ContentModelEditorCore,\n    selection?: DOMSelection,\n    option?: DomToModelOption\n) {\n    const editorContext = core.api.createEditorContext(core);\n    const domToModelContext = option\n        ? createDomToModelContext(editorContext, ...(core.defaultDomToModelOptions || []), option)\n        : createDomToModelContextWithConfig(core.defaultDomToModelConfig, editorContext);\n\n    return domToContentModel(core.contentDiv, domToModelContext, selection);\n}\n","import type { CreateEditorContext } from '../../publicTypes/ContentModelEditorCore';\nimport type { EditorContext } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Create a EditorContext object used by ContentModel API\n */\nexport const createEditorContext: CreateEditorContext = core => {\n    const { lifecycle, format, darkColorHandler, contentDiv, cache } = core;\n\n    const context: EditorContext = {\n        isDarkMode: lifecycle.isDarkMode,\n        defaultFormat: format.defaultFormat,\n        darkColorHandler: darkColorHandler,\n        addDelimiterForEntity: true,\n        allowCacheElement: true,\n        domIndexer: cache.domIndexer,\n    };\n\n    checkRootRtl(contentDiv, context);\n    checkZoomScale(contentDiv, context);\n\n    return context;\n};\n\nfunction checkZoomScale(element: HTMLElement, context: EditorContext) {\n    const originalWidth = element?.getBoundingClientRect()?.width || 0;\n    const visualWidth = element.offsetWidth;\n\n    if (visualWidth > 0 && originalWidth > 0) {\n        context.zoomScale = Math.round((originalWidth / visualWidth) * 100) / 100;\n    }\n}\n\nfunction checkRootRtl(element: HTMLElement, context: EditorContext) {\n    const style = element?.ownerDocument.defaultView?.getComputedStyle(element);\n\n    if (style?.direction == 'rtl') {\n        context.isRootRtl = true;\n    }\n}\n","import { SelectionRangeTypes } from 'roosterjs-editor-types';\nimport type {\n    ContentModelEditorCore,\n    GetDOMSelection,\n} from '../../publicTypes/ContentModelEditorCore';\nimport type { DOMSelection } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const getDOMSelection: GetDOMSelection = core => {\n    return core.cache.cachedSelection ?? getNewSelection(core);\n};\n\nfunction getNewSelection(core: ContentModelEditorCore): DOMSelection | null {\n    // TODO: Get rid of getSelectionRangeEx when we have standalone editor\n    const rangeEx = core.api.getSelectionRangeEx(core);\n\n    if (rangeEx.type == SelectionRangeTypes.Normal && rangeEx.ranges[0]) {\n        return {\n            type: 'range',\n            range: rangeEx.ranges[0],\n        };\n    } else if (rangeEx.type == SelectionRangeTypes.TableSelection && rangeEx.coordinates) {\n        return {\n            type: 'table',\n            table: rangeEx.table,\n            firstColumn: rangeEx.coordinates.firstCell.x,\n            lastColumn: rangeEx.coordinates.lastCell.x,\n            firstRow: rangeEx.coordinates.firstCell.y,\n            lastRow: rangeEx.coordinates.lastCell.y,\n        };\n    } else if (rangeEx.type == SelectionRangeTypes.ImageSelection) {\n        return {\n            type: 'image',\n            image: rangeEx.image,\n        };\n    } else {\n        return null;\n    }\n}\n","import type { SetContentModel } from '../../publicTypes/ContentModelEditorCore';\nimport {\n    contentModelToDom,\n    createModelToDomContext,\n    createModelToDomContextWithConfig,\n} from 'roosterjs-content-model-dom';\n\n/**\n * @internal\n * Set content with content model\n * @param core The editor core object\n * @param model The content model to set\n * @param option Additional options to customize the behavior of Content Model to DOM conversion\n */\nexport const setContentModel: SetContentModel = (core, model, option, onNodeCreated) => {\n    const editorContext = core.api.createEditorContext(core);\n    const modelToDomContext = option\n        ? createModelToDomContext(editorContext, ...(core.defaultModelToDomOptions || []), option)\n        : createModelToDomContextWithConfig(core.defaultModelToDomConfig, editorContext);\n    const selection = contentModelToDom(\n        core.contentDiv.ownerDocument,\n        core.contentDiv,\n        model,\n        modelToDomContext,\n        onNodeCreated\n    );\n\n    if (!core.lifecycle.shadowEditFragment) {\n        core.cache.cachedSelection = selection || undefined;\n\n        if (selection) {\n            core.api.setDOMSelection(core, selection);\n        }\n\n        core.cache.cachedModel = model;\n    }\n\n    return selection;\n};\n","import { SelectionRangeTypes } from 'roosterjs-editor-types';\nimport type { SelectionRangeEx } from 'roosterjs-editor-types';\nimport type { SetDOMSelection } from '../../publicTypes/ContentModelEditorCore';\n\n/**\n * @internal\n */\nexport const setDOMSelection: SetDOMSelection = (core, selection) => {\n    // TODO: Get rid of SelectionRangeEx in standalone editor\n    const rangeEx: SelectionRangeEx =\n        selection.type == 'range'\n            ? {\n                  type: SelectionRangeTypes.Normal,\n                  ranges: [selection.range],\n                  areAllCollapsed: selection.range.collapsed,\n              }\n            : selection.type == 'image'\n            ? {\n                  type: SelectionRangeTypes.ImageSelection,\n                  ranges: [],\n                  areAllCollapsed: false,\n                  image: selection.image,\n              }\n            : {\n                  type: SelectionRangeTypes.TableSelection,\n                  ranges: [],\n                  areAllCollapsed: false,\n                  table: selection.table,\n                  coordinates: {\n                      firstCell: {\n                          x: selection.firstColumn,\n                          y: selection.firstRow,\n                      },\n                      lastCell: {\n                          x: selection.lastColumn,\n                          y: selection.lastRow,\n                      },\n                  },\n              };\n\n    core.api.select(core, rangeEx);\n};\n","import { getSelectionPath } from 'roosterjs-editor-dom';\nimport { PluginEventType } from 'roosterjs-editor-types';\nimport type { ContentModelEditorCore } from '../../publicTypes/ContentModelEditorCore';\nimport type { SwitchShadowEdit } from 'roosterjs-editor-types';\n\n/**\n * @internal\n * Switch the Shadow Edit mode of editor On/Off\n * @param editorCore The EditorCore object\n * @param isOn True to switch On, False to switch Off\n */\nexport const switchShadowEdit: SwitchShadowEdit = (editorCore, isOn): void => {\n    // TODO: Use strong-typed editor core object\n    const core = editorCore as ContentModelEditorCore;\n\n    if (isOn != !!core.lifecycle.shadowEditFragment) {\n        if (isOn) {\n            const model = !core.cache.cachedModel ? core.api.createContentModel(core) : null;\n            const range = core.api.getSelectionRange(core, true /*tryGetFromCache*/);\n\n            // Fake object, not used in Content Model Editor, just to satisfy original editor code\n            // TODO: we can remove them once we have standalone Content Model Editor\n            const fragment = core.contentDiv.ownerDocument.createDocumentFragment();\n            const selectionPath = range && getSelectionPath(core.contentDiv, range);\n\n            core.api.triggerEvent(\n                core,\n                {\n                    eventType: PluginEventType.EnteredShadowEdit,\n                    fragment,\n                    selectionPath,\n                },\n                false /*broadcast*/\n            );\n\n            // This need to be done after EnteredShadowEdit event is triggered since EnteredShadowEdit event will cause a SelectionChanged event\n            // if current selection is table selection or image selection\n            if (!core.cache.cachedModel && model) {\n                core.cache.cachedModel = model;\n            }\n\n            core.lifecycle.shadowEditSelectionPath = selectionPath;\n            core.lifecycle.shadowEditFragment = fragment;\n        } else {\n            core.lifecycle.shadowEditFragment = null;\n            core.lifecycle.shadowEditSelectionPath = null;\n\n            core.api.triggerEvent(\n                core,\n                {\n                    eventType: PluginEventType.LeavingShadowEdit,\n                },\n                false /*broadcast*/\n            );\n\n            if (core.cache.cachedModel) {\n                core.api.setContentModel(core, core.cache.cachedModel);\n            }\n        }\n    }\n};\n","import { areSameRangeEx } from '../../modelApi/selection/areSameRangeEx';\nimport { isCharacterValue } from 'roosterjs-editor-dom';\nimport { Keys, PluginEventType } from 'roosterjs-editor-types';\nimport type ContentModelContentChangedEvent from '../../publicTypes/event/ContentModelContentChangedEvent';\nimport type { ContentModelCachePluginState } from '../../publicTypes/pluginState/ContentModelCachePluginState';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type {\n    IEditor,\n    PluginEvent,\n    PluginKeyDownEvent,\n    PluginWithState,\n} from 'roosterjs-editor-types';\n\n/**\n * ContentModel cache plugin manages cached Content Model, and refresh the cache when necessary\n */\nexport default class ContentModelCachePlugin\n    implements PluginWithState<ContentModelCachePluginState> {\n    private editor: IContentModelEditor | null = null;\n\n    /**\n     * Construct a new instance of ContentModelEditPlugin class\n     * @param state State of this plugin\n     */\n    constructor(private state: ContentModelCachePluginState) {\n        // TODO: Remove tempState parameter once we have standalone Content Model editor\n    }\n\n    /**\n     * Get name of this plugin\n     */\n    getName() {\n        return 'ContentModelCache';\n    }\n\n    /**\n     * The first method that editor will call to a plugin when editor is initializing.\n     * It will pass in the editor instance, plugin should take this chance to save the\n     * editor reference so that it can call to any editor method or format API later.\n     * @param editor The editor object\n     */\n    initialize(editor: IEditor) {\n        // TODO: Later we may need a different interface for Content Model editor plugin\n        this.editor = editor as IContentModelEditor;\n        this.editor.getDocument().addEventListener('selectionchange', this.onNativeSelectionChange);\n    }\n\n    /**\n     * The last method that editor will call to a plugin before it is disposed.\n     * Plugin can take this chance to clear the reference to editor. After this method is\n     * called, plugin should not call to any editor method since it will result in error.\n     */\n    dispose() {\n        if (this.editor) {\n            this.editor\n                .getDocument()\n                .removeEventListener('selectionchange', this.onNativeSelectionChange);\n            this.editor = null;\n        }\n    }\n\n    /**\n     * Get plugin state object\n     */\n    getState(): ContentModelCachePluginState {\n        return this.state;\n    }\n\n    /**\n     * Core method for a plugin. Once an event happens in editor, editor will call this\n     * method of each plugin to handle the event as long as the event is not handled\n     * exclusively by another plugin.\n     * @param event The event to handle:\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (!this.editor) {\n            return;\n        }\n\n        switch (event.eventType) {\n            case PluginEventType.KeyDown:\n                if (this.shouldClearCache(event)) {\n                    this.invalidateCache();\n                }\n                break;\n\n            case PluginEventType.Input:\n                {\n                    this.updateCachedModel(this.editor, true /*forceUpdate*/);\n                }\n                break;\n\n            case PluginEventType.SelectionChanged:\n                this.updateCachedModel(this.editor);\n                break;\n\n            case PluginEventType.ContentChanged:\n                {\n                    const { contentModel, selection } = event as ContentModelContentChangedEvent;\n\n                    if (contentModel && this.state.domIndexer) {\n                        this.state.cachedModel = contentModel;\n                        this.state.cachedSelection = selection;\n                    } else {\n                        this.invalidateCache();\n                    }\n                }\n\n                break;\n        }\n    }\n\n    private onNativeSelectionChange = () => {\n        if (this.editor?.hasFocus()) {\n            this.updateCachedModel(this.editor);\n        }\n    };\n\n    private invalidateCache() {\n        if (!this.editor?.isInShadowEdit()) {\n            this.state.cachedModel = undefined;\n            this.state.cachedSelection = undefined;\n        }\n    }\n\n    private updateCachedModel(editor: IContentModelEditor, forceUpdate?: boolean) {\n        const cachedSelection = this.state.cachedSelection;\n        this.state.cachedSelection = undefined; // Clear it to force getDOMSelection() retrieve the latest selection range\n\n        const newRangeEx = editor.getDOMSelection() || undefined;\n        const model = this.state.cachedModel;\n        const isSelectionChanged =\n            forceUpdate ||\n            !cachedSelection ||\n            !newRangeEx ||\n            !areSameRangeEx(newRangeEx, cachedSelection);\n\n        if (isSelectionChanged) {\n            if (\n                !model ||\n                !newRangeEx ||\n                !this.state.domIndexer?.reconcileSelection(model, newRangeEx, cachedSelection)\n            ) {\n                this.invalidateCache();\n            } else {\n                this.state.cachedSelection = newRangeEx;\n            }\n        } else {\n            this.state.cachedSelection = cachedSelection;\n        }\n    }\n\n    private shouldClearCache(event: PluginKeyDownEvent) {\n        const { rawEvent, handledByEditFeature } = event;\n\n        // In these cases we can't update the model, so clear cache:\n        // 1. It is already handled by Content Edit Features\n        if (handledByEditFeature) {\n            return true;\n        }\n\n        // 2. Default behavior is prevented, which means other plugins has handled the event\n        if (rawEvent.defaultPrevented) {\n            return true;\n        }\n\n        // 3. ENTER key is pressed. ENTER key will create new paragraph, so need to update cache to reflect this change\n        // TODO: Handle ENTER key to better reuse content model\n\n        if (rawEvent.which == Keys.ENTER) {\n            return true;\n        }\n\n        // 4. Current selection is image or table or expanded range selection, and is inputting some text\n        if (\n            (this.state.cachedSelection?.type != 'range' ||\n                !this.state.cachedSelection.range.collapsed) &&\n            isCharacterValue(rawEvent)\n        ) {\n            return true;\n        }\n\n        return false;\n    }\n}\n\n/**\n * @internal\n * Create a new instance of ContentModelCachePlugin class.\n * This is mostly for unit test\n * @param state State of this plugin\n */\nexport function createContentModelCachePlugin(state: ContentModelCachePluginState) {\n    return new ContentModelCachePlugin(state);\n}\n","import paste from '../../publicApi/utils/paste';\nimport { cloneModel } from '../../modelApi/common/cloneModel';\nimport { DeleteResult } from '../../modelApi/edit/utils/DeleteSelectionStep';\nimport { deleteSelection } from '../../modelApi/edit/deleteSelection';\nimport { formatWithContentModel } from '../../publicApi/utils/formatWithContentModel';\nimport { iterateSelections } from '../../modelApi/selection/iterateSelections';\nimport {\n    contentModelToDom,\n    createModelToDomContext,\n    isElementOfType,\n    isNodeOfType,\n    moveChildNodes,\n    normalizeContentModel,\n    toArray,\n} from 'roosterjs-content-model-dom';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type { DOMSelection, OnNodeCreated } from 'roosterjs-content-model-types';\nimport {\n    addRangeToSelection,\n    createElement,\n    extractClipboardItems,\n    wrap,\n} from 'roosterjs-editor-dom';\nimport type {\n    CopyPastePluginState,\n    IEditor,\n    PluginWithState,\n    ClipboardData,\n} from 'roosterjs-editor-types';\nimport {\n    ChangeSource,\n    PluginEventType,\n    KnownCreateElementDataIndex,\n    ColorTransformDirection,\n} from 'roosterjs-editor-types';\n\n/**\n * Copy and paste plugin for handling onCopy and onPaste event\n */\nexport default class ContentModelCopyPastePlugin implements PluginWithState<CopyPastePluginState> {\n    private editor: IContentModelEditor | null = null;\n    private disposer: (() => void) | null = null;\n\n    /**\n     * Construct a new instance of CopyPastePlugin\n     * @param options The editor options\n     */\n    constructor(private state: CopyPastePluginState) {}\n\n    /**\n     * Get a friendly name of  this plugin\n     */\n    getName() {\n        return 'ContentModelCopyPaste';\n    }\n\n    /**\n     * Initialize this plugin. This should only be called from Editor\n     * @param editor Editor instance\n     */\n    initialize(editor: IEditor) {\n        this.editor = editor as IContentModelEditor;\n        this.disposer = this.editor.addDomEventHandler({\n            paste: e => this.onPaste(e),\n            copy: e => this.onCutCopy(e, false /*isCut*/),\n            cut: e => this.onCutCopy(e, true /*isCut*/),\n        });\n    }\n\n    /**\n     * Dispose this plugin\n     */\n    dispose() {\n        if (this.disposer) {\n            this.disposer();\n        }\n        this.disposer = null;\n        this.editor = null;\n    }\n\n    /**\n     * Get plugin state object\n     */\n    getState() {\n        return this.state;\n    }\n\n    private onCutCopy(event: Event, isCut: boolean) {\n        if (!this.editor) {\n            return;\n        }\n\n        const doc = this.editor.getDocument();\n        const selection = this.editor.getDOMSelection();\n\n        if (selection && (selection.type != 'range' || !selection.range.collapsed)) {\n            const model = this.editor.createContentModel();\n\n            const pasteModel = cloneModel(model, {\n                includeCachedElement: this.editor.isDarkMode()\n                    ? (node, type) => {\n                          if (type == 'cache') {\n                              return undefined;\n                          } else {\n                              const result = node.cloneNode(true /*deep*/) as HTMLElement;\n\n                              this.editor?.transformToDarkColor(\n                                  result,\n                                  ColorTransformDirection.DarkToLight\n                              );\n\n                              result.style.color = result.style.color || 'inherit';\n                              result.style.backgroundColor =\n                                  result.style.backgroundColor || 'inherit';\n\n                              return result;\n                          }\n                      }\n                    : false,\n            });\n            if (selection.type === 'table') {\n                iterateSelections([pasteModel], (path, tableContext) => {\n                    if (tableContext?.table) {\n                        const table = tableContext?.table;\n                        table.rows = table.rows\n                            .map(row => {\n                                return {\n                                    ...row,\n                                    cells: row.cells.filter(cell => cell.isSelected),\n                                };\n                            })\n                            .filter(row => row.cells.length > 0);\n                        return true;\n                    }\n                    return false;\n                });\n            }\n            const tempDiv = this.getTempDiv(this.editor);\n            const selectionForCopy = contentModelToDom(\n                tempDiv.ownerDocument,\n                tempDiv,\n                pasteModel,\n                createModelToDomContext(),\n                onNodeCreated\n            );\n\n            let newRange: Range | null = selectionForCopy\n                ? domSelectionToRange(doc, selectionForCopy, tempDiv)\n                : null;\n            if (newRange) {\n                newRange = this.editor.triggerPluginEvent(PluginEventType.BeforeCutCopy, {\n                    clonedRoot: tempDiv,\n                    range: newRange,\n                    rawEvent: event as ClipboardEvent,\n                    isCut,\n                }).range;\n\n                if (newRange) {\n                    addRangeToSelection(newRange);\n                }\n\n                this.editor.runAsync(editor => {\n                    cleanUpAndRestoreSelection(tempDiv);\n                    editor.focus();\n                    (editor as IContentModelEditor).setDOMSelection(selection);\n\n                    if (isCut) {\n                        formatWithContentModel(\n                            editor as IContentModelEditor,\n                            'cut',\n                            (model, context) => {\n                                if (\n                                    deleteSelection(model, [], context).deleteResult ==\n                                    DeleteResult.Range\n                                ) {\n                                    normalizeContentModel(model);\n                                }\n\n                                return true;\n                            },\n                            {\n                                changeSource: ChangeSource.Cut,\n                            }\n                        );\n                    }\n                });\n            } else {\n                cleanUpAndRestoreSelection(tempDiv);\n            }\n        }\n    }\n\n    private onPaste = (event: Event) => {\n        if (this.editor && isClipboardEvent(event)) {\n            const editor = this.editor;\n\n            const dataTransfer = event.clipboardData;\n\n            if (dataTransfer?.items) {\n                event.preventDefault();\n                extractClipboardItems(\n                    toArray(dataTransfer.items),\n                    {\n                        allowedCustomPasteType: this.state.allowedCustomPasteType,\n                    },\n                    true /*pasteNativeEvent*/\n                ).then((clipboardData: ClipboardData) => {\n                    if (!editor.isDisposed()) {\n                        paste(editor, clipboardData);\n                    }\n                });\n            }\n        }\n    };\n\n    private getTempDiv(editor: IEditor) {\n        const div = editor.getCustomData(\n            'CopyPasteTempDiv',\n            () => {\n                const tempDiv = createElement(\n                    KnownCreateElementDataIndex.CopyPasteTempDiv,\n                    editor.getDocument()\n                ) as HTMLDivElement;\n\n                editor.getDocument().body.appendChild(tempDiv);\n\n                return tempDiv;\n            },\n            tempDiv => tempDiv.parentNode?.removeChild(tempDiv)\n        );\n\n        div.style.backgroundColor = 'white';\n        div.style.color = 'black';\n        div.childNodes.forEach(node => div.removeChild(node));\n\n        div.style.display = '';\n        div.focus();\n\n        return div;\n    }\n}\n\nfunction cleanUpAndRestoreSelection(tempDiv: HTMLDivElement) {\n    tempDiv.style.backgroundColor = '';\n    tempDiv.style.color = '';\n    tempDiv.style.display = 'none';\n    moveChildNodes(tempDiv);\n}\n\nfunction isClipboardEvent(event: Event): event is ClipboardEvent {\n    return !!(event as ClipboardEvent).clipboardData;\n}\n\nfunction domSelectionToRange(\n    doc: Document,\n    selection: DOMSelection,\n    tempDiv: HTMLDivElement\n): Range | null {\n    let newRange: Range | null = null;\n\n    if (selection.type === 'table') {\n        const table = tempDiv.querySelector(`#${selection.table.id}`) as HTMLTableElement;\n        const elementToSelect =\n            table.parentElement?.childElementCount == 1 ? table.parentElement : table;\n\n        newRange = doc.createRange();\n        newRange.selectNode(elementToSelect);\n    } else if (selection.type === 'image') {\n        const image = tempDiv.querySelector('#' + selection.image.id);\n\n        if (image) {\n            newRange = doc.createRange();\n            newRange.selectNode(image);\n        }\n    } else {\n        newRange = selection.range;\n    }\n\n    return newRange;\n}\n\n/**\n * @internal\n * Exported only for unit testing\n */\nexport const onNodeCreated: OnNodeCreated = (_, node): void => {\n    if (isNodeOfType(node, 'ELEMENT_NODE') && isElementOfType(node, 'table')) {\n        wrap(node, 'div');\n    }\n    if (isNodeOfType(node, 'ELEMENT_NODE') && !node.isContentEditable) {\n        node.removeAttribute('contenteditable');\n    }\n};\n","import keyboardDelete from '../../publicApi/editing/keyboardDelete';\nimport { Keys, PluginEventType } from 'roosterjs-editor-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type {\n    EditorPlugin,\n    IEditor,\n    PluginEvent,\n    PluginKeyDownEvent,\n} from 'roosterjs-editor-types';\n\n/**\n * ContentModel plugins helps editor to do editing operation on top of content model.\n * This includes:\n * 1. Delete Key\n * 2. Backspace Key\n */\nexport default class ContentModelEditPlugin implements EditorPlugin {\n    private editor: IContentModelEditor | null = null;\n\n    /**\n     * Get name of this plugin\n     */\n    getName() {\n        return 'ContentModelEdit';\n    }\n\n    /**\n     * The first method that editor will call to a plugin when editor is initializing.\n     * It will pass in the editor instance, plugin should take this chance to save the\n     * editor reference so that it can call to any editor method or format API later.\n     * @param editor The editor object\n     */\n    initialize(editor: IEditor) {\n        // TODO: Later we may need a different interface for Content Model editor plugin\n        this.editor = editor as IContentModelEditor;\n    }\n\n    /**\n     * The last method that editor will call to a plugin before it is disposed.\n     * Plugin can take this chance to clear the reference to editor. After this method is\n     * called, plugin should not call to any editor method since it will result in error.\n     */\n    dispose() {\n        this.editor = null;\n    }\n\n    /**\n     * Core method for a plugin. Once an event happens in editor, editor will call this\n     * method of each plugin to handle the event as long as the event is not handled\n     * exclusively by another plugin.\n     * @param event The event to handle:\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (this.editor) {\n            switch (event.eventType) {\n                case PluginEventType.KeyDown:\n                    this.handleKeyDownEvent(this.editor, event);\n                    break;\n            }\n        }\n    }\n\n    private handleKeyDownEvent(editor: IContentModelEditor, event: PluginKeyDownEvent) {\n        const rawEvent = event.rawEvent;\n        const which = rawEvent.which;\n\n        if (!rawEvent.defaultPrevented && !event.handledByEditFeature) {\n            // TODO: Consider use ContentEditFeature and need to hide other conflict features that are not based on Content Model\n            switch (which) {\n                case Keys.BACKSPACE:\n                case Keys.DELETE:\n                    // Use our API to handle BACKSPACE/DELETE key.\n                    // No need to clear cache here since if we rely on browser's behavior, there will be Input event and its handler will reconcile cache\n                    keyboardDelete(editor, rawEvent);\n                    break;\n            }\n        }\n    }\n}\n\n/**\n * @internal\n * Create a new instance of ContentModelEditPlugin class.\n * This is mostly for unit test\n */\nexport function createContentModelEditPlugin() {\n    return new ContentModelEditPlugin();\n}\n","import applyDefaultFormat from '../../publicApi/format/applyDefaultFormat';\nimport applyPendingFormat from '../../publicApi/format/applyPendingFormat';\nimport { canApplyPendingFormat, clearPendingFormat } from '../../modelApi/format/pendingFormat';\nimport { getObjectKeys } from 'roosterjs-content-model-dom';\nimport { isCharacterValue } from 'roosterjs-editor-dom';\nimport { Keys, PluginEventType } from 'roosterjs-editor-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type { IEditor, PluginEvent, PluginWithState } from 'roosterjs-editor-types';\nimport type { ContentModelFormatPluginState } from '../../publicTypes/pluginState/ContentModelFormatPluginState';\n\n// During IME input, KeyDown event will have \"Process\" as key\nconst ProcessKey = 'Process';\n\n/**\n * ContentModelFormat plugins helps editor to do formatting on top of content model.\n * This includes:\n * 1. Handle pending format changes when selection is collapsed\n */\nexport default class ContentModelFormatPlugin\n    implements PluginWithState<ContentModelFormatPluginState> {\n    private editor: IContentModelEditor | null = null;\n    private hasDefaultFormat = false;\n\n    /**\n     * Construct a new instance of ContentModelEditPlugin class\n     * @param state State of this plugin\n     */\n    constructor(private state: ContentModelFormatPluginState) {\n        // TODO: Remove tempState parameter once we have standalone Content Model editor\n    }\n\n    /**\n     * Get name of this plugin\n     */\n    getName() {\n        return 'ContentModelFormat';\n    }\n\n    /**\n     * The first method that editor will call to a plugin when editor is initializing.\n     * It will pass in the editor instance, plugin should take this chance to save the\n     * editor reference so that it can call to any editor method or format API later.\n     * @param editor The editor object\n     */\n    initialize(editor: IEditor) {\n        // TODO: Later we may need a different interface for Content Model editor plugin\n        this.editor = editor as IContentModelEditor;\n        this.hasDefaultFormat =\n            getObjectKeys(this.state.defaultFormat).filter(\n                x => typeof this.state.defaultFormat[x] !== 'undefined'\n            ).length > 0;\n    }\n\n    /**\n     * The last method that editor will call to a plugin before it is disposed.\n     * Plugin can take this chance to clear the reference to editor. After this method is\n     * called, plugin should not call to any editor method since it will result in error.\n     */\n    dispose() {\n        this.editor = null;\n    }\n\n    /**\n     * Get plugin state object\n     */\n    getState(): ContentModelFormatPluginState {\n        return this.state;\n    }\n\n    /**\n     * Core method for a plugin. Once an event happens in editor, editor will call this\n     * method of each plugin to handle the event as long as the event is not handled\n     * exclusively by another plugin.\n     * @param event The event to handle:\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (!this.editor) {\n            return;\n        }\n\n        switch (event.eventType) {\n            case PluginEventType.Input:\n                // In Safari, isComposing will be undefined but isInIME() works\n                if (!event.rawEvent.isComposing && !this.editor.isInIME()) {\n                    this.checkAndApplyPendingFormat(event.rawEvent.data);\n                }\n\n                break;\n\n            case PluginEventType.CompositionEnd:\n                this.checkAndApplyPendingFormat(event.rawEvent.data);\n                break;\n\n            case PluginEventType.KeyDown:\n                if (event.rawEvent.which >= Keys.PAGEUP && event.rawEvent.which <= Keys.DOWN) {\n                    clearPendingFormat(this.editor);\n                } else if (\n                    this.hasDefaultFormat &&\n                    (isCharacterValue(event.rawEvent) || event.rawEvent.key == ProcessKey)\n                ) {\n                    applyDefaultFormat(this.editor, this.state.defaultFormat);\n                }\n\n                break;\n\n            case PluginEventType.MouseUp:\n            case PluginEventType.ContentChanged:\n                if (!canApplyPendingFormat(this.editor)) {\n                    clearPendingFormat(this.editor);\n                }\n                break;\n        }\n    }\n\n    private checkAndApplyPendingFormat(data: string | null) {\n        if (this.editor && data) {\n            applyPendingFormat(this.editor, data);\n            clearPendingFormat(this.editor);\n        }\n    }\n}\n\n/**\n * @internal\n * Create a new instance of ContentModelFormatPlugin.\n * This is mostly for unit test\n */\nexport function createContentModelFormatPlugin(state: ContentModelFormatPluginState) {\n    return new ContentModelFormatPlugin(state);\n}\n","import type { EditorPlugin } from 'roosterjs-editor-types';\n\n/**\n * Dummy plugin, just to skip original TypeInContainerPlugin's behavior\n */\nexport default class ContentModelTypeInContainerPlugin implements EditorPlugin {\n    /**\n     * Get name of this plugin\n     */\n    getName() {\n        return 'ContentModelTypeInContainer';\n    }\n\n    /**\n     * The first method that editor will call to a plugin when editor is initializing.\n     * It will pass in the editor instance, plugin should take this chance to save the\n     * editor reference so that it can call to any editor method or format API later.\n     * @param editor The editor object\n     */\n    initialize() {}\n\n    /**\n     * The last method that editor will call to a plugin before it is disposed.\n     * Plugin can take this chance to clear the reference to editor. After this method is\n     * called, plugin should not call to any editor method since it will result in error.\n     */\n    dispose() {}\n}\n","import ContentModelCopyPastePlugin from './corePlugins/ContentModelCopyPastePlugin';\nimport ContentModelTypeInContainerPlugin from './corePlugins/ContentModelTypeInContainerPlugin';\nimport { contentModelDomIndexer } from './utils/contentModelDomIndexer';\nimport { createContentModel } from './coreApi/createContentModel';\nimport { createContentModelCachePlugin } from './corePlugins/ContentModelCachePlugin';\nimport { createContentModelEditPlugin } from './corePlugins/ContentModelEditPlugin';\nimport { createContentModelFormatPlugin } from './corePlugins/ContentModelFormatPlugin';\nimport { createDomToModelConfig, createModelToDomConfig } from 'roosterjs-content-model-dom';\nimport { createEditorContext } from './coreApi/createEditorContext';\nimport { createEditorCore } from 'roosterjs-editor-core';\nimport { getDOMSelection } from './coreApi/getDOMSelection';\nimport { setContentModel } from './coreApi/setContentModel';\nimport { setDOMSelection } from './coreApi/setDOMSelection';\nimport { switchShadowEdit } from './coreApi/switchShadowEdit';\nimport { tablePreProcessor } from './overrides/tablePreProcessor';\nimport type { ContentModelEditorCore } from '../publicTypes/ContentModelEditorCore';\nimport type { ContentModelEditorOptions } from '../publicTypes/IContentModelEditor';\nimport type { ContentModelPluginState } from '../publicTypes/pluginState/ContentModelPluginState';\nimport type { CoreCreator, EditorCore } from 'roosterjs-editor-types';\n\n/**\n * Editor Core creator for Content Model editor\n */\nexport const createContentModelEditorCore: CoreCreator<\n    ContentModelEditorCore,\n    ContentModelEditorOptions\n> = (contentDiv, options) => {\n    const pluginState = getPluginState(options);\n    const modifiedOptions: ContentModelEditorOptions = {\n        ...options,\n        plugins: [\n            createContentModelCachePlugin(pluginState.cache),\n            ...(options.plugins || []),\n            createContentModelFormatPlugin(pluginState.format),\n            createContentModelEditPlugin(),\n        ],\n        corePluginOverride: {\n            typeInContainer: new ContentModelTypeInContainerPlugin(),\n            copyPaste: new ContentModelCopyPastePlugin(pluginState.copyPaste),\n            ...options.corePluginOverride,\n        },\n    };\n\n    const core = createEditorCore(contentDiv, modifiedOptions) as ContentModelEditorCore;\n\n    promoteToContentModelEditorCore(core, modifiedOptions, pluginState);\n\n    return core;\n};\n\n/**\n * Creator Content Model Editor Core from Editor Core\n * @param core The original EditorCore object\n * @param options Options of this editor\n */\nexport function promoteToContentModelEditorCore(\n    core: EditorCore,\n    options: ContentModelEditorOptions,\n    pluginState: ContentModelPluginState\n) {\n    const cmCore = core as ContentModelEditorCore;\n\n    promoteCorePluginState(cmCore, pluginState);\n    promoteContentModelInfo(cmCore, options);\n    promoteCoreApi(cmCore);\n}\n\nfunction promoteCorePluginState(\n    cmCore: ContentModelEditorCore,\n    pluginState: ContentModelPluginState\n) {\n    Object.assign(cmCore, pluginState);\n}\n\nfunction promoteContentModelInfo(\n    cmCore: ContentModelEditorCore,\n    options: ContentModelEditorOptions\n) {\n    cmCore.defaultDomToModelOptions = [\n        {\n            processorOverride: {\n                table: tablePreProcessor,\n            },\n        },\n        options.defaultDomToModelOptions,\n    ];\n    cmCore.defaultModelToDomOptions = [options.defaultModelToDomOptions];\n    cmCore.defaultDomToModelConfig = createDomToModelConfig(cmCore.defaultDomToModelOptions);\n    cmCore.defaultModelToDomConfig = createModelToDomConfig(cmCore.defaultModelToDomOptions);\n}\n\nfunction promoteCoreApi(cmCore: ContentModelEditorCore) {\n    cmCore.api.createEditorContext = createEditorContext;\n    cmCore.api.createContentModel = createContentModel;\n    cmCore.api.setContentModel = setContentModel;\n    cmCore.api.switchShadowEdit = switchShadowEdit;\n    cmCore.api.getDOMSelection = getDOMSelection;\n    cmCore.api.setDOMSelection = setDOMSelection;\n    cmCore.originalApi.createEditorContext = createEditorContext;\n    cmCore.originalApi.createContentModel = createContentModel;\n    cmCore.originalApi.setContentModel = setContentModel;\n    cmCore.originalApi.getDOMSelection = getDOMSelection;\n    cmCore.originalApi.setDOMSelection = setDOMSelection;\n}\n\nfunction getPluginState(options: ContentModelEditorOptions): ContentModelPluginState {\n    const format = options.defaultFormat || {};\n    return {\n        cache: {\n            domIndexer: options.cacheModel ? contentModelDomIndexer : undefined,\n        },\n        copyPaste: {\n            allowedCustomPasteType: options.allowedCustomPasteType || [],\n        },\n        format: {\n            defaultFormat: {\n                fontWeight: format.bold ? 'bold' : undefined,\n                italic: format.italic || undefined,\n                underline: format.underline || undefined,\n                fontFamily: format.fontFamily || undefined,\n                fontSize: format.fontSize || undefined,\n                textColor: format.textColors?.lightModeColor || format.textColor || undefined,\n                backgroundColor:\n                    format.backgroundColors?.lightModeColor || format.backgroundColor || undefined,\n            },\n        },\n    };\n}\n","import type { IContentModelEditor } from '../publicTypes/IContentModelEditor';\nimport type { IEditor } from 'roosterjs-editor-types';\n\n/**\n * Check if the given editor object is Content Model editor\n * @param editor The editor to check\n * @returns True if the given editor is Content Model editor, otherwise false\n */\nexport default function isContentModelEditor(editor: IEditor): editor is IContentModelEditor {\n    const contentModelEditor = editor as IContentModelEditor;\n\n    return !!contentModelEditor.createContentModel;\n}\n","import { contains } from 'roosterjs-editor-dom';\nimport { entityProcessor, hasMetadata, tableProcessor } from 'roosterjs-content-model-dom';\nimport { getSelectionRootNode } from '../../modelApi/selection/getSelectionRootNode';\nimport type { DomToModelContext, ElementProcessor } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const tablePreProcessor: ElementProcessor<HTMLTableElement> = (group, element, context) => {\n    const processor = shouldUseTableProcessor(element, context) ? tableProcessor : entityProcessor;\n\n    processor(group, element, context);\n};\n\nfunction shouldUseTableProcessor(element: HTMLTableElement, context: DomToModelContext) {\n    // Treat table as a real table when:\n    // 1. It is a roosterjs table (has metadata)\n    // 2. Table is in selection\n    // 3. There is selection inside table (or whole table is selected)\n    // Otherwise, we treat the table as entity so we will not change it when write back\n    return (\n        hasMetadata(element) ||\n        context.isInSelection ||\n        contains(element, getSelectionRootNode(context.selection), true /*treatSameNodeAsContain*/)\n    );\n}\n","import addParser from './utils/addParser';\nimport { chainSanitizerCallback, getPasteSource } from 'roosterjs-editor-dom';\nimport { deprecatedBorderColorParser } from './utils/deprecatedColorParser';\nimport { KnownPasteSourceType, PasteType, PluginEventType } from 'roosterjs-editor-types';\nimport { parseLink } from './utils/linkParser';\nimport { processPastedContentFromExcel } from './Excel/processPastedContentFromExcel';\nimport { processPastedContentFromPowerPoint } from './PowerPoint/processPastedContentFromPowerPoint';\nimport { processPastedContentFromWordDesktop } from './WordDesktop/processPastedContentFromWordDesktop';\nimport { processPastedContentWacComponents } from './WacComponents/processPastedContentWacComponents';\nimport type ContentModelBeforePasteEvent from '../../../publicTypes/event/ContentModelBeforePasteEvent';\nimport type { ContentModelBlockFormat, FormatParser } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../../publicTypes/IContentModelEditor';\nimport type {\n    EditorPlugin,\n    HtmlSanitizerOptions,\n    IEditor,\n    PluginEvent,\n} from 'roosterjs-editor-types';\n\nconst GOOGLE_SHEET_NODE_NAME = 'google-sheets-html-origin';\n\n/**\n * Paste plugin, handles BeforePaste event and reformat some special content, including:\n * 1. Content copied from Word\n * 2. Content copied from Excel\n * 3. Content copied from Word Online or OneNote Online\n * 4. Content copied from Power Point\n * (This class is still under development, and may still be changed in the future with some breaking changes)\n */\nexport default class ContentModelPastePlugin implements EditorPlugin {\n    private editor: IContentModelEditor | null = null;\n\n    /**\n     * Construct a new instance of Paste class\n     * @param unknownTagReplacement Replace solution of unknown tags, default behavior is to replace with SPAN\n     */\n    constructor(private unknownTagReplacement: string = 'SPAN') {}\n\n    /**\n     * Get name of this plugin\n     */\n    getName() {\n        return 'ContentModelPaste';\n    }\n\n    /**\n     * The first method that editor will call to a plugin when editor is initializing.\n     * It will pass in the editor instance, plugin should take this chance to save the\n     * editor reference so that it can call to any editor method or format API later.\n     * @param editor The editor object\n     */\n    initialize(editor: IEditor) {\n        // TODO: Later we may need a different interface for Content Model editor plugin\n        this.editor = editor as IContentModelEditor;\n    }\n\n    /**\n     * The last method that editor will call to a plugin before it is disposed.\n     * Plugin can take this chance to clear the reference to editor. After this method is\n     * called, plugin should not call to any editor method since it will result in error.\n     */\n    dispose() {\n        this.editor = null;\n    }\n\n    /**\n     * Core method for a plugin. Once an event happens in editor, editor will call this\n     * method of each plugin to handle the event as long as the event is not handled\n     * exclusively by another plugin.\n     * @param event The event to handle:\n     */\n    onPluginEvent(event: PluginEvent) {\n        if (!this.editor || event.eventType != PluginEventType.BeforePaste) {\n            return;\n        }\n\n        const ev = event as ContentModelBeforePasteEvent;\n        if (!ev.domToModelOption) {\n            return;\n        }\n        const pasteSource = getPasteSource(ev, false);\n        switch (pasteSource) {\n            case KnownPasteSourceType.WordDesktop:\n                processPastedContentFromWordDesktop(ev);\n                break;\n            case KnownPasteSourceType.WacComponents:\n                processPastedContentWacComponents(ev);\n                break;\n            case KnownPasteSourceType.ExcelOnline:\n            case KnownPasteSourceType.ExcelDesktop:\n                if (ev.pasteType === PasteType.Normal || ev.pasteType === PasteType.MergeFormat) {\n                    // Handle HTML copied from Excel\n                    processPastedContentFromExcel(ev, this.editor.getTrustedHTMLHandler());\n                }\n                break;\n            case KnownPasteSourceType.GoogleSheets:\n                ev.sanitizingOption.additionalTagReplacements[GOOGLE_SHEET_NODE_NAME] = '*';\n                break;\n            case KnownPasteSourceType.PowerPointDesktop:\n                processPastedContentFromPowerPoint(ev, this.editor.getTrustedHTMLHandler());\n                break;\n        }\n\n        addParser(ev.domToModelOption, 'link', parseLink);\n        addParser(ev.domToModelOption, 'tableCell', deprecatedBorderColorParser);\n        addParser(ev.domToModelOption, 'table', deprecatedBorderColorParser);\n        sanitizeBlockStyles(ev.sanitizingOption);\n\n        if (ev.pasteType === PasteType.MergeFormat) {\n            addParser(ev.domToModelOption, 'block', blockElementParser);\n            addParser(ev.domToModelOption, 'listLevel', blockElementParser);\n        }\n\n        ev.sanitizingOption.unknownTagReplacement = this.unknownTagReplacement;\n    }\n}\n\n/**\n * For block elements that have background color style, remove the background color when user selects the merge current format\n * paste option\n */\nconst blockElementParser: FormatParser<ContentModelBlockFormat> = (\n    format: ContentModelBlockFormat,\n    element: HTMLElement\n) => {\n    if (element.style.backgroundColor) {\n        delete format.backgroundColor;\n    }\n};\n\nfunction sanitizeBlockStyles(sanitizingOption: Required<HtmlSanitizerOptions>) {\n    chainSanitizerCallback(sanitizingOption.cssStyleCallbacks, 'display', (value: string) => {\n        return value != 'flex'; // return whether we keep the style\n    });\n}\n","import addParser from '../utils/addParser';\nimport { isNodeOfType, moveChildNodes } from 'roosterjs-content-model-dom';\nimport { setProcessor } from '../utils/setProcessor';\nimport type ContentModelBeforePasteEvent from '../../../../publicTypes/event/ContentModelBeforePasteEvent';\nimport type { TrustedHTMLHandler } from 'roosterjs-editor-types';\n\nconst LAST_TD_END_REGEX = /<\\/\\s*td\\s*>((?!<\\/\\s*tr\\s*>)[\\s\\S])*$/i;\nconst LAST_TR_END_REGEX = /<\\/\\s*tr\\s*>((?!<\\/\\s*table\\s*>)[\\s\\S])*$/i;\nconst LAST_TR_REGEX = /<tr[^>]*>[^<]*/i;\nconst LAST_TABLE_REGEX = /<table[^>]*>[^<]*/i;\nconst DEFAULT_BORDER_STYLE = 'solid 1px #d4d4d4';\n\n/**\n * @internal\n * Convert pasted content from Excel, add borders when source doc doesn't have a border\n * @param event The BeforePaste event\n */\n\nexport function processPastedContentFromExcel(\n    event: ContentModelBeforePasteEvent,\n    trustedHTMLHandler: TrustedHTMLHandler\n) {\n    const { fragment, htmlBefore, clipboardData } = event;\n    const html = clipboardData.html ? excelHandler(clipboardData.html, htmlBefore) : undefined;\n\n    if (html && clipboardData.html != html) {\n        const doc = new DOMParser().parseFromString(trustedHTMLHandler(html), 'text/html');\n        moveChildNodes(fragment, doc?.body);\n    }\n\n    // For Excel Online\n    const firstChild = fragment.firstChild;\n    if (\n        isNodeOfType(firstChild, 'ELEMENT_NODE') &&\n        firstChild.tagName == 'div' &&\n        firstChild.firstChild\n    ) {\n        const tableFound = Array.from(firstChild.childNodes).every((child: Node) => {\n            // Tables pasted from Excel Online should be of the format: 0 to N META tags and 1 TABLE tag\n            const tagName = isNodeOfType(child, 'ELEMENT_NODE') && child.tagName;\n\n            return tagName == 'META'\n                ? true\n                : tagName == 'TABLE'\n                ? child == firstChild.lastChild\n                : false;\n        });\n\n        // Extract Table from Div\n        if (tableFound && firstChild.lastChild) {\n            event.fragment.replaceChildren(firstChild.lastChild);\n        }\n    }\n\n    addParser(event.domToModelOption, 'tableCell', (format, element) => {\n        if (element.style.borderStyle === 'none') {\n            format.borderBottom = DEFAULT_BORDER_STYLE;\n            format.borderLeft = DEFAULT_BORDER_STYLE;\n            format.borderRight = DEFAULT_BORDER_STYLE;\n            format.borderTop = DEFAULT_BORDER_STYLE;\n        }\n    });\n\n    setProcessor(event.domToModelOption, 'child', (group, element, context) => {\n        const segmentFormat = { ...context.segmentFormat };\n        if (group.blockGroupType === 'TableCell' && group.format.textColor) {\n            context.segmentFormat.textColor = group.format.textColor;\n        }\n\n        context.defaultElementProcessors.child(group, element, context);\n\n        if (group.blockGroupType === 'TableCell' && group.format.textColor) {\n            context.segmentFormat = segmentFormat;\n            delete group.format.textColor;\n        }\n    });\n}\n\n/**\n * @internal Export for test only\n * @param html Source html\n */\n\nexport function excelHandler(html: string, htmlBefore: string): string {\n    if (html.match(LAST_TD_END_REGEX)) {\n        const trMatch = htmlBefore.match(LAST_TR_REGEX);\n        const tr = trMatch ? trMatch[0] : '<TR>';\n        html = tr + html + '</TR>';\n    }\n    if (html.match(LAST_TR_END_REGEX)) {\n        const tableMatch = htmlBefore.match(LAST_TABLE_REGEX);\n        const table = tableMatch ? tableMatch[0] : '<TABLE>';\n        html = table + html + '</TABLE>';\n    }\n\n    return html;\n}\n","import { moveChildNodes } from 'roosterjs-content-model-dom';\nimport type { BeforePasteEvent, TrustedHTMLHandler } from 'roosterjs-editor-types';\n\n/**\n * @internal\n * Convert pasted content from PowerPoint\n * @param event The BeforePaste event\n */\n\nexport function processPastedContentFromPowerPoint(\n    event: BeforePasteEvent,\n    trustedHTMLHandler: TrustedHTMLHandler\n) {\n    const { fragment, clipboardData } = event;\n\n    if (clipboardData.html && !clipboardData.text && clipboardData.image) {\n        // It is possible that PowerPoint copied both image and HTML but not plain text.\n        // We always prefer HTML if any.\n        const doc = new DOMParser().parseFromString(\n            trustedHTMLHandler(clipboardData.html),\n            'text/html'\n        );\n\n        moveChildNodes(fragment, doc?.body);\n    }\n}\n","import addParser from '../utils/addParser';\nimport { findClosestElementAncestor, matchesSelector } from 'roosterjs-editor-dom';\nimport { setProcessor } from '../utils/setProcessor';\nimport type ContentModelBeforePasteEvent from '../../../../publicTypes/event/ContentModelBeforePasteEvent';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelBlockGroup,\n    ContentModelListItemLevelFormat,\n    ContentModelSegmentFormat,\n    DomToModelContext,\n    ElementProcessor,\n    FormatParser,\n} from 'roosterjs-content-model-types';\n\nconst WAC_IDENTIFY_SELECTOR =\n    'ul[class^=\"BulletListStyle\"]>.OutlineElement,ol[class^=\"NumberListStyle\"]>.OutlineElement,span.WACImageContainer,span.WACImageBorder';\nconst LIST_CONTAINER_ELEMENT_CLASS_NAME = 'ListContainerWrapper';\n\nconst PARAGRAPH = 'Paragraph';\nconst TABLE_CONTAINER = 'TableContainer';\n\nconst TEMP_ELEMENTS_CLASSES = [\n    'TableInsertRowGapBlank',\n    'TableColumnResizeHandle',\n    'TableCellTopBorderHandle',\n    'TableCellLeftBorderHandle',\n    'TableHoverColumnHandle',\n    'TableHoverRowHandle',\n    'ListMarkerWrappingSpan',\n];\n\nconst CLASSES_TO_KEEP = [\n    'OutlineElement',\n    'NumberListStyle',\n    'WACImageContainer',\n    'ListContainerWrapper',\n    'BulletListStyle',\n    ...TEMP_ELEMENTS_CLASSES,\n    'TableCellContent',\n    PARAGRAPH,\n    'WACImageContainer',\n    'WACImageBorder',\n    TABLE_CONTAINER,\n    'LineBreakBlob',\n];\n\nconst LIST_ELEMENT_TAGS = ['UL', 'OL', 'LI'];\nconst LIST_ELEMENT_SELECTOR = LIST_ELEMENT_TAGS.join(',');\n\n/**\n * Wac components do not use sub and super tags, instead only add vertical align to a span.\n * This parser normalize the content for content model\n */\nconst wacSubSuperParser: FormatParser<ContentModelSegmentFormat> = (\n    format: ContentModelSegmentFormat,\n    element: HTMLElement\n): void => {\n    const verticalAlign = element.style.verticalAlign;\n    if (verticalAlign === 'super') {\n        format.superOrSubScriptSequence = 'super';\n    }\n    if (verticalAlign === 'sub') {\n        format.superOrSubScriptSequence = 'sub';\n    }\n};\n\n/**\n * This processor does:\n * 1) Remove the display and margin of the element.\n * 2) When an element should be ignored but should handle the child elements call the default child processor.\n * 3) Removes the End of Paragraph element to avoid empty lines, we should only remove this if the previous element of the EOP is an EmptyTextRun\n * 4) Finally call the default processor.\n * @returns\n */\nconst wacElementProcessor: ElementProcessor<HTMLElement> = (\n    group: ContentModelBlockGroup,\n    element: HTMLElement,\n    context: DomToModelContext\n): void => {\n    const elementTag = element.tagName;\n    if (matchesSelector(element, WAC_IDENTIFY_SELECTOR)) {\n        element.style.removeProperty('display');\n        element.style.removeProperty('margin');\n    }\n\n    if (element.classList.contains(LIST_CONTAINER_ELEMENT_CLASS_NAME)) {\n        context.elementProcessors.child(group, element, context);\n        return;\n    }\n\n    if (TEMP_ELEMENTS_CLASSES.some(className => element.classList.contains(className))) {\n        return;\n    } else if (shouldClearListContext(elementTag, element, context)) {\n        const { listFormat } = context;\n        listFormat.levels = [];\n        listFormat.listParent = undefined;\n    }\n\n    context.defaultElementProcessors.element(group, element, context);\n};\n\n/**\n * This processor calls the default list processor and then sets the correct list level and list bullet.\n */\nconst wacLiElementProcessor: ElementProcessor<HTMLLIElement> = (\n    group: ContentModelBlockGroup,\n    element: HTMLLIElement,\n    context: DomToModelContext\n): void => {\n    context.defaultElementProcessors.li?.(group, element, context);\n    const { listFormat } = context;\n    const listParent = listFormat.listParent;\n    if (listParent) {\n        const lastblock = listParent.blocks[listParent.blocks.length - 1];\n        if (\n            lastblock.blockType == 'BlockGroup' &&\n            lastblock.blockGroupType == 'ListItem' &&\n            context.listFormat.listParent !== lastblock\n        ) {\n            const currentLevel = lastblock.levels[lastblock.levels.length - 1];\n\n            // Get item level from 'data-aria-level' attribute\n            const level = parseInt(element.getAttribute('data-aria-level') ?? '');\n            if (level > 0) {\n                if (level > lastblock.levels.length) {\n                    while (level != lastblock.levels.length) {\n                        lastblock.levels.push(currentLevel);\n                    }\n                } else {\n                    lastblock.levels.splice(level, lastblock.levels.length - 1);\n                    lastblock.levels[level - 1] = currentLevel;\n                }\n            }\n        }\n    }\n};\n\n/**\n * This parsers does:\n * 1) Sets the display for dummy item to undefined when the current style is block.\n * 2) Removes the Margin Left\n */\nconst wacListItemParser: FormatParser<ContentModelListItemLevelFormat> = (\n    format: ContentModelListItemLevelFormat,\n    element: HTMLElement\n): void => {\n    if (element.style.display === 'block') {\n        format.displayForDummyItem = undefined;\n    }\n\n    format.marginLeft = undefined;\n};\n\n/**\n * Wac usually adds padding to lists which is unwanted so remove it.\n */\nconst wacListLevelParser: FormatParser<ContentModelListItemLevelFormat> = (\n    format: ContentModelListItemLevelFormat\n): void => {\n    format.marginLeft = undefined;\n    format.paddingLeft = undefined;\n};\n\n/**\n * This function returns whether we need to clear the list format.\n * Word Online wraps lists inside divs to have this structure:\n *\n *  <div class='ListContainerWrapper'>\n *      <ol>...</ol>\n *  </div>\n *  <div>\n *      <p>...</p>\n *  <div>\n *  <div class='ListContainerWrapper'>\n *      <ol>...</ol>\n *  </div>\n *\n *  So if a elements is not contained inside of a list we should clear the list context to prevent normal text to be\n *  transformed into list\n *  For the above scenario, if we do not clear the format, the content inside of the second div would be transformed to a list too.\n */\nfunction shouldClearListContext(\n    elementTag: string,\n    element: HTMLElement,\n    context: DomToModelContext\n) {\n    return (\n        context.listFormat.levels.length > 0 &&\n        LIST_ELEMENT_TAGS.every(tag => tag != elementTag) &&\n        !findClosestElementAncestor(element, undefined, LIST_ELEMENT_SELECTOR)\n    );\n}\n\n/**\n * @internal\n * Convert pasted content from Office Online\n * Once it is known that the document is from WAC\n * We need to remove the display property and margin from all the list item\n * @param ev ContentModelBeforePasteEvent\n */\nexport function processPastedContentWacComponents(ev: ContentModelBeforePasteEvent) {\n    addParser(ev.domToModelOption, 'segment', wacSubSuperParser);\n    addParser(ev.domToModelOption, 'listItem', wacListItemParser);\n    addParser(ev.domToModelOption, 'listLevel', wacListLevelParser);\n    addParser(ev.domToModelOption, 'container', wacBlockParser);\n\n    setProcessor(ev.domToModelOption, 'element', wacElementProcessor);\n    setProcessor(ev.domToModelOption, 'li', wacLiElementProcessor);\n    setProcessor(ev.domToModelOption, 'ol', wacListProcessor);\n    setProcessor(ev.domToModelOption, 'ul', wacListProcessor);\n    ev.sanitizingOption.additionalAllowedCssClasses.push(...CLASSES_TO_KEEP);\n}\n\n/**\n * List items from word have this format when using List items:\n * @example\n        <div>\n           <ol></ol>\n        </div>\n        <div>\n           <ol></ol>\n        </div>\n        <div>\n           <ol></ol>\n        </div>\n *  Due to this the div between each of the lists we need to restore the list context to use the previous list,\n *  otherwise it could create a new list instead under the same list element\n */\nconst wacListProcessor: ElementProcessor<HTMLOListElement | HTMLUListElement> = (\n    group: ContentModelBlockGroup,\n    element: HTMLOListElement | HTMLUListElement,\n    context: DomToModelContext\n): void => {\n    const lastBlock = group.blocks[group.blocks.length - 1];\n    const isWrappedInContainer = findClosestElementAncestor(\n        element,\n        undefined,\n        `.${LIST_CONTAINER_ELEMENT_CLASS_NAME}`\n    );\n    if (\n        isWrappedInContainer?.previousElementSibling?.classList.contains(\n            LIST_CONTAINER_ELEMENT_CLASS_NAME\n        )\n    ) {\n        if (lastBlock?.blockType === 'BlockGroup' && lastBlock.blockGroupType == 'ListItem') {\n            context.listFormat = {\n                threadItemCounts: [],\n                levels: lastBlock.levels,\n                listParent: group,\n            };\n        }\n    }\n    if (element.tagName.toUpperCase() === 'OL') {\n        context.defaultElementProcessors.ol?.(group, element as HTMLOListElement, context);\n    } else {\n        context.defaultElementProcessors.ul?.(group, element as HTMLUListElement, context);\n    }\n};\n\nconst wacBlockParser: FormatParser<ContentModelBlockFormat> = (\n    format: ContentModelBlockFormat,\n    element: HTMLElement\n) => {\n    if (element.classList.contains(TABLE_CONTAINER) && element.style.marginLeft.startsWith('-')) {\n        delete format.marginLeft;\n    }\n};\n","import addParser from '../utils/addParser';\nimport { chainSanitizerCallback, getStyles } from 'roosterjs-editor-dom';\nimport { moveChildNodes } from 'roosterjs-content-model-dom';\nimport { processWordComments } from './processWordComments';\nimport { processWordList } from './processWordLists';\nimport { setProcessor } from '../utils/setProcessor';\nimport type ContentModelBeforePasteEvent from '../../../../publicTypes/event/ContentModelBeforePasteEvent';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelListItemFormat,\n    ContentModelListItemLevelFormat,\n    DomToModelContext,\n    ElementProcessor,\n    FormatParser,\n} from 'roosterjs-content-model-types';\n\nconst PERCENTAGE_REGEX = /%/;\nconst DEFAULT_BROWSER_LINE_HEIGHT_PERCENTAGE = 120;\n\n/**\n * @internal\n * Handles Pasted content when source is Word Desktop\n * @param ev ContentModelBeforePasteEvent\n */\nexport function processPastedContentFromWordDesktop(ev: ContentModelBeforePasteEvent) {\n    setProcessor(ev.domToModelOption, 'element', wordDesktopElementProcessor);\n    addParser(ev.domToModelOption, 'block', removeNonValidLineHeight);\n    addParser(ev.domToModelOption, 'listLevel', listLevelParser);\n    addParser(ev.domToModelOption, 'listItemElement', listItemElementParser);\n\n    // Remove \"border:none\" for image to fix image resize behavior\n    // We found a problem that when paste an image with \"border:none\" then the resize border will be\n    // displayed incorrectly when resize it. So we need to drop this style\n    chainSanitizerCallback(\n        ev.sanitizingOption.cssStyleCallbacks,\n        'border',\n        (value, element) => element.tagName != 'IMG' || value != 'none'\n    );\n\n    // Preserve <o:p> when its innerHTML is \"&nbsp;\" to avoid dropping an empty line\n    chainSanitizerCallback(ev.sanitizingOption.elementCallbacks, 'O:P', element => {\n        moveChildNodes(element);\n        element.appendChild(element.ownerDocument.createTextNode('\\u00A0')); // &nbsp;\n        return true;\n    });\n}\n\n/**\n * @internal\n * Exported only for unit test\n */\nexport const wordDesktopElementProcessor: ElementProcessor<HTMLElement> = (\n    group,\n    element,\n    context\n) => {\n    const styles = getStyles(element);\n    // Process Word Lists or Word Commands, otherwise use the default processor on this element.\n    if (\n        !(processWordList(styles, group, element, context) || processWordComments(styles, element))\n    ) {\n        context.defaultElementProcessors.element(group, element, context);\n    }\n};\n\nfunction removeNonValidLineHeight(\n    format: ContentModelBlockFormat,\n    element: HTMLElement,\n    context: DomToModelContext,\n    defaultStyle: Readonly<Partial<CSSStyleDeclaration>>\n): void {\n    //If the line height is less than the browser default line height, line between the text is going to be too narrow\n    let parsedLineHeight: number;\n    if (\n        PERCENTAGE_REGEX.test(element.style.lineHeight) &&\n        !isNaN((parsedLineHeight = parseInt(element.style.lineHeight))) &&\n        parsedLineHeight < DEFAULT_BROWSER_LINE_HEIGHT_PERCENTAGE\n    ) {\n        format.lineHeight = defaultStyle.lineHeight;\n    }\n}\n\nfunction listLevelParser(\n    format: ContentModelListItemLevelFormat,\n    element: HTMLElement,\n    context: DomToModelContext,\n    defaultStyle: Readonly<Partial<CSSStyleDeclaration>>\n): void {\n    if (element.style.marginLeft != '') {\n        format.marginLeft = defaultStyle.marginLeft;\n    }\n\n    format.marginBottom = undefined;\n}\n\nconst listItemElementParser: FormatParser<ContentModelListItemFormat> = (\n    format: ContentModelListItemFormat,\n    element: HTMLElement\n): void => {\n    if (element.style.marginLeft) {\n        format.marginLeft = undefined;\n    }\n    if (element.style.marginRight) {\n        format.marginRight = undefined;\n    }\n};\n","import { isElementOfType } from 'roosterjs-content-model-dom';\n\nconst MSO_COMMENT_ANCHOR_HREF_REGEX = /#_msocom_/;\nconst MSO_SPECIAL_CHARACTER = 'mso-special-character';\nconst MSO_SPECIAL_CHARACTER_COMMENT = 'comment';\nconst MSO_ELEMENT = 'mso-element';\nconst MSO_ELEMENT_COMMENT_LIST = 'comment-list';\n\n/**\n * @internal\n * Check whether the element contain Word attributes related to comments and if it does we should no process\n * this element.\n * @returns\n */\nexport function processWordComments(styles: Record<string, string>, element: HTMLElement) {\n    return (\n        styles[MSO_SPECIAL_CHARACTER] == MSO_SPECIAL_CHARACTER_COMMENT ||\n        (isElementOfType(element, 'a') && MSO_COMMENT_ANCHOR_HREF_REGEX.test(element.href)) ||\n        styles[MSO_ELEMENT] == MSO_ELEMENT_COMMENT_LIST\n    );\n}\n","import { getStyles } from 'roosterjs-editor-dom';\nimport {\n    addBlock,\n    createListItem,\n    createListLevel,\n    isNodeOfType,\n    parseFormat,\n} from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelListItemLevelFormat,\n    ContentModelListLevel,\n    DomToModelContext,\n    DomToModelListFormat,\n    FormatParser,\n} from 'roosterjs-content-model-types';\n\n/** Word list metadata style name */\nconst MSO_LIST = 'mso-list';\nconst MSO_LIST_IGNORE = 'ignore';\nconst LOOKUP_DEPTH = 5;\nconst WORD_FIRST_LIST = 'l0';\n\ninterface WordDesktopListFormat extends DomToModelListFormat {\n    wordLevel?: number | '';\n    wordList?: string;\n    wordKnownLevels?: Map<string, ContentModelListLevel[]>;\n}\n\n/**\n * @internal\n * @param styles\n * @param group\n * @param element\n * @param context\n * @returns\n */\nexport function processWordList(\n    styles: Record<string, string>,\n    group: ContentModelBlockGroup,\n    element: HTMLElement,\n    context: DomToModelContext\n) {\n    const listFormat = context.listFormat as WordDesktopListFormat;\n    if (!listFormat.wordKnownLevels) {\n        listFormat.wordKnownLevels = new Map<string, ContentModelListLevel[]>();\n    }\n    const wordListStyle = styles[MSO_LIST] || '';\n\n    // If the element contains Ignore style, do not process it,\n    // Usually this element contains the fake bullet used in Word Desktop.\n    if (wordListStyle.toLowerCase() === MSO_LIST_IGNORE) {\n        return true;\n    }\n\n    const listProps = wordListStyle.split(' ');\n    // Try get the list metadata from word, which follows this format: l1 level1 lfo2\n    // If we are able to get the level property means we can process this element to be a list\n    listFormat.wordLevel = listProps[1] && parseInt(listProps[1].substr('level'.length));\n\n    listFormat.wordList = listProps[0] || WORD_FIRST_LIST;\n    if (listFormat.levels.length == 0) {\n        listFormat.levels = listFormat.wordKnownLevels.get(listFormat.wordList) || [];\n    }\n\n    if (wordListStyle && group && typeof listFormat.wordLevel === 'number') {\n        const { wordLevel } = listFormat;\n        // Retrieve the Fake bullet on the element and also the list type\n        const fakeBullet = getFakeBulletText(element);\n        const listType = getFakeBulletTagName(fakeBullet);\n\n        // Create the new level of the list item and parse the format\n        const newLevel: ContentModelListLevel = createListLevel(listType);\n        parseFormat(element, context.formatParsers.listLevel, newLevel.format, context);\n\n        // If the list format is in a different level, update the array so we get the new item\n        // To be in the same level as the provided level metadata.\n        if (wordLevel > listFormat.levels.length) {\n            while (wordLevel != listFormat.levels.length) {\n                listFormat.levels.push(newLevel);\n            }\n        } else {\n            listFormat.levels.splice(wordLevel, listFormat.levels.length - 1);\n            listFormat.levels[wordLevel - 1] = newLevel;\n        }\n\n        listFormat.listParent = group;\n\n        processAsListItem(listFormat, context, element, group, fakeBullet);\n\n        if (\n            listFormat.levels.length > 0 &&\n            listFormat.wordKnownLevels.get(listFormat.wordList) != listFormat.levels\n        ) {\n            listFormat.wordKnownLevels.set(listFormat.wordList, [...listFormat.levels]);\n        }\n        return true;\n    }\n\n    return false;\n}\n\nfunction processAsListItem(\n    listFormat: WordDesktopListFormat,\n    context: DomToModelContext,\n    element: HTMLElement,\n    group: ContentModelBlockGroup,\n    fakeBullet: string\n) {\n    const listItem = createListItem(listFormat.levels, context.segmentFormat);\n    const lastLevel = listItem.levels[listItem.levels.length - 1];\n\n    parseFormat(element, context.formatParsers.segmentOnBlock, context.segmentFormat, context);\n    parseFormat(element, context.formatParsers.listItemElement, listItem.format, context);\n\n    if (lastLevel?.listType == 'OL') {\n        parseFormat(\n            element,\n            [startNumberOverrideParser(fakeBullet)],\n            listItem.levels[listItem.levels.length - 1].format,\n            context\n        );\n    }\n\n    context.elementProcessors.child(listItem, element, context);\n    addBlock(group, listItem);\n}\n\nfunction startNumberOverrideParser(\n    fakeBullet: string\n): FormatParser<ContentModelListItemLevelFormat> | null {\n    return (format, _, context) => {\n        const {\n            wordKnownLevels,\n            wordLevel,\n            wordList,\n        } = context.listFormat as WordDesktopListFormat;\n        if (typeof wordLevel === 'number' && wordList) {\n            const start = parseInt(fakeBullet);\n            if (start != undefined && !isNaN(start) && !wordKnownLevels?.has(wordList)) {\n                format.startNumberOverride = start;\n            }\n        }\n    };\n}\n\n/**\n * Check whether the string is a fake bullet from word Desktop\n */\nfunction isFakeBullet(fakeBullet: string): boolean {\n    return ['o', '', '', '-'].indexOf(fakeBullet) >= 0;\n}\n\n/** Given a fake bullet text, returns the type of list that should be used for it */\nfunction getFakeBulletTagName(fakeBullet: string): 'UL' | 'OL' {\n    return isFakeBullet(fakeBullet) ? 'UL' : 'OL';\n}\n\n/**\n * Finds the fake bullet text out of the specified node and returns it. For images, it will return\n * a bullet string. If not found, it returns null...\n */\nfunction getFakeBulletText(node: Node, levels?: number): string {\n    // Word uses the following format for their bullets:\n    // &lt;p style=\"mso-list:l1 level1 lfo2\"&gt;\n    // &lt;span style=\"...\"&gt;\n    // &lt;span style=\"mso-list:Ignore\"&gt;1.&lt;span style=\"...\"&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;/span&gt;\n    // &lt;/span&gt;\n    // Content here...\n    // &lt;/p&gt;\n    //\n    // Basically, we need to locate the mso-list:Ignore SPAN, which holds either one text or image node. That\n    // text or image node will be the fake bullet we are looking for\n    let result: string = '';\n    levels = levels || LOOKUP_DEPTH;\n    let child: Node | null = node.firstChild;\n    while (!result && child) {\n        // Check if this is the node that holds the fake bullets (mso-list: Ignore)\n        if (isIgnoreNode(child)) {\n            // Yes... this is the node that holds either the text or image data\n            result = child.textContent?.trim() ?? '';\n\n            // This is the case for image case\n            if (result.length == 0) {\n                result = 'o';\n            }\n        } else if (isNodeOfType(child, 'ELEMENT_NODE') && levels > 1) {\n            // If this is an element and we are not in the last level, try to get the fake bullet\n            // out of the child\n            result = getFakeBulletText(child, levels - 1);\n        }\n\n        child = child.nextSibling;\n    }\n\n    return result;\n}\n/**\n * Checks if the specified node is marked as a mso-list: Ignore. These\n * nodes need to be ignored when a list item is converted into standard\n * HTML lists\n */\nfunction isIgnoreNode(node: Node): boolean {\n    if (isNodeOfType(node, 'ELEMENT_NODE')) {\n        const listAttribute = getStyles(node as HTMLElement)[MSO_LIST];\n        if (\n            listAttribute &&\n            listAttribute.length > 0 &&\n            listAttribute.trim().toLowerCase() == MSO_LIST_IGNORE\n        ) {\n            return true;\n        }\n    }\n\n    return false;\n}\n","import type {\n    ContentModelFormatMap,\n    DomToModelOption,\n    FormatParser,\n    FormatParsersPerCategory,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport default function addParser<TKey extends keyof FormatParsersPerCategory>(\n    domToModelOption: DomToModelOption,\n    entry: TKey,\n    additionalFormatParsers: FormatParser<ContentModelFormatMap[TKey]>\n) {\n    if (!domToModelOption.additionalFormatParsers) {\n        domToModelOption.additionalFormatParsers = {};\n    }\n    if (!domToModelOption.additionalFormatParsers[entry]) {\n        domToModelOption.additionalFormatParsers[entry] = [];\n    }\n\n    domToModelOption.additionalFormatParsers[entry]?.push(additionalFormatParsers);\n}\n","import { BorderKeys, DeprecatedColors } from 'roosterjs-content-model-dom';\nimport type { BorderFormat, FormatParser } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport const deprecatedBorderColorParser: FormatParser<BorderFormat> = (\n    format: BorderFormat\n): void => {\n    BorderKeys.forEach(key => {\n        const value = format[key];\n        let color: string = '';\n        if (\n            value &&\n            DeprecatedColors.some(dColor => value.indexOf(dColor) > -1 && (color = dColor))\n        ) {\n            const newValue = value.replace(color, '').trimRight();\n            format[key] = newValue;\n        }\n    });\n};\n","import { isElementOfType } from 'roosterjs-content-model-dom';\nimport type { ContentModelHyperLinkFormat, FormatParser } from 'roosterjs-content-model-types';\n\nconst SUPPORTED_PROTOCOLS = ['http:', 'https:', 'notes:', 'mailto:', 'onenote:'];\nconst INVALID_LINKS_REGEX = /^file:\\/\\/\\/[a-zA-Z\\/]/i;\n\n/**\n * @internal\n */\nexport const parseLink: FormatParser<ContentModelHyperLinkFormat> = (format, element) => {\n    if (!isElementOfType(element, 'a')) {\n        return;\n    }\n\n    let url: URL | undefined;\n    try {\n        url = new URL(element.href);\n    } catch {\n        url = undefined;\n    }\n\n    if (\n        (url && SUPPORTED_PROTOCOLS.indexOf(url.protocol) === -1) ||\n        INVALID_LINKS_REGEX.test(element.href)\n    ) {\n        element.removeAttribute('href');\n        format.href = '';\n    }\n};\n","import type { DomToModelOption, ElementProcessorMap } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function setProcessor<TKey extends keyof ElementProcessorMap>(\n    domToModelOption: DomToModelOption,\n    entry: TKey,\n    processorOverride: Partial<ElementProcessorMap>[TKey]\n) {\n    if (!domToModelOption.processorOverride) {\n        domToModelOption.processorOverride = {};\n    }\n\n    domToModelOption.processorOverride[entry] = processorOverride;\n}\n","import { createSelectionMarker, createText, isNodeOfType } from 'roosterjs-content-model-dom';\nimport { setSelection } from '../../modelApi/selection/setSelection';\nimport type {\n    ContentModelDocument,\n    ContentModelDomIndexer,\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelSelectionMarker,\n    ContentModelTable,\n    ContentModelTableRow,\n    ContentModelText,\n    DOMSelection,\n    Selectable,\n} from 'roosterjs-content-model-types';\n\ninterface SegmentItem {\n    paragraph: ContentModelParagraph;\n    segments: ContentModelSegment[];\n}\n\ninterface TableItem {\n    tableRows: ContentModelTableRow[];\n}\n\ninterface IndexedSegmentNode extends Node {\n    __roosterjsContentModel: SegmentItem;\n}\n\ninterface IndexedTableElement extends HTMLTableElement {\n    __roosterjsContentModel: TableItem;\n}\n\nfunction isIndexedSegment(node: Node): node is IndexedSegmentNode {\n    const { paragraph, segments } = (node as IndexedSegmentNode).__roosterjsContentModel ?? {};\n\n    return (\n        paragraph &&\n        paragraph.blockType == 'Paragraph' &&\n        Array.isArray(paragraph.segments) &&\n        Array.isArray(segments)\n    );\n}\n\nfunction onSegment(\n    segmentNode: Node,\n    paragraph: ContentModelParagraph,\n    segment: ContentModelSegment[]\n) {\n    const indexedText = segmentNode as IndexedSegmentNode;\n    indexedText.__roosterjsContentModel = {\n        paragraph,\n        segments: segment,\n    };\n}\n\nfunction onParagraph(paragraphElement: HTMLElement) {\n    let previousText: Text | null = null;\n\n    for (let child = paragraphElement.firstChild; child; child = child.nextSibling) {\n        if (isNodeOfType(child, 'TEXT_NODE')) {\n            if (!previousText) {\n                previousText = child;\n            } else {\n                const item = isIndexedSegment(previousText)\n                    ? previousText.__roosterjsContentModel\n                    : undefined;\n\n                if (item && isIndexedSegment(child)) {\n                    item.segments = item.segments.concat(child.__roosterjsContentModel.segments);\n                    child.__roosterjsContentModel.segments = [];\n                }\n            }\n        } else if (isNodeOfType(child, 'ELEMENT_NODE')) {\n            previousText = null;\n\n            onParagraph(child);\n        } else {\n            previousText = null;\n        }\n    }\n}\n\nfunction onTable(tableElement: HTMLTableElement, table: ContentModelTable) {\n    const indexedTable = tableElement as IndexedTableElement;\n    indexedTable.__roosterjsContentModel = { tableRows: table.rows };\n}\n\nfunction reconcileSelection(\n    model: ContentModelDocument,\n    newSelection: DOMSelection,\n    oldSelection?: DOMSelection\n): boolean {\n    if (oldSelection) {\n        if (\n            oldSelection.type == 'range' &&\n            oldSelection.range.collapsed &&\n            isNodeOfType(oldSelection.range.startContainer, 'TEXT_NODE')\n        ) {\n            if (isIndexedSegment(oldSelection.range.startContainer)) {\n                reconcileTextSelection(oldSelection.range.startContainer);\n            }\n        } else {\n            setSelection(model);\n        }\n    }\n\n    switch (newSelection.type) {\n        case 'image':\n        case 'table':\n            // For image and table selection, we just clear the cached model since during selecting the element id might be changed\n            return false;\n\n        case 'range':\n            const newRange = newSelection.range;\n            if (newRange) {\n                const {\n                    startContainer,\n                    startOffset,\n                    endContainer,\n                    endOffset,\n                    collapsed,\n                } = newRange;\n\n                if (collapsed) {\n                    return !!reconcileNodeSelection(startContainer, startOffset);\n                } else if (\n                    startContainer == endContainer &&\n                    isNodeOfType(startContainer, 'TEXT_NODE')\n                ) {\n                    return (\n                        isIndexedSegment(startContainer) &&\n                        !!reconcileTextSelection(startContainer, startOffset, endOffset)\n                    );\n                } else {\n                    const marker1 = reconcileNodeSelection(startContainer, startOffset);\n                    const marker2 = reconcileNodeSelection(endContainer, endOffset);\n\n                    if (marker1 && marker2) {\n                        setSelection(model, marker1, marker2);\n                        return true;\n                    } else {\n                        return false;\n                    }\n                }\n            }\n\n            break;\n    }\n\n    return false;\n}\n\nfunction reconcileNodeSelection(node: Node, offset: number): Selectable | undefined {\n    if (isNodeOfType(node, 'TEXT_NODE')) {\n        return isIndexedSegment(node) ? reconcileTextSelection(node, offset) : undefined;\n    } else if (offset >= node.childNodes.length) {\n        return insertMarker(node.lastChild, true /*isAfter*/);\n    } else {\n        return insertMarker(node.childNodes[offset], false /*isAfter*/);\n    }\n}\n\nfunction insertMarker(node: Node | null, isAfter: boolean): Selectable | undefined {\n    let marker: ContentModelSelectionMarker | undefined;\n\n    if (node && isIndexedSegment(node)) {\n        const { paragraph, segments } = node.__roosterjsContentModel;\n        const index = paragraph.segments.indexOf(segments[0]);\n\n        if (index >= 0) {\n            const formatSegment =\n                (!isAfter && paragraph.segments[index - 1]) || paragraph.segments[index];\n            marker = createSelectionMarker(formatSegment.format);\n\n            paragraph.segments.splice(isAfter ? index + 1 : index, 0, marker);\n        }\n    }\n\n    return marker;\n}\n\nfunction reconcileTextSelection(\n    textNode: IndexedSegmentNode,\n    startOffset?: number,\n    endOffset?: number\n) {\n    const { paragraph, segments } = textNode.__roosterjsContentModel;\n    const first = segments[0];\n    const last = segments[segments.length - 1];\n    let selectable: Selectable | undefined;\n\n    if (first?.segmentType == 'Text' && last?.segmentType == 'Text') {\n        const newSegments: ContentModelSegment[] = [];\n        const txt = textNode.nodeValue || '';\n        const textSegments: ContentModelText[] = [];\n\n        if (startOffset === undefined) {\n            first.text = txt;\n            newSegments.push(first);\n            textSegments.push(first);\n        } else {\n            if (startOffset > 0) {\n                first.text = txt.substring(0, startOffset);\n                newSegments.push(first);\n                textSegments.push(first);\n            }\n\n            if (endOffset === undefined) {\n                const marker = createSelectionMarker(first.format);\n                newSegments.push(marker);\n\n                selectable = marker;\n                endOffset = startOffset;\n            } else if (endOffset > startOffset) {\n                const middle = createText(\n                    txt.substring(startOffset, endOffset),\n                    first.format,\n                    first.link,\n                    first.code\n                );\n\n                middle.isSelected = true;\n                newSegments.push(middle);\n                textSegments.push(middle);\n                selectable = middle;\n            }\n\n            if (endOffset < txt.length) {\n                const newLast = createText(\n                    txt.substring(endOffset),\n                    first.format,\n                    first.link,\n                    first.code\n                );\n                newSegments.push(newLast);\n                textSegments.push(newLast);\n            }\n        }\n\n        let firstIndex = paragraph.segments.indexOf(first);\n        let lastIndex = paragraph.segments.indexOf(last);\n\n        if (firstIndex >= 0 && lastIndex >= 0) {\n            while (\n                firstIndex > 0 &&\n                paragraph.segments[firstIndex - 1].segmentType == 'SelectionMarker'\n            ) {\n                firstIndex--;\n            }\n\n            while (\n                lastIndex < paragraph.segments.length - 1 &&\n                paragraph.segments[lastIndex + 1].segmentType == 'SelectionMarker'\n            ) {\n                lastIndex++;\n            }\n\n            paragraph.segments.splice(firstIndex, lastIndex - firstIndex + 1, ...newSegments);\n        }\n\n        onSegment(textNode, paragraph, textSegments);\n\n        delete paragraph.cachedElement;\n    }\n\n    return selectable;\n}\n\n/**\n * @internal\n * Implementation of ContentModelDomIndexer\n */\nexport const contentModelDomIndexer: ContentModelDomIndexer = {\n    onSegment,\n    onParagraph,\n    onTable,\n    reconcileSelection,\n};\n","import { DeleteResult } from '../../modelApi/edit/utils/DeleteSelectionStep';\nimport { normalizeContentModel } from 'roosterjs-content-model-dom';\nimport { PluginEventType } from 'roosterjs-editor-types';\nimport type { ContentModelDocument } from 'roosterjs-content-model-types';\nimport type { FormatWithContentModelContext } from '../../publicTypes/parameter/FormatWithContentModelContext';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * @internal\n * @return True means content is changed, so need to rewrite content model to editor. Otherwise false\n */\nexport function handleKeyboardEventResult(\n    editor: IContentModelEditor,\n    model: ContentModelDocument,\n    rawEvent: KeyboardEvent,\n    result: DeleteResult,\n    context: FormatWithContentModelContext\n): boolean {\n    context.skipUndoSnapshot = true;\n\n    switch (result) {\n        case DeleteResult.NotDeleted:\n            // We have not delete anything, we will let browser handle this event\n            return false;\n\n        case DeleteResult.NothingToDelete:\n            // We known there is nothing to delete, no need to let browser keep handling the event\n            rawEvent.preventDefault();\n            return false;\n\n        case DeleteResult.Range:\n        case DeleteResult.SingleChar:\n            // We have deleted what we need from content model, no need to let browser keep handling the event\n            rawEvent.preventDefault();\n            normalizeContentModel(model);\n\n            if (result == DeleteResult.Range) {\n                // A range is about to be deleted, so add an undo snapshot immediately\n                context.skipUndoSnapshot = false;\n            }\n\n            // Trigger an event to let plugins know the content is about to be changed by Content Model keyboard editing.\n            // So plugins can do proper handling. e.g. UndoPlugin can decide whether take a snapshot before this change happens.\n            editor.triggerPluginEvent(PluginEventType.BeforeKeyboardEditing, {\n                rawEvent,\n            });\n\n            return true;\n    }\n}\n\n/**\n * @internal\n */\nexport function shouldDeleteWord(rawEvent: KeyboardEvent, isMac: boolean) {\n    return (\n        (isMac && rawEvent.altKey && !rawEvent.metaKey) ||\n        (!isMac && rawEvent.ctrlKey && !rawEvent.altKey)\n    );\n}\n\n/**\n * @internal\n */\nexport function shouldDeleteAllSegmentsBefore(rawEvent: KeyboardEvent) {\n    return rawEvent.metaKey && !rawEvent.altKey;\n}\n","export { ContentModelFormatState } from './publicTypes/format/formatState/ContentModelFormatState';\nexport { ImageFormatState } from './publicTypes/format/formatState/ImageFormatState';\nexport { Border } from './publicTypes/interface/Border';\nexport {\n    CreateEditorContext,\n    ContentModelCoreApiMap,\n    ContentModelEditorCore,\n    CreateContentModel,\n    SetContentModel,\n    GetDOMSelection,\n    SetDOMSelection,\n} from './publicTypes/ContentModelEditorCore';\nexport {\n    default as ContentModelBeforePasteEvent,\n    ContentModelBeforePasteEventData,\n    CompatibleContentModelBeforePasteEvent,\n} from './publicTypes/event/ContentModelBeforePasteEvent';\nexport {\n    default as ContentModelContentChangedEvent,\n    CompatibleContentModelContentChangedEvent,\n    ContentModelContentChangedEventData,\n} from './publicTypes/event/ContentModelContentChangedEvent';\n\nexport { IContentModelEditor, ContentModelEditorOptions } from './publicTypes/IContentModelEditor';\nexport { InsertPoint } from './publicTypes/selection/InsertPoint';\nexport { TableSelectionContext } from './publicTypes/selection/TableSelectionContext';\nexport {\n    DeletedEntity,\n    FormatWithContentModelContext,\n    FormatWithContentModelOptions,\n    ContentModelFormatter,\n} from './publicTypes/parameter/FormatWithContentModelContext';\nexport {\n    InsertEntityOptions,\n    InsertEntityPosition,\n} from './publicTypes/parameter/InsertEntityOptions';\n\nexport { default as insertTable } from './publicApi/table/insertTable';\nexport { default as formatTable } from './publicApi/table/formatTable';\nexport { default as setTableCellShade } from './publicApi/table/setTableCellShade';\nexport { default as editTable } from './publicApi/table/editTable';\nexport { default as toggleBullet } from './publicApi/list/toggleBullet';\nexport { default as toggleNumbering } from './publicApi/list/toggleNumbering';\nexport { default as toggleBold } from './publicApi/segment/toggleBold';\nexport { default as toggleItalic } from './publicApi/segment/toggleItalic';\nexport { default as toggleUnderline } from './publicApi/segment/toggleUnderline';\nexport { default as toggleStrikethrough } from './publicApi/segment/toggleStrikethrough';\nexport { default as toggleSubscript } from './publicApi/segment/toggleSubscript';\nexport { default as toggleSuperscript } from './publicApi/segment/toggleSuperscript';\nexport { default as setBackgroundColor } from './publicApi/segment/setBackgroundColor';\nexport { default as setFontName } from './publicApi/segment/setFontName';\nexport { default as setFontSize } from './publicApi/segment/setFontSize';\nexport { default as setTextColor } from './publicApi/segment/setTextColor';\nexport { default as changeFontSize } from './publicApi/segment/changeFontSize';\nexport { default as applySegmentFormat } from './publicApi/segment/applySegmentFormat';\nexport { default as changeCapitalization } from './publicApi/segment/changeCapitalization';\nexport { default as insertImage } from './publicApi/image/insertImage';\nexport { default as setListStyle } from './publicApi/list/setListStyle';\nexport { default as setListStartNumber } from './publicApi/list/setListStartNumber';\nexport { default as hasSelectionInBlock } from './publicApi/selection/hasSelectionInBlock';\nexport { default as hasSelectionInSegment } from './publicApi/selection/hasSelectionInSegment';\nexport { default as hasSelectionInBlockGroup } from './publicApi/selection/hasSelectionInBlockGroup';\nexport { default as getSelectedSegments } from './publicApi/selection/getSelectedSegments';\nexport { default as setIndentation } from './publicApi/block/setIndentation';\nexport { default as setAlignment } from './publicApi/block/setAlignment';\nexport { default as setDirection } from './publicApi/block/setDirection';\nexport { default as setHeadingLevel } from './publicApi/block/setHeadingLevel';\nexport { default as toggleBlockQuote } from './publicApi/block/toggleBlockQuote';\nexport { default as setSpacing } from './publicApi/block/setSpacing';\nexport { default as setImageBorder } from './publicApi/image/setImageBorder';\nexport { default as setImageBoxShadow } from './publicApi/image/setImageBoxShadow';\nexport { default as changeImage } from './publicApi/image/changeImage';\nexport { default as getFormatState } from './publicApi/format/getFormatState';\nexport { default as applyPendingFormat } from './publicApi/format/applyPendingFormat';\nexport { default as clearFormat } from './publicApi/format/clearFormat';\nexport { default as insertLink } from './publicApi/link/insertLink';\nexport { default as removeLink } from './publicApi/link/removeLink';\nexport { default as adjustLinkSelection } from './publicApi/link/adjustLinkSelection';\nexport { default as setImageAltText } from './publicApi/image/setImageAltText';\nexport { default as adjustImageSelection } from './publicApi/image/adjustImageSelection';\nexport { default as setParagraphMargin } from './publicApi/block/setParagraphMargin';\nexport { default as toggleCode } from './publicApi/segment/toggleCode';\nexport { default as paste } from './publicApi/utils/paste';\nexport { default as insertEntity } from './publicApi/entity/insertEntity';\nexport { formatWithContentModel } from './publicApi/utils/formatWithContentModel';\nexport { default as keyboardDelete } from './publicApi/editing/keyboardDelete';\n\nexport { default as ContentModelEditor } from './editor/ContentModelEditor';\nexport { default as isContentModelEditor } from './editor/isContentModelEditor';\nexport { default as ContentModelPastePlugin } from './editor/plugins/PastePlugin/ContentModelPastePlugin';\n\nexport { default as ContentModelFormatPlugin } from './editor/corePlugins/ContentModelFormatPlugin';\nexport { default as ContentModelEditPlugin } from './editor/corePlugins/ContentModelEditPlugin';\nexport { default as ContentModelTypeInContainerPlugin } from './editor/corePlugins/ContentModelTypeInContainerPlugin';\nexport { default as ContentModelCopyPastePlugin } from './editor/corePlugins/ContentModelCopyPastePlugin';\nexport { default as ContentModelCachePlugin } from './editor/corePlugins/ContentModelCachePlugin';\n\nexport {\n    createContentModelEditorCore,\n    promoteToContentModelEditorCore,\n} from './editor/createContentModelEditorCore';\nexport { combineBorderValue, extractBorderValues } from './domUtils/borderValues';\nexport { updateImageMetadata } from './domUtils/metadata/updateImageMetadata';\nexport { updateTableCellMetadata } from './domUtils/metadata/updateTableCellMetadata';\nexport { updateTableMetadata } from './domUtils/metadata/updateTableMetadata';\n\nexport { ContentModelCachePluginState } from './publicTypes/pluginState/ContentModelCachePluginState';\nexport { ContentModelPluginState } from './publicTypes/pluginState/ContentModelPluginState';\nexport { ContentModelFormatPluginState } from './publicTypes/pluginState/ContentModelFormatPluginState';\n","import { isGeneralSegment } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelParagraph,\n    ContentModelSegment,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport type BlockAndPath = {\n    /**\n     * The sibling block\n     */\n    block: ContentModelBlock;\n\n    /**\n     * Path of this sibling block\n     */\n    path: ContentModelBlockGroup[];\n\n    /**\n     * If the input block is under a general segment, it is possible there are sibling segments under the same paragraph.\n     * Use this property to return the sibling sibling under the same paragraph\n     */\n    siblingSegment?: ContentModelSegment;\n};\n\n/**\n * @internal\n */\nexport function getLeafSiblingBlock(\n    path: ContentModelBlockGroup[],\n    block: ContentModelBlock,\n    isNext: boolean\n): BlockAndPath | null {\n    const newPath = [...path];\n\n    while (newPath.length > 0) {\n        const group = newPath[0];\n        const index = group.blocks.indexOf(block);\n\n        if (index < 0) {\n            break;\n        }\n\n        let nextBlock = group.blocks[index + (isNext ? 1 : -1)];\n\n        if (nextBlock) {\n            while (nextBlock.blockType == 'BlockGroup') {\n                const child = nextBlock.blocks[isNext ? 0 : nextBlock.blocks.length - 1];\n\n                if (!child) {\n                    return { block: nextBlock, path: newPath };\n                } else if (child.blockType != 'BlockGroup') {\n                    newPath.unshift(nextBlock);\n                    return { block: child, path: newPath };\n                } else {\n                    newPath.unshift(nextBlock);\n                    nextBlock = child;\n                }\n            }\n\n            return { block: nextBlock, path: newPath };\n        } else if (isGeneralSegment(group)) {\n            // For general segment, we need to check if there is sibling segment under the same paragraph\n            // First let's find the parent paragraph of this segment\n            newPath.shift();\n\n            let segmentIndex = -1;\n            const segment = group;\n            const para = newPath[0]?.blocks.find(\n                x => x.blockType == 'Paragraph' && (segmentIndex = x.segments.indexOf(segment)) >= 0\n            ) as ContentModelParagraph;\n\n            if (para) {\n                // Now we have found the parent paragraph, so let's check if it has a sibling segment\n                const siblingSegment = para.segments[segmentIndex + (isNext ? 1 : -1)];\n\n                if (siblingSegment) {\n                    // Return this block, path and segment since we have found it\n                    return { block: para, path: newPath, siblingSegment };\n                } else {\n                    // No sibling segment, let's keep go upper level\n                    block = para;\n                }\n            } else {\n                // Parent sibling is not found (in theory this should never happen), just return null\n                break;\n            }\n        } else if (group.blockGroupType != 'Document' && group.blockGroupType != 'TableCell') {\n            newPath.shift();\n            block = group;\n        } else {\n            break;\n        }\n    }\n\n    return null;\n}\n","import { alignTable } from '../table/alignTable';\nimport { getOperationalBlocks } from '../selection/collectSelections';\nimport { TableOperation } from 'roosterjs-editor-types';\nimport type { ContentModelDocument, ContentModelListItem } from 'roosterjs-content-model-types';\n\nconst ResultMap: Record<\n    'left' | 'center' | 'right',\n    Record<'ltr' | 'rtl', 'start' | 'center' | 'end'>\n> = {\n    left: {\n        ltr: 'start',\n        rtl: 'end',\n    },\n    center: {\n        ltr: 'center',\n        rtl: 'center',\n    },\n    right: {\n        ltr: 'end',\n        rtl: 'start',\n    },\n};\n\nconst TableAlignMap: Record<\n    'left' | 'center' | 'right',\n    Record<\n        'ltr' | 'rtl',\n        TableOperation.AlignLeft | TableOperation.AlignCenter | TableOperation.AlignRight\n    >\n> = {\n    left: {\n        ltr: TableOperation.AlignLeft,\n        rtl: TableOperation.AlignRight,\n    },\n    center: {\n        ltr: TableOperation.AlignCenter,\n        rtl: TableOperation.AlignCenter,\n    },\n    right: {\n        ltr: TableOperation.AlignRight,\n        rtl: TableOperation.AlignLeft,\n    },\n};\n\n/**\n * @internal\n */\nexport function setModelAlignment(\n    model: ContentModelDocument,\n    alignment: 'left' | 'center' | 'right'\n) {\n    const paragraphOrListItemOrTable = getOperationalBlocks<ContentModelListItem>(\n        model,\n        ['ListItem'],\n        ['TableCell']\n    );\n\n    paragraphOrListItemOrTable.forEach(({ block }) => {\n        const newAligment = ResultMap[alignment][block.format.direction == 'rtl' ? 'rtl' : 'ltr'];\n        if (block.blockType === 'Table') {\n            alignTable(\n                block,\n                TableAlignMap[alignment][block.format.direction == 'rtl' ? 'rtl' : 'ltr']\n            );\n        } else if (block) {\n            const { format } = block;\n            format.textAlign = newAligment;\n        }\n    });\n\n    return paragraphOrListItemOrTable.length > 0;\n}\n","import { findListItemsInSameThread } from '../list/findListItemsInSameThread';\nimport { getOperationalBlocks } from '../selection/collectSelections';\nimport { isBlockGroupOfType } from '../common/isBlockGroupOfType';\nimport type {\n    ContentModelBlockFormat,\n    ContentModelDocument,\n    ContentModelListItem,\n    MarginFormat,\n    PaddingFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function setModelDirection(model: ContentModelDocument, direction: 'ltr' | 'rtl') {\n    const paragraphOrListItemOrTable = getOperationalBlocks<ContentModelListItem>(\n        model,\n        ['ListItem'],\n        ['TableCell']\n    );\n\n    paragraphOrListItemOrTable.forEach(({ block }) => {\n        if (isBlockGroupOfType<ContentModelListItem>(block, 'ListItem')) {\n            const items = findListItemsInSameThread(model, block);\n\n            items.forEach(item => {\n                item.levels.forEach(level => {\n                    level.format.direction = direction;\n                });\n\n                item.blocks.forEach(block => internalSetDirection(block.format, direction));\n            });\n        } else if (block) {\n            internalSetDirection(block.format, direction);\n        }\n    });\n\n    return paragraphOrListItemOrTable.length > 0;\n}\n\nfunction internalSetDirection(format: ContentModelBlockFormat, direction: 'ltr' | 'rtl') {\n    const wasRtl = format.direction == 'rtl';\n    const isRtl = direction == 'rtl';\n\n    if (wasRtl != isRtl) {\n        format.direction = direction;\n\n        // Adjust margin when change direction\n        // TODO: make margin and padding direction-aware, like what we did for textAlign. So no need to adjust them here\n        // TODO: Do we also need to handle border here?\n        const marginLeft = format.marginLeft;\n        const paddingLeft = format.paddingLeft;\n\n        setProperty(format, 'marginLeft', format.marginRight);\n        setProperty(format, 'marginRight', marginLeft);\n        setProperty(format, 'paddingLeft', format.paddingRight);\n        setProperty(format, 'paddingRight', paddingLeft);\n    }\n}\n\nfunction setProperty(\n    format: MarginFormat & PaddingFormat,\n    key: keyof (MarginFormat & PaddingFormat),\n    value: string | undefined\n) {\n    if (value) {\n        format[key] = value;\n    } else {\n        delete format[key];\n    }\n}\n","import { createListLevel, parseValueWithUnit } from 'roosterjs-content-model-dom';\nimport { getOperationalBlocks } from '../selection/collectSelections';\nimport { isBlockGroupOfType } from '../common/isBlockGroupOfType';\nimport type {\n    ContentModelDocument,\n    ContentModelListItem,\n    ContentModelListLevel,\n} from 'roosterjs-content-model-types';\n\nconst IndentStepInPixel = 40;\n\n/**\n * @internal\n */\nexport function setModelIndentation(\n    model: ContentModelDocument,\n    indentation: 'indent' | 'outdent',\n    length: number = IndentStepInPixel\n) {\n    const paragraphOrListItem = getOperationalBlocks<ContentModelListItem>(\n        model,\n        ['ListItem'],\n        ['TableCell']\n    );\n    const isIndent = indentation == 'indent';\n\n    paragraphOrListItem.forEach(({ block }) => {\n        if (isBlockGroupOfType<ContentModelListItem>(block, 'ListItem')) {\n            if (isIndent) {\n                const lastLevel = block.levels[block.levels.length - 1];\n                const newLevel: ContentModelListLevel = createListLevel(\n                    lastLevel?.listType || 'UL',\n                    lastLevel?.format\n                );\n\n                // New level is totally new, no need to have these attributes for now\n                delete newLevel.format.startNumberOverride;\n\n                block.levels.push(newLevel);\n            } else {\n                block.levels.pop();\n            }\n        } else if (block) {\n            const { format } = block;\n            const { marginLeft, marginRight, direction } = format;\n            const isRtl = direction == 'rtl';\n            const originalValue = parseValueWithUnit(isRtl ? marginRight : marginLeft);\n            let newValue = (isIndent ? Math.ceil : Math.floor)(originalValue / length) * length;\n\n            if (newValue == originalValue) {\n                newValue = Math.max(newValue + length * (isIndent ? 1 : -1), 0);\n            }\n\n            if (isRtl) {\n                format.marginRight = newValue + 'px';\n            } else {\n                format.marginLeft = newValue + 'px';\n            }\n        }\n    });\n\n    return paragraphOrListItem.length > 0;\n}\n","import { areSameFormats, createFormatContainer, unwrapBlock } from 'roosterjs-content-model-dom';\nimport { getOperationalBlocks } from '../selection/collectSelections';\nimport { isBlockGroupOfType } from '../common/isBlockGroupOfType';\nimport { wrapBlockStep1, wrapBlockStep2 } from '../common/wrapBlock';\nimport type { OperationalBlocks } from '../selection/collectSelections';\nimport type { WrapBlockStep1Result } from '../common/wrapBlock';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelFormatContainer,\n    ContentModelFormatContainerFormat,\n    ContentModelListItem,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function toggleModelBlockQuote(\n    model: ContentModelDocument,\n    format: ContentModelFormatContainerFormat\n): boolean {\n    const paragraphOfQuote = getOperationalBlocks<\n        ContentModelFormatContainer | ContentModelListItem\n    >(model, ['FormatContainer', 'ListItem'], ['TableCell'], true /*deepFirst*/);\n\n    if (areAllBlockQuotes(paragraphOfQuote)) {\n        // All selections are already in quote, we need to unquote them\n        paragraphOfQuote.forEach(({ block, parent }) => {\n            unwrapBlock(parent, block);\n        });\n    } else {\n        const step1Results: WrapBlockStep1Result<ContentModelFormatContainer>[] = [];\n        const creator = () => createFormatContainer('blockquote', format);\n        const canMerge = (\n            target: ContentModelBlock,\n            current?: ContentModelFormatContainer\n        ): target is ContentModelFormatContainer =>\n            canMergeQuote(target, current?.format || format);\n\n        paragraphOfQuote.forEach(({ block, parent }) => {\n            if (isQuote(block)) {\n                // Already in quote, no op\n            } else {\n                wrapBlockStep1(step1Results, parent, block, creator, canMerge);\n            }\n        });\n\n        wrapBlockStep2(step1Results, canMerge);\n    }\n\n    return paragraphOfQuote.length > 0;\n}\n\nfunction canMergeQuote(\n    target: ContentModelBlock,\n    format: ContentModelFormatContainerFormat\n): target is ContentModelFormatContainer {\n    return isQuote(target) && areSameFormats(format, target.format);\n}\n\nfunction isQuote(block: ContentModelBlock): block is ContentModelFormatContainer {\n    return (\n        isBlockGroupOfType<ContentModelFormatContainer>(block, 'FormatContainer') &&\n        block.tagName == 'blockquote'\n    );\n}\n\nfunction areAllBlockQuotes(\n    blockAndParents: OperationalBlocks<ContentModelFormatContainer | ContentModelListItem>[]\n): blockAndParents is { block: ContentModelFormatContainer; parent: ContentModelBlockGroup }[] {\n    return blockAndParents.every(blockAndParent => isQuote(blockAndParent.block));\n}\n","import { adjustWordSelection } from '../selection/adjustWordSelection';\nimport { applyTableFormat } from '../table/applyTableFormat';\nimport { createFormatContainer } from 'roosterjs-content-model-dom';\nimport { getClosestAncestorBlockGroupIndex } from './getClosestAncestorBlockGroupIndex';\nimport { iterateSelections } from '../selection/iterateSelections';\nimport { updateTableCellMetadata } from '../../domUtils/metadata/updateTableCellMetadata';\nimport { updateTableMetadata } from '../../domUtils/metadata/updateTableMetadata';\nimport type { TableSelectionContext } from '../../publicTypes/selection/TableSelectionContext';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelFormatContainer,\n    ContentModelListItem,\n    ContentModelSegment,\n    ContentModelSegmentFormat,\n    ContentModelTable,\n    Selectable,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function clearModelFormat(\n    model: ContentModelDocument,\n    blocksToClear: [ContentModelBlockGroup[], ContentModelBlock][],\n    segmentsToClear: ContentModelSegment[],\n    tablesToClear: [ContentModelTable, boolean][]\n) {\n    iterateSelections(\n        [model],\n        (path, tableContext, block, segments) => {\n            if (segments) {\n                segmentsToClear.push(...segments);\n            }\n\n            if (block) {\n                blocksToClear.push([path, block]);\n            } else if (tableContext) {\n                clearTableCellFormat(tableContext, tablesToClear);\n            }\n        },\n        {\n            // When there is a default format to apply, we know how to handle segment format under list.\n            // So no need to clear format of list number.\n            // Otherwise, we will clear all format of selected text. And since they are under LI tag, we\n            // also need to clear the format of LI (format holder) so that the format is really cleared\n            includeListFormatHolder: model.format ? 'never' : 'anySegment',\n        }\n    );\n\n    const marker = segmentsToClear[0];\n\n    // 2. If selection is collapsed, add selection to whole word to clear if any\n    if (\n        blocksToClear.length == 1 &&\n        isOnlySelectionMarkerSelected(blocksToClear[0][1]) &&\n        blocksToClear.length == 1\n    ) {\n        segmentsToClear.splice(0, segmentsToClear.length, ...adjustWordSelection(model, marker));\n        clearListFormat(blocksToClear[0][0]);\n    } else if (blocksToClear.length > 1 || blocksToClear.some(x => isWholeBlockSelected(x[1]))) {\n        // 2. If a full block or multiple blocks are selected, clear block format\n        for (let i = blocksToClear.length - 1; i >= 0; i--) {\n            const [path, block] = blocksToClear[i];\n\n            clearBlockFormat(path, block);\n            clearListFormat(path);\n            clearContainerFormat(path, block);\n        }\n    }\n\n    // 3. Finally clear format for segments\n    clearSegmentsFormat(segmentsToClear, model.format);\n\n    // 4. Clear format for table if any\n    createTablesFormat(tablesToClear);\n}\n\nfunction createTablesFormat(tablesToClear: [ContentModelTable, boolean][]) {\n    tablesToClear.forEach(x => {\n        const [table, isWholeTableSelected] = x;\n        if (isWholeTableSelected) {\n            table.format = {\n                useBorderBox: table.format.useBorderBox,\n                borderCollapse: table.format.borderCollapse,\n            };\n            updateTableMetadata(table, () => null);\n        }\n\n        applyTableFormat(table, undefined /*newFormat*/, true);\n    });\n}\n\nfunction clearSegmentsFormat(\n    segmentsToClear: ContentModelSegment[],\n    defaultSegmentFormat: ContentModelSegmentFormat | undefined\n) {\n    segmentsToClear.forEach(x => {\n        x.format = { ...(defaultSegmentFormat || {}) };\n\n        if (x.link) {\n            delete x.link.format.textColor;\n        }\n\n        delete x.code;\n    });\n}\n\nfunction clearTableCellFormat(\n    tableContext: TableSelectionContext | undefined,\n    tablesToClear: [ContentModelTable, boolean][]\n) {\n    if (tableContext) {\n        const { table, colIndex, rowIndex, isWholeTableSelected } = tableContext;\n        const cell = table.rows[rowIndex].cells[colIndex];\n\n        if (cell.isSelected) {\n            updateTableCellMetadata(cell, () => null);\n            cell.isHeader = false;\n            cell.format = {\n                useBorderBox: cell.format.useBorderBox,\n            };\n        }\n\n        if (!tablesToClear.find(x => x[0] == table)) {\n            tablesToClear.push([table, isWholeTableSelected]);\n        }\n    }\n}\n\nfunction clearContainerFormat(path: ContentModelBlockGroup[], block: ContentModelBlock) {\n    const containerPathIndex = getClosestAncestorBlockGroupIndex(\n        path,\n        ['FormatContainer'],\n        ['TableCell']\n    );\n\n    if (containerPathIndex >= 0 && containerPathIndex < path.length - 1) {\n        const container = path[containerPathIndex] as ContentModelFormatContainer;\n        const containerIndex = path[containerPathIndex + 1].blocks.indexOf(container);\n        const blockIndex = container.blocks.indexOf(block);\n\n        if (blockIndex >= 0 && containerIndex >= 0) {\n            const newContainer = createFormatContainer(container.tagName, container.format);\n\n            container.blocks.splice(blockIndex, 1);\n            newContainer.blocks = container.blocks.splice(blockIndex);\n\n            path[containerPathIndex + 1].blocks.splice(containerIndex + 1, 0, block, newContainer);\n        }\n    }\n}\n\nfunction clearListFormat(path: ContentModelBlockGroup[]) {\n    const listItem = path[getClosestAncestorBlockGroupIndex(path, ['ListItem'], ['TableCell'])] as\n        | ContentModelListItem\n        | undefined;\n\n    if (listItem) {\n        listItem.levels = [];\n    }\n}\n\nfunction clearBlockFormat(path: ContentModelBlockGroup[], block: ContentModelBlock) {\n    if (block.blockType == 'Divider') {\n        const index = path[0].blocks.indexOf(block);\n\n        if (index >= 0) {\n            path[0].blocks.splice(index, 1);\n        }\n    } else if (block.blockType == 'Paragraph') {\n        block.format = {};\n        delete block.decorator;\n    }\n}\n\nfunction isOnlySelectionMarkerSelected(block: ContentModelBlock) {\n    const segments = block.blockType == 'Paragraph' ? block.segments.filter(x => x.isSelected) : [];\n\n    return segments.length == 1 && segments[0].segmentType == 'SelectionMarker';\n}\n\nfunction isWholeBlockSelected(block: ContentModelBlock) {\n    return (\n        (block as Selectable).isSelected ||\n        (block.blockType == 'Paragraph' && block.segments.every(x => x.isSelected))\n    );\n}\n","import type {\n    ContentModelBlock,\n    ContentModelBlockBase,\n    ContentModelBlockGroupBase,\n    ContentModelBlockGroupType,\n    ContentModelBlockType,\n    ContentModelDivider,\n    ContentModelDocument,\n    ContentModelEntity,\n    ContentModelFormatBase,\n    ContentModelFormatContainer,\n    ContentModelGeneralBlock,\n    ContentModelImage,\n    ContentModelListItem,\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelSegmentBase,\n    ContentModelSegmentType,\n    ContentModelSelectionMarker,\n    ContentModelTable,\n    ContentModelTableCell,\n    ContentModelWithDataset,\n    ContentModelWithFormat,\n    ContentModelGeneralSegment,\n    ContentModelText,\n    ContentModelTableRow,\n    ContentModelListLevel,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport type CachedElementHandler = (\n    node: HTMLElement,\n    type: 'general' | 'entity' | 'cache'\n) => HTMLElement | undefined;\n\n/**\n * @internal\n * Options for cloneModel API\n */\nexport interface CloneModelOptions {\n    /**\n     * Specify how to deal with cached element, including cached block element, element in General Model, and wrapper element in Entity\n     * - True: Cloned model will have the same reference to the cached element\n     * - False/Not passed: For cached block element, cached element will be undefined. For General Model and Entity, the element will have deep clone and assign to the cloned model\n     * - A callback: invoke the callback with the source cached element and a string to specify model type, let the callback return the expected value of cached element.\n     * For General Model and Entity, the callback must return a valid element, otherwise there will be exception thrown.\n     */\n    includeCachedElement?: boolean | CachedElementHandler;\n}\n\n/**\n * @internal\n */\nexport function cloneModel(\n    model: ContentModelDocument,\n    options?: CloneModelOptions\n): ContentModelDocument {\n    const newModel: ContentModelDocument = cloneBlockGroupBase(model, options || {});\n\n    if (model.format) {\n        newModel.format = Object.assign({}, model.format);\n    }\n\n    return newModel;\n}\n\nfunction cloneBlock(block: ContentModelBlock, options: CloneModelOptions): ContentModelBlock {\n    switch (block.blockType) {\n        case 'BlockGroup':\n            switch (block.blockGroupType) {\n                case 'FormatContainer':\n                    return cloneFormatContainer(block, options);\n                case 'General':\n                    return cloneGeneralBlock(block, options);\n                case 'ListItem':\n                    return cloneListItem(block, options);\n            }\n            break;\n        case 'Divider':\n            return cloneDivider(block, options);\n        case 'Entity':\n            return cloneEntity(block, options);\n        case 'Paragraph':\n            return cloneParagraph(block, options);\n        case 'Table':\n            return cloneTable(block, options);\n    }\n}\n\nfunction cloneSegment(\n    segment: ContentModelSegment,\n    options: CloneModelOptions\n): ContentModelSegment {\n    switch (segment.segmentType) {\n        case 'Br':\n            return cloneSegmentBase(segment);\n        case 'Entity':\n            return cloneEntity(segment, options);\n        case 'General':\n            return cloneGeneralSegment(segment, options);\n        case 'Image':\n            return cloneImage(segment);\n        case 'SelectionMarker':\n            return cloneSelectionMarker(segment);\n        case 'Text':\n            return cloneText(segment);\n    }\n}\n\nfunction cloneModelWithFormat<T extends ContentModelFormatBase>(\n    model: ContentModelWithFormat<T>\n): ContentModelWithFormat<T> {\n    return {\n        format: Object.assign({}, model.format),\n    };\n}\n\nfunction cloneModelWithDataset<T>(model: ContentModelWithDataset<T>): ContentModelWithDataset<T> {\n    return {\n        dataset: Object.assign({}, model.dataset),\n    };\n}\n\nfunction cloneBlockBase<T extends ContentModelBlockType>(\n    block: ContentModelBlockBase<T>\n): ContentModelBlockBase<T> {\n    const { blockType } = block;\n\n    return Object.assign(\n        {\n            blockType,\n        },\n        cloneModelWithFormat(block)\n    );\n}\n\nfunction cloneBlockGroupBase<T extends ContentModelBlockGroupType>(\n    group: ContentModelBlockGroupBase<T>,\n    options: CloneModelOptions\n): ContentModelBlockGroupBase<T> {\n    const { blockGroupType, blocks } = group;\n\n    return {\n        blockGroupType: blockGroupType,\n        blocks: blocks.map(block => cloneBlock(block, options)),\n    };\n}\n\nfunction cloneSegmentBase<T extends ContentModelSegmentType>(\n    segment: ContentModelSegmentBase<T>\n): ContentModelSegmentBase<T> {\n    const { segmentType, isSelected, code, link } = segment;\n\n    const newSegment: ContentModelSegmentBase<T> = Object.assign(\n        {\n            segmentType,\n            isSelected,\n        },\n        cloneModelWithFormat(segment)\n    );\n\n    if (code) {\n        newSegment.code = cloneModelWithFormat(code);\n    }\n    if (link) {\n        newSegment.link = Object.assign(cloneModelWithFormat(link), cloneModelWithDataset(link));\n    }\n\n    return newSegment;\n}\n\nfunction cloneEntity(entity: ContentModelEntity, options: CloneModelOptions): ContentModelEntity {\n    const { wrapper, entityFormat } = entity;\n\n    return Object.assign(\n        {\n            wrapper: handleCachedElement(wrapper, 'entity', options),\n            entityFormat: { ...entityFormat },\n        },\n        cloneBlockBase(entity),\n        cloneSegmentBase(entity)\n    );\n}\n\nfunction cloneParagraph(\n    paragraph: ContentModelParagraph,\n    options: CloneModelOptions\n): ContentModelParagraph {\n    const { cachedElement, segments, isImplicit, decorator, segmentFormat } = paragraph;\n\n    const newParagraph: ContentModelParagraph = Object.assign(\n        {\n            cachedElement: handleCachedElement(cachedElement, 'cache', options),\n            isImplicit,\n            segments: segments.map(segment => cloneSegment(segment, options)),\n            segmentFormat: segmentFormat ? { ...segmentFormat } : undefined,\n        },\n        cloneBlockBase(paragraph),\n        cloneModelWithFormat(paragraph)\n    );\n\n    if (decorator) {\n        newParagraph.decorator = Object.assign(\n            {\n                tagName: decorator.tagName,\n            },\n            cloneModelWithFormat(decorator)\n        );\n    }\n\n    return newParagraph;\n}\n\nfunction cloneTable(table: ContentModelTable, options: CloneModelOptions): ContentModelTable {\n    const { cachedElement, widths, rows } = table;\n\n    return Object.assign(\n        {\n            cachedElement: handleCachedElement(cachedElement, 'cache', options),\n            widths: Array.from(widths),\n            rows: rows.map(row => cloneTableRow(row, options)),\n        },\n        cloneBlockBase(table),\n        cloneModelWithDataset(table)\n    );\n}\n\nfunction cloneTableRow(\n    row: ContentModelTableRow,\n    options: CloneModelOptions\n): ContentModelTableRow {\n    const { height, cells, cachedElement } = row;\n\n    return Object.assign(\n        {\n            height,\n            cachedElement: handleCachedElement(cachedElement, 'cache', options),\n            cells: cells.map(cell => cloneTableCell(cell, options)),\n        },\n        cloneModelWithFormat(row)\n    );\n}\n\nfunction cloneTableCell(\n    cell: ContentModelTableCell,\n    options: CloneModelOptions\n): ContentModelTableCell {\n    const { cachedElement, isSelected, spanAbove, spanLeft, isHeader } = cell;\n\n    return Object.assign(\n        {\n            cachedElement: handleCachedElement(cachedElement, 'cache', options),\n            isSelected,\n            spanAbove,\n            spanLeft,\n            isHeader,\n        },\n        cloneBlockGroupBase(cell, options),\n        cloneModelWithFormat(cell),\n        cloneModelWithDataset(cell)\n    );\n}\n\nfunction cloneFormatContainer(\n    container: ContentModelFormatContainer,\n    options: CloneModelOptions\n): ContentModelFormatContainer {\n    const { tagName, cachedElement } = container;\n    const newContainer: ContentModelFormatContainer = Object.assign(\n        { tagName, cachedElement: handleCachedElement(cachedElement, 'cache', options) },\n        cloneBlockBase(container),\n        cloneBlockGroupBase(container, options)\n    );\n\n    if (container.zeroFontSize) {\n        newContainer.zeroFontSize = true;\n    }\n\n    return newContainer;\n}\n\nfunction cloneListItem(\n    item: ContentModelListItem,\n    options: CloneModelOptions\n): ContentModelListItem {\n    const { formatHolder, levels } = item;\n\n    return Object.assign(\n        {\n            formatHolder: cloneSelectionMarker(formatHolder),\n            levels: levels.map(cloneListLevel),\n        },\n        cloneBlockBase(item),\n        cloneBlockGroupBase(item, options)\n    );\n}\n\nfunction cloneListLevel(level: ContentModelListLevel): ContentModelListLevel {\n    const { listType } = level;\n\n    return Object.assign({ listType }, cloneModelWithFormat(level), cloneModelWithDataset(level));\n}\nfunction cloneDivider(\n    divider: ContentModelDivider,\n    options: CloneModelOptions\n): ContentModelDivider {\n    const { tagName, isSelected, cachedElement } = divider;\n\n    return Object.assign(\n        {\n            isSelected,\n            tagName,\n            cachedElement: handleCachedElement(cachedElement, 'cache', options),\n        },\n        cloneBlockBase(divider)\n    );\n}\n\nfunction cloneGeneralBlock(\n    general: ContentModelGeneralBlock,\n    options: CloneModelOptions\n): ContentModelGeneralBlock {\n    const { element } = general;\n\n    return Object.assign(\n        {\n            element: handleCachedElement(element, 'general', options),\n        },\n        cloneBlockBase(general),\n        cloneBlockGroupBase(general, options)\n    );\n}\n\nfunction cloneSelectionMarker(marker: ContentModelSelectionMarker): ContentModelSelectionMarker {\n    return Object.assign({ isSelected: marker.isSelected }, cloneSegmentBase(marker));\n}\n\nfunction cloneImage(image: ContentModelImage): ContentModelImage {\n    const { src, alt, title, isSelectedAsImageSelection } = image;\n\n    return Object.assign(\n        { src, alt, title, isSelectedAsImageSelection },\n        cloneSegmentBase(image),\n        cloneModelWithDataset(image)\n    );\n}\n\nfunction cloneGeneralSegment(\n    general: ContentModelGeneralSegment,\n    options: CloneModelOptions\n): ContentModelGeneralSegment {\n    return Object.assign(cloneGeneralBlock(general, options), cloneSegmentBase(general));\n}\n\nfunction cloneText(textSegment: ContentModelText): ContentModelText {\n    const { text } = textSegment;\n    return Object.assign({ text }, cloneSegmentBase(textSegment));\n}\n\nfunction handleCachedElement<T extends HTMLElement>(\n    node: T,\n    type: 'general' | 'entity',\n    options: CloneModelOptions\n): T;\n\nfunction handleCachedElement<T extends HTMLElement>(\n    node: T | undefined,\n    type: 'cache',\n    options: CloneModelOptions\n): T | undefined;\n\nfunction handleCachedElement<T extends HTMLElement>(\n    node: T | undefined,\n    type: 'general' | 'entity' | 'cache',\n    options: CloneModelOptions\n): T | undefined {\n    const { includeCachedElement } = options;\n\n    if (!node) {\n        return undefined;\n    } else if (!includeCachedElement) {\n        return type == 'cache' ? undefined : (node.cloneNode(true /*deep*/) as T);\n    } else if (includeCachedElement === true) {\n        return node;\n    } else {\n        const result = includeCachedElement(node, type) as T | undefined;\n\n        if ((type == 'general' || type == 'entity') && !result) {\n            throw new Error('Entity and General Model must has wrapper element');\n        }\n\n        return result;\n    }\n}\n","import type {\n    ContentModelBlockGroup,\n    ContentModelBlockGroupBase,\n    ContentModelBlockGroupType,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport type TypeOfBlockGroup<\n    T extends ContentModelBlockGroup\n> = T extends ContentModelBlockGroupBase<infer U> ? U : never;\n\n/**\n * @internal\n */\nexport function getClosestAncestorBlockGroupIndex<T extends ContentModelBlockGroup>(\n    path: ContentModelBlockGroup[],\n    blockGroupTypes: TypeOfBlockGroup<T>[],\n    stopTypes: ContentModelBlockGroupType[] = []\n): number {\n    for (let i = 0; i < path.length; i++) {\n        const group = path[i];\n\n        if ((blockGroupTypes as string[]).indexOf(group.blockGroupType) >= 0) {\n            return i;\n        } else if (stopTypes.indexOf(group.blockGroupType) >= 0) {\n            // Do not go across boundary specified by stopTypes.\n            // For example, in most case we will set table as the boundary,\n            // in order to allow modify list item under a table when the table itself is in another list item\n            // Although this is not very likely to happen in most case, but we still need to handle it\n            return -1;\n        }\n    }\n\n    return -1;\n}\n","import type { ContentModelBlock, ContentModelBlockGroup } from 'roosterjs-content-model-types';\nimport type { TypeOfBlockGroup } from './getClosestAncestorBlockGroupIndex';\n\n/**\n * @internal\n */\nexport function isBlockGroupOfType<T extends ContentModelBlockGroup>(\n    input: ContentModelBlock | ContentModelBlockGroup | null | undefined,\n    type: TypeOfBlockGroup<T>\n): input is T {\n    const item = <T | null | undefined>input;\n\n    return item?.blockGroupType == type;\n}\n","import { applyTableFormat } from '../table/applyTableFormat';\nimport { deleteSelection } from '../edit/deleteSelection';\nimport { getClosestAncestorBlockGroupIndex } from './getClosestAncestorBlockGroupIndex';\nimport { normalizeTable } from '../table/normalizeTable';\nimport {\n    addSegment,\n    createListItem,\n    createParagraph,\n    createSelectionMarker,\n    createTableCell,\n    getObjectKeys,\n    normalizeContentModel,\n} from 'roosterjs-content-model-dom';\nimport type { FormatWithContentModelContext } from '../../publicTypes/parameter/FormatWithContentModelContext';\nimport type { InsertPoint } from '../../publicTypes/selection/InsertPoint';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockFormat,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelListItem,\n    ContentModelParagraph,\n    ContentModelSegmentFormat,\n    ContentModelTable,\n} from 'roosterjs-content-model-types';\n\nconst HeadingTags = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n\n/**\n * @internal\n * Options to specify how to merge models\n */\nexport interface MergeModelOption {\n    /**\n     * When there is only a table to merge, whether merge this table into current table (if any), or just directly insert (nested table).\n     * This is usually used when paste table inside a table\n     * @default false\n     */\n    mergeTable?: boolean;\n\n    /**\n     * Use this insert position to merge instead of querying selection from target model\n     * @default undefined\n     */\n    insertPosition?: InsertPoint;\n\n    /**\n     * Use this to decide whether to change the source model format when doing the merge.\n     * 'mergeAll': segment format of the insert position will be merged into the content that is merged into current model.\n     * If the source model already has some format, it will not be overwritten.\n     * 'keepSourceEmphasisFormat': format of the insert position will be set into the content that is merged into current model.\n     * If the source model already has emphasis format, such as, fontWeight, Italic or underline different than the default style, it will not be overwritten.\n     * 'none' the source segment format will not be modified.\n     * @default undefined\n     */\n    mergeFormat?: 'mergeAll' | 'keepSourceEmphasisFormat' | 'none';\n}\n\n/**\n * @internal\n */\nexport function mergeModel(\n    target: ContentModelDocument,\n    source: ContentModelDocument,\n    context?: FormatWithContentModelContext,\n    options?: MergeModelOption\n) {\n    const insertPosition =\n        options?.insertPosition ?? deleteSelection(target, [], context).insertPoint;\n\n    if (insertPosition) {\n        if (options?.mergeFormat && options.mergeFormat != 'none') {\n            const newFormat: ContentModelSegmentFormat = {\n                ...(target.format || {}),\n                ...insertPosition.marker.format,\n            };\n\n            applyDefaultFormat(source, newFormat, options?.mergeFormat);\n        }\n\n        for (let i = 0; i < source.blocks.length; i++) {\n            const block = source.blocks[i];\n\n            switch (block.blockType) {\n                case 'Paragraph':\n                    mergeParagraph(insertPosition, block, i == 0, context, options);\n                    break;\n\n                case 'Divider':\n                    insertBlock(insertPosition, block);\n                    break;\n\n                case 'Entity':\n                    insertBlock(insertPosition, block);\n                    context?.newEntities.push(block);\n                    break;\n\n                case 'Table':\n                    if (source.blocks.length == 1 && options?.mergeTable) {\n                        mergeTable(insertPosition, block, source);\n                    } else {\n                        insertBlock(insertPosition, block);\n                    }\n                    break;\n\n                case 'BlockGroup':\n                    switch (block.blockGroupType) {\n                        case 'General':\n                        case 'FormatContainer':\n                            insertBlock(insertPosition, block);\n                            break;\n                        case 'ListItem':\n                            mergeList(insertPosition, block);\n                            break;\n                    }\n                    break;\n            }\n        }\n    }\n\n    normalizeContentModel(target);\n}\n\nfunction mergeParagraph(\n    markerPosition: InsertPoint,\n    newPara: ContentModelParagraph,\n    mergeToCurrentParagraph: boolean,\n    context?: FormatWithContentModelContext,\n    option?: MergeModelOption\n) {\n    const { paragraph, marker } = markerPosition;\n    const newParagraph = mergeToCurrentParagraph\n        ? paragraph\n        : splitParagraph(markerPosition, newPara.format);\n    const segmentIndex = newParagraph.segments.indexOf(marker);\n\n    if (option?.mergeFormat == 'none' && mergeToCurrentParagraph) {\n        newParagraph.segments.forEach(segment => {\n            segment.format = { ...(newParagraph.segmentFormat || {}), ...segment.format };\n        });\n        delete newParagraph.segmentFormat;\n    }\n    if (segmentIndex >= 0) {\n        for (let i = 0; i < newPara.segments.length; i++) {\n            const segment = newPara.segments[i];\n\n            newParagraph.segments.splice(segmentIndex + i, 0, segment);\n\n            if (context) {\n                if (segment.segmentType == 'Entity') {\n                    context.newEntities.push(segment);\n                }\n\n                if (segment.segmentType == 'Image') {\n                    context.newImages.push(segment);\n                }\n            }\n        }\n    }\n\n    if (newPara.decorator) {\n        newParagraph.decorator = { ...newPara.decorator };\n        if (HeadingTags.indexOf(newParagraph.decorator.tagName) > -1) {\n            const sourceKeys: (keyof ContentModelSegmentFormat)[] = getObjectKeys(\n                newParagraph.decorator.format\n            );\n            const segmentDecoratorKeys: (keyof ContentModelSegmentFormat)[] = getObjectKeys(\n                newParagraph.segmentFormat || {}\n            );\n\n            sourceKeys.forEach(key => {\n                if (segmentDecoratorKeys.indexOf(key) > -1) {\n                    delete newParagraph.segmentFormat?.[key];\n                }\n            });\n        }\n    }\n\n    if (!mergeToCurrentParagraph) {\n        newParagraph.format = newPara.format;\n    }\n}\n\nfunction mergeTable(\n    markerPosition: InsertPoint,\n    newTable: ContentModelTable,\n    source: ContentModelDocument\n) {\n    const { tableContext } = markerPosition;\n\n    if (tableContext && source.blocks.length == 1 && source.blocks[0] == newTable) {\n        const { table, colIndex, rowIndex } = tableContext;\n        for (let i = 0; i < newTable.rows.length; i++) {\n            for (let j = 0; j < newTable.rows[i].cells.length; j++) {\n                const newCell = newTable.rows[i].cells[j];\n\n                if (i == 0 && colIndex + j >= table.rows[0].cells.length) {\n                    for (let k = 0; k < table.rows.length; k++) {\n                        const leftCell = table.rows[k]?.cells[colIndex + j - 1];\n                        table.rows[k].cells[colIndex + j] = createTableCell(\n                            false /*spanLeft*/,\n                            false /*spanAbove*/,\n                            leftCell?.isHeader,\n                            leftCell?.format\n                        );\n                    }\n                }\n\n                if (j == 0 && rowIndex + i >= table.rows.length) {\n                    if (!table.rows[rowIndex + i]) {\n                        table.rows[rowIndex + i] = {\n                            cells: [],\n                            format: {},\n                            height: 0,\n                        };\n                    }\n\n                    for (let k = 0; k < table.rows[rowIndex].cells.length; k++) {\n                        const aboveCell = table.rows[rowIndex + i - 1]?.cells[k];\n                        table.rows[rowIndex + i].cells[k] = createTableCell(\n                            false /*spanLeft*/,\n                            false /*spanAbove*/,\n                            false /*isHeader*/,\n                            aboveCell?.format\n                        );\n                    }\n                }\n\n                table.rows[rowIndex + i].cells[colIndex + j] = newCell;\n\n                if (i == 0 && j == 0) {\n                    addSegment(newCell, createSelectionMarker());\n                }\n            }\n        }\n\n        normalizeTable(table, markerPosition.marker.format);\n        applyTableFormat(table, undefined /*newFormat*/, true /*keepCellShade*/);\n    } else {\n        insertBlock(markerPosition, newTable);\n    }\n}\n\nfunction mergeList(markerPosition: InsertPoint, newList: ContentModelListItem) {\n    splitParagraph(markerPosition, newList.format);\n\n    const { path, paragraph } = markerPosition;\n\n    const listItemIndex = getClosestAncestorBlockGroupIndex(path, ['ListItem']);\n    const listItem = path[listItemIndex] as ContentModelListItem;\n    const listParent = path[listItemIndex + 1]; // It is ok here when index is -1, that means there is no list and we just insert a new paragraph and use path[0] as its parent\n    const blockIndex = listParent.blocks.indexOf(listItem || paragraph);\n\n    if (blockIndex >= 0) {\n        listParent.blocks.splice(blockIndex, 0, newList);\n    }\n\n    if (listItem) {\n        listItem?.levels.forEach((level, i) => {\n            newList.levels[i] = { ...level };\n        });\n    }\n}\n\nfunction splitParagraph(markerPosition: InsertPoint, newParaFormat: ContentModelBlockFormat) {\n    const { paragraph, marker, path } = markerPosition;\n    const segmentIndex = paragraph.segments.indexOf(marker);\n    const paraIndex = path[0].blocks.indexOf(paragraph);\n    const newParagraph = createParagraph(\n        false /*isImplicit*/,\n        { ...paragraph.format, ...newParaFormat },\n        paragraph.segmentFormat\n    );\n\n    if (segmentIndex >= 0) {\n        newParagraph.segments = paragraph.segments.splice(segmentIndex);\n    }\n\n    if (paraIndex >= 0) {\n        path[0].blocks.splice(paraIndex + 1, 0, newParagraph);\n    }\n\n    const listItemIndex = getClosestAncestorBlockGroupIndex(\n        path,\n        ['ListItem'],\n        ['FormatContainer', 'TableCell']\n    );\n    const listItem = path[listItemIndex] as ContentModelListItem;\n\n    if (listItem) {\n        const listParent = listItemIndex >= 0 ? path[listItemIndex + 1] : null;\n        const blockIndex = listParent ? listParent.blocks.indexOf(listItem) : -1;\n\n        if (blockIndex >= 0 && listParent) {\n            const newListItem = createListItem(listItem.levels, listItem.formatHolder.format);\n\n            if (paraIndex >= 0) {\n                newListItem.blocks = listItem.blocks.splice(paraIndex + 1);\n            }\n\n            if (blockIndex >= 0) {\n                listParent.blocks.splice(blockIndex + 1, 0, newListItem);\n            }\n\n            path[listItemIndex] = newListItem;\n        }\n    }\n\n    markerPosition.paragraph = newParagraph;\n\n    return newParagraph;\n}\n\nfunction insertBlock(markerPosition: InsertPoint, block: ContentModelBlock) {\n    const { path } = markerPosition;\n    const newParaFormat = block.blockType !== 'Paragraph' ? {} : block.format;\n    const newPara = splitParagraph(markerPosition, newParaFormat);\n    const blockIndex = path[0].blocks.indexOf(newPara);\n\n    if (blockIndex >= 0) {\n        path[0].blocks.splice(blockIndex, 0, block);\n    }\n}\n\nfunction applyDefaultFormat(\n    group: ContentModelBlockGroup,\n    format: ContentModelSegmentFormat,\n    applyDefaultFormatOption: 'mergeAll' | 'keepSourceEmphasisFormat'\n) {\n    group.blocks.forEach(block => {\n        switch (block.blockType) {\n            case 'BlockGroup':\n                if (block.blockGroupType == 'ListItem') {\n                    block.formatHolder.format = mergeSegmentFormat(\n                        applyDefaultFormatOption,\n                        format,\n                        block.formatHolder.format\n                    );\n                }\n                applyDefaultFormat(block, format, applyDefaultFormatOption);\n                break;\n\n            case 'Table':\n                block.rows.forEach(row =>\n                    row.cells.forEach(cell => {\n                        applyDefaultFormat(cell, format, applyDefaultFormatOption);\n                    })\n                );\n                break;\n\n            case 'Paragraph':\n                const paragraphFormat = block.decorator?.format || {};\n                block.segments.forEach(segment => {\n                    if (segment.segmentType == 'General') {\n                        applyDefaultFormat(segment, format, applyDefaultFormatOption);\n                    }\n\n                    segment.format = mergeSegmentFormat(applyDefaultFormatOption, format, {\n                        ...paragraphFormat,\n                        ...segment.format,\n                    });\n                });\n\n                if (applyDefaultFormatOption === 'keepSourceEmphasisFormat') {\n                    delete block.decorator;\n                }\n                break;\n        }\n    });\n}\n\nfunction mergeSegmentFormat(\n    applyDefaultFormatOption: 'mergeAll' | 'keepSourceEmphasisFormat',\n    targetformat: ContentModelSegmentFormat,\n    sourceFormat: ContentModelSegmentFormat\n): ContentModelSegmentFormat {\n    return applyDefaultFormatOption == 'mergeAll'\n        ? { ...targetformat, ...sourceFormat }\n        : {\n              ...targetformat,\n              ...getSemanticFormat(sourceFormat),\n          };\n}\n\nfunction getSemanticFormat(segmentFormat: ContentModelSegmentFormat): ContentModelSegmentFormat {\n    const result: ContentModelSegmentFormat = {};\n\n    const { fontWeight, italic, underline } = segmentFormat;\n\n    if (fontWeight && fontWeight != 'normal') {\n        result.fontWeight = fontWeight;\n    }\n    if (italic) {\n        result.italic = italic;\n    }\n    if (underline) {\n        result.underline = underline;\n    }\n\n    return result;\n}\n","import { extractBorderValues } from '../../domUtils/borderValues';\nimport { getClosestAncestorBlockGroupIndex } from './getClosestAncestorBlockGroupIndex';\nimport { isBold } from '../../publicApi/segment/toggleBold';\nimport { iterateSelections } from '../selection/iterateSelections';\nimport { updateTableMetadata } from '../../domUtils/metadata/updateTableMetadata';\nimport type { ContentModelFormatState } from '../../publicTypes/format/formatState/ContentModelFormatState';\nimport type { TableSelectionContext } from '../../publicTypes/selection/TableSelectionContext';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelFormatContainer,\n    ContentModelImage,\n    ContentModelListItem,\n    ContentModelParagraph,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function retrieveModelFormatState(\n    model: ContentModelDocument,\n    pendingFormat: ContentModelSegmentFormat | null,\n    formatState: ContentModelFormatState\n) {\n    let firstTableContext: TableSelectionContext | undefined;\n    let firstBlock: ContentModelBlock | undefined;\n    let isFirst = true;\n    let isFirstImage = true;\n    let isFirstSegment = true;\n\n    iterateSelections(\n        [model],\n        (path, tableContext, block, segments) => {\n            // Structure formats\n            retrieveStructureFormat(formatState, path, isFirst);\n\n            // Multiple line format\n            if (block) {\n                if (firstBlock) {\n                    formatState.isMultilineSelection = true;\n                } else {\n                    firstBlock = block;\n                }\n            }\n\n            if (block?.blockType == 'Paragraph') {\n                // Paragraph formats\n                retrieveParagraphFormat(formatState, block, isFirst);\n\n                // Segment formats\n                segments?.forEach(segment => {\n                    if (isFirstSegment || segment.segmentType != 'SelectionMarker') {\n                        const modelFormat = Object.assign({}, model.format);\n                        delete modelFormat?.italic;\n                        delete modelFormat?.underline;\n                        delete modelFormat?.fontWeight;\n\n                        retrieveSegmentFormat(\n                            formatState,\n                            isFirst,\n                            Object.assign(\n                                {},\n                                modelFormat,\n                                block.format,\n                                block.decorator?.format,\n                                segment.format,\n                                segment.code?.format,\n                                segment.link?.format,\n                                pendingFormat\n                            )\n                        );\n\n                        mergeValue(formatState, 'isCodeInline', !!segment?.code, isFirst);\n                    }\n\n                    // We only care the format of selection marker when it is the first selected segment. This is because when selection marker\n                    // is after some other selected segments, it mostly like appears at the beginning of a seconde line when the whole first line\n                    // is selected (e.g. triple-click on a line) then the second selection marker doesn't contain a correct format, so we need to\n                    // ignore it\n                    isFirstSegment = false;\n\n                    formatState.canUnlink = formatState.canUnlink || !!segment.link;\n                    formatState.canAddImageAltText =\n                        formatState.canAddImageAltText ||\n                        segments.some(segment => segment.segmentType == 'Image');\n\n                    isFirst = false;\n\n                    if (segment.segmentType === 'Image') {\n                        if (isFirstImage) {\n                            retrieveImageFormat(segment, formatState);\n                            isFirstImage = false;\n                        } else {\n                            formatState.imageFormat = undefined;\n                        }\n                    }\n                });\n\n                isFirst = false;\n            }\n\n            if (tableContext) {\n                if (firstTableContext) {\n                    const { table, colIndex, rowIndex } = firstTableContext;\n\n                    // Merge table format\n                    if (\n                        tableContext.table == table &&\n                        (tableContext.colIndex != colIndex || tableContext.rowIndex != rowIndex)\n                    ) {\n                        formatState.canMergeTableCell = true;\n                        formatState.isMultilineSelection = true;\n                    }\n                } else {\n                    // Table formats\n                    retrieveTableFormat(tableContext, formatState);\n                    firstTableContext = tableContext;\n                }\n            }\n\n            // TODO: Support Code block in format state for Content Model\n        },\n        {\n            includeListFormatHolder: 'never',\n        }\n    );\n\n    if (formatState.fontSize) {\n        formatState.fontSize = px2Pt(formatState.fontSize);\n    }\n}\n\nfunction retrieveSegmentFormat(\n    result: ContentModelFormatState,\n    isFirst: boolean,\n    mergedFormat: ContentModelSegmentFormat\n) {\n    const superOrSubscript = mergedFormat.superOrSubScriptSequence?.split(' ')?.pop();\n\n    mergeValue(result, 'isBold', isBold(mergedFormat.fontWeight), isFirst);\n    mergeValue(result, 'isItalic', mergedFormat.italic, isFirst);\n    mergeValue(result, 'isUnderline', mergedFormat.underline, isFirst);\n    mergeValue(result, 'isStrikeThrough', mergedFormat.strikethrough, isFirst);\n    mergeValue(result, 'isSuperscript', superOrSubscript == 'super', isFirst);\n    mergeValue(result, 'isSubscript', superOrSubscript == 'sub', isFirst);\n    mergeValue(result, 'letterSpacing', mergedFormat.letterSpacing, isFirst);\n\n    mergeValue(result, 'fontName', mergedFormat.fontFamily, isFirst);\n    mergeValue(result, 'fontSize', mergedFormat.fontSize, isFirst);\n    mergeValue(result, 'backgroundColor', mergedFormat.backgroundColor, isFirst);\n    mergeValue(result, 'textColor', mergedFormat.textColor, isFirst);\n\n    //TODO: handle block owning segments with different line-heights\n    mergeValue(result, 'lineHeight', mergedFormat.lineHeight, isFirst);\n}\n\nfunction retrieveParagraphFormat(\n    result: ContentModelFormatState,\n    paragraph: ContentModelParagraph,\n    isFirst: boolean\n) {\n    const headingLevel = parseInt((paragraph.decorator?.tagName || '').substring(1));\n    const validHeadingLevel = headingLevel >= 1 && headingLevel <= 6 ? headingLevel : undefined;\n\n    mergeValue(result, 'marginBottom', paragraph.format.marginBottom, isFirst);\n    mergeValue(result, 'marginTop', paragraph.format.marginTop, isFirst);\n    mergeValue(result, 'headingLevel', validHeadingLevel, isFirst);\n    mergeValue(result, 'headerLevel', validHeadingLevel, isFirst);\n    mergeValue(result, 'textAlign', paragraph.format.textAlign, isFirst);\n    mergeValue(result, 'direction', paragraph.format.direction, isFirst);\n}\n\nfunction retrieveStructureFormat(\n    result: ContentModelFormatState,\n    path: ContentModelBlockGroup[],\n    isFirst: boolean\n) {\n    const listItemIndex = getClosestAncestorBlockGroupIndex(path, ['ListItem'], []);\n    const containerIndex = getClosestAncestorBlockGroupIndex(path, ['FormatContainer'], []);\n\n    if (listItemIndex >= 0) {\n        const listItem = path[listItemIndex] as ContentModelListItem;\n        const listType = listItem?.levels[listItem.levels.length - 1]?.listType;\n\n        mergeValue(result, 'isBullet', listType == 'UL', isFirst);\n        mergeValue(result, 'isNumbering', listType == 'OL', isFirst);\n    }\n\n    mergeValue(\n        result,\n        'isBlockQuote',\n        containerIndex >= 0 &&\n            (path[containerIndex] as ContentModelFormatContainer)?.tagName == 'blockquote',\n        isFirst\n    );\n}\n\nfunction retrieveTableFormat(tableContext: TableSelectionContext, result: ContentModelFormatState) {\n    const tableFormat = updateTableMetadata(tableContext.table);\n\n    result.isInTable = true;\n    result.tableHasHeader = tableContext.table.rows.some(row =>\n        row.cells.some(cell => cell.isHeader)\n    );\n\n    if (tableFormat) {\n        result.tableFormat = tableFormat;\n    }\n}\n\nfunction retrieveImageFormat(image: ContentModelImage, result: ContentModelFormatState) {\n    const { format } = image;\n    const borderKey = 'borderTop';\n    const extractedBorder = extractBorderValues(format[borderKey]);\n    const borderColor = extractedBorder.color;\n    const borderWidth = extractedBorder.width;\n    const borderStyle = extractedBorder.style;\n    result.imageFormat = {\n        borderColor,\n        borderWidth,\n        borderStyle,\n        boxShadow: format.boxShadow,\n        borderRadius: format.borderRadius,\n    };\n}\n\nfunction mergeValue<K extends keyof ContentModelFormatState>(\n    format: ContentModelFormatState,\n    key: K,\n    newValue: ContentModelFormatState[K] | undefined,\n    isFirst: boolean\n) {\n    if (isFirst) {\n        if (newValue !== undefined) {\n            format[key] = newValue;\n        }\n    } else if (newValue !== format[key]) {\n        delete format[key];\n    }\n}\n\nfunction px2Pt(px: string) {\n    if (px && px.indexOf('px') == px.length - 2) {\n        // Edge may not handle the floating computing well which causes the calculated value is a little less than actual value\n        // So add 0.05 to fix it\n        return Math.round(parseFloat(px) * 75 + 0.05) / 100 + 'pt';\n    }\n    return px;\n}\n","import { addBlock, setParagraphNotImplicit } from 'roosterjs-content-model-dom';\nimport type { ContentModelBlock, ContentModelBlockGroup } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport interface WrapBlockStep1Result<T extends ContentModelBlockGroup & ContentModelBlock> {\n    parent: ContentModelBlockGroup;\n    wrapper: T;\n}\n\n/**\n * @internal\n */\nexport function wrapBlockStep1<T extends ContentModelBlockGroup & ContentModelBlock>(\n    step1Result: WrapBlockStep1Result<T>[],\n    parent: ContentModelBlockGroup | null,\n    blockToWrap: ContentModelBlock,\n    creator: () => T,\n    canMerge: (target: ContentModelBlock) => target is T\n) {\n    const index = parent?.blocks.indexOf(blockToWrap) ?? -1;\n\n    if (parent && index >= 0) {\n        parent.blocks.splice(index, 1);\n\n        const prevBlock = parent.blocks[index - 1];\n        const wrapper = canMerge(prevBlock) ? prevBlock : createAndAdd(parent, index, creator);\n\n        setParagraphNotImplicit(blockToWrap);\n        addBlock(wrapper, blockToWrap);\n\n        // Use reverse order, so that we can merge from last to first to avoid modifying unmerged quotes\n        step1Result.unshift({ parent, wrapper });\n    }\n}\n\n/**\n * @internal\n */\nexport function wrapBlockStep2<T extends ContentModelBlockGroup & ContentModelBlock>(\n    step1Result: WrapBlockStep1Result<T>[],\n    canMerge: (target: ContentModelBlock, current: T) => target is T\n) {\n    step1Result.forEach(({ parent, wrapper }) => {\n        const index = parent.blocks.indexOf(wrapper);\n        const nextBlock = parent.blocks[index + 1];\n\n        if (index >= 0 && canMerge(nextBlock, wrapper)) {\n            wrapper.blocks.forEach(setParagraphNotImplicit);\n            wrapper.blocks.push(...nextBlock.blocks);\n            parent.blocks.splice(index + 1, 1);\n        }\n    });\n}\n\nfunction createAndAdd<T extends ContentModelBlockGroup & ContentModelBlock>(\n    parent: ContentModelBlockGroup,\n    index: number,\n    creator: () => T\n): T {\n    const block = creator();\n\n    parent.blocks.splice(index, 0, block);\n    return block;\n}\n","import { deleteExpandedSelection } from './utils/deleteExpandedSelection';\nimport { DeleteResult } from './utils/DeleteSelectionStep';\nimport type { ContentModelDocument } from 'roosterjs-content-model-types';\nimport type { FormatWithContentModelContext } from '../../publicTypes/parameter/FormatWithContentModelContext';\nimport type {\n    DeleteSelectionContext,\n    DeleteSelectionResult,\n    DeleteSelectionStep,\n    ValidDeleteSelectionContext,\n} from './utils/DeleteSelectionStep';\n\n/**\n * @internal\n */\nexport function deleteSelection(\n    model: ContentModelDocument,\n    additionalSteps: (DeleteSelectionStep | null)[] = [],\n    formatContext?: FormatWithContentModelContext\n): DeleteSelectionResult {\n    const context = deleteExpandedSelection(model, formatContext);\n\n    additionalSteps.forEach(step => {\n        if (\n            step &&\n            isValidDeleteSelectionContext(context) &&\n            context.deleteResult == DeleteResult.NotDeleted\n        ) {\n            step(context);\n        }\n    });\n\n    mergeParagraphAfterDelete(context);\n\n    return context;\n}\n\nfunction isValidDeleteSelectionContext(\n    context: DeleteSelectionContext\n): context is ValidDeleteSelectionContext {\n    return !!context.insertPoint;\n}\n\n// If we end up with multiple paragraphs impacted, we need to merge them\nfunction mergeParagraphAfterDelete(context: DeleteSelectionContext) {\n    const { insertPoint, deleteResult, lastParagraph, lastTableContext } = context;\n\n    if (\n        insertPoint &&\n        deleteResult != DeleteResult.NotDeleted &&\n        deleteResult != DeleteResult.NothingToDelete &&\n        lastParagraph &&\n        lastParagraph != insertPoint.paragraph &&\n        lastTableContext == insertPoint.tableContext\n    ) {\n        insertPoint.paragraph.segments.push(...lastParagraph.segments);\n        lastParagraph.segments = [];\n    }\n}\n","import { DeleteResult } from '../utils/DeleteSelectionStep';\nimport { deleteSegment } from '../utils/deleteSegment';\nimport type { DeleteSelectionStep } from '../utils/DeleteSelectionStep';\n\n/**\n * @internal\n */\nexport const deleteAllSegmentBefore: DeleteSelectionStep = context => {\n    const { paragraph, marker } = context.insertPoint;\n    const index = paragraph.segments.indexOf(marker);\n\n    for (let i = index - 1; i >= 0; i--) {\n        const segment = paragraph.segments[i];\n\n        segment.isSelected = true;\n\n        if (deleteSegment(paragraph, segment, context.formatContext)) {\n            context.deleteResult = DeleteResult.Range;\n        }\n    }\n};\n","import { createInsertPoint } from '../utils/createInsertPoint';\nimport { deleteBlock } from '../utils/deleteBlock';\nimport { DeleteResult } from '../utils/DeleteSelectionStep';\nimport { deleteSegment } from '../utils/deleteSegment';\nimport { getLeafSiblingBlock } from '../../block/getLeafSiblingBlock';\nimport { setParagraphNotImplicit } from 'roosterjs-content-model-dom';\nimport type { BlockAndPath } from '../../block/getLeafSiblingBlock';\nimport type { ContentModelSegment } from 'roosterjs-content-model-types';\nimport type { DeleteSelectionStep } from '../utils/DeleteSelectionStep';\n\nfunction getDeleteCollapsedSelection(direction: 'forward' | 'backward'): DeleteSelectionStep {\n    return context => {\n        const isForward = direction == 'forward';\n        const { paragraph, marker, path, tableContext } = context.insertPoint;\n        const segments = paragraph.segments;\n\n        fixupBr(segments);\n\n        const index = segments.indexOf(marker) + (isForward ? 1 : -1);\n        const segmentToDelete = segments[index];\n        let blockToDelete: BlockAndPath | null;\n\n        if (segmentToDelete) {\n            if (deleteSegment(paragraph, segmentToDelete, context.formatContext, direction)) {\n                context.deleteResult = DeleteResult.SingleChar;\n\n                // It is possible that we have deleted everything from this paragraph, so we need to mark it as not implicit\n                // to avoid losing its format. See https://github.com/microsoft/roosterjs/issues/1953\n                setParagraphNotImplicit(paragraph);\n            }\n        } else if ((blockToDelete = getLeafSiblingBlock(path, paragraph, isForward))) {\n            const { block, path, siblingSegment } = blockToDelete;\n\n            if (block.blockType == 'Paragraph') {\n                if (siblingSegment) {\n                    // When selection is under general segment, need to check if it has a sibling sibling, and delete from it\n                    if (deleteSegment(block, siblingSegment, context.formatContext, direction)) {\n                        context.deleteResult = DeleteResult.Range;\n                    }\n                } else {\n                    if (isForward) {\n                        context.lastParagraph = block;\n                    } else {\n                        if (block.segments[block.segments.length - 1]?.segmentType == 'Br') {\n                            block.segments.pop();\n                        }\n\n                        context.insertPoint = createInsertPoint(marker, block, path, tableContext);\n                        context.lastParagraph = paragraph;\n                        delete block.cachedElement;\n                    }\n\n                    context.deleteResult = DeleteResult.Range;\n                }\n\n                // When go across table, getLeafSiblingBlock will return null, when we are here, we must be in the same table context\n                context.lastTableContext = tableContext;\n            } else {\n                if (\n                    deleteBlock(\n                        path[0].blocks,\n                        block,\n                        undefined /*replacement*/,\n                        context.formatContext,\n                        direction\n                    )\n                ) {\n                    context.deleteResult = DeleteResult.Range;\n                }\n            }\n        } else {\n            // We have nothing to delete, in this case we don't want browser handle it as well.\n            // Because when Backspace on an empty document, it will also delete the only DIV and SPAN element, causes\n            // editor is really empty. We don't want that happen. So the handling should stop here.\n            context.deleteResult = DeleteResult.NothingToDelete;\n        }\n    };\n}\n\n/**\n * If the last segment is BR, remove it for now. We may add it back later when normalize model.\n * So that if this is an empty paragraph, it will start to delete next block\n */\nfunction fixupBr(segments: ContentModelSegment[]) {\n    if (segments[segments.length - 1]?.segmentType == 'Br') {\n        const segmentsWithoutBr = segments.filter(x => x.segmentType != 'SelectionMarker');\n\n        if (segmentsWithoutBr[segmentsWithoutBr.length - 2]?.segmentType != 'Br') {\n            segments.pop();\n        }\n    }\n}\n\n/**\n * @internal if we didn't delete anything, and we want to delete forward, now perform it\n */\nexport const forwardDeleteCollapsedSelection = getDeleteCollapsedSelection('forward');\n\n/**\n * @internal if we didn't delete anything, and we want to delete backward, now perform it\n */\nexport const backwardDeleteCollapsedSelection = getDeleteCollapsedSelection('backward');\n","import { DeleteResult } from '../utils/DeleteSelectionStep';\nimport { isPunctuation, isSpace, normalizeText } from '../../../domUtils/stringUtil';\nimport { isWhiteSpacePreserved } from 'roosterjs-content-model-dom';\nimport type { ContentModelParagraph } from 'roosterjs-content-model-types';\nimport type { DeleteSelectionContext, DeleteSelectionStep } from '../utils/DeleteSelectionStep';\n\nconst enum DeleteWordState {\n    Start,\n    Punctuation,\n    Text,\n    NonText,\n    Space,\n    End,\n}\n\ninterface CharInfo {\n    text: boolean;\n    space: boolean;\n    punctuation: boolean;\n}\n\nfunction getDeleteWordSelection(direction: 'forward' | 'backward'): DeleteSelectionStep {\n    return context => {\n        const { marker, paragraph } = context.insertPoint;\n        const startIndex = paragraph.segments.indexOf(marker);\n        const deleteNext = direction == 'forward';\n\n        const iterator = iterateSegments(paragraph, startIndex, deleteNext, context);\n        let curr = iterator.next();\n\n        for (let state = DeleteWordState.Start; state != DeleteWordState.End && !curr.done; ) {\n            const { punctuation, space, text } = curr.value;\n\n            // This is a state machine of how to delete a whole word together with space and punctuations.\n            // For a full state machine chart, see\n            // Forward delete: https://github.com/microsoft/roosterjs/blob/master/assets/design-charts/ForwardDeleteWord.png\n            // Backward delete: https://github.com/microsoft/roosterjs/blob/master/assets/design-charts/BackwardDeleteWord.png\n            switch (state) {\n                case DeleteWordState.Start:\n                    state = space\n                        ? DeleteWordState.Space\n                        : punctuation\n                        ? DeleteWordState.Punctuation\n                        : DeleteWordState.Text;\n                    curr = iterator.next(true /*delete*/);\n                    break;\n\n                case DeleteWordState.Punctuation:\n                    if (deleteNext && space) {\n                        state = DeleteWordState.NonText;\n                        curr = iterator.next(true /*delete*/);\n                    } else if (punctuation) {\n                        curr = iterator.next(true /*delete*/);\n                    } else {\n                        state = DeleteWordState.End;\n                    }\n                    break;\n\n                case DeleteWordState.Text:\n                    if (deleteNext && space) {\n                        state = DeleteWordState.NonText;\n                        curr = iterator.next(true /*delete*/);\n                    } else if (text) {\n                        curr = iterator.next(true /*delete*/);\n                    } else {\n                        state = DeleteWordState.End;\n                    }\n                    break;\n\n                case DeleteWordState.NonText:\n                    if (punctuation || !space) {\n                        state = DeleteWordState.End;\n                    } else {\n                        curr = iterator.next(true /*delete*/);\n                    }\n                    break;\n\n                case DeleteWordState.Space:\n                    if (space) {\n                        curr = iterator.next(true /*delete*/);\n                    } else if (punctuation) {\n                        state = deleteNext ? DeleteWordState.NonText : DeleteWordState.Punctuation;\n                        curr = iterator.next(true /*delete*/);\n                    } else {\n                        state = deleteNext ? DeleteWordState.End : DeleteWordState.Text;\n                    }\n                    break;\n            }\n        }\n    };\n}\n\nfunction* iterateSegments(\n    paragraph: ContentModelParagraph,\n    markerIndex: number,\n    forward: boolean,\n    context: DeleteSelectionContext\n): Generator<CharInfo, null, boolean> {\n    const step = forward ? 1 : -1;\n    const segments = paragraph.segments;\n    const preserveWhiteSpace = isWhiteSpacePreserved(paragraph);\n\n    for (let i = markerIndex + step; i >= 0 && i < segments.length; i += step) {\n        const segment = segments[i];\n\n        switch (segment.segmentType) {\n            case 'Text':\n                for (\n                    let j = forward ? 0 : segment.text.length - 1;\n                    j >= 0 && j < segment.text.length;\n                    j += step\n                ) {\n                    const c = segment.text[j];\n                    const punctuation = isPunctuation(c);\n                    const space = isSpace(c);\n                    const text = !punctuation && !space;\n\n                    if (yield { punctuation, space, text }) {\n                        let newText = segment.text;\n\n                        newText = newText.substring(0, j) + newText.substring(j + 1);\n\n                        if (!preserveWhiteSpace) {\n                            newText = normalizeText(newText, forward);\n                        }\n\n                        context.deleteResult = DeleteResult.Range;\n\n                        if (newText) {\n                            segment.text = newText;\n\n                            if (step > 0) {\n                                j -= step;\n                            }\n                        } else {\n                            segments.splice(i, 1);\n\n                            if (step > 0) {\n                                i -= step;\n                            }\n\n                            break;\n                        }\n                    }\n                }\n                break;\n\n            case 'Image':\n                if (\n                    yield { punctuation: true, space: false, text: false } // Treat image as punctuation since they have the same behavior.\n                ) {\n                    segments.splice(i, 1);\n\n                    if (step > 0) {\n                        i -= step;\n                    }\n\n                    context.deleteResult = DeleteResult.Range;\n                }\n                break;\n\n            case 'SelectionMarker':\n                break;\n\n            default:\n                return null;\n        }\n    }\n\n    return null;\n}\n\n/**\n * @internal\n */\nexport const forwardDeleteWordSelection = getDeleteWordSelection('forward');\n\n/**\n * @internal\n */\nexport const backwardDeleteWordSelection = getDeleteWordSelection('backward');\n","import type { InsertPoint } from '../../../publicTypes/selection/InsertPoint';\nimport type { TableSelectionContext } from '../../../publicTypes/selection/TableSelectionContext';\nimport type {\n    ContentModelBlockGroup,\n    ContentModelParagraph,\n    ContentModelSelectionMarker,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function createInsertPoint(\n    marker: ContentModelSelectionMarker,\n    paragraph: ContentModelParagraph,\n    path: ContentModelBlockGroup[],\n    tableContext: TableSelectionContext | undefined\n): InsertPoint {\n    return {\n        marker,\n        paragraph,\n        path,\n        tableContext,\n    };\n}\n","import { EntityOperation } from 'roosterjs-editor-types';\nimport type { ContentModelBlock } from 'roosterjs-content-model-types';\nimport type { FormatWithContentModelContext } from '../../../publicTypes/parameter/FormatWithContentModelContext';\n\n/**\n * @internal\n */\nexport function deleteBlock(\n    blocks: ContentModelBlock[],\n    blockToDelete: ContentModelBlock,\n    replacement?: ContentModelBlock,\n    context?: FormatWithContentModelContext,\n    direction?: 'forward' | 'backward'\n): boolean {\n    const index = blocks.indexOf(blockToDelete);\n\n    switch (blockToDelete.blockType) {\n        case 'Table':\n        case 'Divider':\n            replacement ? blocks.splice(index, 1, replacement) : blocks.splice(index, 1);\n            return true;\n\n        case 'Entity':\n            const operation = blockToDelete.isSelected\n                ? EntityOperation.Overwrite\n                : direction == 'forward'\n                ? EntityOperation.RemoveFromStart\n                : direction == 'backward'\n                ? EntityOperation.RemoveFromEnd\n                : undefined;\n\n            if (operation !== undefined) {\n                replacement ? blocks.splice(index, 1, replacement) : blocks.splice(index, 1);\n                context?.deletedEntities.push({\n                    entity: blockToDelete,\n                    operation,\n                });\n            }\n\n            return true;\n\n        case 'BlockGroup':\n            switch (blockToDelete.blockGroupType) {\n                case 'General':\n                    if (replacement) {\n                        blocks.splice(index, 1, replacement);\n                        return true;\n                    } else {\n                        // no op, let browser handle it\n                        return false;\n                    }\n\n                case 'ListItem':\n                case 'FormatContainer':\n                    blocks.splice(index, 1);\n                    return true;\n            }\n    }\n\n    return false;\n}\n","import { createInsertPoint } from '../utils/createInsertPoint';\nimport { deleteBlock } from '../utils/deleteBlock';\nimport { DeleteResult } from '../utils/DeleteSelectionStep';\nimport { deleteSegment } from '../utils/deleteSegment';\nimport { iterateSelections } from '../../selection/iterateSelections';\nimport type { ContentModelDocument } from 'roosterjs-content-model-types';\nimport type { DeleteSelectionContext } from '../utils/DeleteSelectionStep';\nimport type { FormatWithContentModelContext } from '../../../publicTypes/parameter/FormatWithContentModelContext';\nimport type { IterateSelectionsOption } from '../../selection/iterateSelections';\nimport {\n    createBr,\n    createParagraph,\n    createSelectionMarker,\n    setParagraphNotImplicit,\n} from 'roosterjs-content-model-dom';\n\nconst DeleteSelectionIteratingOptions: IterateSelectionsOption = {\n    contentUnderSelectedTableCell: 'ignoreForTableOrCell', // When a table cell is selected, we replace all content for this cell, so no need to go into its content\n    contentUnderSelectedGeneralElement: 'generalElementOnly', // When a general element is selected, we replace the whole element so no need to go into its content\n    includeListFormatHolder: 'never',\n};\n\n/**\n * @internal\n * Iterate the model and find all selected content if any, delete them, and keep/create an insert point\n * at the first deleted position so that we know where to put cursor to after delete\n */\nexport function deleteExpandedSelection(\n    model: ContentModelDocument,\n    formatContext?: FormatWithContentModelContext\n): DeleteSelectionContext {\n    const context: DeleteSelectionContext = {\n        deleteResult: DeleteResult.NotDeleted,\n        insertPoint: null,\n        formatContext,\n    };\n\n    iterateSelections(\n        [model],\n        (path, tableContext, block, segments) => {\n            // Set paragraph, format and index for default position where we will put cursor to.\n            // Later we can overwrite these info when process the selections\n            let paragraph = createParagraph(\n                true /*implicit*/,\n                undefined /*blockFormat*/,\n                model.format\n            );\n            let markerFormat = model.format;\n            let insertMarkerIndex = 0;\n\n            if (segments) {\n                // Delete segments inside a paragraph\n                if (segments[0] && block?.blockType == 'Paragraph') {\n                    // Now that we have found a paragraph with selections, we can overwrite the default paragraph with this one\n                    // so we can put cursor here after delete\n                    paragraph = block;\n                    insertMarkerIndex = paragraph.segments.indexOf(segments[0]);\n                    markerFormat = segments[0].format;\n\n                    context.lastParagraph = paragraph;\n                    context.lastTableContext = tableContext;\n\n                    segments.forEach((segment, i) => {\n                        if (\n                            i == 0 &&\n                            !context.insertPoint &&\n                            segment.segmentType == 'SelectionMarker'\n                        ) {\n                            // First time we hit a selection and it is a selection marker, just mark it and not need to delete\n                            // because this is possible a collapsed selection, then it will be handled later\n                            context.insertPoint = createInsertPoint(\n                                segment,\n                                block,\n                                path,\n                                tableContext\n                            );\n                        } else if (deleteSegment(block, segment, context.formatContext)) {\n                            context.deleteResult = DeleteResult.Range;\n                        }\n                    });\n\n                    // Since we are operating on this paragraph and it possible we delete everything from this paragraph,\n                    // Need to make it \"not implicit\" so that it will always have a container element, so that when we do normalization\n                    // of this paragraph, a BR can be added if need\n                    if (context.deleteResult == DeleteResult.Range) {\n                        setParagraphNotImplicit(block);\n                    }\n                }\n            } else if (block) {\n                // Delete a whole block (divider, table, ...)\n                const blocks = path[0].blocks;\n\n                if (deleteBlock(blocks, block, paragraph, context.formatContext)) {\n                    context.deleteResult = DeleteResult.Range;\n                }\n            } else if (tableContext) {\n                // Delete a whole table cell\n                const { table, colIndex, rowIndex } = tableContext;\n                const row = table.rows[rowIndex];\n                const cell = row.cells[colIndex];\n\n                path = [cell, ...path];\n                paragraph.segments.push(createBr(model.format));\n                cell.blocks = [paragraph];\n\n                delete cell.cachedElement;\n                delete row.cachedElement;\n                context.deleteResult = DeleteResult.Range;\n            }\n\n            if (!context.insertPoint) {\n                // If we have not got a insert point after delete and we have a paragraph to put an insert point in, create insert point now\n                const marker = createSelectionMarker(markerFormat);\n\n                setParagraphNotImplicit(paragraph);\n                paragraph.segments.splice(insertMarkerIndex, 0, marker);\n                context.insertPoint = createInsertPoint(marker, paragraph, path, tableContext);\n            }\n        },\n        DeleteSelectionIteratingOptions\n    );\n\n    return context;\n}\n","import { deleteSingleChar } from './deleteSingleChar';\nimport { EntityOperation } from 'roosterjs-editor-types';\nimport { isWhiteSpacePreserved, normalizeSingleSegment } from 'roosterjs-content-model-dom';\nimport { normalizeText } from '../../../domUtils/stringUtil';\nimport type { ContentModelParagraph, ContentModelSegment } from 'roosterjs-content-model-types';\nimport type { FormatWithContentModelContext } from '../../../publicTypes/parameter/FormatWithContentModelContext';\n\n/**\n * @internal\n */\nexport function deleteSegment(\n    paragraph: ContentModelParagraph,\n    segmentToDelete: ContentModelSegment,\n    context?: FormatWithContentModelContext,\n    direction?: 'forward' | 'backward'\n): boolean {\n    const segments = paragraph.segments;\n    const index = segments.indexOf(segmentToDelete);\n    const preserveWhiteSpace = isWhiteSpacePreserved(paragraph);\n    const isForward = direction == 'forward';\n    const isBackward = direction == 'backward';\n\n    if (!preserveWhiteSpace) {\n        normalizePreviousSegment(segments, index);\n    }\n\n    switch (segmentToDelete.segmentType) {\n        case 'Br':\n        case 'Image':\n        case 'SelectionMarker':\n            segments.splice(index, 1);\n            return true;\n\n        case 'Entity':\n            const operation = segmentToDelete.isSelected\n                ? EntityOperation.Overwrite\n                : isForward\n                ? EntityOperation.RemoveFromStart\n                : isBackward\n                ? EntityOperation.RemoveFromEnd\n                : undefined;\n            if (operation !== undefined) {\n                segments.splice(index, 1);\n                context?.deletedEntities.push({\n                    entity: segmentToDelete,\n                    operation,\n                });\n            }\n\n            return true;\n\n        case 'Text':\n            let text = segmentToDelete.text;\n\n            if (text.length == 0 || segmentToDelete.isSelected) {\n                segments.splice(index, 1);\n            } else if (direction) {\n                text = deleteSingleChar(text, isForward); //  isForward ? text.substring(1) : text.substring(0, text.length - 1);\n\n                if (!preserveWhiteSpace) {\n                    text = normalizeText(text, isForward);\n                }\n\n                if (text == '') {\n                    segments.splice(index, 1);\n                } else {\n                    segmentToDelete.text = text;\n                }\n            }\n\n            return true;\n\n        case 'General':\n            if (segmentToDelete.isSelected) {\n                segments.splice(index, 1);\n                return true;\n            } else {\n                // No op if a general segment is not selected, let browser handle general segment\n                // TODO: Need to revisit this\n                return false;\n            }\n    }\n}\n\nfunction normalizePreviousSegment(segments: ContentModelSegment[], currentIndex: number) {\n    let index = currentIndex - 1;\n\n    while (segments[index]?.segmentType == 'SelectionMarker') {\n        index--;\n    }\n\n    const segment = segments[index];\n\n    if (segment) {\n        normalizeSingleSegment(segment);\n    }\n}\n","/**\n * @internal\n */\nexport function deleteSingleChar(text: string, isForward: boolean) {\n    // In case of emoji that occupies multiple characters, we need to delete the whole emoji\n    const array = [...text];\n    let deleteLength = 0;\n\n    for (\n        let i = isForward ? 0 : array.length - 1,\n            deleteState: 'notDeleted' | 'waiting' | 'done' = 'notDeleted';\n        i >= 0 && i < array.length && deleteState != 'done';\n        i += isForward ? 1 : -1\n    ) {\n        switch (array[i]) {\n            case '\\u200D': // ZERO WIDTH JOINER\n            case '\\u20E3': // COMBINING ENCLOSING KEYCAP\n            case '\\uFE0E': // VARIATION SELECTOR-15\n            case '\\uFE0F': // VARIATION SELECTOR-16\n                deleteState = 'notDeleted';\n                deleteLength++;\n                break;\n\n            default:\n                if (deleteState == 'notDeleted') {\n                    deleteState = 'waiting';\n                    deleteLength++;\n                } else if (deleteState == 'waiting') {\n                    deleteState = 'done';\n                }\n                break;\n        }\n    }\n\n    array.splice(isForward ? 0 : array.length - deleteLength, deleteLength);\n\n    return array.join('');\n}\n","import { DeleteResult } from '../edit/utils/DeleteSelectionStep';\nimport { deleteSelection } from '../edit/deleteSelection';\nimport { getClosestAncestorBlockGroupIndex } from '../common/getClosestAncestorBlockGroupIndex';\nimport { setSelection } from '../selection/setSelection';\nimport {\n    createBr,\n    createParagraph,\n    createSelectionMarker,\n    normalizeContentModel,\n} from 'roosterjs-content-model-dom';\nimport type { DeleteSelectionResult } from '../edit/utils/DeleteSelectionStep';\nimport type { FormatWithContentModelContext } from '../../publicTypes/parameter/FormatWithContentModelContext';\nimport type { InsertEntityPosition } from '../../publicTypes/parameter/InsertEntityOptions';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelEntity,\n    ContentModelParagraph,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function insertEntityModel(\n    model: ContentModelDocument,\n    entityModel: ContentModelEntity,\n    position: InsertEntityPosition,\n    isBlock: boolean,\n    focusAfterEntity?: boolean,\n    context?: FormatWithContentModelContext\n) {\n    let blockParent: ContentModelBlockGroup | undefined;\n    let blockIndex = -1;\n    let deleteResult: DeleteSelectionResult;\n\n    if (position == 'begin' || position == 'end') {\n        blockParent = model;\n        blockIndex = position == 'begin' ? 0 : model.blocks.length;\n    } else if ((deleteResult = deleteSelection(model, [], context)).insertPoint) {\n        const { marker, paragraph, path } = deleteResult.insertPoint;\n\n        if (deleteResult.deleteResult == DeleteResult.Range) {\n            normalizeContentModel(model);\n        }\n\n        if (!isBlock) {\n            const index = paragraph.segments.indexOf(marker);\n\n            if (index >= 0) {\n                paragraph.segments.splice(focusAfterEntity ? index : index + 1, 0, entityModel);\n            }\n        } else {\n            const pathIndex =\n                position == 'root'\n                    ? getClosestAncestorBlockGroupIndex(path, ['TableCell', 'Document'])\n                    : 0;\n            blockParent = path[pathIndex];\n            const child = path[pathIndex - 1];\n            const directChild: ContentModelBlock =\n                child?.blockGroupType == 'FormatContainer' ||\n                child?.blockGroupType == 'General' ||\n                child?.blockGroupType == 'ListItem'\n                    ? child\n                    : paragraph;\n            const childIndex = blockParent.blocks.indexOf(directChild);\n            blockIndex = childIndex >= 0 ? childIndex + 1 : -1;\n        }\n    }\n\n    if (blockIndex >= 0 && blockParent) {\n        const blocksToInsert: ContentModelBlock[] = [];\n        let nextParagraph: ContentModelParagraph | undefined;\n\n        if (isBlock) {\n            const nextBlock = blockParent.blocks[blockIndex];\n\n            blocksToInsert.push(entityModel);\n\n            if (nextBlock?.blockType == 'Paragraph') {\n                nextParagraph = nextBlock;\n            } else if (!nextBlock || nextBlock.blockType == 'Entity' || focusAfterEntity) {\n                nextParagraph = createParagraph(false /*isImplicit*/, {}, model.format);\n                nextParagraph.segments.push(createBr(model.format));\n                blocksToInsert.push(nextParagraph);\n            }\n        } else {\n            nextParagraph = createParagraph(\n                false /*isImplicit*/,\n                undefined /*format*/,\n                model.format\n            );\n\n            nextParagraph.segments.push(entityModel);\n            blocksToInsert.push(nextParagraph);\n        }\n\n        blockParent.blocks.splice(blockIndex, 0, ...blocksToInsert);\n\n        if (focusAfterEntity && nextParagraph) {\n            const marker = createSelectionMarker(nextParagraph.segments[0]?.format || model.format);\n            const segments = nextParagraph.segments;\n\n            isBlock ? segments.unshift(marker) : segments.push(marker);\n            setSelection(model, marker, marker);\n        }\n    }\n}\n","import type { ContentModelSegmentFormat } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * @internal\n * Get pending segment format from editor if any, otherwise null\n * @param editor The editor to get format from\n */\nexport function getPendingFormat(editor: IContentModelEditor): ContentModelSegmentFormat | null {\n    return getPendingFormatHolder(editor).format;\n}\n\n/**\n * @internal\n * Set pending segment format to editor\n * @param editor The editor to set pending format to\n * @param format The format to set.\n * @param posContainer Container node of current focus position\n * @param posOffset Offset number of current focus position\n */\nexport function setPendingFormat(\n    editor: IContentModelEditor,\n    format: ContentModelSegmentFormat,\n    posContainer: Node,\n    posOffset: number\n) {\n    const holder = getPendingFormatHolder(editor);\n\n    holder.format = format;\n    holder.posContainer = posContainer;\n    holder.posOffset = posOffset;\n}\n\n/**\n * @internal Clear pending format if any\n * @param editor The editor to set pending format to\n */\nexport function clearPendingFormat(editor: IContentModelEditor) {\n    const holder = getPendingFormatHolder(editor);\n\n    holder.format = null;\n    holder.posContainer = null;\n    holder.posOffset = null;\n}\n\n/**\n * @internal\n * Check if this editor can apply pending format\n * @param editor The editor to get format from\n */\nexport function canApplyPendingFormat(editor: IContentModelEditor): boolean {\n    const holder = getPendingFormatHolder(editor);\n    let result = false;\n\n    if (holder.format && holder.posContainer && holder.posOffset !== null) {\n        const position = editor.getFocusedPosition();\n\n        if (position?.node == holder.posContainer && position?.offset == holder.posOffset) {\n            result = true;\n        }\n    }\n\n    return result;\n}\ninterface PendingFormatHolder {\n    format: ContentModelSegmentFormat | null;\n    posContainer: Node | null;\n    posOffset: number | null;\n}\n\nconst PendingFormatHolderKey = '__ContentModelPendingFormat';\n\nfunction getPendingFormatHolder(editor: IContentModelEditor): PendingFormatHolder {\n    return editor.getCustomData<PendingFormatHolder>(PendingFormatHolderKey, () => ({\n        format: null,\n        posContainer: null,\n        posOffset: null,\n    }));\n}\n","import { extractBorderValues } from '../../domUtils/borderValues';\nimport { parseValueWithUnit } from 'roosterjs-content-model-dom';\nimport type { Border } from '../../publicTypes/interface/Border';\nimport type { ContentModelImage } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport default function applyImageBorderFormat(\n    image: ContentModelImage,\n    border: Border | null,\n    borderRadius?: string\n) {\n    if (border) {\n        const format = image.format;\n        const { width, style, color } = border;\n        const borderKey = 'borderTop';\n        const extractedBorder = extractBorderValues(format[borderKey]);\n        const borderColor = extractedBorder.color;\n        const borderWidth = extractedBorder.width;\n        const borderStyle = extractedBorder.style;\n        let borderFormat = '';\n\n        if (width) {\n            borderFormat = parseValueWithUnit(width) + 'px';\n        } else if (borderWidth) {\n            borderFormat = borderWidth;\n        } else {\n            borderFormat = '1px';\n        }\n\n        if (style) {\n            borderFormat = `${borderFormat} ${style}`;\n        } else if (borderStyle) {\n            borderFormat = `${borderFormat} ${borderStyle}`;\n        } else {\n            borderFormat = `${borderFormat} solid`;\n        }\n\n        if (color) {\n            borderFormat = `${borderFormat} ${color}`;\n        } else if (borderColor) {\n            borderFormat = `${borderFormat} ${borderColor}`;\n        }\n        image.format.borderLeft = borderFormat;\n        image.format.borderTop = borderFormat;\n        image.format.borderBottom = borderFormat;\n        image.format.borderRight = borderFormat;\n    } else {\n        delete image.format.borderLeft;\n        delete image.format.borderTop;\n        delete image.format.borderBottom;\n        delete image.format.borderRight;\n    }\n\n    if (borderRadius) {\n        image.format.borderRadius = borderRadius;\n    }\n}\n","import type {\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelListItem,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function findListItemsInSameThread(\n    model: ContentModelDocument,\n    currentItem: ContentModelListItem\n): ContentModelListItem[] {\n    const items: (ContentModelListItem | null)[] = [];\n\n    findListItems(model, items);\n\n    return filterListItems(items, currentItem);\n}\n\nfunction findListItems(group: ContentModelBlockGroup, result: (ContentModelListItem | null)[]) {\n    group.blocks.forEach(block => {\n        switch (block.blockType) {\n            case 'BlockGroup':\n                if (block.blockGroupType == 'ListItem') {\n                    result.push(block);\n                } else {\n                    pushNullIfNecessary(result);\n                    findListItems(block, result);\n                    pushNullIfNecessary(result);\n                }\n                break;\n\n            case 'Paragraph':\n                pushNullIfNecessary(result);\n\n                block.segments.forEach(segment => {\n                    if (segment.segmentType == 'General') {\n                        findListItems(segment, result);\n                    }\n                });\n\n                pushNullIfNecessary(result);\n                break;\n\n            case 'Table':\n                pushNullIfNecessary(result);\n\n                block.rows.forEach(row =>\n                    row.cells.forEach(cell => {\n                        findListItems(cell, result);\n                    })\n                );\n                pushNullIfNecessary(result);\n\n                break;\n        }\n    });\n}\n\nfunction pushNullIfNecessary(result: (ContentModelListItem | null)[]) {\n    const last = result[result.length - 1];\n\n    if (!last || last !== null) {\n        result.push(null);\n    }\n}\n\nfunction filterListItems(\n    items: (ContentModelListItem | null)[],\n    currentItem: ContentModelListItem\n) {\n    const result: ContentModelListItem[] = [];\n    const currentIndex = items.indexOf(currentItem);\n    const levelLength = currentItem.levels.length;\n    const isOrderedList = currentItem.levels[levelLength - 1]?.listType == 'OL';\n\n    if (currentIndex >= 0) {\n        for (let i = currentIndex; i >= 0; i--) {\n            const item = items[i];\n\n            if (!item) {\n                if (isOrderedList) {\n                    continue;\n                } else {\n                    break;\n                }\n            }\n\n            const startNumberOverride = hasStartNumberOverride(item, levelLength);\n\n            if (areListTypesCompatible(items, currentIndex, i)) {\n                result.unshift(item);\n\n                if (isOrderedList && startNumberOverride) {\n                    break;\n                }\n            } else if (!isOrderedList || startNumberOverride) {\n                break;\n            }\n        }\n\n        for (let i = currentIndex + 1; i < items.length; i++) {\n            const item = items[i];\n\n            if (!item) {\n                if (isOrderedList) {\n                    continue;\n                } else {\n                    break;\n                }\n            }\n\n            const startNumberOverride = hasStartNumberOverride(item, levelLength);\n\n            if (areListTypesCompatible(items, currentIndex, i) && !startNumberOverride) {\n                result.push(item);\n            } else if (!isOrderedList || startNumberOverride) {\n                break;\n            }\n        }\n    }\n\n    return result;\n}\n\nfunction areListTypesCompatible(\n    listItems: (ContentModelListItem | null)[],\n    currentIndex: number,\n    compareToIndex: number\n): boolean {\n    const currentLevels = listItems[currentIndex]!.levels;\n    const compareToLevels = listItems[compareToIndex]!.levels;\n\n    return (\n        currentLevels.length <= compareToLevels.length &&\n        currentLevels.every(\n            (currentLevel, i) => currentLevel.listType == compareToLevels[i].listType\n        )\n    );\n}\n\nfunction hasStartNumberOverride(item: ContentModelListItem, levelLength: number): boolean {\n    return item.levels\n        .slice(0, levelLength)\n        .some(level => level.format.startNumberOverride !== undefined);\n}\n","import { getOperationalBlocks } from '../selection/collectSelections';\nimport { isBlockGroupOfType } from '../common/isBlockGroupOfType';\nimport {\n    createListItem,\n    createListLevel,\n    normalizeContentModel,\n    setParagraphNotImplicit,\n} from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlock,\n    ContentModelDocument,\n    ContentModelListItem,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function setListType(model: ContentModelDocument, listType: 'OL' | 'UL') {\n    const paragraphOrListItems = getOperationalBlocks<ContentModelListItem>(\n        model,\n        ['ListItem'],\n        [] // Set stop types to be empty so we can find list items even cross the boundary of table, then we can always operation on the list item if any\n    );\n    const alreadyInExpectedType = paragraphOrListItems.every(({ block }) =>\n        isBlockGroupOfType<ContentModelListItem>(block, 'ListItem')\n            ? block.levels[block.levels.length - 1]?.listType == listType\n            : shouldIgnoreBlock(block)\n    );\n    let existingListItems: ContentModelListItem[] = [];\n    let hasIgnoredParagraphBefore = false;\n\n    paragraphOrListItems.forEach(({ block, parent }, itemIndex) => {\n        if (isBlockGroupOfType<ContentModelListItem>(block, 'ListItem')) {\n            const level = block.levels.pop();\n\n            if (!alreadyInExpectedType && level) {\n                level.listType = listType;\n                block.levels.push(level);\n            } else if (block.blocks.length == 1) {\n                setParagraphNotImplicit(block.blocks[0]);\n            }\n        } else {\n            const index = parent.blocks.indexOf(block);\n\n            if (index >= 0) {\n                if (paragraphOrListItems.length == 1 || !shouldIgnoreBlock(block)) {\n                    const prevBlock = parent.blocks[index - 1];\n                    const segmentFormat =\n                        (block.blockType == 'Paragraph' && block.segments[0]?.format) || {};\n                    const newListItem = createListItem(\n                        [\n                            createListLevel(listType, {\n                                startNumberOverride:\n                                    itemIndex > 0 ||\n                                    (prevBlock?.blockType == 'BlockGroup' &&\n                                        prevBlock.blockGroupType == 'ListItem' &&\n                                        prevBlock.levels[0]?.listType == 'OL')\n                                        ? undefined\n                                        : 1,\n                                direction: block.format.direction,\n                                textAlign: block.format.textAlign,\n                                marginTop: hasIgnoredParagraphBefore ? '0' : undefined,\n                            }),\n                        ],\n                        // For list bullet, we only want to carry over these formats from segments:\n                        {\n                            fontFamily: segmentFormat.fontFamily,\n                            fontSize: segmentFormat.fontSize,\n                            textColor: segmentFormat.textColor,\n                        }\n                    );\n\n                    // Since there is only one paragraph under the list item, no need to keep its paragraph element (DIV).\n                    // TODO: Do we need to keep the CSS styles applied to original DIV?\n                    if (block.blockType == 'Paragraph') {\n                        block.isImplicit = true;\n                    }\n\n                    newListItem.blocks.push(block);\n\n                    parent.blocks.splice(index, 1, newListItem);\n                    existingListItems.push(newListItem);\n                } else {\n                    hasIgnoredParagraphBefore = true;\n\n                    existingListItems.forEach(x => (x.levels[0].format.marginBottom = '0'));\n                    existingListItems = [];\n                }\n            }\n        }\n    });\n\n    normalizeContentModel(model);\n\n    return paragraphOrListItems.length > 0;\n}\n\nfunction shouldIgnoreBlock(block: ContentModelBlock) {\n    switch (block.blockType) {\n        case 'Table':\n            return false;\n        case 'Paragraph':\n            return block.segments.every(\n                x => x.segmentType == 'Br' || x.segmentType == 'SelectionMarker'\n            );\n        default:\n            return true;\n    }\n}\n","import { getSelectedParagraphs } from './collectSelections';\nimport { setSelection } from './setSelection';\nimport type { ContentModelDocument, ContentModelSegment } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function adjustSegmentSelection(\n    model: ContentModelDocument,\n    firstMatcher: (target: ContentModelSegment) => boolean,\n    siblingMatcher: (target: ContentModelSegment, ref: ContentModelSegment) => boolean\n): boolean {\n    const paragraphs = getSelectedParagraphs(model);\n    let first: ContentModelSegment | undefined;\n    let last: ContentModelSegment | undefined;\n    let changed = false;\n\n    paragraphs.forEach(p => {\n        const index = first ? 0 : p.segments.findIndex(x => firstMatcher(x));\n        const segments = p.segments;\n\n        if (!first) {\n            first = segments[index];\n\n            for (let i = index; i > 0; i--) {\n                if (siblingMatcher(segments[i - 1], first)) {\n                    first = segments[i - 1];\n                    changed = changed || !segments[i - 1].isSelected;\n                } else {\n                    changed = changed || !!segments[i - 1].isSelected;\n                    break;\n                }\n            }\n        }\n\n        if (first) {\n            for (let i = index; i < p.segments.length; i++) {\n                if (i == index || siblingMatcher(segments[i], last || segments[index])) {\n                    last = segments[i];\n                    changed = changed || !segments[i].isSelected;\n                } else {\n                    changed = changed || !!segments[i].isSelected;\n                    break;\n                }\n            }\n        }\n    });\n\n    if (first && last) {\n        setSelection(model, first, last);\n    }\n\n    return changed;\n}\n","import { createText } from 'roosterjs-content-model-dom';\nimport { isPunctuation, isSpace } from '../../domUtils/stringUtil';\nimport { iterateSelections } from '../../modelApi/selection/iterateSelections';\nimport type {\n    ContentModelDocument,\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelText,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function adjustWordSelection(\n    model: ContentModelDocument,\n    marker: ContentModelSegment\n): ContentModelSegment[] {\n    let markerBlock: ContentModelParagraph | undefined;\n\n    iterateSelections([model], (path, tableContext, block, segments) => {\n        //Find the block with the selection marker\n        if (block?.blockType == 'Paragraph' && segments?.length == 1 && segments[0] == marker) {\n            markerBlock = block;\n        }\n        return true;\n    });\n\n    const tempSegments = markerBlock ? [...markerBlock.segments] : undefined;\n\n    if (tempSegments && markerBlock) {\n        const segments: ContentModelSegment[] = [];\n        let markerSelectionIndex = tempSegments.indexOf(marker);\n        for (let i = markerSelectionIndex - 1; i >= 0; i--) {\n            const currentSegment = tempSegments[i];\n            if (currentSegment.segmentType == 'Text') {\n                const found = findDelimiter(currentSegment, false /*moveRightward*/);\n                if (found > -1) {\n                    if (found == currentSegment.text.length) {\n                        break;\n                    }\n\n                    splitTextSegment(tempSegments, currentSegment, i, found);\n\n                    segments.push(tempSegments[i + 1]);\n\n                    break;\n                } else {\n                    segments.push(tempSegments[i]);\n                }\n            } else {\n                break;\n            }\n        }\n\n        markerSelectionIndex = tempSegments.indexOf(marker);\n        segments.push(marker);\n\n        // Marker is at start of word\n        if (segments.length <= 1) {\n            return segments;\n        }\n\n        for (let i = markerSelectionIndex + 1; i < tempSegments.length; i++) {\n            const currentSegment = tempSegments[i];\n            if (currentSegment.segmentType == 'Text') {\n                const found = findDelimiter(currentSegment, true /*moveRightward*/);\n                if (found > -1) {\n                    if (found == 0) {\n                        break;\n                    }\n                    splitTextSegment(tempSegments, currentSegment, i, found);\n                    segments.push(tempSegments[i]);\n                    break;\n                } else {\n                    segments.push(tempSegments[i]);\n                }\n            } else {\n                break;\n            }\n        }\n\n        // Marker is at end of word\n        if (segments[segments.length - 1] == marker) {\n            return [marker];\n        }\n\n        markerBlock.segments = tempSegments;\n        return segments;\n    } else {\n        return [marker];\n    }\n}\n\n/*\n// These are unicode characters mostly from the Category Space Separator (Zs)\nhttps://unicode.org/Public/UNIDATA/Scripts.txt\n\n\\u2000 = EN QUAD\n\\u2009 = THIN SPACE\n\\u200a = HAIR SPACE\n\\u200b = ZERO WIDTH SPACE\n\\u202f = NARROW NO-BREAK SPACE\n\\u205f = MEDIUM MATHEMATICAL SPACE\n\\u3000 = IDEOGRAPHIC SPACE\n*/\nfunction findDelimiter(segment: ContentModelText, moveRightward: boolean): number {\n    const word = segment.text;\n    let offset = -1;\n    if (moveRightward) {\n        for (let i = 0; i < word.length; i++) {\n            const char = word[i];\n\n            if (isPunctuation(char) || isSpace(char)) {\n                offset = i;\n                break;\n            }\n        }\n    } else {\n        for (let i = word.length - 1; i >= 0; i--) {\n            const char = word[i];\n\n            if (isPunctuation(char) || isSpace(char)) {\n                offset = i + 1;\n                break;\n            }\n        }\n    }\n    return offset;\n}\n\nfunction splitTextSegment(\n    segments: ContentModelSegment[],\n    textSegment: Readonly<ContentModelText>,\n    index: number,\n    found: number\n) {\n    const text = textSegment.text;\n    const newSegmentLeft = createText(\n        text.substring(0, found),\n        textSegment.format,\n        textSegment.link,\n        textSegment.code\n    );\n    const newSegmentRight = createText(\n        text.substring(found, text.length),\n        textSegment.format,\n        textSegment.link,\n        textSegment.code\n    );\n    segments.splice(index, 1, newSegmentLeft, newSegmentRight);\n}\n","import type { DOMSelection } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * Check if the given selections are the same\n */\nexport function areSameRangeEx(sel1: DOMSelection, sel2: DOMSelection): boolean {\n    if (sel1 == sel2) {\n        return true;\n    }\n\n    switch (sel1.type) {\n        case 'image':\n            return sel2.type == 'image' && sel2.image == sel1.image;\n\n        case 'table':\n            return (\n                sel2.type == 'table' &&\n                sel2.table == sel1.table &&\n                sel2.firstColumn == sel1.firstColumn &&\n                sel2.lastColumn == sel1.lastColumn &&\n                sel2.firstRow == sel1.firstRow &&\n                sel2.lastRow == sel1.lastRow\n            );\n\n        case 'range':\n        default:\n            return sel2.type == 'range' && areSameRanges(sel2.range, sel1.range);\n    }\n}\n\nfunction areSameRanges(r1?: Range, r2?: Range): boolean {\n    return !!(\n        r1 &&\n        r2 &&\n        r1.startContainer == r2.startContainer &&\n        r1.startOffset == r2.startOffset &&\n        r1.endContainer == r2.endContainer &&\n        r1.endOffset == r2.endOffset\n    );\n}\n","import { addSegment, createSelectionMarker } from 'roosterjs-content-model-dom';\nimport type { ContentModelTableRow } from 'roosterjs-content-model-types';\nimport type { TableSelectionCoordinates } from '../table/getSelectedCells';\n\n/**\n * @internal\n */\nexport function collapseTableSelection(\n    rows: ContentModelTableRow[],\n    selection: TableSelectionCoordinates\n) {\n    const { firstCol, firstRow } = selection;\n    const cell = rows[firstRow]?.cells[firstCol];\n    if (cell) {\n        addSegment(cell, createSelectionMarker());\n    }\n}\n","import { getClosestAncestorBlockGroupIndex } from '../common/getClosestAncestorBlockGroupIndex';\nimport { isBlockGroupOfType } from '../common/isBlockGroupOfType';\nimport { iterateSelections } from './iterateSelections';\nimport type { IterateSelectionsOption } from './iterateSelections';\nimport type { TableSelectionContext } from '../../publicTypes/selection/TableSelectionContext';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelBlockGroupType,\n    ContentModelDocument,\n    ContentModelListItem,\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelTable,\n} from 'roosterjs-content-model-types';\nimport type { TypeOfBlockGroup } from '../common/getClosestAncestorBlockGroupIndex';\n\n/**\n * @internal\n */\nexport type OperationalBlocks<T extends ContentModelBlockGroup> = {\n    parent: ContentModelBlockGroup;\n    block: ContentModelBlock | T;\n};\n\n/**\n * @internal\n */\nexport function getSelectedSegmentsAndParagraphs(\n    model: ContentModelDocument,\n    includingFormatHolder: boolean\n): [ContentModelSegment, ContentModelParagraph | null][] {\n    const selections = collectSelections(model, {\n        includeListFormatHolder: includingFormatHolder ? 'allSegments' : 'never',\n    });\n    const result: [ContentModelSegment, ContentModelParagraph | null][] = [];\n\n    selections.forEach(({ segments, block }) => {\n        if (segments && ((includingFormatHolder && !block) || block?.blockType == 'Paragraph')) {\n            segments.forEach(segment => {\n                if (segment.segmentType != 'Entity' || !segment.entityFormat.isReadonly) {\n                    result.push([segment, block?.blockType == 'Paragraph' ? block : null]);\n                }\n            });\n        }\n    });\n\n    return result;\n}\n\n/**\n * @internal\n */\nexport function getSelectedParagraphs(model: ContentModelDocument): ContentModelParagraph[] {\n    const selections = collectSelections(model, { includeListFormatHolder: 'never' });\n    const result: ContentModelParagraph[] = [];\n\n    removeUnmeaningfulSelections(selections);\n\n    selections.forEach(({ block }) => {\n        if (block?.blockType == 'Paragraph') {\n            result.push(block);\n        }\n    });\n\n    return result;\n}\n\n/**\n * @internal\n */\nexport function getOperationalBlocks<T extends ContentModelBlockGroup>(\n    model: ContentModelDocument,\n    blockGroupTypes: TypeOfBlockGroup<T>[],\n    stopTypes: ContentModelBlockGroupType[],\n    deepFirst?: boolean\n): OperationalBlocks<T>[] {\n    const result: OperationalBlocks<T>[] = [];\n    const findSequence = deepFirst ? blockGroupTypes.map(type => [type]) : [blockGroupTypes];\n    const selections = collectSelections(model, {\n        includeListFormatHolder: 'never',\n        contentUnderSelectedTableCell: 'ignoreForTable', // When whole table is selected, we treat the table as a single block\n    });\n\n    removeUnmeaningfulSelections(selections);\n\n    selections.forEach(({ path, block }) => {\n        for (let i = 0; i < findSequence.length; i++) {\n            const groupIndex = getClosestAncestorBlockGroupIndex(path, findSequence[i], stopTypes);\n\n            if (groupIndex >= 0) {\n                if (result.filter(x => x.block == path[groupIndex]).length <= 0) {\n                    result.push({\n                        parent: path[groupIndex + 1],\n                        block: path[groupIndex] as T,\n                    });\n                }\n                break;\n            } else if (i == findSequence.length - 1 && block) {\n                result.push({\n                    parent: path[0],\n                    block: block,\n                });\n                break;\n            }\n        }\n    });\n\n    return result;\n}\n\n/**\n * @internal\n */\nexport function getFirstSelectedTable(\n    model: ContentModelDocument\n): [ContentModelTable | undefined, ContentModelBlockGroup[]] {\n    const selections = collectSelections(model, { includeListFormatHolder: 'never' });\n    let table: ContentModelTable | undefined;\n    let resultPath: ContentModelBlockGroup[] = [];\n\n    removeUnmeaningfulSelections(selections);\n\n    selections.forEach(({ block, tableContext, path }) => {\n        if (!table) {\n            if (block?.blockType == 'Table') {\n                table = block;\n                resultPath = [...path];\n            } else if (tableContext?.table) {\n                table = tableContext.table;\n\n                const parent = path.filter(\n                    group => group.blocks.indexOf(tableContext.table) >= 0\n                )[0];\n                const index = path.indexOf(parent);\n                resultPath = index >= 0 ? path.slice(index) : [];\n            }\n        }\n    });\n\n    return [table, resultPath];\n}\n\n/**\n * @internal\n */\nexport function getFirstSelectedListItem(\n    model: ContentModelDocument\n): ContentModelListItem | undefined {\n    let listItem: ContentModelListItem | undefined;\n\n    getOperationalBlocks(model, ['ListItem'], ['TableCell']).forEach(r => {\n        if (!listItem && isBlockGroupOfType<ContentModelListItem>(r.block, 'ListItem')) {\n            listItem = r.block;\n        }\n    });\n\n    return listItem;\n}\n\ninterface SelectionInfo {\n    path: ContentModelBlockGroup[];\n    segments?: ContentModelSegment[];\n    block?: ContentModelBlock;\n    tableContext?: TableSelectionContext;\n}\n\nfunction collectSelections(\n    model: ContentModelDocument,\n    option?: IterateSelectionsOption\n): SelectionInfo[] {\n    const selections: SelectionInfo[] = [];\n\n    iterateSelections(\n        [model],\n        (path, tableContext, block, segments) => {\n            selections.push({\n                path,\n                tableContext,\n                block,\n                segments,\n            });\n        },\n        option\n    );\n\n    return selections;\n}\n\nfunction removeUnmeaningfulSelections(selections: SelectionInfo[]) {\n    if (\n        selections.length > 1 &&\n        isOnlySelectionMarkerSelected(selections, false /*checkFirstParagraph*/)\n    ) {\n        selections.pop();\n    }\n\n    // Remove head paragraph if first selection marker is the only selection\n    if (\n        selections.length > 1 &&\n        isOnlySelectionMarkerSelected(selections, true /*checkFirstParagraph*/)\n    ) {\n        selections.shift();\n    }\n}\n\nfunction isOnlySelectionMarkerSelected(\n    selections: SelectionInfo[],\n    checkFirstParagraph: boolean\n): boolean {\n    const selection = selections[checkFirstParagraph ? 0 : selections.length - 1];\n\n    if (\n        selection.block?.blockType == 'Paragraph' &&\n        selection.segments &&\n        selection.segments.length > 0\n    ) {\n        const allSegments = selection.block.segments;\n        const segment = selection.segments[0];\n\n        return (\n            selection.segments.length == 1 &&\n            segment.segmentType == 'SelectionMarker' &&\n            segment == allSegments[checkFirstParagraph ? allSegments.length - 1 : 0]\n        );\n    } else {\n        return false;\n    }\n}\n","import type { DOMSelection } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function getSelectionRootNode(selection: DOMSelection | undefined): Node | undefined {\n    return !selection\n        ? undefined\n        : selection.type == 'range'\n        ? selection.range.commonAncestorContainer\n        : selection.type == 'table'\n        ? selection.table\n        : selection.type == 'image'\n        ? selection.image\n        : undefined;\n}\n","import type { TableSelectionContext } from '../../publicTypes/selection/TableSelectionContext';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelBlockWithCache,\n    ContentModelSegment,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport interface IterateSelectionsOption {\n    /**\n     * For selected table cell, this property determines how do we handle its content.\n     * include: No matter if table cell is selected, always invoke callback function for selected content (default value)\n     * ignoreForTable: When the whole table is selected we invoke callback for the table (using block parameter) but skip\n     * all its cells and content, otherwise keep invoking callback for table cell and content\n     * ignoreForTableOrCell: If whole table is selected, same with ignoreForTable, or if a table cell is selected, only\n     * invoke callback for the table cell itself but not for its content, otherwise keep invoking callback for content.\n     * @default include\n     */\n    contentUnderSelectedTableCell?: 'include' | 'ignoreForTable' | 'ignoreForTableOrCell';\n\n    /**\n     * For a selected general element, this property determines how do we handle its content.\n     * contentOnly: (Default) When the whole general element is selected, we only invoke callback for its selected content\n     * generalElementOnly: When the whole general element is selected, we only invoke callback for the general element (using block or\n     * segment parameter depends on if it is a block or segment), but skip all its content.\n     * both: When general element is selected, we invoke callback first for its content, then for general element itself\n     */\n    contentUnderSelectedGeneralElement?: 'contentOnly' | 'generalElementOnly' | 'both';\n\n    /**\n     * Whether call the callback for the list item format holder segment\n     * anySegment: call the callback if any segment is selected under a list item\n     * allSegments: call the callback only when all segments under the list item are selected\n     * never: never call the callback for list item format holder\n     * @default allSegments\n     */\n    includeListFormatHolder?: 'anySegment' | 'allSegments' | 'never';\n}\n\n/**\n * @internal\n * @returns True to stop iterating, otherwise keep going\n */\nexport type IterateSelectionsCallback = (\n    path: ContentModelBlockGroup[],\n    tableContext?: TableSelectionContext,\n    block?: ContentModelBlock,\n    segments?: ContentModelSegment[]\n) => void | boolean;\n\n/**\n * @internal\n * @returns True to stop iterating, otherwise keep going\n */\nexport function iterateSelections(\n    path: ContentModelBlockGroup[],\n    callback: IterateSelectionsCallback,\n    option?: IterateSelectionsOption,\n    table?: TableSelectionContext,\n    treatAllAsSelect?: boolean\n) {\n    const internalCallback: IterateSelectionsCallback = (path, tableContext, block, segments) => {\n        if (!!(block as ContentModelBlockWithCache)?.cachedElement) {\n            // TODO: This is a temporary solution. A better solution would be making all results from iterationSelection() to be readonly,\n            // use a util function to change it to be editable before edit them where we clear its cached element\n            delete (block as ContentModelBlockWithCache).cachedElement;\n        }\n\n        return callback(path, tableContext, block, segments);\n    };\n\n    internalIterateSelections(path, internalCallback, option, table, treatAllAsSelect);\n}\n\nfunction internalIterateSelections(\n    path: ContentModelBlockGroup[],\n    callback: IterateSelectionsCallback,\n    option?: IterateSelectionsOption,\n    table?: TableSelectionContext,\n    treatAllAsSelect?: boolean\n): boolean {\n    const parent = path[0];\n    const includeListFormatHolder = option?.includeListFormatHolder || 'allSegments';\n    const contentUnderSelectedTableCell = option?.contentUnderSelectedTableCell || 'include';\n    const contentUnderSelectedGeneralElement =\n        option?.contentUnderSelectedGeneralElement || 'contentOnly';\n\n    let hasSelectedSegment = false;\n    let hasUnselectedSegment = false;\n\n    for (let i = 0; i < parent.blocks.length; i++) {\n        const block = parent.blocks[i];\n\n        switch (block.blockType) {\n            case 'BlockGroup':\n                const newPath = [block, ...path];\n\n                if (block.blockGroupType == 'General') {\n                    const isSelected = treatAllAsSelect || block.isSelected;\n                    const handleGeneralContent =\n                        !isSelected ||\n                        contentUnderSelectedGeneralElement == 'both' ||\n                        contentUnderSelectedGeneralElement == 'contentOnly';\n                    const handleGeneralElement =\n                        isSelected &&\n                        (contentUnderSelectedGeneralElement == 'both' ||\n                            contentUnderSelectedGeneralElement == 'generalElementOnly' ||\n                            block.blocks.length == 0);\n\n                    if (\n                        (handleGeneralContent &&\n                            internalIterateSelections(\n                                newPath,\n                                callback,\n                                option,\n                                table,\n                                isSelected\n                            )) ||\n                        (handleGeneralElement && callback(path, table, block))\n                    ) {\n                        return true;\n                    }\n                } else if (\n                    internalIterateSelections(newPath, callback, option, table, treatAllAsSelect)\n                ) {\n                    return true;\n                }\n                break;\n\n            case 'Table':\n                const rows = block.rows;\n                const isWholeTableSelected = rows.every(row =>\n                    row.cells.every(cell => cell.isSelected)\n                );\n\n                if (contentUnderSelectedTableCell != 'include' && isWholeTableSelected) {\n                    if (callback(path, table, block)) {\n                        return true;\n                    }\n                } else {\n                    for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {\n                        const row = rows[rowIndex];\n\n                        for (let colIndex = 0; colIndex < row.cells.length; colIndex++) {\n                            const cell = row.cells[colIndex];\n                            if (!cell) {\n                                continue;\n                            }\n\n                            const newTable: TableSelectionContext = {\n                                table: block,\n                                rowIndex,\n                                colIndex,\n                                isWholeTableSelected,\n                            };\n\n                            if (cell.isSelected && callback(path, newTable)) {\n                                return true;\n                            }\n\n                            if (\n                                !cell.isSelected ||\n                                contentUnderSelectedTableCell != 'ignoreForTableOrCell'\n                            ) {\n                                const newPath = [cell, ...path];\n                                const isSelected = treatAllAsSelect || cell.isSelected;\n\n                                if (\n                                    internalIterateSelections(\n                                        newPath,\n                                        callback,\n                                        option,\n                                        newTable,\n                                        isSelected\n                                    )\n                                ) {\n                                    return true;\n                                }\n                            }\n                        }\n                    }\n                }\n\n                break;\n\n            case 'Paragraph':\n                const segments: ContentModelSegment[] = [];\n\n                for (let i = 0; i < block.segments.length; i++) {\n                    const segment = block.segments[i];\n                    const isSelected = treatAllAsSelect || segment.isSelected;\n\n                    if (segment.segmentType == 'General') {\n                        const handleGeneralContent =\n                            !isSelected ||\n                            contentUnderSelectedGeneralElement == 'both' ||\n                            contentUnderSelectedGeneralElement == 'contentOnly';\n                        const handleGeneralElement =\n                            isSelected &&\n                            (contentUnderSelectedGeneralElement == 'both' ||\n                                contentUnderSelectedGeneralElement == 'generalElementOnly' ||\n                                segment.blocks.length == 0);\n\n                        if (\n                            handleGeneralContent &&\n                            internalIterateSelections(\n                                [segment, ...path],\n                                callback,\n                                option,\n                                table,\n                                isSelected\n                            )\n                        ) {\n                            return true;\n                        }\n\n                        if (handleGeneralElement) {\n                            segments.push(segment);\n                        }\n                    } else if (isSelected) {\n                        segments.push(segment);\n                    }\n\n                    if (isSelected) {\n                        hasSelectedSegment = true;\n                    } else {\n                        hasUnselectedSegment = true;\n                    }\n                }\n\n                if (segments.length > 0 && callback(path, table, block, segments)) {\n                    return true;\n                }\n                break;\n\n            case 'Divider':\n            case 'Entity':\n                if ((treatAllAsSelect || block.isSelected) && callback(path, table, block)) {\n                    return true;\n                }\n\n                break;\n        }\n    }\n\n    if (\n        includeListFormatHolder != 'never' &&\n        parent.blockGroupType == 'ListItem' &&\n        hasSelectedSegment &&\n        (!hasUnselectedSegment || includeListFormatHolder == 'anySegment') &&\n        // When whole list item is selected, also add its format holder as selected segment\n        callback(path, table, undefined /*block*/, [parent.formatHolder])\n    ) {\n        return true;\n    }\n\n    return false;\n}\n","import { isGeneralSegment } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelSegment,\n    ContentModelTable,\n    Selectable,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function setSelection(group: ContentModelBlockGroup, start?: Selectable, end?: Selectable) {\n    setSelectionToBlockGroup(group, false /*isInSelection*/, start || null, end || null);\n}\n\nfunction setSelectionToBlockGroup(\n    group: ContentModelBlockGroup,\n    isInSelection: boolean,\n    start: Selectable | null,\n    end: Selectable | null\n): boolean {\n    return handleSelection(isInSelection, group, start, end, isInSelection => {\n        if (isGeneralSegment(group)) {\n            setIsSelected(group, isInSelection);\n        }\n\n        group.blocks.forEach(block => {\n            isInSelection = setSelectionToBlock(block, isInSelection, start, end);\n        });\n\n        return isInSelection;\n    });\n}\n\nfunction setSelectionToBlock(\n    block: ContentModelBlock,\n    isInSelection: boolean,\n    start: Selectable | null,\n    end: Selectable | null\n) {\n    switch (block.blockType) {\n        case 'BlockGroup':\n            return setSelectionToBlockGroup(block, isInSelection, start, end);\n\n        case 'Table':\n            return setSelectionToTable(block, isInSelection, start, end);\n\n        case 'Divider':\n        case 'Entity':\n            return handleSelection(isInSelection, block, start, end, isInSelection => {\n                if (isInSelection) {\n                    block.isSelected = true;\n                } else {\n                    delete block.isSelected;\n                }\n\n                return isInSelection;\n            });\n\n        case 'Paragraph':\n            const segmentsToDelete: number[] = [];\n\n            block.segments.forEach((segment, i) => {\n                isInSelection = handleSelection(\n                    isInSelection,\n                    segment,\n                    start,\n                    end,\n                    isInSelection => {\n                        return setSelectionToSegment(\n                            segment,\n                            isInSelection,\n                            segmentsToDelete,\n                            start,\n                            end,\n                            i\n                        );\n                    }\n                );\n            });\n\n            while (segmentsToDelete.length > 0) {\n                const index = segmentsToDelete.pop()!;\n\n                if (index >= 0) {\n                    block.segments.splice(index, 1);\n                }\n            }\n\n            return isInSelection;\n\n        default:\n            return isInSelection;\n    }\n}\n\nfunction setSelectionToTable(\n    table: ContentModelTable,\n    isInSelection: boolean,\n    start: Selectable | null,\n    end: Selectable | null\n): boolean {\n    const first = findCell(table, start);\n    const last = end ? findCell(table, end) : first;\n\n    if (!isInSelection) {\n        for (let row = 0; row < table.rows.length; row++) {\n            const currentRow = table.rows[row];\n            for (let col = 0; col < currentRow.cells.length; col++) {\n                const currentCell = table.rows[row].cells[col];\n                const isSelected =\n                    row >= first.row && row <= last.row && col >= first.col && col <= last.col;\n\n                setIsSelected(currentCell, isSelected);\n\n                if (!isSelected) {\n                    setSelectionToBlockGroup(\n                        currentCell,\n                        false /*isInSelection*/,\n                        null /*start*/,\n                        null /*end*/\n                    );\n                }\n            }\n        }\n    } else {\n        table.rows.forEach(row =>\n            row.cells.forEach(cell => {\n                isInSelection = setSelectionToBlockGroup(cell, isInSelection, start, end);\n            })\n        );\n    }\n\n    return isInSelection;\n}\n\nfunction findCell(table: ContentModelTable, cell: Selectable | null): { row: number; col: number } {\n    let col = -1;\n    const row = cell\n        ? table.rows.findIndex(row => (col = (row.cells as Selectable[]).indexOf(cell)) >= 0)\n        : -1;\n\n    return { row, col };\n}\n\nfunction setSelectionToSegment(\n    segment: ContentModelSegment,\n    isInSelection: boolean,\n    segmentsToDelete: number[],\n    start: Selectable | null,\n    end: Selectable | null,\n    i: number\n) {\n    switch (segment.segmentType) {\n        case 'SelectionMarker':\n            if (!isInSelection || (segment != start && segment != end)) {\n                // Delete the selection marker when\n                // 1. It is not in selection any more. Or\n                // 2. It is in middle of selection, so no need to have it\n                segmentsToDelete.push(i);\n            }\n            return isInSelection;\n\n        case 'General':\n            setIsSelected(segment, isInSelection);\n\n            return segment != start && segment != end\n                ? setSelectionToBlockGroup(segment, isInSelection, start, end)\n                : isInSelection;\n\n        case 'Image':\n            setIsSelected(segment, isInSelection);\n            segment.isSelectedAsImageSelection = start == segment && (!end || end == segment);\n            return isInSelection;\n        default:\n            setIsSelected(segment, isInSelection);\n            return isInSelection;\n    }\n}\n\nfunction setIsSelected(selectable: Selectable, value: boolean) {\n    if (value) {\n        selectable.isSelected = true;\n    } else {\n        delete selectable.isSelected;\n    }\n\n    return value;\n}\n\nfunction handleSelection(\n    isInSelection: boolean,\n    model: ContentModelBlockGroup | ContentModelBlock | ContentModelSegment,\n    start: Selectable | null,\n    end: Selectable | null,\n    callback: (isInSelection: boolean) => boolean\n) {\n    isInSelection = isInSelection || model == start;\n    isInSelection = callback(isInSelection);\n    return isInSelection && !!end && model != end;\n}\n","import { TableOperation } from 'roosterjs-editor-types';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\nimport type { CompatibleTableOperation } from 'roosterjs-editor-types/lib/compatibleTypes';\n\n/**\n * @internal\n */\nexport function alignTable(\n    table: ContentModelTable,\n    operation:\n        | TableOperation.AlignCenter\n        | TableOperation.AlignLeft\n        | TableOperation.AlignRight\n        | CompatibleTableOperation.AlignCenter\n        | CompatibleTableOperation.AlignLeft\n        | CompatibleTableOperation.AlignRight\n) {\n    table.format.marginLeft = operation == TableOperation.AlignLeft ? '' : 'auto';\n    table.format.marginRight = operation == TableOperation.AlignRight ? '' : 'auto';\n\n    delete table.cachedElement;\n}\n","import { getSelectedCells } from './getSelectedCells';\nimport { TableOperation } from 'roosterjs-editor-types';\nimport { updateTableCellMetadata } from '../../domUtils/metadata/updateTableCellMetadata';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\nimport type { CompatibleTableOperation } from 'roosterjs-editor-types/lib/compatibleTypes';\n\nconst TextAlignValueMap: Partial<Record<TableOperation, 'start' | 'center' | 'end'>> = {\n    [TableOperation.AlignCellLeft]: 'start',\n    [TableOperation.AlignCellCenter]: 'center',\n    [TableOperation.AlignCellRight]: 'end',\n};\n\nconst VerticalAlignValueMap: Partial<Record<TableOperation, 'top' | 'middle' | 'bottom'>> = {\n    [TableOperation.AlignCellTop]: 'top',\n    [TableOperation.AlignCellMiddle]: 'middle',\n    [TableOperation.AlignCellBottom]: 'bottom',\n};\n\n/**\n * @internal\n */\nexport function alignTableCell(\n    table: ContentModelTable,\n    operation:\n        | TableOperation.AlignCellCenter\n        | TableOperation.AlignCellLeft\n        | TableOperation.AlignCellRight\n        | TableOperation.AlignCellTop\n        | TableOperation.AlignCellMiddle\n        | TableOperation.AlignCellBottom\n        | CompatibleTableOperation.AlignCellCenter\n        | CompatibleTableOperation.AlignCellLeft\n        | CompatibleTableOperation.AlignCellRight\n        | CompatibleTableOperation.AlignCellTop\n        | CompatibleTableOperation.AlignCellMiddle\n        | CompatibleTableOperation.AlignCellBottom\n) {\n    const sel = getSelectedCells(table);\n\n    if (sel) {\n        const textAlign = TextAlignValueMap[operation];\n        const verticalAlign = VerticalAlignValueMap[operation];\n\n        for (let rowIndex = sel.firstRow; rowIndex <= sel.lastRow; rowIndex++) {\n            for (let colIndex = sel.firstCol; colIndex <= sel.lastCol; colIndex++) {\n                const cell = table.rows[rowIndex]?.cells[colIndex];\n                const format = cell?.format;\n\n                if (format) {\n                    delete cell.cachedElement;\n\n                    format.textAlign = textAlign || format.textAlign;\n                    format.verticalAlign = verticalAlign || format.verticalAlign;\n\n                    if (verticalAlign) {\n                        updateTableCellMetadata(cell, metadata => {\n                            metadata = metadata || {};\n                            metadata.vAlignOverride = true;\n                            return metadata;\n                        });\n                    }\n\n                    cell.blocks.forEach(block => {\n                        if (block.blockType === 'Paragraph') {\n                            delete block.format.textAlign;\n                        }\n                    });\n                }\n            }\n        }\n    }\n}\n","import { BorderKeys } from 'roosterjs-content-model-dom';\nimport { combineBorderValue, extractBorderValues } from '../../domUtils/borderValues';\nimport { setTableCellBackgroundColor } from './setTableCellBackgroundColor';\nimport { TableBorderFormat } from 'roosterjs-editor-types';\nimport { updateTableCellMetadata } from '../../domUtils/metadata/updateTableCellMetadata';\nimport { updateTableMetadata } from '../../domUtils/metadata/updateTableMetadata';\nimport type {\n    BorderFormat,\n    ContentModelTable,\n    ContentModelTableRow,\n    TableMetadataFormat,\n} from 'roosterjs-content-model-types';\n\nconst DEFAULT_FORMAT: Required<TableMetadataFormat> = {\n    topBorderColor: '#ABABAB',\n    bottomBorderColor: '#ABABAB',\n    verticalBorderColor: '#ABABAB',\n    hasHeaderRow: false,\n    hasFirstColumn: false,\n    hasBandedRows: false,\n    hasBandedColumns: false,\n    bgColorEven: null,\n    bgColorOdd: '#ABABAB20',\n    headerRowColor: '#ABABAB',\n    tableBorderFormat: TableBorderFormat.DEFAULT,\n    verticalAlign: null,\n};\n\ntype MetaOverrides = {\n    bgColorOverrides: boolean[][];\n    vAlignOverrides: boolean[][];\n};\n\n/**\n * @internal\n */\nexport function applyTableFormat(\n    table: ContentModelTable,\n    newFormat?: TableMetadataFormat,\n    keepCellShade?: boolean\n) {\n    const { rows } = table;\n\n    updateTableMetadata(table, format => {\n        const effectiveMetadata = {\n            ...DEFAULT_FORMAT,\n            ...format,\n            ...(newFormat || {}),\n        };\n\n        const metaOverrides: MetaOverrides = updateOverrides(rows, !keepCellShade);\n\n        delete table.cachedElement;\n\n        clearCache(rows);\n        formatCells(rows, effectiveMetadata, metaOverrides);\n        setFirstColumnFormat(rows, effectiveMetadata, metaOverrides);\n        setHeaderRowFormat(rows, effectiveMetadata, metaOverrides);\n        return effectiveMetadata;\n    });\n}\n\nfunction clearCache(rows: ContentModelTableRow[]) {\n    rows.forEach(row => {\n        row.cells.forEach(cell => {\n            delete cell.cachedElement;\n        });\n\n        delete row.cachedElement;\n    });\n}\n\nfunction updateOverrides(rows: ContentModelTableRow[], removeCellShade: boolean): MetaOverrides {\n    const overrides: MetaOverrides = { bgColorOverrides: [], vAlignOverrides: [] };\n\n    rows.forEach(row => {\n        const bgColorOverrides: boolean[] = [];\n        const vAlignOverrides: boolean[] = [];\n\n        overrides.bgColorOverrides.push(bgColorOverrides);\n        overrides.vAlignOverrides.push(vAlignOverrides);\n\n        row.cells.forEach(cell => {\n            updateTableCellMetadata(cell, metadata => {\n                if (metadata && removeCellShade) {\n                    bgColorOverrides.push(false);\n                    delete metadata.bgColorOverride;\n                } else {\n                    bgColorOverrides.push(!!metadata?.bgColorOverride);\n                }\n                vAlignOverrides.push(!!metadata?.vAlignOverride);\n\n                return metadata;\n            });\n        });\n    });\n\n    return overrides;\n}\n\ntype ShouldUseTransparentBorder = (indexProp: {\n    firstRow: boolean;\n    lastRow: boolean;\n    firstColumn: boolean;\n    lastColumn: boolean;\n}) => [boolean, boolean, boolean, boolean];\n\nconst BorderFormatters: Record<TableBorderFormat, ShouldUseTransparentBorder> = {\n    [TableBorderFormat.DEFAULT]: _ => [false, false, false, false],\n    [TableBorderFormat.LIST_WITH_SIDE_BORDERS]: ({ lastColumn, firstColumn }) => [\n        false,\n        !lastColumn,\n        false,\n        !firstColumn,\n    ],\n    [TableBorderFormat.FIRST_COLUMN_HEADER_EXTERNAL]: ({\n        firstColumn,\n        firstRow,\n        lastColumn,\n        lastRow,\n    }) => [\n        !firstRow,\n        (!lastColumn && !firstColumn) || (firstColumn && firstRow),\n        !lastRow && !firstRow,\n        !firstColumn,\n    ],\n    [TableBorderFormat.NO_HEADER_BORDERS]: ({ firstRow, firstColumn, lastColumn }) => [\n        firstRow,\n        firstRow || lastColumn,\n        false,\n        firstRow || firstColumn,\n    ],\n    [TableBorderFormat.NO_SIDE_BORDERS]: ({ firstColumn, lastColumn }) => [\n        false,\n        lastColumn,\n        false,\n        firstColumn,\n    ],\n    [TableBorderFormat.ESPECIAL_TYPE_1]: ({ firstRow, firstColumn }) => [\n        firstColumn && !firstRow,\n        firstRow,\n        firstColumn && !firstRow,\n        firstRow && !firstColumn,\n    ],\n    [TableBorderFormat.ESPECIAL_TYPE_2]: ({ firstRow, firstColumn }) => [\n        !firstRow,\n        firstRow || !firstColumn,\n        !firstRow,\n        !firstColumn,\n    ],\n    [TableBorderFormat.ESPECIAL_TYPE_3]: ({ firstColumn, firstRow }) => [\n        true,\n        firstRow || !firstColumn,\n        !firstRow,\n        true,\n    ],\n    [TableBorderFormat.CLEAR]: () => [true, true, true, true],\n};\n\n/*\n * Apply vertical align, borders, and background color to all cells in the table\n */\nfunction formatCells(\n    rows: ContentModelTableRow[],\n    format: TableMetadataFormat,\n    metaOverrides: MetaOverrides\n) {\n    const { hasBandedRows, hasBandedColumns, bgColorOdd, bgColorEven } = format;\n\n    rows.forEach((row, rowIndex) => {\n        row.cells.forEach((cell, colIndex) => {\n            // Format Borders\n            const transparentBorderMatrix = BorderFormatters[\n                format.tableBorderFormat as TableBorderFormat\n            ]({\n                firstRow: rowIndex === 0,\n                lastRow: rowIndex === rows.length - 1,\n                firstColumn: colIndex === 0,\n                lastColumn: colIndex === row.cells.length - 1,\n            });\n\n            const formatColor = [\n                format.topBorderColor,\n                format.verticalBorderColor,\n                format.bottomBorderColor,\n                format.verticalBorderColor,\n            ];\n\n            transparentBorderMatrix.forEach((alwaysUseTransparent, i) => {\n                const borderColor = (!alwaysUseTransparent && formatColor[i]) || '';\n\n                cell.format[BorderKeys[i]] = combineBorderValue({\n                    style: getBorderStyleFromColor(borderColor),\n                    width: '1px',\n                    color: borderColor,\n                });\n            });\n\n            // Format Background Color\n            if (!metaOverrides.bgColorOverrides[rowIndex][colIndex]) {\n                const color =\n                    hasBandedRows || hasBandedColumns\n                        ? (hasBandedColumns && colIndex % 2 != 0) ||\n                          (hasBandedRows && rowIndex % 2 != 0)\n                            ? bgColorOdd\n                            : bgColorEven\n                        : bgColorEven; /* bgColorEven is the default color */\n\n                setTableCellBackgroundColor(\n                    cell,\n                    color,\n                    false /*isColorOverride*/,\n                    true /*applyToSegments*/\n                );\n            }\n\n            // Format Vertical Align\n            if (format.verticalAlign && !metaOverrides.vAlignOverrides[rowIndex][colIndex]) {\n                cell.format.verticalAlign = format.verticalAlign;\n            }\n        });\n    });\n}\n\nfunction setFirstColumnFormat(\n    rows: ContentModelTableRow[],\n    format: Partial<TableMetadataFormat>,\n    metaOverrides: MetaOverrides\n) {\n    rows.forEach((row, rowIndex) => {\n        row.cells.forEach((cell, cellIndex) => {\n            if (format.hasFirstColumn && cellIndex === 0) {\n                cell.isHeader = true;\n\n                if (rowIndex !== 0 && !metaOverrides.bgColorOverrides[rowIndex][cellIndex]) {\n                    setBorderColor(cell.format, 'borderTop');\n                    setTableCellBackgroundColor(\n                        cell,\n                        null /*color*/,\n                        false /*isColorOverride*/,\n                        true /*applyToSegments*/\n                    );\n                }\n\n                if (rowIndex !== rows.length - 1 && rowIndex !== 0) {\n                    setBorderColor(cell.format, 'borderBottom');\n                }\n            } else {\n                cell.isHeader = false;\n            }\n        });\n    });\n}\n\nfunction setHeaderRowFormat(\n    rows: ContentModelTableRow[],\n    format: TableMetadataFormat,\n    metaOverrides: MetaOverrides\n) {\n    const rowIndex = 0;\n\n    rows[rowIndex]?.cells.forEach((cell, cellIndex) => {\n        cell.isHeader = format.hasHeaderRow;\n\n        if (format.hasHeaderRow && format.headerRowColor) {\n            if (!metaOverrides.bgColorOverrides[rowIndex][cellIndex]) {\n                setTableCellBackgroundColor(\n                    cell,\n                    format.headerRowColor,\n                    false /*isColorOverride*/,\n                    true /*applyToSegments*/\n                );\n            }\n\n            setBorderColor(cell.format, 'borderTop', format.headerRowColor);\n            setBorderColor(cell.format, 'borderRight', format.headerRowColor);\n            setBorderColor(cell.format, 'borderLeft', format.headerRowColor);\n        }\n    });\n}\n\nfunction setBorderColor(format: BorderFormat, key: keyof BorderFormat, value?: string) {\n    const border = extractBorderValues(format[key]);\n    border.color = value || '';\n    border.style = getBorderStyleFromColor(border.color);\n    format[key] = combineBorderValue(border);\n}\n\nfunction getBorderStyleFromColor(color?: string): string {\n    return !color || color == 'transparent' ? 'none' : 'solid';\n}\n","import type { ContentModelTableRow } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function canMergeCells(\n    rows: ContentModelTableRow[],\n    firstRow: number,\n    firstCol: number,\n    lastRow: number,\n    lastCol: number\n): boolean {\n    const noSpanAbove =\n        firstCol == lastCol ||\n        rows[firstRow].cells.every(\n            (cell, colIndex) => colIndex < firstCol || colIndex > lastCol || !cell.spanAbove\n        );\n    const noSpanLeft =\n        firstRow == lastRow ||\n        rows.every(\n            (row, rowIndex) =>\n                rowIndex < firstRow || rowIndex > lastRow || !row.cells[firstCol].spanLeft\n        );\n\n    const noDifferentBelowSpan = rows[lastRow].cells\n        .map((_, colIndex) =>\n            colIndex >= firstCol && colIndex <= lastCol\n                ? getBelowSpanCount(rows, lastRow, colIndex)\n                : -1\n        )\n        .every((x, _, a) => x < 0 || x == a[firstCol]);\n    const noDifferentRightSpan = rows\n        .map((_, rowIndex) =>\n            rowIndex >= firstRow && rowIndex <= lastRow\n                ? getRightSpanCount(rows, rowIndex, lastCol)\n                : -1\n        )\n        .every((x, _, a) => x < 0 || x == a[firstRow]);\n\n    return noSpanAbove && noSpanLeft && noDifferentBelowSpan && noDifferentRightSpan;\n}\n\nfunction getBelowSpanCount(rows: ContentModelTableRow[], rowIndex: number, colIndex: number) {\n    let spanCount = 0;\n\n    for (let row = rowIndex + 1; row < rows.length; row++) {\n        if (rows[row]?.cells[colIndex]?.spanAbove) {\n            spanCount++;\n        } else {\n            break;\n        }\n    }\n\n    return spanCount;\n}\n\nfunction getRightSpanCount(rows: ContentModelTableRow[], rowIndex: number, colIndex: number) {\n    let spanCount = 0;\n\n    for (let col = colIndex + 1; col < rows[rowIndex]?.cells.length; col++) {\n        if (rows[rowIndex]?.cells[col]?.spanLeft) {\n            spanCount++;\n        } else {\n            break;\n        }\n    }\n\n    return spanCount;\n}\n","import { addBlock, createTable, createTableCell } from 'roosterjs-content-model-dom';\nimport type { ContentModelBlockGroup, ContentModelTable } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function createTableStructure(\n    parent: ContentModelBlockGroup,\n    columns: number,\n    rows: number\n): ContentModelTable {\n    const table = createTable(rows);\n\n    addBlock(parent, table);\n\n    table.rows.forEach(row => {\n        for (let i = 0; i < columns; i++) {\n            const cell = createTableCell();\n\n            row.cells.push(cell);\n        }\n    });\n\n    return table;\n}\n","import type { ContentModelTable } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function deleteTable(table: ContentModelTable) {\n    table.rows = [];\n    delete table.cachedElement;\n}\n","import { collapseTableSelection } from '../selection/collapseTableSelection';\nimport { getSelectedCells } from './getSelectedCells';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function deleteTableColumn(table: ContentModelTable) {\n    const sel = getSelectedCells(table);\n\n    if (sel) {\n        for (let rowIndex = 0; rowIndex < table.rows.length; rowIndex++) {\n            const cellInNextCol = table.rows[rowIndex].cells[sel.lastCol + 1];\n\n            if (cellInNextCol) {\n                cellInNextCol.spanLeft =\n                    cellInNextCol.spanLeft && table.rows[rowIndex].cells[sel.firstCol].spanLeft;\n            }\n\n            table.rows[rowIndex].cells.splice(sel.firstCol, sel.lastCol - sel.firstCol + 1);\n        }\n\n        table.widths.splice(sel.firstCol, sel.lastCol - sel.firstCol + 1);\n        collapseTableSelection(table.rows, sel);\n    }\n}\n","import { collapseTableSelection } from '../selection/collapseTableSelection';\nimport { getSelectedCells } from './getSelectedCells';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function deleteTableRow(table: ContentModelTable) {\n    const sel = getSelectedCells(table);\n\n    if (sel) {\n        table.rows[sel.firstRow].cells.forEach((cell, colIndex) => {\n            const cellInNextRow = table.rows[sel.lastRow + 1]?.cells[colIndex];\n\n            if (cellInNextRow) {\n                cellInNextRow.spanAbove = cellInNextRow.spanAbove && cell.spanAbove;\n            }\n        });\n\n        table.rows.splice(sel.firstRow, sel.lastRow - sel.firstRow + 1);\n\n        collapseTableSelection(table.rows, sel);\n    }\n}\n","import { createBr, createParagraph } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelDocument,\n    ContentModelParagraph,\n    ContentModelTable,\n} from 'roosterjs-content-model-types';\n\n/**\n * @internal\n * After edit table, it maybe in a abnormal state, e.g. selected table cell is removed, or all rows are removed causes no place to put cursor.\n * We need to make sure table is in normal state, and there is a place to put cursor.\n * @returns a new paragraph that can but put focus in, or undefined if not needed\n */\nexport function ensureFocusableParagraphForTable(\n    model: ContentModelDocument,\n    path: ContentModelBlockGroup[],\n    table: ContentModelTable\n): ContentModelParagraph | undefined {\n    let paragraph: ContentModelParagraph | undefined;\n    const firstCell = table.rows.filter(row => row.cells.length > 0)[0]?.cells[0];\n\n    if (firstCell) {\n        // When there is a valid cell to put focus, use it\n        paragraph = firstCell.blocks.filter(\n            (block): block is ContentModelParagraph => block.blockType == 'Paragraph'\n        )[0];\n\n        if (!paragraph) {\n            // If there is not a paragraph under this cell, create one\n            paragraph = createEmptyParagraph(model);\n            firstCell.blocks.push(paragraph);\n        }\n    } else {\n        // No table cell at all, which means the whole table is deleted. So we need to remove it from content model.\n        let block: ContentModelBlock = table;\n        let parent: ContentModelBlockGroup | undefined;\n        paragraph = createEmptyParagraph(model);\n\n        // If the table is the only block of its parent and parent is a FormatContainer, remove the parent as well.\n        // We need to do this in a loop in case there are multiple layer of FormatContainer that match this case\n        while ((parent = path.shift())) {\n            const index = parent.blocks.indexOf(block) ?? -1;\n\n            if (parent && index >= 0) {\n                parent.blocks.splice(index, 1, paragraph);\n            }\n\n            if (\n                parent.blockGroupType == 'FormatContainer' &&\n                parent.blocks.length == 1 &&\n                parent.blocks[0] == paragraph\n            ) {\n                // If the new paragraph is the only child of parent format container, unwrap parent as well\n                block = parent;\n            } else {\n                // Otherwise, just stop here and keep processing the new paragraph\n                break;\n            }\n        }\n    }\n\n    return paragraph;\n}\n\nfunction createEmptyParagraph(model: ContentModelDocument) {\n    const newPara = createParagraph(false /*isImplicit*/, undefined /*blockFormat*/, model.format);\n    const br = createBr(model.format);\n\n    newPara.segments.push(br);\n\n    return newPara;\n}\n","import hasSelectionInBlockGroup from '../../publicApi/selection/hasSelectionInBlockGroup';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport interface TableSelectionCoordinates {\n    firstRow: number;\n    firstCol: number;\n    lastRow: number;\n    lastCol: number;\n}\n\n/**\n * @internal\n */\nexport function getSelectedCells(table: ContentModelTable): TableSelectionCoordinates | null {\n    let firstRow = -1;\n    let firstCol = -1;\n    let lastRow = -1;\n    let lastCol = -1;\n    let hasSelection = false;\n\n    table.rows.forEach((row, rowIndex) =>\n        row.cells.forEach((cell, colIndex) => {\n            if (hasSelectionInBlockGroup(cell)) {\n                hasSelection = true;\n\n                if (firstRow < 0) {\n                    firstRow = rowIndex;\n                }\n\n                if (firstCol < 0) {\n                    firstCol = colIndex;\n                }\n\n                lastRow = Math.max(lastRow, rowIndex);\n                lastCol = Math.max(lastCol, colIndex);\n            }\n        })\n    );\n\n    return hasSelection ? { firstRow, firstCol, lastRow, lastCol } : null;\n}\n","import { createTableCell } from 'roosterjs-content-model-dom';\nimport { getSelectedCells } from './getSelectedCells';\nimport { TableOperation } from 'roosterjs-editor-types';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\nimport type { CompatibleTableOperation } from 'roosterjs-editor-types/lib/compatibleTypes';\n\n/**\n * @internal\n */\nexport function insertTableColumn(\n    table: ContentModelTable,\n    operation:\n        | TableOperation.InsertLeft\n        | TableOperation.InsertRight\n        | CompatibleTableOperation.InsertLeft\n        | CompatibleTableOperation.InsertRight\n) {\n    const sel = getSelectedCells(table);\n    const insertLeft = operation == TableOperation.InsertLeft;\n\n    if (sel) {\n        for (let i = sel?.firstCol; i <= sel.lastCol; i++) {\n            table.rows.forEach(row => {\n                const cell = row.cells[insertLeft ? sel.firstCol : sel.lastCol];\n\n                row.cells.splice(\n                    insertLeft ? sel.firstCol : sel.lastCol + 1,\n                    0,\n                    createTableCell(cell.spanLeft, cell.spanAbove, cell.isHeader, cell.format)\n                );\n            });\n            table.widths.splice(\n                insertLeft ? sel.firstCol : sel.lastCol + 1,\n                0,\n                table.widths[insertLeft ? sel.firstCol : sel.lastCol]\n            );\n        }\n    }\n}\n","import { createTableCell } from 'roosterjs-content-model-dom';\nimport { getSelectedCells } from './getSelectedCells';\nimport { TableOperation } from 'roosterjs-editor-types';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\nimport type { CompatibleTableOperation } from 'roosterjs-editor-types/lib/compatibleTypes';\n\n/**\n * @internal\n */\nexport function insertTableRow(\n    table: ContentModelTable,\n    operation:\n        | TableOperation.InsertAbove\n        | TableOperation.InsertBelow\n        | CompatibleTableOperation.InsertAbove\n        | CompatibleTableOperation.InsertBelow\n) {\n    const sel = getSelectedCells(table);\n    const insertAbove = operation == TableOperation.InsertAbove;\n\n    if (sel) {\n        for (let i = sel.firstRow; i <= sel.lastRow; i++) {\n            const sourceRow = table.rows[insertAbove ? sel.firstRow : sel.lastRow];\n\n            table.rows.splice(insertAbove ? sel.firstRow : sel.lastRow + 1, 0, {\n                format: { ...sourceRow.format },\n                cells: sourceRow.cells.map(cell =>\n                    createTableCell(cell.spanLeft, cell.spanAbove, cell.isHeader, cell.format)\n                ),\n                height: sourceRow.height,\n            });\n        }\n    }\n}\n","import { canMergeCells } from './canMergeCells';\nimport { getSelectedCells } from './getSelectedCells';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\n\n/**\n * @internal\n */\nexport function mergeTableCells(table: ContentModelTable) {\n    const sel = getSelectedCells(table);\n\n    if (sel && canMergeCells(table.rows, sel.firstRow, sel.firstCol, sel.lastRow, sel.lastCol)) {\n        for (let rowIndex = sel.firstRow; rowIndex <= sel.lastRow; rowIndex++) {\n            for (let colIndex = sel.firstCol; colIndex <= sel.lastCol; colIndex++) {\n                const cell = table.rows[rowIndex].cells[colIndex];\n\n                if (cell) {\n                    cell.spanLeft = colIndex > sel.firstCol;\n                    cell.spanAbove = rowIndex > sel.firstRow;\n\n                    delete cell.cachedElement;\n                }\n            }\n\n            delete table.rows[rowIndex].cachedElement;\n        }\n    }\n}\n","import { canMergeCells } from './canMergeCells';\nimport { getSelectedCells } from './getSelectedCells';\nimport { TableOperation } from 'roosterjs-editor-types';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\nimport type { CompatibleTableOperation } from 'roosterjs-editor-types/lib/compatibleTypes';\n\n/**\n * @internal\n */\nexport function mergeTableColumn(\n    table: ContentModelTable,\n    operation:\n        | TableOperation.MergeLeft\n        | TableOperation.MergeRight\n        | CompatibleTableOperation.MergeLeft\n        | CompatibleTableOperation.MergeRight\n) {\n    const sel = getSelectedCells(table);\n    const mergeLeft = operation == TableOperation.MergeLeft;\n\n    if (sel) {\n        const mergingColIndex = mergeLeft ? sel.firstCol : sel.lastCol + 1;\n\n        if (mergingColIndex > 0 && mergingColIndex < table.rows[0].cells.length) {\n            for (let rowIndex = sel.firstRow; rowIndex <= sel.lastRow; rowIndex++) {\n                const cell = table.rows[rowIndex]?.cells[mergingColIndex];\n\n                if (\n                    cell &&\n                    canMergeCells(\n                        table.rows,\n                        rowIndex,\n                        mergingColIndex - 1,\n                        rowIndex,\n                        mergingColIndex\n                    )\n                ) {\n                    cell.spanLeft = true;\n\n                    let newSelectedCol = mergingColIndex;\n\n                    while (table.rows[rowIndex]?.cells[newSelectedCol]?.spanLeft) {\n                        delete table.rows[rowIndex].cells[newSelectedCol].cachedElement;\n                        newSelectedCol--;\n                    }\n\n                    if (table.rows[rowIndex]?.cells[newSelectedCol]) {\n                        table.rows[rowIndex].cells[newSelectedCol].isSelected = true;\n\n                        delete table.rows[rowIndex].cells[newSelectedCol].cachedElement;\n                    }\n\n                    delete cell.cachedElement;\n                }\n\n                delete table.rows[rowIndex].cachedElement;\n            }\n        }\n    }\n}\n","import { canMergeCells } from './canMergeCells';\nimport { getSelectedCells } from './getSelectedCells';\nimport { TableOperation } from 'roosterjs-editor-types';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\nimport type { CompatibleTableOperation } from 'roosterjs-editor-types/lib/compatibleTypes';\n\n/**\n * @internal\n */\nexport function mergeTableRow(\n    table: ContentModelTable,\n    operation:\n        | TableOperation.MergeAbove\n        | TableOperation.MergeBelow\n        | CompatibleTableOperation.MergeAbove\n        | CompatibleTableOperation.MergeBelow\n) {\n    const sel = getSelectedCells(table);\n    const mergeAbove = operation == TableOperation.MergeAbove;\n\n    if (sel) {\n        const mergingRowIndex = mergeAbove ? sel.firstRow : sel.lastRow + 1;\n\n        if (mergingRowIndex > 0 && mergingRowIndex < table.rows.length) {\n            for (let colIndex = sel.firstCol; colIndex <= sel.lastCol; colIndex++) {\n                const cell = table.rows[mergingRowIndex].cells[colIndex];\n\n                if (\n                    cell &&\n                    canMergeCells(\n                        table.rows,\n                        mergingRowIndex - 1,\n                        colIndex,\n                        mergingRowIndex,\n                        colIndex\n                    )\n                ) {\n                    cell.spanAbove = true;\n\n                    let newSelectedRow = mergingRowIndex;\n\n                    while (table.rows[newSelectedRow]?.cells[colIndex]?.spanAbove) {\n                        delete table.rows[newSelectedRow].cells[colIndex].cachedElement;\n                        delete table.rows[newSelectedRow].cachedElement;\n                        newSelectedRow--;\n                    }\n\n                    if (table.rows[newSelectedRow]?.cells[colIndex]) {\n                        table.rows[newSelectedRow].cells[colIndex].isSelected = true;\n\n                        delete table.rows[newSelectedRow].cells[colIndex].cachedElement;\n                        delete table.rows[newSelectedRow].cachedElement;\n                    }\n\n                    delete cell.cachedElement;\n                }\n            }\n        }\n    }\n}\n","import { addBlock, addSegment, createBr, createParagraph } from 'roosterjs-content-model-dom';\nimport type {\n    ContentModelSegment,\n    ContentModelSegmentFormat,\n    ContentModelTable,\n    ContentModelTableCell,\n} from 'roosterjs-content-model-types';\n\nconst MIN_HEIGHT = 22;\n\n/**\n * @internal\n */\nexport function normalizeTable(\n    table: ContentModelTable,\n    defaultSegmentFormat?: ContentModelSegmentFormat\n) {\n    // Always collapse border and use border box for table in roosterjs to make layout simpler\n    const format = table.format;\n\n    if (!format.borderCollapse || !format.useBorderBox) {\n        format.borderCollapse = true;\n        format.useBorderBox = true;\n    }\n\n    // Make sure all first cells are not spanned\n    // Make sure all inner cells are not header\n    // Make sure all cells have content and width\n    table.rows.forEach((row, rowIndex) => {\n        row.cells.forEach((cell, colIndex) => {\n            if (cell.blocks.length == 0) {\n                const format = cell.format.textColor\n                    ? {\n                          ...defaultSegmentFormat,\n                          textColor: cell.format.textColor,\n                      }\n                    : defaultSegmentFormat;\n                addBlock(\n                    cell,\n                    createParagraph(undefined /*isImplicit*/, undefined /*blockFormat*/, format)\n                );\n                addSegment(cell, createBr(format));\n            }\n\n            if (rowIndex == 0) {\n                cell.spanAbove = false;\n            } else if (rowIndex > 0 && cell.isHeader) {\n                cell.isHeader = false;\n                delete cell.cachedElement;\n            }\n\n            if (colIndex == 0) {\n                cell.spanLeft = false;\n            }\n\n            cell.format.useBorderBox = true;\n        });\n\n        // Make sure table has correct width and height array\n        if (row.height < MIN_HEIGHT) {\n            row.height = MIN_HEIGHT;\n        }\n    });\n\n    const columns = Math.max(...table.rows.map(row => row.cells.length));\n\n    for (let i = 0; i < columns; i++) {\n        if (table.widths[i] === undefined) {\n            table.widths[i] = getTableCellWidth(columns);\n        }\n    }\n\n    // Move blocks from spanned cell to its main cell if any,\n    // and remove rows/columns if all cells in it are spanned\n    const colCount = table.rows[0]?.cells.length || 0;\n\n    for (let colIndex = colCount - 1; colIndex > 0; colIndex--) {\n        table.rows.forEach(row => {\n            const cell = row.cells[colIndex];\n            const leftCell = row.cells[colIndex - 1];\n            if (cell && leftCell && cell.spanLeft) {\n                tryMoveBlocks(leftCell, cell);\n            }\n        });\n\n        if (table.rows.every(row => row.cells[colIndex]?.spanLeft)) {\n            table.rows.forEach(row => row.cells.splice(colIndex, 1));\n            table.widths.splice(\n                colIndex - 1,\n                2,\n                table.widths[colIndex - 1] + table.widths[colIndex]\n            );\n        }\n    }\n\n    for (let rowIndex = table.rows.length - 1; rowIndex > 0; rowIndex--) {\n        const row = table.rows[rowIndex];\n\n        row.cells.forEach((cell, colIndex) => {\n            const aboveCell = table.rows[rowIndex - 1]?.cells[colIndex];\n            if (aboveCell && cell.spanAbove) {\n                tryMoveBlocks(aboveCell, cell);\n            }\n        });\n\n        if (row.cells.every(cell => cell.spanAbove)) {\n            table.rows[rowIndex - 1].height += row.height;\n            table.rows.splice(rowIndex, 1);\n        }\n    }\n}\n\nfunction getTableCellWidth(columns: number): number {\n    if (columns <= 4) {\n        return 120;\n    } else if (columns <= 6) {\n        return 100;\n    } else {\n        return 70;\n    }\n}\n\nfunction tryMoveBlocks(targetCell: ContentModelTableCell, sourceCell: ContentModelTableCell) {\n    const onlyHasEmptyOrBr = sourceCell.blocks.every(\n        block => block.blockType == 'Paragraph' && hasOnlyBrSegment(block.segments)\n    );\n\n    if (!onlyHasEmptyOrBr) {\n        targetCell.blocks.push(...sourceCell.blocks);\n        sourceCell.blocks = [];\n    }\n}\n\nfunction hasOnlyBrSegment(segments: ContentModelSegment[]): boolean {\n    segments = segments.filter(s => s.segmentType != 'SelectionMarker');\n\n    return segments.length == 0 || (segments.length == 1 && segments[0].segmentType == 'Br');\n}\n","import { parseColor } from 'roosterjs-editor-dom';\nimport { updateTableCellMetadata } from '../../domUtils/metadata/updateTableCellMetadata';\nimport type { ContentModelTableCell } from 'roosterjs-content-model-types';\n\n// Using the HSL (hue, saturation and lightness) representation for RGB color values.\n// If the value of the lightness is less than 20, the color is dark.\n// If the value of the lightness is more than 80, the color is bright\nconst DARK_COLORS_LIGHTNESS = 20;\nconst BRIGHT_COLORS_LIGHTNESS = 80;\nconst White = '#ffffff';\nconst Black = '#000000';\n\n/**\n * @internal\n */\nexport function setTableCellBackgroundColor(\n    cell: ContentModelTableCell,\n    color: string | null | undefined,\n    isColorOverride?: boolean,\n    applyToSegments?: boolean\n) {\n    if (color) {\n        cell.format.backgroundColor = color;\n\n        if (isColorOverride) {\n            updateTableCellMetadata(cell, metadata => {\n                metadata = metadata || {};\n                metadata.bgColorOverride = true;\n                return metadata;\n            });\n        }\n\n        const lightness = calculateLightness(color);\n\n        if (lightness < DARK_COLORS_LIGHTNESS) {\n            cell.format.textColor = White;\n        } else if (lightness > BRIGHT_COLORS_LIGHTNESS) {\n            cell.format.textColor = Black;\n        } else {\n            delete cell.format.textColor;\n        }\n\n        if (applyToSegments && cell.format.textColor) {\n            cell.blocks.forEach(block => {\n                if (block.blockType == 'Paragraph') {\n                    block.segmentFormat = {\n                        ...block.segmentFormat,\n                        textColor: cell.format.textColor,\n                    };\n                    block.segments.forEach(segment => {\n                        segment.format = {\n                            ...segment.format,\n                            textColor: cell.format.textColor,\n                        };\n                    });\n                }\n            });\n        }\n    } else {\n        delete cell.format.backgroundColor;\n        delete cell.format.textColor;\n    }\n\n    delete cell.cachedElement;\n}\n\nfunction calculateLightness(color: string) {\n    const colorValues = parseColor(color);\n\n    // Use the values of r,g,b to calculate the lightness in the HSl representation\n    //First calculate the fraction of the light in each color, since in css the value of r,g,b is in the interval of [0,255], we have\n    if (colorValues) {\n        const red = colorValues[0] / 255;\n        const green = colorValues[1] / 255;\n        const blue = colorValues[2] / 255;\n\n        //Then the lightness in the HSL representation is the average between maximum fraction of r,g,b and the minimum fraction\n        return (Math.max(red, green, blue) + Math.min(red, green, blue)) * 50;\n    } else {\n        return 255;\n    }\n}\n","import { createTableCell } from 'roosterjs-content-model-dom';\nimport { getSelectedCells } from './getSelectedCells';\nimport type { ContentModelTable } from 'roosterjs-content-model-types';\n\nconst MIN_WIDTH = 30;\n\n/**\n * @internal\n */\nexport function splitTableCellHorizontally(table: ContentModelTable) {\n    const sel = getSelectedCells(table);\n\n    if (sel) {\n        for (let colIndex = sel.lastCol; colIndex >= sel.firstCol; colIndex--) {\n            if (\n                table.rows.every(\n                    (row, rowIndex) =>\n                        rowIndex < sel.firstRow ||\n                        rowIndex > sel.lastRow ||\n                        row.cells[colIndex + 1]?.spanLeft\n                )\n            ) {\n                table.rows.forEach((row, rowIndex) => {\n                    delete row.cells[colIndex].cachedElement;\n\n                    if (rowIndex >= sel.firstRow && rowIndex <= sel.lastRow) {\n                        row.cells[colIndex + 1].spanLeft = false;\n                        delete row.cells[colIndex + 1].cachedElement;\n                    }\n                });\n            } else {\n                table.rows.forEach((row, rowIndex) => {\n                    const cell = row.cells[colIndex];\n                    if (cell) {\n                        const newCell = createTableCell(\n                            cell.spanLeft,\n                            cell.spanAbove,\n                            cell.isHeader,\n                            cell.format\n                        );\n\n                        newCell.dataset = { ...cell.dataset };\n\n                        if (rowIndex < sel.firstRow || rowIndex > sel.lastRow) {\n                            newCell.spanLeft = true;\n                        } else {\n                            newCell.isSelected = cell.isSelected;\n                        }\n                        row.cells.splice(colIndex + 1, 0, newCell);\n\n                        delete row.cells[colIndex].cachedElement;\n                    }\n                });\n\n                const newWidth = Math.max(table.widths[colIndex] / 2, MIN_WIDTH);\n\n                table.widths.splice(colIndex, 1, newWidth, newWidth);\n            }\n        }\n    }\n}\n","import { createTableCell } from 'roosterjs-content-model-dom';\nimport { getSelectedCells } from './getSelectedCells';\nimport type { ContentModelTable, ContentModelTableRow } from 'roosterjs-content-model-types';\n\nconst MIN_HEIGHT = 22;\n\n/**\n * @internal\n */\nexport function splitTableCellVertically(table: ContentModelTable) {\n    const sel = getSelectedCells(table);\n\n    if (sel) {\n        for (let rowIndex = sel.lastRow; rowIndex >= sel.firstRow; rowIndex--) {\n            const row = table.rows[rowIndex];\n            const belowRow = table.rows[rowIndex + 1];\n\n            row.cells.forEach(cell => {\n                delete cell.cachedElement;\n            });\n\n            delete row.cachedElement;\n\n            if (\n                belowRow?.cells.every(\n                    (belowCell, colIndex) =>\n                        colIndex < sel.firstCol || colIndex > sel.lastCol || belowCell.spanAbove\n                )\n            ) {\n                belowRow.cells.forEach((belowCell, colIndex) => {\n                    if (colIndex >= sel.firstCol && colIndex <= sel.lastCol) {\n                        belowCell.spanAbove = false;\n                        delete belowCell.cachedElement;\n                    }\n                });\n\n                delete belowRow.cachedElement;\n            } else {\n                const newHeight = Math.max((row.height /= 2), MIN_HEIGHT);\n                const newRow: ContentModelTableRow = {\n                    format: { ...row.format },\n                    height: newHeight,\n                    cells: row.cells.map((cell, colIndex) => {\n                        const newCell = createTableCell(\n                            cell.spanLeft,\n                            cell.spanAbove,\n                            cell.isHeader,\n                            cell.format\n                        );\n\n                        newCell.dataset = { ...cell.dataset };\n\n                        if (colIndex < sel.firstCol || colIndex > sel.lastCol) {\n                            newCell.spanAbove = true;\n                        } else {\n                            newCell.isSelected = cell.isSelected;\n                        }\n\n                        return newCell;\n                    }),\n                };\n\n                row.height = newHeight;\n                table.rows.splice(rowIndex + 1, 0, newRow);\n            }\n        }\n    }\n}\n","import { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { setModelAlignment } from '../../modelApi/block/setModelAlignment';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Set text alignment of selected paragraphs\n * @param editor The editor to set alignment\n * @param alignment Alignment value: left, center or right\n */\nexport default function setAlignment(\n    editor: IContentModelEditor,\n    alignment: 'left' | 'center' | 'right'\n) {\n    editor.focus();\n\n    formatWithContentModel(editor, 'setAlignment', model => setModelAlignment(model, alignment));\n}\n","import { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { setModelDirection } from '../../modelApi/block/setModelDirection';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Set text direction of selected paragraphs (Left to right or Right to left)\n * @param editor The editor to set alignment\n * @param direction Direction value: ltr (Left to right) or rtl (Right to left)\n */\nexport default function setDirection(editor: IContentModelEditor, direction: 'ltr' | 'rtl') {\n    editor.focus();\n\n    formatWithContentModel(editor, 'setDirection', model => setModelDirection(model, direction));\n}\n","import { formatParagraphWithContentModel } from '../utils/formatParagraphWithContentModel';\nimport type { ContentModelParagraphDecorator } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\ntype HeadingLevelTags = 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6';\n\nconst HeaderFontSizes: Record<HeadingLevelTags, string> = {\n    h1: '2em',\n    h2: '1.5em',\n    h3: '1.17em',\n    h4: '1em',\n    h5: '0.83em',\n    h6: '0.67em',\n};\n\n/**\n * Set heading level of selected paragraphs\n * @param editor The editor to set heading level to\n * @param headingLevel Level of heading, from 1 to 6. Set to 0 means set it back to a regular paragraph\n */\nexport default function setHeadingLevel(\n    editor: IContentModelEditor,\n    headingLevel: 0 | 1 | 2 | 3 | 4 | 5 | 6\n) {\n    editor.focus();\n\n    formatParagraphWithContentModel(editor, 'setHeadingLevel', para => {\n        const tagName =\n            headingLevel > 0\n                ? (('h' + headingLevel) as HeadingLevelTags | null)\n                : getExistingHeadingTag(para.decorator);\n\n        if (headingLevel > 0) {\n            para.decorator = {\n                tagName: tagName!,\n                format: tagName\n                    ? {\n                          fontWeight: 'bold',\n                          fontSize: HeaderFontSizes[tagName],\n                      }\n                    : {},\n            };\n\n            // Remove existing formats since tags have default font size and weight\n            para.segments.forEach(segment => {\n                delete segment.format.fontSize;\n                delete segment.format.fontWeight;\n            });\n        } else if (tagName) {\n            delete para.decorator;\n        }\n    });\n}\n\nfunction getExistingHeadingTag(\n    decorator?: ContentModelParagraphDecorator\n): HeadingLevelTags | null {\n    const tag = decorator?.tagName || '';\n    const level = parseInt(tag.substring(1));\n\n    return level >= 1 && level <= 6 ? (tag as HeadingLevelTags) : null;\n}\n","import { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { normalizeContentModel } from 'roosterjs-content-model-dom';\nimport { setModelIndentation } from '../../modelApi/block/setModelIndentation';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Indent or outdent to selected paragraphs\n * @param editor The editor to operate on\n * @param indentation Whether indent or outdent\n * @param length The length of pixel to indent/outdent @default 40\n */\nexport default function setIndentation(\n    editor: IContentModelEditor,\n    indentation: 'indent' | 'outdent',\n    length?: number\n) {\n    editor.focus();\n\n    formatWithContentModel(\n        editor,\n        'setIndentation',\n        model => {\n            const result = setModelIndentation(model, indentation, length);\n\n            if (result) {\n                normalizeContentModel(model);\n            }\n\n            return result;\n        },\n        {\n            preservePendingFormat: true,\n        }\n    );\n}\n","import { createParagraphDecorator } from 'roosterjs-content-model-dom';\nimport { formatParagraphWithContentModel } from '../utils/formatParagraphWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Toggles the current block(s) margin properties.\n * null deletes any existing value, undefined is ignored\n * @param editor The editor to operate on\n * @param marginTop value for top margin\n * @param marginBottom value for bottom margin\n */\nexport default function setParagraphMargin(\n    editor: IContentModelEditor,\n    marginTop?: string | null,\n    marginBottom?: string | null\n) {\n    editor.focus();\n\n    formatParagraphWithContentModel(editor, 'setParagraphMargin', para => {\n        if (!para.decorator) {\n            para.decorator = createParagraphDecorator('p');\n        }\n\n        if (marginTop) {\n            para.format.marginTop = marginTop;\n        } else if (marginTop === null) {\n            delete para.format.marginTop;\n        }\n\n        if (marginBottom) {\n            para.format.marginBottom = marginBottom;\n        } else if (marginBottom === null) {\n            delete para.format.marginBottom;\n        }\n    });\n}\n","import { formatParagraphWithContentModel } from '../utils/formatParagraphWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Sets current selected block(s) line-height property and wipes such property from child segments\n * @param editor The editor to operate on\n * @param spacing Unitless/px value to set line height\n */\nexport default function setSpacing(editor: IContentModelEditor, spacing: number | string) {\n    editor.focus();\n\n    formatParagraphWithContentModel(editor, 'setSpacing', paragraph => {\n        paragraph.format.lineHeight = spacing.toString();\n        paragraph.segments.forEach(segment => {\n            if (segment.format.lineHeight) {\n                delete segment.format.lineHeight;\n            }\n        });\n    });\n}\n","import { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { toggleModelBlockQuote } from '../../modelApi/block/toggleModelBlockQuote';\nimport type { ContentModelFormatContainerFormat } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\nconst DefaultQuoteFormat: ContentModelFormatContainerFormat = {\n    borderLeft: '3px solid rgb(200, 200, 200)', // TODO: Support RTL\n    textColor: 'rgb(102, 102, 102)',\n};\nconst BuildInQuoteFormat: ContentModelFormatContainerFormat = {\n    marginTop: '1em',\n    marginBottom: '1em',\n    marginLeft: '40px',\n    marginRight: '40px',\n    paddingLeft: '10px',\n};\n\n/**\n * Toggle BLOCKQUOTE state of selected paragraphs.\n * If any selected paragraph is not under a BLOCKQUOTE, wrap them into a BLOCKQUOTE.\n * Otherwise, unwrap all related BLOCKQUOTEs.\n * @param editor The editor object to toggle BLOCKQUOTE onto\n * @param quoteFormat @optional Block format for the new quote object\n */\nexport default function toggleBlockQuote(\n    editor: IContentModelEditor,\n    quoteFormat: ContentModelFormatContainerFormat = DefaultQuoteFormat\n) {\n    const fullQuoteFormat = {\n        ...BuildInQuoteFormat,\n        ...quoteFormat,\n    };\n\n    editor.focus();\n\n    formatWithContentModel(\n        editor,\n        'toggleBlockQuote',\n        model => toggleModelBlockQuote(model, fullQuoteFormat),\n        {\n            preservePendingFormat: true,\n        }\n    );\n}\n","import { Browser, isModifierKey } from 'roosterjs-editor-dom';\nimport { ChangeSource, Keys } from 'roosterjs-editor-types';\nimport { deleteAllSegmentBefore } from '../../modelApi/edit/deleteSteps/deleteAllSegmentBefore';\nimport { DeleteResult } from '../../modelApi/edit/utils/DeleteSelectionStep';\nimport { deleteSelection } from '../../modelApi/edit/deleteSelection';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { isNodeOfType } from 'roosterjs-content-model-dom';\nimport type { DeleteSelectionStep } from '../../modelApi/edit/utils/DeleteSelectionStep';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport {\n    handleKeyboardEventResult,\n    shouldDeleteAllSegmentsBefore,\n    shouldDeleteWord,\n} from '../../editor/utils/handleKeyboardEventCommon';\nimport {\n    backwardDeleteWordSelection,\n    forwardDeleteWordSelection,\n} from '../../modelApi/edit/deleteSteps/deleteWordSelection';\nimport {\n    backwardDeleteCollapsedSelection,\n    forwardDeleteCollapsedSelection,\n} from '../../modelApi/edit/deleteSteps/deleteCollapsedSelection';\n\n/**\n * Do keyboard event handling for DELETE/BACKSPACE key\n * @param editor The Content Model Editor\n * @param rawEvent DOM keyboard event\n * @returns True if the event is handled with this function, otherwise false\n */\nexport default function keyboardDelete(\n    editor: IContentModelEditor,\n    rawEvent: KeyboardEvent\n): boolean {\n    const which = rawEvent.which;\n    const selection = editor.getDOMSelection();\n    const range = selection?.type == 'range' ? selection.range : null;\n    let isDeleted = false;\n\n    if (shouldDeleteWithContentModel(range, rawEvent)) {\n        formatWithContentModel(\n            editor,\n            which == Keys.DELETE ? 'handleDeleteKey' : 'handleBackspaceKey',\n            (model, context) => {\n                const result = deleteSelection(model, getDeleteSteps(rawEvent), context)\n                    .deleteResult;\n\n                isDeleted = result != DeleteResult.NotDeleted;\n\n                return handleKeyboardEventResult(editor, model, rawEvent, result, context);\n            },\n            {\n                rawEvent,\n                changeSource: ChangeSource.Keyboard,\n                getChangeData: () => which,\n            }\n        );\n\n        return true;\n    }\n\n    return isDeleted;\n}\n\nfunction getDeleteSteps(rawEvent: KeyboardEvent): (DeleteSelectionStep | null)[] {\n    const isForward = rawEvent.which == Keys.DELETE;\n    const deleteAllSegmentBeforeStep =\n        shouldDeleteAllSegmentsBefore(rawEvent) && !isForward ? deleteAllSegmentBefore : null;\n    const deleteWordSelection = shouldDeleteWord(rawEvent, !!Browser.isMac)\n        ? isForward\n            ? forwardDeleteWordSelection\n            : backwardDeleteWordSelection\n        : null;\n    const deleteCollapsedSelection = isForward\n        ? forwardDeleteCollapsedSelection\n        : backwardDeleteCollapsedSelection;\n    return [deleteAllSegmentBeforeStep, deleteWordSelection, deleteCollapsedSelection];\n}\n\nfunction shouldDeleteWithContentModel(range: Range | null, rawEvent: KeyboardEvent) {\n    return !(\n        range?.collapsed &&\n        isNodeOfType(range.startContainer, 'TEXT_NODE') &&\n        !isModifierKey(rawEvent) &&\n        (canDeleteBefore(rawEvent, range) || canDeleteAfter(rawEvent, range))\n    );\n}\n\nfunction canDeleteBefore(rawEvent: KeyboardEvent, range: Range) {\n    return (\n        rawEvent.which == Keys.BACKSPACE &&\n        (range.startOffset > 1 || range.startContainer.previousSibling)\n    );\n}\n\nfunction canDeleteAfter(rawEvent: KeyboardEvent, range: Range) {\n    return (\n        rawEvent.which == Keys.DELETE &&\n        (range.startOffset < (range.startContainer.nodeValue?.length ?? 0) - 1 ||\n            range.startContainer.nextSibling)\n    );\n}\n","import { ChangeSource } from 'roosterjs-editor-types';\nimport { createEntity, normalizeContentModel } from 'roosterjs-content-model-dom';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { insertEntityModel } from '../../modelApi/entity/insertEntityModel';\nimport type { ContentModelEntity, DOMSelection } from 'roosterjs-content-model-types';\nimport type { Entity } from 'roosterjs-editor-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type {\n    InsertEntityOptions,\n    InsertEntityPosition,\n} from '../../publicTypes/parameter/InsertEntityOptions';\n\nconst BlockEntityTag = 'div';\nconst InlineEntityTag = 'span';\n\n/**\n * Insert an entity into editor\n * @param editor The Content Model editor\n * @param type Type of entity\n * @param isBlock True to insert a block entity, false to insert an inline entity\n * @param position Position of the entity to insert. It can be\n * Value of InsertEntityPosition: see InsertEntityPosition\n * selectionRangeEx: Use this range instead of current focus position to insert. After insert, focus will be moved to\n * the beginning of this range (when focusAfterEntity is not set to true) or after the new entity (when focusAfterEntity is set to true)\n * @param options Move options to insert. See InsertEntityOptions\n */\nexport default function insertEntity(\n    editor: IContentModelEditor,\n    type: string,\n    isBlock: boolean,\n    position: 'focus' | 'begin' | 'end' | DOMSelection,\n    options?: InsertEntityOptions\n): ContentModelEntity | null;\n\n/**\n * Insert a block entity into editor\n * @param editor The Content Model editor\n * @param type Type of entity\n * @param isBlock Must be true for a block entity\n * @param position Position of the entity to insert. It can be\n * Value of InsertEntityPosition: see InsertEntityPosition\n * selectionRangeEx: Use this range instead of current focus position to insert. After insert, focus will be moved to\n * the beginning of this range (when focusAfterEntity is not set to true) or after the new entity (when focusAfterEntity is set to true)\n * @param options Move options to insert. See InsertEntityOptions\n */\nexport default function insertEntity(\n    editor: IContentModelEditor,\n    type: string,\n    isBlock: true,\n    position: InsertEntityPosition | DOMSelection,\n    options?: InsertEntityOptions\n): ContentModelEntity | null;\n\nexport default function insertEntity(\n    editor: IContentModelEditor,\n    type: string,\n    isBlock: boolean,\n    position?: InsertEntityPosition | DOMSelection,\n    options?: InsertEntityOptions\n): ContentModelEntity | null {\n    const { contentNode, focusAfterEntity, wrapperDisplay, skipUndoSnapshot } = options || {};\n    const wrapper = editor.getDocument().createElement(isBlock ? BlockEntityTag : InlineEntityTag);\n    const display = wrapperDisplay ?? (isBlock ? undefined : 'inline-block');\n\n    wrapper.style.setProperty('display', display || null);\n\n    if (contentNode) {\n        wrapper.appendChild(contentNode);\n    }\n\n    const entityModel = createEntity(wrapper, true /*isReadonly*/, undefined /*format*/, type);\n\n    formatWithContentModel(\n        editor,\n        'insertEntity',\n        (model, context) => {\n            insertEntityModel(\n                model,\n                entityModel,\n                typeof position == 'string' ? position : 'focus',\n                isBlock,\n                focusAfterEntity,\n                context\n            );\n\n            normalizeContentModel(model);\n\n            context.skipUndoSnapshot = skipUndoSnapshot;\n            context.newEntities.push(entityModel);\n\n            return true;\n        },\n        {\n            selectionOverride: typeof position === 'object' ? position : undefined,\n            changeSource: ChangeSource.InsertEntity,\n            getChangeData: () => {\n                // TODO: Remove this entity when we have standalone editor\n                const entity: Entity = {\n                    wrapper,\n                    type,\n                    id: '',\n                    isReadonly: true,\n                };\n\n                return entity;\n            },\n        }\n    );\n\n    return entityModel;\n}\n","import { DeleteResult } from '../../modelApi/edit/utils/DeleteSelectionStep';\nimport { deleteSelection } from '../../modelApi/edit/deleteSelection';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { getPendingFormat, setPendingFormat } from '../../modelApi/format/pendingFormat';\nimport { isNodeOfType, normalizeContentModel } from 'roosterjs-content-model-dom';\nimport { isBlockElement } from 'roosterjs-editor-dom';\nimport type { ContentModelSegmentFormat } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * @internal\n * When necessary, set default format as current pending format so it will be applied when Input event is fired\n * @param editor The Content Model Editor\n * @param defaultFormat The default segment format to apply\n */\nexport default function applyDefaultFormat(\n    editor: IContentModelEditor,\n    defaultFormat: ContentModelSegmentFormat\n) {\n    const selection = editor.getDOMSelection();\n    const range = selection?.type == 'range' ? selection.range : null;\n    const posContainer = range?.startContainer ?? null;\n    const posOffset = range?.startOffset ?? null;\n    let node = posContainer;\n\n    while (node && editor.contains(node)) {\n        if (isNodeOfType(node, 'ELEMENT_NODE') && node.getAttribute?.('style')) {\n            return;\n        } else if (isBlockElement(node)) {\n            break;\n        } else {\n            node = node.parentNode;\n        }\n    }\n\n    formatWithContentModel(editor, 'input', (model, context) => {\n        const result = deleteSelection(model, [], context);\n\n        if (result.deleteResult == DeleteResult.Range) {\n            normalizeContentModel(model);\n            editor.addUndoSnapshot();\n\n            return true;\n        } else if (\n            result.deleteResult == DeleteResult.NotDeleted &&\n            result.insertPoint &&\n            posContainer &&\n            posOffset !== null\n        ) {\n            const { paragraph, path, marker } = result.insertPoint;\n            const blocks = path[0].blocks;\n            const blockCount = blocks.length;\n            const blockIndex = blocks.indexOf(paragraph);\n\n            if (\n                paragraph.isImplicit &&\n                paragraph.segments.length == 1 &&\n                paragraph.segments[0] == marker &&\n                blockCount > 0 &&\n                blockIndex == blockCount - 1\n            ) {\n                // Focus is in the last paragraph which is implicit and there is not other segments.\n                // This can happen when focus is moved after all other content under current block group.\n                // We need to check if browser will merge focus into previous paragraph by checking if\n                // previous block is block. If previous block is paragraph, browser will most likely merge\n                // the input into previous paragraph, then nothing need to do here. Otherwise we need to\n                // apply pending format since this input event will start a new real paragraph.\n                const previousBlock = blocks[blockIndex - 1];\n\n                if (previousBlock?.blockType != 'Paragraph') {\n                    internalApplyDefaultFormat(\n                        editor,\n                        defaultFormat,\n                        marker.format,\n                        posContainer,\n                        posOffset\n                    );\n                }\n            } else if (paragraph.segments.every(x => x.segmentType != 'Text')) {\n                internalApplyDefaultFormat(\n                    editor,\n                    defaultFormat,\n                    marker.format,\n                    posContainer,\n                    posOffset\n                );\n            }\n\n            // We didn't do any change but just apply default format to pending format, so no need to write back\n            return false;\n        } else {\n            return false;\n        }\n    });\n}\n\nfunction internalApplyDefaultFormat(\n    editor: IContentModelEditor,\n    defaultFormat: ContentModelSegmentFormat,\n    currentFormat: ContentModelSegmentFormat,\n    posContainer: Node,\n    posOffset: number\n) {\n    const pendingFormat = getPendingFormat(editor) || {};\n    const newFormat: ContentModelSegmentFormat = {\n        ...defaultFormat,\n        ...pendingFormat,\n        ...currentFormat,\n    };\n\n    setPendingFormat(editor, newFormat, posContainer, posOffset);\n}\n","import { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { getPendingFormat } from '../../modelApi/format/pendingFormat';\nimport { iterateSelections } from '../../modelApi/selection/iterateSelections';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport {\n    createText,\n    normalizeContentModel,\n    setParagraphNotImplicit,\n} from 'roosterjs-content-model-dom';\n\nconst ANSI_SPACE = '\\u0020';\nconst NON_BREAK_SPACE = '\\u00A0';\n\n/**\n * Apply pending format to the text user just input\n * @param editor The editor to get format from\n * @param data The text user just input\n */\nexport default function applyPendingFormat(editor: IContentModelEditor, data: string) {\n    const format = getPendingFormat(editor);\n\n    if (format) {\n        let isChanged = false;\n\n        formatWithContentModel(editor, 'applyPendingFormat', (model, context) => {\n            iterateSelections([model], (_, __, block, segments) => {\n                if (\n                    block?.blockType == 'Paragraph' &&\n                    segments?.length == 1 &&\n                    segments[0].segmentType == 'SelectionMarker'\n                ) {\n                    const marker = segments[0];\n                    const index = block.segments.indexOf(marker);\n                    const previousSegment = block.segments[index - 1];\n\n                    if (previousSegment?.segmentType == 'Text') {\n                        const text = previousSegment.text;\n                        const subStr = text.substr(-data.length, data.length);\n\n                        // For space, there can be &#32 (space) or &#160 (&nbsp;), we treat them as the same\n                        if (subStr == data || (data == ANSI_SPACE && subStr == NON_BREAK_SPACE)) {\n                            marker.format = { ...format };\n                            previousSegment.text = text.substring(0, text.length - data.length);\n\n                            const newText = createText(\n                                data == ANSI_SPACE ? NON_BREAK_SPACE : data,\n                                {\n                                    ...previousSegment.format,\n                                    ...format,\n                                }\n                            );\n\n                            block.segments.splice(index, 0, newText);\n                            setParagraphNotImplicit(block);\n                            isChanged = true;\n                        }\n                    }\n                }\n                return true;\n            });\n\n            if (isChanged) {\n                normalizeContentModel(model);\n                context.skipUndoSnapshot = true;\n            }\n\n            return isChanged;\n        });\n    }\n}\n","import { clearModelFormat } from '../../modelApi/common/clearModelFormat';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { normalizeContentModel } from 'roosterjs-content-model-dom';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type {\n    ContentModelBlock,\n    ContentModelBlockGroup,\n    ContentModelSegment,\n    ContentModelTable,\n} from 'roosterjs-content-model-types';\n\n/**\n * Clear format of selection\n * @param editor The editor to clear format from\n */\nexport default function clearFormat(editor: IContentModelEditor) {\n    editor.focus();\n\n    formatWithContentModel(editor, 'clearFormat', model => {\n        const blocksToClear: [ContentModelBlockGroup[], ContentModelBlock][] = [];\n        const segmentsToClear: ContentModelSegment[] = [];\n        const tablesToClear: [ContentModelTable, boolean][] = [];\n\n        clearModelFormat(model, blocksToClear, segmentsToClear, tablesToClear);\n\n        normalizeContentModel(model);\n\n        return blocksToClear.length > 0 || segmentsToClear.length > 0 || tablesToClear.length > 0;\n    });\n}\n","import { contains } from 'roosterjs-editor-dom';\nimport { getPendingFormat } from '../../modelApi/format/pendingFormat';\nimport { getSelectionRootNode } from '../../modelApi/selection/getSelectionRootNode';\nimport { retrieveModelFormatState } from '../../modelApi/common/retrieveModelFormatState';\nimport type { ContentModelBlockGroup, DomToModelContext } from 'roosterjs-content-model-types';\nimport type { ContentModelFormatState } from '../../publicTypes/format/formatState/ContentModelFormatState';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport {\n    getRegularSelectionOffsets,\n    handleRegularSelection,\n    isNodeOfType,\n    processChildNode,\n} from 'roosterjs-content-model-dom';\n\n/**\n * Get current format state\n * @param editor The editor to get format from\n */\nexport default function getFormatState(editor: IContentModelEditor): ContentModelFormatState {\n    const pendingFormat = getPendingFormat(editor);\n    const model = editor.createContentModel({\n        processorOverride: {\n            child: reducedModelChildProcessor,\n        },\n    });\n    const result: ContentModelFormatState = {\n        ...editor.getUndoState(),\n        isDarkMode: editor.isDarkMode(),\n        zoomScale: editor.getZoomScale(),\n    };\n\n    retrieveModelFormatState(model, pendingFormat, result);\n\n    return result;\n}\n\n/**\n * @internal\n */\ninterface FormatStateContext extends DomToModelContext {\n    /**\n     * An optional stack of parent elements to process. When provided, the child nodes of current parent element will be ignored,\n     * but use the top element in this stack instead in childProcessor.\n     */\n    nodeStack?: Node[];\n}\n\n/**\n * @internal\n * Export for test only\n * In order to get format, we can still use the regular child processor. However, to improve performance, we don't need to create\n * content model for the whole doc, instead we only need to traverse the tree path that can arrive current selected node.\n * This \"reduced\" child processor will first create a node stack that stores DOM node from root to current common ancestor node of selection,\n * then use this stack as a faked DOM tree to create a reduced content model which we can use to retrieve format state\n */\nexport function reducedModelChildProcessor(\n    group: ContentModelBlockGroup,\n    parent: ParentNode,\n    context: FormatStateContext\n) {\n    const selectionRootNode = getSelectionRootNode(context.selection);\n\n    if (selectionRootNode) {\n        if (!context.nodeStack) {\n            context.nodeStack = createNodeStack(parent, selectionRootNode);\n        }\n\n        const stackChild = context.nodeStack.pop();\n\n        if (stackChild) {\n            const [nodeStartOffset, nodeEndOffset] = getRegularSelectionOffsets(context, parent);\n\n            // If selection is not on this node, skip getting node index to save some time since we don't need it here\n            const index =\n                nodeStartOffset >= 0 || nodeEndOffset >= 0 ? getChildIndex(parent, stackChild) : -1;\n\n            if (index >= 0) {\n                handleRegularSelection(index, context, group, nodeStartOffset, nodeEndOffset);\n            }\n\n            processChildNode(group, stackChild, context);\n\n            if (index >= 0) {\n                handleRegularSelection(index + 1, context, group, nodeStartOffset, nodeEndOffset);\n            }\n        } else {\n            // No child node from node stack, that means we have reached the deepest node of selection.\n            // Now we can use default child processor to perform full sub tree scanning for content model,\n            // So that all selected node will be included.\n            context.defaultElementProcessors.child(group, parent, context);\n        }\n    }\n}\n\nfunction createNodeStack(root: Node, startNode: Node): Node[] {\n    const result: Node[] = [];\n    let node: Node | null = startNode;\n\n    while (node && contains(root, node)) {\n        if (isNodeOfType(node, 'ELEMENT_NODE') && node.tagName == 'TABLE') {\n            // For table, we can't do a reduced model creation since we need to handle their cells and indexes,\n            // so clean up whatever we already have, and just put table into the stack\n            result.splice(0, result.length, node);\n        } else {\n            result.push(node);\n        }\n\n        node = node.parentNode;\n    }\n\n    return result;\n}\n\nfunction getChildIndex(parent: ParentNode, stackChild: Node) {\n    let index = 0;\n    let child = parent.firstChild;\n\n    while (child && child != stackChild) {\n        index++;\n        child = child.nextSibling;\n    }\n    return index;\n}\n","import { adjustSegmentSelection } from '../../modelApi/selection/adjustSegmentSelection';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport type { ContentModelImage } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Adjust selection to make sure select an image if any\n * @return Content Model Image object if an image is select, or null\n */\nexport default function adjustImageSelection(\n    editor: IContentModelEditor\n): ContentModelImage | null {\n    let image: ContentModelImage | null = null;\n\n    formatWithContentModel(editor, 'adjustImageSelection', model =>\n        adjustSegmentSelection(\n            model,\n            target => {\n                if (target.isSelected && target.segmentType == 'Image') {\n                    image = target;\n                    return true;\n                } else {\n                    return false;\n                }\n            },\n            (target, ref) => target == ref\n        )\n    );\n\n    return image;\n}\n","import formatImageWithContentModel from '../utils/formatImageWithContentModel';\nimport { getMetadata, readFile } from 'roosterjs-editor-dom';\nimport type { ContentModelImage } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Change the selected image src\n * @param editor The editor instance\n * @param file The image file\n */\nexport default function changeImage(editor: IContentModelEditor, file: File) {\n    editor.focus();\n\n    const selection = editor.getDOMSelection();\n    readFile(file, dataUrl => {\n        if (dataUrl && !editor.isDisposed() && selection?.type === 'image') {\n            formatImageWithContentModel(\n                editor,\n                'changeImage',\n                (image: ContentModelImage) => {\n                    image.src = dataUrl;\n                    image.dataset = {};\n                    image.format.width = '';\n                    image.format.height = '';\n                    image.alt = '';\n                },\n                {\n                    image: selection.image,\n                    previousSrc: selection.image.src,\n                    newSrc: dataUrl,\n                    originalSrc: getImageSrc(selection.image),\n                }\n            );\n        }\n    });\n}\n\nconst getImageSrc = (image: HTMLImageElement) => {\n    const obj = getMetadata<{ src: string }>(image);\n    return (obj && obj.src) || '';\n};\n","import { addSegment, createContentModelDocument, createImage } from 'roosterjs-content-model-dom';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { mergeModel } from '../../modelApi/common/mergeModel';\nimport { readFile } from 'roosterjs-editor-dom';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Insert an image into current selected position\n * @param editor The editor to operate on\n * @param file Image Blob file or source string\n */\nexport default function insertImage(editor: IContentModelEditor, imageFileOrSrc: File | string) {\n    editor.focus();\n\n    if (typeof imageFileOrSrc == 'string') {\n        insertImageWithSrc(editor, imageFileOrSrc);\n    } else {\n        readFile(imageFileOrSrc, dataUrl => {\n            if (dataUrl && !editor.isDisposed()) {\n                insertImageWithSrc(editor, dataUrl);\n            }\n        });\n    }\n}\n\nfunction insertImageWithSrc(editor: IContentModelEditor, src: string) {\n    formatWithContentModel(editor, 'insertImage', (model, context) => {\n        const image = createImage(src, { backgroundColor: '' });\n        const doc = createContentModelDocument();\n\n        addSegment(doc, image);\n        mergeModel(model, doc, context, {\n            mergeFormat: 'mergeAll',\n        });\n\n        return true;\n    });\n}\n","import formatImageWithContentModel from '../utils/formatImageWithContentModel';\nimport type { ContentModelImage } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Set image alt text for all selected images at selection. If no images is contained\n * in selection, do nothing.\n * @param editor The editor instance\n * @param altText The image alt text\n */\nexport default function setImageAltText(editor: IContentModelEditor, altText: string) {\n    editor.focus();\n\n    formatImageWithContentModel(editor, 'setImageAltText', (image: ContentModelImage) => {\n        image.alt = altText;\n    });\n}\n","import applyImageBorderFormat from '../../modelApi/image/applyImageBorderFormat';\nimport formatImageWithContentModel from '../utils/formatImageWithContentModel';\nimport type { Border } from '../../publicTypes/interface/Border';\nimport type { ContentModelImage } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Set image border style for all selected images at selection.\n * @param editor The editor instance\n * @param border the border format object. Ex: { color: 'red', width: '10px', style: 'solid'}, if one of the value in object is undefined\n * its value will not be changed. Passing null instead of an object will remove the border\n * @param borderRadius the border radius value, if undefined, the border radius will keep the actual value\n */\nexport default function setImageBorder(\n    editor: IContentModelEditor,\n    border: Border | null,\n    borderRadius?: string\n) {\n    editor.focus();\n\n    formatImageWithContentModel(editor, 'setImageBorder', (image: ContentModelImage) => {\n        applyImageBorderFormat(image, border, borderRadius);\n    });\n}\n","import formatImageWithContentModel from '../utils/formatImageWithContentModel';\nimport type { ContentModelImage } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Set image box shadow for all selected images at selection.\n * @param editor The editor instance\n * @param boxShadow The image box boxShadow\n * @param margin The image margin for all sides (eg. \"4px\"), null to remove margin\n */\nexport default function setImageBoxShadow(\n    editor: IContentModelEditor,\n    boxShadow: string,\n    margin?: string | null\n) {\n    editor.focus();\n\n    formatImageWithContentModel(editor, 'setImageBoxShadow', (image: ContentModelImage) => {\n        image.format.boxShadow = boxShadow;\n        if (margin) {\n            image.format.marginBottom = margin;\n            image.format.marginLeft = margin;\n            image.format.marginRight = margin;\n            image.format.marginTop = margin;\n        } else if (margin === null) {\n            delete image.format.marginBottom;\n            delete image.format.marginLeft;\n            delete image.format.marginRight;\n            delete image.format.marginTop;\n        }\n    });\n}\n","import getSelectedSegments from '../selection/getSelectedSegments';\nimport { adjustSegmentSelection } from '../../modelApi/selection/adjustSegmentSelection';\nimport { adjustWordSelection } from '../../modelApi/selection/adjustWordSelection';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { setSelection } from '../../modelApi/selection/setSelection';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Adjust selection to make sure select a hyperlink if any, or a word if original selection is collapsed\n * @return A combination of existing link display text and url if any. If there is no existing link, return selected text and null\n */\nexport default function adjustLinkSelection(editor: IContentModelEditor): [string, string | null] {\n    let text = '';\n    let url: string | null = null;\n\n    formatWithContentModel(editor, 'adjustLinkSelection', model => {\n        let changed = adjustSegmentSelection(\n            model,\n            target => !!target.isSelected && !!target.link,\n            (target, ref) => !!target.link && target.link.format.href == ref.link!.format.href\n        );\n        let segments = getSelectedSegments(model, false /*includingFormatHolder*/);\n        const firstSegment = segments[0];\n\n        if (segments.length == 1 && firstSegment.segmentType == 'SelectionMarker') {\n            segments = adjustWordSelection(model, firstSegment);\n\n            if (segments.length > 1) {\n                changed = true;\n                setSelection(model, segments[0], segments[segments.length - 1]);\n            }\n        }\n\n        text = segments.map(x => (x.segmentType == 'Text' ? x.text : '')).join('');\n        url = segments[0]?.link?.format.href || null;\n\n        return changed;\n    });\n\n    return [text, url];\n}\n","import getSelectedSegments from '../selection/getSelectedSegments';\nimport { ChangeSource } from 'roosterjs-editor-types';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { getPendingFormat } from '../../modelApi/format/pendingFormat';\nimport { HtmlSanitizer, matchLink } from 'roosterjs-editor-dom';\nimport { mergeModel } from '../../modelApi/common/mergeModel';\nimport type { ContentModelLink } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport {\n    addLink,\n    addSegment,\n    createContentModelDocument,\n    createText,\n} from 'roosterjs-content-model-dom';\n\n// Regex matching Uri scheme\nconst URI_REGEX = /^[a-zA-Z]+:/i;\n// Regex matching begin of email address\nconst MAILTO_REGEX = /^[\\w.%+-]+@/i;\n// Regex matching begin of ftp, i.e. ftp.microsoft.com\nconst FTP_REGEX = /^ftp\\./i;\n\n/**\n * Insert a hyperlink at cursor.\n * When there is a selection, hyperlink will be applied to the selection,\n * otherwise a hyperlink will be inserted to the cursor position.\n * @param editor Editor object\n * @param link Link address, can be http(s), mailto, notes, file, unc, ftp, news, telnet, gopher, wais.\n * When protocol is not specified, a best matched protocol will be predicted.\n * @param anchorTitle Optional alt text of the link, will be shown when hover on the link\n * @param displayText Optional display text for the link.\n * @param target Optional display target for the link (\"_blank\"|\"_self\"|\"_parent\"|\"_top\"|\"{framename}\")\n * If specified, the display text of link will be replaced with this text.\n * If not specified and there wasn't a link, the link url will be used as display text.\n */\nexport default function insertLink(\n    editor: IContentModelEditor,\n    link: string,\n    anchorTitle?: string,\n    displayText?: string,\n    target?: string\n) {\n    editor.focus();\n\n    const url = (checkXss(link) || '').trim();\n    if (url) {\n        const linkData = matchLink(url);\n        const linkUrl = linkData ? linkData.normalizedUrl : applyLinkPrefix(url);\n        const links: ContentModelLink[] = [];\n        let anchorNode: Node | undefined;\n\n        formatWithContentModel(\n            editor,\n            'insertLink',\n            (model, context) => {\n                const segments = getSelectedSegments(model, false /*includingFormatHolder*/);\n                const originalText = segments\n                    .map(x => (x.segmentType == 'Text' ? x.text : ''))\n                    .join('');\n                const text = displayText || originalText || '';\n\n                if (\n                    segments.some(x => x.segmentType != 'SelectionMarker') &&\n                    originalText == text\n                ) {\n                    segments.forEach(x => {\n                        const link = createLink(\n                            linkUrl,\n                            anchorTitle,\n                            target,\n                            x.segmentType == 'Text'\n                        );\n                        addLink(x, link);\n                        if (x.link) {\n                            links.push(x.link);\n                        }\n                    });\n                } else if (\n                    segments.every(x => x.segmentType == 'SelectionMarker') ||\n                    (!!text && text != originalText)\n                ) {\n                    const segment = createText(text || (linkData ? linkData.originalUrl : url), {\n                        ...(segments[0]?.format || {}),\n                        ...(getPendingFormat(editor) || {}),\n                    });\n                    const doc = createContentModelDocument();\n                    const link = createLink(linkUrl, anchorTitle, target);\n\n                    addLink(segment, link);\n                    addSegment(doc, segment);\n\n                    if (segment.link) {\n                        links.push(segment.link);\n                    }\n\n                    mergeModel(model, doc, context, {\n                        mergeFormat: 'mergeAll',\n                    });\n                }\n\n                return segments.length > 0;\n            },\n            {\n                changeSource: ChangeSource.CreateLink,\n                onNodeCreated: (modelElement, node) => {\n                    if (!anchorNode && links.indexOf(modelElement as ContentModelLink) >= 0) {\n                        anchorNode = node;\n                    }\n                },\n                getChangeData: () => anchorNode,\n            }\n        );\n    }\n}\n\nconst createLink = (\n    url: string,\n    anchorTitle?: string,\n    target?: string,\n    underline: boolean = true\n): ContentModelLink => {\n    return {\n        dataset: {},\n        format: {\n            href: url,\n            anchorTitle,\n            target,\n            underline: underline,\n        },\n    };\n};\n\n// TODO: This is copied from original code. We may need to integrate this logic into matchLink() later.\nfunction applyLinkPrefix(url: string): string {\n    if (!url) {\n        return url;\n    }\n\n    // Add link prefix per rule:\n    // (a) if the url always starts with a URI scheme, leave it as it is\n    // (b) if the url is an email address, xxx@... add mailto: prefix\n    // (c) if the url starts with ftp., add ftp:// prefix\n    // (d) rest, add http:// prefix\n    let prefix = '';\n    if (url.search(URI_REGEX) < 0) {\n        if (url.search(MAILTO_REGEX) == 0) {\n            prefix = 'mailto:';\n        } else if (url.search(FTP_REGEX) == 0) {\n            prefix = 'ftp://';\n        } else {\n            // fallback to http://\n            prefix = 'http://';\n        }\n    }\n\n    return prefix + url;\n}\n\n// TODO: This is copied from original code. However, ContentModel should be able to filter out malicious\n// attributes later, so no need to use HtmlSanitizer here\nfunction checkXss(link: string): string {\n    const sanitizer = new HtmlSanitizer();\n    const a = document.createElement('a');\n\n    a.href = link || '';\n\n    sanitizer.sanitize(a);\n    // We use getAttribute because some browsers will try to make the href property a valid link.\n    // This has unintended side effects when the link lacks a protocol.\n    return a.getAttribute('href') || '';\n}\n","import getSelectedSegments from '../selection/getSelectedSegments';\nimport { adjustSegmentSelection } from '../../modelApi/selection/adjustSegmentSelection';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Remove link at selection. If no links at selection, do nothing.\n * If selection contains multiple links, all of the link styles will be removed.\n * If only part of a link is selected, the whole link style will be removed.\n * @param editor The editor instance\n */\nexport default function removeLink(editor: IContentModelEditor) {\n    editor.focus();\n\n    formatWithContentModel(editor, 'removeLink', model => {\n        adjustSegmentSelection(\n            model,\n            target => !!target.isSelected && !!target.link,\n            (target, ref) =>\n                target.isSelected || // Expand the selection to any link that is involved. So we can remove multiple links together\n                (!!target.link && target.link.format.href == ref.link!.format.href)\n        );\n\n        const segments = getSelectedSegments(model, false /*includingFormatHolder*/);\n        let isChanged = false;\n\n        segments.forEach(segment => {\n            if (segment.link) {\n                isChanged = true;\n\n                delete segment.link;\n            }\n        });\n\n        return isChanged;\n    });\n}\n","import { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { getFirstSelectedListItem } from '../../modelApi/selection/collectSelections';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Set start number of a list item\n * @param editor The editor to operate on\n * @param value The number to set to, must be equal or greater than 1\n */\nexport default function setListStartNumber(editor: IContentModelEditor, value: number) {\n    editor.focus();\n\n    formatWithContentModel(editor, 'setListStartNumber', model => {\n        const listItem = getFirstSelectedListItem(model);\n        const level = listItem?.levels[listItem?.levels.length - 1];\n\n        if (level) {\n            level.format.startNumberOverride = value;\n\n            return true;\n        } else {\n            return false;\n        }\n    });\n}\n","import { findListItemsInSameThread } from '../../modelApi/list/findListItemsInSameThread';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { getFirstSelectedListItem } from '../../modelApi/selection/collectSelections';\nimport { updateListMetadata } from 'roosterjs-content-model-dom';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type { ListMetadataFormat } from 'roosterjs-content-model-types';\n\n/**\n * Set style of list items with in same thread of current item\n * @param editor The editor to operate on\n * @param style The target list item style to set\n */\nexport default function setListStyle(editor: IContentModelEditor, style: ListMetadataFormat) {\n    editor.focus();\n\n    formatWithContentModel(editor, 'setListStyle', model => {\n        const listItem = getFirstSelectedListItem(model);\n\n        if (listItem) {\n            const listItems = findListItemsInSameThread(model, listItem);\n            const levelIndex = listItem.levels.length - 1;\n\n            listItems.forEach(listItem => {\n                const level = listItem.levels[levelIndex];\n\n                if (level) {\n                    updateListMetadata(level, metadata => Object.assign({}, metadata, style));\n                }\n            });\n\n            return true;\n        } else {\n            return false;\n        }\n    });\n}\n","import { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { setListType } from '../../modelApi/list/setListType';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Toggle bullet list type\n * - When there are some blocks not in bullet list, set all blocks to the given type\n * - When all blocks are already in bullet list, turn off / outdent there list type\n * @param editor The editor to operate on\n */\nexport default function toggleBullet(editor: IContentModelEditor) {\n    editor.focus();\n\n    formatWithContentModel(editor, 'toggleBullet', model => setListType(model, 'UL'), {\n        preservePendingFormat: true,\n    });\n}\n","import { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { setListType } from '../../modelApi/list/setListType';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Toggle numbering list type\n * - When there are some blocks not in numbering list, set all blocks to the given type\n * - When all blocks are already in numbering list, turn off / outdent there list type\n * @param editor The editor to operate on\n */\nexport default function toggleNumbering(editor: IContentModelEditor) {\n    editor.focus();\n\n    formatWithContentModel(editor, 'toggleNumbering', model => setListType(model, 'OL'), {\n        preservePendingFormat: true,\n    });\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { ContentModelSegmentFormat } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Bulk apply segment format to all selected content. This is usually used for format painter.\n * @param editor The editor to operate on\n * @param newFormat The segment format to apply\n */\nexport default function applySegmentFormat(\n    editor: IContentModelEditor,\n    newFormat: ContentModelSegmentFormat\n) {\n    formatSegmentWithContentModel(\n        editor,\n        'applySegmentFormat',\n        format => {\n            format.backgroundColor = newFormat.backgroundColor;\n            format.fontFamily = newFormat.fontFamily;\n            format.fontSize = newFormat.fontSize;\n            format.fontWeight = newFormat.fontWeight;\n            format.italic = newFormat.italic;\n            format.strikethrough = newFormat.strikethrough;\n            format.superOrSubScriptSequence = newFormat.superOrSubScriptSequence;\n            format.textColor = newFormat.textColor;\n            format.underline = newFormat.underline;\n        },\n        undefined /* segmentHasStyleCallback*/,\n        true /*includingFormatHandler*/\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Change the capitalization of text in the selection\n * @param editor The editor instance\n * @param capitalization The case option\n * @param language Optional parameter for language string that should comply to \"IETF BCP 47 Tags for\n * Identifying Languages\". For example: 'en' or 'en-US' for English, 'tr' for Turkish.\n * Default is the host environments current locale.\n */\nexport default function changeCapitalization(\n    editor: IContentModelEditor,\n    capitalization: 'sentence' | 'lowerCase' | 'upperCase' | 'capitalize',\n    language?: string\n) {\n    editor.focus();\n\n    formatSegmentWithContentModel(editor, 'changeCapitalization', (_, __, segment) => {\n        if (segment?.segmentType == 'Text') {\n            switch (capitalization) {\n                case 'lowerCase':\n                    segment.text = segment.text.toLocaleLowerCase(language);\n                    break;\n\n                case 'upperCase':\n                    segment.text = segment.text.toLocaleUpperCase(language);\n                    break;\n\n                case 'capitalize':\n                    const wordArray = segment.text.toLocaleLowerCase(language).split(' ');\n\n                    for (let i = 0; i < wordArray.length; i++) {\n                        wordArray[i] =\n                            wordArray[i].charAt(0).toLocaleUpperCase(language) +\n                            wordArray[i].slice(1);\n                    }\n\n                    segment.text = wordArray.join(' ');\n                    break;\n\n                case 'sentence':\n                    // TODO: Add rules on punctuation for internationalization - TASK 104769\n                    const punctuationMarks = '[\\\\.\\\\!\\\\?]';\n                    // Find a match of a word character either:\n                    // - At the beginning of a string with or without preceding whitespace, for\n                    // example: '  hello world' and 'hello world' strings would both match 'h'.\n                    // - Or preceded by a punctuation mark and at least one whitespace, for\n                    // example 'yes. hello world' would match 'y' and 'h'.\n                    const regex = new RegExp('^\\\\s*\\\\w|' + punctuationMarks + '\\\\s+\\\\w', 'g');\n\n                    segment.text = segment.text\n                        .toLocaleLowerCase(language)\n                        .replace(regex, match => match.toLocaleUpperCase(language));\n                    break;\n            }\n        }\n    });\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport { parseValueWithUnit } from 'roosterjs-content-model-dom';\nimport { setFontSizeInternal } from './setFontSize';\nimport type {\n    ContentModelParagraph,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Default font size sequence, in pt. Suggest editor UI use this sequence as your font size list,\n * So that when increase/decrease font size, the font size can match the sequence of your font size picker\n */\nconst FONT_SIZES = [8, 9, 10, 11, 12, 14, 16, 18, 20, 22, 24, 26, 28, 36, 48, 72];\nconst MIN_FONT_SIZE = 1;\nconst MAX_FONT_SIZE = 1000;\n\n/**\n * Increase or decrease font size in selection\n * @param editor The editor instance\n * @param change Whether increase or decrease font size\n * @param fontSizes A sorted font size array, in pt. Default value is FONT_SIZES\n */\nexport default function changeFontSize(\n    editor: IContentModelEditor,\n    change: 'increase' | 'decrease'\n) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'changeFontSize',\n        (format, _, __, paragraph) => changeFontSizeInternal(change, format, paragraph),\n        undefined /* segmentHasStyleCallback*/,\n        true /*includingFormatHandler*/\n    );\n}\n\nfunction changeFontSizeInternal(\n    change: 'increase' | 'decrease',\n    format: ContentModelSegmentFormat,\n    paragraph: ContentModelParagraph | null\n) {\n    if (format.fontSize) {\n        const sizeInPt = parseValueWithUnit(format.fontSize, undefined /*element*/, 'pt');\n\n        if (sizeInPt > 0) {\n            const newSize = getNewFontSize(sizeInPt, change == 'increase' ? 1 : -1, FONT_SIZES);\n\n            setFontSizeInternal(newSize + 'pt', format, paragraph);\n        }\n    }\n}\n\nfunction getNewFontSize(pt: number, changeBase: 1 | -1, fontSizes: number[]): number {\n    pt = changeBase == 1 ? Math.floor(pt) : Math.ceil(pt);\n    const last = fontSizes[fontSizes.length - 1];\n    if (pt <= fontSizes[0]) {\n        pt = Math.max(pt + changeBase, MIN_FONT_SIZE);\n    } else if (pt > last || (pt == last && changeBase == 1)) {\n        pt = pt / 10;\n        pt = changeBase == 1 ? Math.floor(pt) : Math.ceil(pt);\n        pt = Math.min(Math.max((pt + changeBase) * 10, last), MAX_FONT_SIZE);\n    } else if (changeBase == 1) {\n        for (let i = 0; i < fontSizes.length; i++) {\n            if (pt < fontSizes[i]) {\n                pt = fontSizes[i];\n                break;\n            }\n        }\n    } else {\n        for (let i = fontSizes.length - 1; i >= 0; i--) {\n            if (pt > fontSizes[i]) {\n                pt = fontSizes[i];\n                break;\n            }\n        }\n    }\n    return pt;\n}\n","import { createSelectionMarker } from 'roosterjs-content-model-dom';\nimport { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport { setSelection } from '../../modelApi/selection/setSelection';\nimport type { ContentModelParagraph } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Set background color\n * @param editor The editor to operate on\n * @param backgroundColor The color to set. Pass null to remove existing color.\n */\nexport default function setBackgroundColor(\n    editor: IContentModelEditor,\n    backgroundColor: string | null\n) {\n    editor.focus();\n\n    let lastParagraph: ContentModelParagraph | null = null;\n    let lastSegmentIndex: number = -1;\n\n    formatSegmentWithContentModel(\n        editor,\n        'setBackgroundColor',\n        (format, _, segment, paragraph) => {\n            if (backgroundColor === null) {\n                delete format.backgroundColor;\n            } else {\n                format.backgroundColor = backgroundColor;\n            }\n\n            if (segment && paragraph && segment.segmentType != 'SelectionMarker') {\n                lastParagraph = paragraph;\n                lastSegmentIndex = lastParagraph.segments.indexOf(segment);\n            }\n        },\n        undefined /*segmentHasStyleCallback*/,\n        undefined /*includingFormatHolder*/,\n        model => {\n            if (lastParagraph && lastSegmentIndex >= 0) {\n                const marker = createSelectionMarker(\n                    lastParagraph.segments[lastSegmentIndex]?.format\n                );\n\n                lastParagraph.segments.splice(lastSegmentIndex + 1, 0, marker);\n                setSelection(model, marker, marker);\n            }\n        }\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Set font name\n * @param editor The editor to operate on\n * @param fontName The font name to set\n */\nexport default function setFontName(editor: IContentModelEditor, fontName: string) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'setFontName',\n        (format, _, segment) => {\n            format.fontFamily = fontName;\n\n            if (segment?.code) {\n                segment.code.format.fontFamily = fontName;\n            }\n        },\n        undefined /* segmentHasStyleCallback*/,\n        true /*includingFormatHandler*/\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type {\n    ContentModelParagraph,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Set font size\n * @param editor The editor to operate on\n * @param fontSize The font size to set\n */\nexport default function setFontSize(editor: IContentModelEditor, fontSize: string) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'setFontSize',\n        (format, _, __, paragraph) => setFontSizeInternal(fontSize, format, paragraph),\n        undefined /* segmentHasStyleCallback*/,\n        true /*includingFormatHandler*/\n    );\n}\n\n/**\n * @internal\n * Internal set font function shared by setFontSize and changeFontSize\n */\nexport function setFontSizeInternal(\n    fontSize: string,\n    format: ContentModelSegmentFormat,\n    paragraph: ContentModelParagraph | null\n) {\n    format.fontSize = fontSize;\n\n    // Since we have set font size to segment, it can be smaller than the one in paragraph format, so delete font size from paragraph\n    if (paragraph?.segmentFormat?.fontSize) {\n        const size = paragraph.segmentFormat.fontSize;\n\n        paragraph.segments.forEach(segment => {\n            if (!segment.format.fontSize) {\n                segment.format.fontSize = size;\n            }\n        });\n\n        delete paragraph.segmentFormat.fontSize;\n    }\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Set text color\n * @param editor The editor to operate on\n * @param textColor The text color to set. Pass null to remove existing color.\n */\nexport default function setTextColor(editor: IContentModelEditor, textColor: string | null) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'setTextColor',\n        textColor === null\n            ? (format, _, segment) => {\n                  delete format.textColor;\n\n                  if (segment?.link) {\n                      delete segment.link.format.textColor;\n                  }\n              }\n            : (format, _, segment) => {\n                  format.textColor = textColor;\n\n                  if (segment?.link) {\n                      segment.link.format.textColor = textColor;\n                  }\n              },\n        undefined /* segmentHasStyleCallback*/,\n        true /*includingFormatHandler*/\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Toggle bold style\n * @param editor The editor to operate on\n */\nexport default function toggleBold(editor: IContentModelEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleBold',\n        (format, isTurningOn) => {\n            format.fontWeight = isTurningOn ? 'bold' : 'normal';\n        },\n        (format, _, paragraph) =>\n            isBold(\n                typeof format.fontWeight == 'undefined'\n                    ? paragraph?.decorator?.format.fontWeight\n                    : format.fontWeight\n            )\n    );\n}\n\n/**\n * @internal\n */\nexport function isBold(boldStyle?: string): boolean {\n    return (\n        !!boldStyle && (boldStyle == 'bold' || boldStyle == 'bolder' || parseInt(boldStyle) >= 600)\n    );\n}\n","import { addCode } from 'roosterjs-content-model-dom';\nimport { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { ContentModelCode } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\nconst DefaultCode: ContentModelCode = {\n    format: {\n        fontFamily: 'monospace',\n    },\n};\n\n/**\n * Toggle italic style\n * @param editor The editor to operate on\n */\nexport default function toggleCode(editor: IContentModelEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleCode',\n        (_, isTurningOn, segment) => {\n            if (segment) {\n                if (isTurningOn) {\n                    addCode(segment, DefaultCode);\n                } else {\n                    delete segment.code;\n                }\n            }\n        },\n        (_, segment) => !!segment?.code\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Toggle italic style\n * @param editor The editor to operate on\n */\nexport default function toggleItalic(editor: IContentModelEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleItalic',\n        (format, isTurningOn) => {\n            format.italic = !!isTurningOn;\n        },\n        format => !!format.italic\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Toggle strikethrough style\n * @param editor The editor to operate on\n */\nexport default function toggleStrikethrough(editor: IContentModelEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleStrikethrough',\n        (format, isTurningOn) => {\n            format.strikethrough = !!isTurningOn;\n        },\n        format => !!format.strikethrough\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Toggle subscript style\n * @param editor The editor to operate on\n */\nexport default function toggleSubscript(editor: IContentModelEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleSubscript',\n        (format, isTurningOn) => {\n            format.superOrSubScriptSequence = isTurningOn ? 'sub' : '';\n        },\n        format => format.superOrSubScriptSequence?.split(' ').pop() == 'sub'\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Toggle superscript style\n * @param editor The editor to operate on\n */\nexport default function toggleSuperscript(editor: IContentModelEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleSuperscript',\n        (format, isTurningOn) => {\n            format.superOrSubScriptSequence = isTurningOn ? 'super' : '';\n        },\n        format => format.superOrSubScriptSequence?.split(' ').pop() == 'super'\n    );\n}\n","import { formatSegmentWithContentModel } from '../utils/formatSegmentWithContentModel';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Toggle underline style\n * @param editor The editor to operate on\n */\nexport default function toggleUnderline(editor: IContentModelEditor) {\n    editor.focus();\n\n    formatSegmentWithContentModel(\n        editor,\n        'toggleUnderline',\n        (format, isTurningOn, segment) => {\n            format.underline = !!isTurningOn;\n\n            if (segment?.link) {\n                segment.link.format.underline = !!isTurningOn;\n            }\n        },\n        (format, segment) => !!format.underline || !!segment?.link?.format?.underline\n    );\n}\n","import { getSelectedSegmentsAndParagraphs } from '../../modelApi/selection/collectSelections';\nimport type { ContentModelDocument, ContentModelSegment } from 'roosterjs-content-model-types';\n\n/**\n * Get selected segments from a content model\n */\nexport default function getSelectedSegments(\n    model: ContentModelDocument,\n    includingFormatHolder: boolean\n): ContentModelSegment[] {\n    return getSelectedSegmentsAndParagraphs(model, includingFormatHolder).map(x => x[0]);\n}\n","import hasSelectionInBlockGroup from './hasSelectionInBlockGroup';\nimport hasSelectionInSegment from './hasSelectionInSegment';\nimport type { ContentModelBlock } from 'roosterjs-content-model-types';\n\n/**\n * Check if there is selection within the given block\n * @param block The block to check\n */\nexport default function hasSelectionInBlock(block: ContentModelBlock): boolean {\n    switch (block.blockType) {\n        case 'Paragraph':\n            return block.segments.some(hasSelectionInSegment);\n\n        case 'Table':\n            return block.rows.some(row => row.cells.some(hasSelectionInBlockGroup));\n\n        case 'BlockGroup':\n            return hasSelectionInBlockGroup(block);\n\n        case 'Divider':\n        case 'Entity':\n            return !!block.isSelected;\n\n        default:\n            return false;\n    }\n}\n","import hasSelectionInBlock from './hasSelectionInBlock';\nimport type { ContentModelBlockGroup } from 'roosterjs-content-model-types';\n\n/**\n * Check if there is selection within the given block\n * @param block The block to check\n */\nexport default function hasSelectionInBlockGroup(group: ContentModelBlockGroup): boolean {\n    if (group.blockGroupType == 'TableCell' && group.isSelected) {\n        return true;\n    }\n\n    if (group.blocks.some(hasSelectionInBlock)) {\n        return true;\n    }\n\n    return false;\n}\n","import hasSelectionInBlock from './hasSelectionInBlock';\nimport type { ContentModelSegment } from 'roosterjs-content-model-types';\n\n/**\n * Check if there is selection within the given segment\n * @param segment The segment to check\n */\nexport default function hasSelectionInSegment(segment: ContentModelSegment): boolean {\n    return (\n        segment.isSelected ||\n        (segment.segmentType == 'General' && segment.blocks.some(hasSelectionInBlock))\n    );\n}\n","import hasSelectionInBlock from '../selection/hasSelectionInBlock';\nimport { alignTable } from '../../modelApi/table/alignTable';\nimport { alignTableCell } from '../../modelApi/table/alignTableCell';\nimport { applyTableFormat } from '../../modelApi/table/applyTableFormat';\nimport { deleteTable } from '../../modelApi/table/deleteTable';\nimport { deleteTableColumn } from '../../modelApi/table/deleteTableColumn';\nimport { deleteTableRow } from '../../modelApi/table/deleteTableRow';\nimport { ensureFocusableParagraphForTable } from '../../modelApi/table/ensureFocusableParagraphForTable';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { getFirstSelectedTable } from '../../modelApi/selection/collectSelections';\nimport { insertTableColumn } from '../../modelApi/table/insertTableColumn';\nimport { insertTableRow } from '../../modelApi/table/insertTableRow';\nimport { mergeTableCells } from '../../modelApi/table/mergeTableCells';\nimport { mergeTableColumn } from '../../modelApi/table/mergeTableColumn';\nimport { mergeTableRow } from '../../modelApi/table/mergeTableRow';\nimport { normalizeTable } from '../../modelApi/table/normalizeTable';\nimport { setSelection } from '../../modelApi/selection/setSelection';\nimport { splitTableCellHorizontally } from '../../modelApi/table/splitTableCellHorizontally';\nimport { splitTableCellVertically } from '../../modelApi/table/splitTableCellVertically';\nimport { TableOperation } from 'roosterjs-editor-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport {\n    createSelectionMarker,\n    hasMetadata,\n    setParagraphNotImplicit,\n} from 'roosterjs-content-model-dom';\n\n/**\n * Format current focused table with the given format\n * @param editor The editor instance\n * @param operation The table operation to apply\n */\nexport default function editTable(editor: IContentModelEditor, operation: TableOperation) {\n    editor.focus();\n\n    formatWithContentModel(editor, 'editTable', model => {\n        const [tableModel, path] = getFirstSelectedTable(model);\n\n        if (tableModel) {\n            switch (operation) {\n                case TableOperation.AlignCellLeft:\n                case TableOperation.AlignCellCenter:\n                case TableOperation.AlignCellRight:\n                    alignTableCell(tableModel, operation);\n                    break;\n                case TableOperation.AlignCellTop:\n                case TableOperation.AlignCellMiddle:\n                case TableOperation.AlignCellBottom:\n                    alignTableCell(tableModel, operation);\n                    break;\n                case TableOperation.AlignCenter:\n                case TableOperation.AlignLeft:\n                case TableOperation.AlignRight:\n                    alignTable(tableModel, operation);\n                    break;\n\n                case TableOperation.DeleteColumn:\n                    deleteTableColumn(tableModel);\n                    break;\n\n                case TableOperation.DeleteRow:\n                    deleteTableRow(tableModel);\n                    break;\n\n                case TableOperation.DeleteTable:\n                    deleteTable(tableModel);\n                    break;\n\n                case TableOperation.InsertAbove:\n                case TableOperation.InsertBelow:\n                    insertTableRow(tableModel, operation);\n                    break;\n\n                case TableOperation.InsertLeft:\n                case TableOperation.InsertRight:\n                    insertTableColumn(tableModel, operation);\n                    break;\n\n                case TableOperation.MergeAbove:\n                case TableOperation.MergeBelow:\n                    mergeTableRow(tableModel, operation);\n                    break;\n\n                case TableOperation.MergeCells:\n                    mergeTableCells(tableModel);\n                    break;\n\n                case TableOperation.MergeLeft:\n                case TableOperation.MergeRight:\n                    mergeTableColumn(tableModel, operation);\n                    break;\n\n                case TableOperation.SplitHorizontally:\n                    splitTableCellHorizontally(tableModel);\n                    break;\n\n                case TableOperation.SplitVertically:\n                    splitTableCellVertically(tableModel);\n                    break;\n            }\n\n            if (!hasSelectionInBlock(tableModel)) {\n                const paragraph = ensureFocusableParagraphForTable(model, path, tableModel);\n\n                if (paragraph) {\n                    const marker = createSelectionMarker(model.format);\n\n                    paragraph.segments.unshift(marker);\n                    setParagraphNotImplicit(paragraph);\n                    setSelection(model, marker);\n                }\n            }\n\n            normalizeTable(tableModel);\n\n            if (hasMetadata(tableModel)) {\n                applyTableFormat(tableModel, undefined /*newFormat*/, true /*keepCellShade*/);\n            }\n\n            return true;\n        } else {\n            return false;\n        }\n    });\n}\n","import { applyTableFormat } from '../../modelApi/table/applyTableFormat';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { getFirstSelectedTable } from '../../modelApi/selection/collectSelections';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type { TableMetadataFormat } from 'roosterjs-content-model-types';\n\n/**\n * Format current focused table with the given format\n * @param editor The editor instance\n * @param format The table format to apply\n * @param keepCellShade Whether keep existing shade color when apply format if there is a manually set shade color\n */\nexport default function formatTable(\n    editor: IContentModelEditor,\n    format: TableMetadataFormat,\n    keepCellShade?: boolean\n) {\n    editor.focus();\n\n    formatWithContentModel(editor, 'formatTable', model => {\n        const [tableModel] = getFirstSelectedTable(model);\n\n        if (tableModel) {\n            applyTableFormat(tableModel, format, keepCellShade);\n\n            return true;\n        } else {\n            return false;\n        }\n    });\n}\n","import { applyTableFormat } from '../../modelApi/table/applyTableFormat';\nimport { createContentModelDocument, createSelectionMarker } from 'roosterjs-content-model-dom';\nimport { createTableStructure } from '../../modelApi/table/createTableStructure';\nimport { deleteSelection } from '../../modelApi/edit/deleteSelection';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { getPendingFormat } from '../../modelApi/format/pendingFormat';\nimport { mergeModel } from '../../modelApi/common/mergeModel';\nimport { normalizeTable } from '../../modelApi/table/normalizeTable';\nimport { setSelection } from '../../modelApi/selection/setSelection';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type { TableMetadataFormat } from 'roosterjs-content-model-types';\n\n/**\n * Insert table into editor at current selection\n * @param editor The editor instance\n * @param columns Number of columns in table, it also controls the default table cell width:\n * if columns &lt;= 4, width = 120px; if columns &lt;= 6, width = 100px; else width = 70px\n * @param rows Number of rows in table\n * @param format (Optional) The table format. If not passed, the default format will be applied:\n * background color: #FFF; border color: #ABABAB\n */\nexport default function insertTable(\n    editor: IContentModelEditor,\n    columns: number,\n    rows: number,\n    format?: Partial<TableMetadataFormat>\n) {\n    editor.focus();\n\n    formatWithContentModel(editor, 'insertTable', (model, context) => {\n        const insertPosition = deleteSelection(model, [], context).insertPoint;\n\n        if (insertPosition) {\n            const doc = createContentModelDocument();\n            const table = createTableStructure(doc, columns, rows);\n\n            normalizeTable(table, getPendingFormat(editor) || insertPosition.marker.format);\n            // Assign default vertical align\n            format = format || { verticalAlign: 'top' };\n            applyTableFormat(table, format);\n            mergeModel(model, doc, context, {\n                insertPosition,\n                mergeFormat: 'mergeAll',\n            });\n\n            const firstBlock = table.rows[0]?.cells[0]?.blocks[0];\n\n            if (firstBlock?.blockType == 'Paragraph') {\n                const marker = createSelectionMarker(firstBlock.segments[0]?.format);\n                firstBlock.segments.unshift(marker);\n                setSelection(model, marker);\n            }\n\n            return true;\n        } else {\n            return false;\n        }\n    });\n}\n","import hasSelectionInBlockGroup from '../selection/hasSelectionInBlockGroup';\nimport { formatWithContentModel } from '../utils/formatWithContentModel';\nimport { getFirstSelectedTable } from '../../modelApi/selection/collectSelections';\nimport { normalizeTable } from '../../modelApi/table/normalizeTable';\nimport { setTableCellBackgroundColor } from '../../modelApi/table/setTableCellBackgroundColor';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * Set table cell shade color\n * @param editor The editor instance\n * @param color The color to set. Pass null to remove existing shade color\n */\nexport default function setTableCellShade(editor: IContentModelEditor, color: string | null) {\n    editor.focus();\n\n    formatWithContentModel(editor, 'setTableCellShade', model => {\n        const [table] = getFirstSelectedTable(model);\n\n        if (table) {\n            normalizeTable(table);\n\n            table.rows.forEach(row =>\n                row.cells.forEach(cell => {\n                    if (hasSelectionInBlockGroup(cell)) {\n                        setTableCellBackgroundColor(cell, color, true /*isColorOverride*/);\n                    }\n                })\n            );\n\n            return true;\n        } else {\n            return false;\n        }\n    });\n}\n","import { formatSegmentWithContentModel } from './formatSegmentWithContentModel';\nimport { PluginEventType } from 'roosterjs-editor-types';\nimport type { ContentModelImage } from 'roosterjs-content-model-types';\nimport type { EditImageEventData } from 'roosterjs-editor-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * @internal\n */\nexport default function formatImageWithContentModel(\n    editor: IContentModelEditor,\n    apiName: string,\n    callback: (segment: ContentModelImage) => void,\n    eventChangeData?: EditImageEventData\n) {\n    formatSegmentWithContentModel(\n        editor,\n        apiName,\n        (_, __, segment) => {\n            if (segment?.segmentType == 'Image') {\n                callback(segment);\n                if (eventChangeData) {\n                    editor.triggerPluginEvent(PluginEventType.EditImage, eventChangeData);\n                }\n            }\n        },\n        undefined /** segmentHasStyleCallback **/,\n        undefined /** includingFormatHolder */\n    );\n}\n","import { formatWithContentModel } from './formatWithContentModel';\nimport { getSelectedParagraphs } from '../../modelApi/selection/collectSelections';\nimport type { ContentModelParagraph } from 'roosterjs-content-model-types';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\n\n/**\n * @internal\n */\nexport function formatParagraphWithContentModel(\n    editor: IContentModelEditor,\n    apiName: string,\n    setStyleCallback: (paragraph: ContentModelParagraph) => void\n) {\n    formatWithContentModel(\n        editor,\n        apiName,\n        model => {\n            const paragraphs = getSelectedParagraphs(model);\n\n            paragraphs.forEach(setStyleCallback);\n\n            return paragraphs.length > 0;\n        },\n        {\n            preservePendingFormat: true,\n        }\n    );\n}\n","import { adjustWordSelection } from '../../modelApi/selection/adjustWordSelection';\nimport { formatWithContentModel } from './formatWithContentModel';\nimport { getPendingFormat, setPendingFormat } from '../../modelApi/format/pendingFormat';\nimport { getSelectedSegmentsAndParagraphs } from '../../modelApi/selection/collectSelections';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type {\n    ContentModelDocument,\n    ContentModelParagraph,\n    ContentModelSegment,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\n/**\n * @internal\n */\nexport function formatSegmentWithContentModel(\n    editor: IContentModelEditor,\n    apiName: string,\n    toggleStyleCallback: (\n        format: ContentModelSegmentFormat,\n        isTuringOn: boolean,\n        segment: ContentModelSegment | null,\n        paragraph: ContentModelParagraph | null\n    ) => void,\n    segmentHasStyleCallback?: (\n        format: ContentModelSegmentFormat,\n        segment: ContentModelSegment | null,\n        paragraph: ContentModelParagraph | null\n    ) => boolean,\n    includingFormatHolder?: boolean,\n    afterFormatCallback?: (model: ContentModelDocument) => void\n) {\n    formatWithContentModel(editor, apiName, model => {\n        let segmentAndParagraphs = getSelectedSegmentsAndParagraphs(model, !!includingFormatHolder);\n        const pendingFormat = getPendingFormat(editor);\n        let isCollapsedSelection =\n            segmentAndParagraphs.length == 1 &&\n            segmentAndParagraphs[0][0].segmentType == 'SelectionMarker';\n\n        if (isCollapsedSelection) {\n            const para = segmentAndParagraphs[0][1];\n\n            segmentAndParagraphs = adjustWordSelection(model, segmentAndParagraphs[0][0]).map(x => [\n                x,\n                para,\n            ]);\n\n            if (segmentAndParagraphs.length > 1) {\n                isCollapsedSelection = false;\n            }\n        }\n\n        const formatsAndSegments: [\n            ContentModelSegmentFormat,\n            ContentModelSegment | null,\n            ContentModelParagraph | null\n        ][] = pendingFormat\n            ? [[pendingFormat, null, null]]\n            : segmentAndParagraphs.map(item => [item[0].format, item[0], item[1]]);\n\n        const isTurningOff = segmentHasStyleCallback\n            ? formatsAndSegments.every(([format, segment, paragraph]) =>\n                  segmentHasStyleCallback(format, segment, paragraph)\n              )\n            : false;\n\n        formatsAndSegments.forEach(([format, segment, paragraph]) =>\n            toggleStyleCallback(format, !isTurningOff, segment, paragraph)\n        );\n\n        afterFormatCallback?.(model);\n\n        if (!pendingFormat && isCollapsedSelection) {\n            const pos = editor.getFocusedPosition();\n\n            if (pos) {\n                setPendingFormat(editor, segmentAndParagraphs[0][0].format, pos.node, pos.offset);\n            }\n        }\n\n        if (isCollapsedSelection) {\n            editor.focus();\n            return false;\n        } else {\n            return formatsAndSegments.length > 0;\n        }\n    });\n}\n","import { ChangeSource, PluginEventType } from 'roosterjs-editor-types';\nimport { getPendingFormat, setPendingFormat } from '../../modelApi/format/pendingFormat';\nimport type { Entity } from 'roosterjs-editor-types';\nimport type { ContentModelContentChangedEventData } from '../../publicTypes/event/ContentModelContentChangedEvent';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type {\n    ContentModelFormatter,\n    FormatWithContentModelContext,\n    FormatWithContentModelOptions,\n} from '../../publicTypes/parameter/FormatWithContentModelContext';\nimport type { DOMSelection } from 'roosterjs-content-model-types';\n\n/**\n * The general API to do format change with Content Model\n * It will grab a Content Model for current editor content, and invoke a callback function\n * to do format change. Then according to the return value, write back the modified content model into editor.\n * If there is cached model, it will be used and updated.\n * @param editor Content Model editor\n * @param apiName Name of the format API\n * @param formatter Formatter function, see ContentModelFormatter\n * @param options More options, see FormatWithContentModelOptions\n */\nexport function formatWithContentModel(\n    editor: IContentModelEditor,\n    apiName: string,\n    formatter: ContentModelFormatter,\n    options?: FormatWithContentModelOptions\n) {\n    const {\n        onNodeCreated,\n        preservePendingFormat,\n        getChangeData,\n        changeSource,\n        rawEvent,\n        selectionOverride,\n    } = options || {};\n\n    const model = editor.createContentModel(undefined /*option*/, selectionOverride);\n    const context: FormatWithContentModelContext = {\n        newEntities: [],\n        deletedEntities: [],\n        rawEvent,\n        newImages: [],\n    };\n    let selection: DOMSelection | undefined;\n\n    if (formatter(model, context)) {\n        const writeBack = () => {\n            handleNewEntities(editor, context);\n            handleDeletedEntities(editor, context);\n            handleImages(editor, context);\n\n            selection =\n                editor.setContentModel(model, undefined /*options*/, onNodeCreated) || undefined;\n\n            if (preservePendingFormat) {\n                const pendingFormat = getPendingFormat(editor);\n                const pos = editor.getFocusedPosition();\n\n                if (pendingFormat && pos) {\n                    setPendingFormat(editor, pendingFormat, pos.node, pos.offset);\n                }\n            }\n        };\n\n        if (context.skipUndoSnapshot) {\n            writeBack();\n        } else {\n            editor.addUndoSnapshot(\n                writeBack,\n                undefined /*changeSource, passing undefined here to avoid triggering ContentChangedEvent. We will trigger it using it with Content Model below */,\n                false /*canUndoByBackspace*/,\n                {\n                    formatApiName: apiName,\n                }\n            );\n        }\n\n        const eventData: ContentModelContentChangedEventData = {\n            contentModel: model,\n            selection: selection,\n            source: changeSource || ChangeSource.Format,\n            data: getChangeData?.(),\n            additionalData: {\n                formatApiName: apiName,\n            },\n        };\n        editor.triggerPluginEvent(PluginEventType.ContentChanged, eventData);\n    }\n}\n\nfunction handleNewEntities(editor: IContentModelEditor, context: FormatWithContentModelContext) {\n    // TODO: Ideally we can trigger NewEntity event here. But to be compatible with original editor code, we don't do it here for now.\n    // Once Content Model Editor can be standalone, we can change this behavior to move triggering NewEntity event code\n    // from EntityPlugin to here\n\n    if (editor.isDarkMode()) {\n        context.newEntities.forEach(entity => {\n            editor.transformToDarkColor(entity.wrapper);\n        });\n    }\n}\n\nfunction handleDeletedEntities(\n    editor: IContentModelEditor,\n    context: FormatWithContentModelContext\n) {\n    context.deletedEntities.forEach(\n        ({\n            entity: {\n                wrapper,\n                entityFormat: { id, entityType, isReadonly },\n            },\n            operation,\n        }) => {\n            if (id && entityType) {\n                // TODO: Revisit this entity parameter for standalone editor, we may just directly pass ContentModelEntity object instead\n                const entity: Entity = {\n                    id,\n                    type: entityType,\n                    isReadonly: !!isReadonly,\n                    wrapper,\n                };\n                editor.triggerPluginEvent(PluginEventType.EntityOperation, {\n                    entity,\n                    operation,\n                    rawEvent: context.rawEvent,\n                });\n            }\n        }\n    );\n}\n\nfunction handleImages(editor: IContentModelEditor, context: FormatWithContentModelContext) {\n    if (context.newImages.length > 0) {\n        const viewport = editor.getVisibleViewport();\n        if (viewport) {\n            const { top, bottom, left, right } = viewport;\n            const minMaxImageSize = 10;\n            const maxWidth = Math.max(right - left, minMaxImageSize);\n            const maxHeight = Math.max(bottom - top, minMaxImageSize);\n            context.newImages.forEach(image => {\n                image.format.maxHeight = `${maxHeight}px`;\n                image.format.maxWidth = `${maxWidth}px`;\n            });\n        }\n    }\n}\n","import getSelectedSegments from '../selection/getSelectedSegments';\nimport { ChangeSource, GetContentMode, PasteType, PluginEventType } from 'roosterjs-editor-types';\nimport { formatWithContentModel } from './formatWithContentModel';\nimport { mergeModel } from '../../modelApi/common/mergeModel';\nimport type {\n    ContentModelDocument,\n    ContentModelSegmentFormat,\n} from 'roosterjs-content-model-types';\nimport type { FormatWithContentModelContext } from '../../publicTypes/parameter/FormatWithContentModelContext';\nimport type { IContentModelEditor } from '../../publicTypes/IContentModelEditor';\nimport type { ClipboardData } from 'roosterjs-editor-types';\nimport {\n    applySegmentFormatToElement,\n    createDomToModelContext,\n    domToContentModel,\n    moveChildNodes,\n} from 'roosterjs-content-model-dom';\nimport type { ContentModelBeforePasteEventData } from '../../publicTypes/event/ContentModelBeforePasteEvent';\nimport type ContentModelBeforePasteEvent from '../../publicTypes/event/ContentModelBeforePasteEvent';\nimport {\n    createDefaultHtmlSanitizerOptions,\n    getPasteType,\n    handleImagePaste,\n    handleTextPaste,\n    retrieveMetadataFromClipboard,\n    sanitizePasteContent,\n} from 'roosterjs-editor-dom';\n\n/**\n * Paste into editor using a clipboardData object\n * @param clipboardData Clipboard data retrieved from clipboard\n * @param pasteAsText Force pasting as plain text. Default value is false\n * @param applyCurrentStyle True if apply format of current selection to the pasted content,\n * false to keep original format.  Default value is false. When pasteAsText is true, this parameter is ignored\n * @param pasteAsImage: When set to true, if the clipboardData contains a imageDataUri will paste the image to the editor\n */\nexport default function paste(\n    editor: IContentModelEditor,\n    clipboardData: ClipboardData,\n    pasteAsText: boolean = false,\n    applyCurrentFormat: boolean = false,\n    pasteAsImage: boolean = false\n) {\n    if (clipboardData.snapshotBeforePaste) {\n        // Restore original content before paste a new one\n        editor.setContent(clipboardData.snapshotBeforePaste);\n    } else {\n        clipboardData.snapshotBeforePaste = editor.getContent(GetContentMode.RawHTMLWithSelection);\n    }\n\n    editor.focus();\n\n    formatWithContentModel(\n        editor,\n        'Paste',\n        (model, context) => {\n            const eventData = createBeforePasteEventData(\n                editor,\n                clipboardData,\n                getPasteType(pasteAsText, applyCurrentFormat, pasteAsImage)\n            );\n            const currentSegment = getSelectedSegments(model, true /*includingFormatHolder*/)[0];\n            const { fontFamily, fontSize, textColor, backgroundColor, letterSpacing, lineHeight } =\n                currentSegment?.format ?? {};\n            const {\n                domToModelOption,\n                fragment,\n                customizedMerge,\n            } = triggerPluginEventAndCreatePasteFragment(\n                editor,\n                clipboardData,\n                pasteAsText,\n                pasteAsImage,\n                eventData,\n                { fontFamily, fontSize, textColor, backgroundColor, letterSpacing, lineHeight }\n            );\n\n            const pasteModel = domToContentModel(\n                fragment,\n                createDomToModelContext(undefined /*editorContext*/, domToModelOption)\n            );\n\n            mergePasteContent(model, context, pasteModel, applyCurrentFormat, customizedMerge);\n\n            return true;\n        },\n\n        {\n            changeSource: ChangeSource.Paste,\n            getChangeData: () => clipboardData,\n        }\n    );\n}\n\n/**\n * @internal\n * Export only for unit test\n */\nexport function mergePasteContent(\n    model: ContentModelDocument,\n    context: FormatWithContentModelContext,\n    pasteModel: ContentModelDocument,\n    applyCurrentFormat: boolean,\n    customizedMerge:\n        | undefined\n        | ((source: ContentModelDocument, target: ContentModelDocument) => void)\n) {\n    if (customizedMerge) {\n        customizedMerge(model, pasteModel);\n    } else {\n        mergeModel(model, pasteModel, context, {\n            mergeFormat: applyCurrentFormat ? 'keepSourceEmphasisFormat' : 'none',\n            mergeTable: shouldMergeTable(pasteModel),\n        });\n    }\n}\n\nfunction shouldMergeTable(pasteModel: ContentModelDocument): boolean | undefined {\n    // If model contains a table and a paragraph element after the table with a single BR segment, remove the Paragraph after the table\n    if (\n        pasteModel.blocks.length == 2 &&\n        pasteModel.blocks[0].blockType === 'Table' &&\n        pasteModel.blocks[1].blockType === 'Paragraph' &&\n        pasteModel.blocks[1].segments.length === 1 &&\n        pasteModel.blocks[1].segments[0].segmentType === 'Br'\n    ) {\n        pasteModel.blocks.splice(1);\n    }\n    // Only merge table when the document contain a single table.\n    return pasteModel.blocks.length === 1 && pasteModel.blocks[0].blockType === 'Table';\n}\n\nfunction createBeforePasteEventData(\n    editor: IContentModelEditor,\n    clipboardData: ClipboardData,\n    pasteType: PasteType\n): ContentModelBeforePasteEventData {\n    const options = createDefaultHtmlSanitizerOptions();\n\n    // Remove \"caret-color\" style generated by Safari to make sure caret shows in right color after paste\n    options.cssStyleCallbacks['caret-color'] = () => false;\n\n    return {\n        clipboardData,\n        fragment: editor.getDocument().createDocumentFragment(),\n        sanitizingOption: options,\n        htmlBefore: '',\n        htmlAfter: '',\n        htmlAttributes: {},\n        domToModelOption: {},\n        pasteType,\n    };\n}\n\n/**\n * This function is used to create a BeforePasteEvent object after trigger the event, so other plugins can modify the event object\n * This function will also create a DocumentFragment for paste.\n */\nfunction triggerPluginEventAndCreatePasteFragment(\n    editor: IContentModelEditor,\n    clipboardData: ClipboardData,\n    pasteAsText: boolean,\n    pasteAsImage: boolean,\n    eventData: ContentModelBeforePasteEventData,\n    currentFormat: ContentModelSegmentFormat\n): ContentModelBeforePasteEventData {\n    const event = {\n        eventType: PluginEventType.BeforePaste,\n        ...eventData,\n    } as ContentModelBeforePasteEvent;\n\n    const { fragment } = event;\n    const { rawHtml, text, imageDataUri } = clipboardData;\n    const trustedHTMLHandler = editor.getTrustedHTMLHandler();\n\n    const doc: Document | undefined = rawHtml\n        ? new DOMParser().parseFromString(trustedHTMLHandler(rawHtml), 'text/html')\n        : undefined;\n\n    // Step 2: Retrieve Metadata from Html and the Html that was copied.\n    retrieveMetadataFromClipboard(doc, event, trustedHTMLHandler);\n\n    // Step 3: Fill the BeforePasteEvent object, especially the fragment for paste\n    if ((pasteAsImage && imageDataUri) || (!pasteAsText && !text && imageDataUri)) {\n        // Paste image\n        handleImagePaste(imageDataUri, fragment);\n    } else if (!pasteAsText && rawHtml && doc ? doc.body : false) {\n        moveChildNodes(fragment, doc?.body);\n    } else if (text) {\n        // Paste text\n        handleTextPaste(text, null /*position*/, fragment);\n    }\n\n    const formatContainer = fragment.ownerDocument.createElement('span');\n\n    moveChildNodes(formatContainer, fragment);\n    fragment.appendChild(formatContainer);\n\n    applySegmentFormatToElement(formatContainer, currentFormat);\n\n    let pluginEvent: ContentModelBeforePasteEvent = event;\n    // Step 4: Trigger BeforePasteEvent so that plugins can do proper change before paste, when the type of paste is different than Plain Text\n    if (event.pasteType !== PasteType.AsPlainText) {\n        pluginEvent = editor.triggerPluginEvent(\n            PluginEventType.BeforePaste,\n            event,\n            true /* broadcast */\n        ) as ContentModelBeforePasteEvent;\n    }\n\n    // Step 5. Sanitize the fragment before paste to make sure the content is safe\n    sanitizePasteContent(event, null /*position*/);\n\n    return pluginEvent;\n}\n","import { ContentModelEditor, ContentModelPastePlugin } from 'roosterjs-content-model-editor';\nimport { getDarkColor } from 'roosterjs-color-utils';\nimport type { EditorPlugin } from 'roosterjs-editor-types';\nimport type {\n    ContentModelEditorOptions,\n    IContentModelEditor,\n} from 'roosterjs-content-model-editor';\n\n/**\n * Create a Content Model Editor using the given options\n * @param contentDiv The html div element needed for creating the editor\n * @param additionalPlugins The additional user defined plugins. Currently the default plugins that are already included are\n * ContentEdit, HyperLink and Paste, user don't need to add those.\n * @param initialContent The initial content to show in editor. It can't be removed by undo, user need to manually remove it if needed.\n * @returns The ContentModelEditor instance\n */\nexport function createContentModelEditor(\n    contentDiv: HTMLDivElement,\n    additionalPlugins?: EditorPlugin[],\n    initialContent?: string\n): IContentModelEditor {\n    let plugins: EditorPlugin[] = [new ContentModelPastePlugin()];\n\n    if (additionalPlugins) {\n        plugins = plugins.concat(additionalPlugins);\n    }\n\n    const options: ContentModelEditorOptions = {\n        plugins: plugins,\n        initialContent: initialContent,\n        getDarkColor: getDarkColor,\n        defaultFormat: {\n            fontFamily: 'Calibri,Arial,Helvetica,sans-serif',\n            fontSize: '11pt',\n            textColor: '#000000',\n        },\n    };\n    return new ContentModelEditor(contentDiv, options);\n}\n","export { createContentModelEditor } from './createContentModelEditor';\nexport * from 'roosterjs-content-model-types';\nexport * from 'roosterjs-content-model-dom';\nexport * from 'roosterjs-content-model-editor';\n","module.exports = roosterjs;","/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n  return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(2594);\n"],"names":["defaultContentModelFormatMap","a","underline","blockquote","marginTop","marginBottom","marginLeft","marginRight","code","fontFamily","h1","fontWeight","fontSize","h2","h3","h4","h5","h6","p","pre","whiteSpace","blockElement","display","defaultHTMLStyleMap","address","article","aside","b","br","center","textAlign","dd","div","dl","dt","em","fontStyle","fieldset","figcaption","figure","footer","form","header","hr","i","li","main","nav","ol","s","textDecoration","section","strike","strong","sub","verticalAlign","sup","table","boxSizing","td","th","u","ul","createDomToModelContextWithConfig","config","editorContext","Object","assign","isInSelection","blockFormat","isRootRtl","direction","segmentFormat","listFormat","levels","threadItemCounts","link","format","dataset","blockDecorator","tagName","createDomToModelConfig","options","elementProcessors","defaultProcessorMap","map","x","processorOverride","formatParsers","buildFormatParsers","formatParserOverride","additionalFormatParsers","defaultElementProcessors","defaultFormatParsers","overrides","additionalParsersArray","combinedOverrides","getObjectKeys","defaultFormatKeysPerCategory","reduce","result","key","value","formatKey","undefined","concat","parsers","linkProcessor","knownElementProcessor","brProcessor","codeProcessor","font","fontProcessor","img","imageProcessor","headingProcessor","hrProcessor","listItemProcessor","listProcessor","pProcessor","formatContainerProcessor","span","tableProcessor","generalProcessor","textProcessor","element","elementProcessor","entity","entityProcessor","child","childProcessor","delimiter","delimiterProcessor","root","context","selection","model","createContentModelDocument","defaultFormat","normalizeContentModel","SegmentDecoratorTags","group","decorator","isSegmentDecorator","indexOf","parseFormat","block","container","ContextStyles","forEach","style","paragraph","createParagraph","addBlock","createBr","isSelected","addSegment","domIndexer","onSegment","processChildNode","isNodeOfType","handleRegularSelection","index","nodeStartOffset","nodeEndOffset","addSelectionMarker","type","range","collapsed","parent","getRegularSelectionOffsets","firstChild","nextSibling","stackFormat","toLowerCase","processor","isEntityElement","contentEditable","tryGetProcessorForEntity","getDelimiterFromElement","tryGetProcessorForDelimiter","isBlockEntity","isBlockElement","segment","entityModel","createEntity","entityFormat","FontSizes","size","intSize","getAttribute","parseInt","Number","isNaN","length","textColor","segmentOnBlock","getDefaultStyle","formatContainer","createFormatContainer","zeroFontSize","blocks","blockType","isImplicit","shouldFallbackToParagraph","setParagraphNotImplicit","generalBlockProcessor","createGeneralBlock","isSelectedBefore","generalSegmentProcessor","createGeneralSegment","addDecorators","createParagraphDecorator","blockProcessor","divider","createDivider","imageFormat","image","createImage","src","alt","title","isSelectedAsImageSelection","FormatContainerTriggerStyles","ByPassFormatContainerTags","isBlock","defaultStyle","bgcolor","getPropertyValue","some","shouldUseFormatContainer","href","segmentUnderLink","hasAttribute","listParent","listItem","createListItem","listItemElement","push","currentBlocks","lastItem","level","createListLevel","listLevel","updateListMetadata","metadata","listLevelMetadataFormatHandler","parse","orderedStyleType","unorderedStyleType","originalListParent","pop","calcSizes","positions","lastPos","tableElement","createTable","rows","tableSelection","hasTableSelection","allowCacheElement","cachedElement","onTable","tableBorder","columnPositions","rowPositions","zoomScale","row","tr","tableRow","tbody","parentNode","isElementOfType","parentElement","parentTag","sourceCol","targetCol","cells","hasSelectionBeforeCell","colEnd","colSpan","rowEnd","rowSpan","needCalcWidth","needCalcHeight","rect","getBoundingClientRect","width","height","segmentOnTableCell","cellFormat","tableCell","hasTd","cell","createTableCell","spannedRow","hasSelectionAfterCell","firstRow","lastRow","firstColumn","lastColumn","col","widths","heights","textNode","txt","nodeValue","offsets","txtStartOffset","txtEndOffset","segments","ensureParagraph","subText","substring","addTextSegment","filter","WhiteSpaceValuesNeedToHandle","text","textModel","hasSpacesOnly","createText","marker","createSelectionMarker","f1","f2","keys1","keys2","every","tag","currentContainer","startContainer","startOffset","endContainer","endOffset","BLOCK_DISPLAY_STYLES","parser","SkippedStylesForBlock","SkippedStylesForTable","stackFormatInternal","processType","callback","linkFormat","codeFormat","decoratorFormat","stackLinkInternal","stackCodeInternal","ENTITY_INFO_NAME","ENTITY_TYPE_PREFIX","ENTITY_ID_PREFIX","ENTITY_READONLY_PREFIX","node","classList","contains","className","entityType","id","isReadonly","isFakeEntity","obj","keys","toLocaleLowerCase","expectedType","nodeType","Node","ListStyleDefinitionMetadata","createObjectDefinition","createNumberDefinition","list","updateMetadata","EditingInfoDatasetName","definition","metadataString","JSON","validate","stringify","moveChildNodes","target","source","keepExistingChildren","removeChild","appendChild","newElement","ownerDocument","createElement","collection","slice","call","directionFormatHandler","_","dir","apply","displayFormatHandler","htmlAlignFormatHandler","htmlAlign","calcAlign","setAttribute","ResultMap","lineHeightFormatHandler","lineHeight","MarginKeys","marginFormatHandler","parseValueWithUnit","implicitFormat","PaddingKeys","paddingFormatHandler","textAlignFormatHandler","flexDirection","alignSelf","whiteSpaceFormatHandler","backgroundColorFormatHandler","backgroundColor","getColor","darkColorHandler","isDarkMode","setColor","borderBoxFormatHandler","useBorderBox","BorderKeys","borderFormatHandler","boxShadowFormatHandler","boxShadow","datasetFormatHandler","floatFormatHandler","float","idFormatHandler","PercentageRegex","tryParseSize","attrName","attrValue","test","sizeFormatHandler","maxWidth","maxHeight","minWidth","minHeight","verticalAlignFormatHandler","wordBreakFormatHandler","wordBreak","defaultFormatHandlerMap","bold","boldFormatHandler","border","borderBox","fontFamilyFormatHandler","fontSizeFormatHandler","entityFormatHandler","italic","italicFormatHandler","letterSpacing","letterSpacingFormatHandler","linkFormatHandler","listItemThread","listItemThreadFormatHandler","listLevelThread","listLevelThreadFormatHandler","listStylePosition","listStylePositionFormatHandler","margin","padding","strikeFormatHandler","superOrSubScript","superOrSubScriptFormatHandler","tableLayout","tableLayoutFormatHandler","tableSpacing","tableSpacingFormatHandler","textColorFormatHandler","textColorOnTableCell","textColorOnTableCellFormatHandler","underlineFormatHandler","styleBasedSegmentFormats","elementBasedSegmentFormats","sharedBlockFormats","sharedContainerFormats","styleBasedSegment","elementBasedSegment","tableCellBorder","defaultFormatAppliers","isEntity","name","parseEntityClassName","isContentEditable","generateEntityClassNames","removeAttribute","OrderedMapPlaceholderRegex","DefaultOrderedListStyles","DefaultUnorderedListStyles","CharCodeOfA","RomanValues","M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I","getOrderedListStyleValue","template","listNumber","replace","match","subStr","convertDecimalsToAlpha","convertDecimalsToRoman","decimal","isLowerCase","alpha","String","fromCharCode","Math","floor","romanValue","timesRomanCharAppear","repeat","listItemMetadataFormatHandler","depth","nodeStack","listStyleType","OrderedMap","UnorderedMap","isLiUnderOl","defaultStyles","displayForDummyItem","splice","startNumberOverride","OLTypeToStyleMap","A","getKeyFromValue","listStyle","listType","start","startNumber","blockFontWeight","wrapAllChildNodes","isSuperOrSubScript","contextFont","knownFontSize","KnownFontSizes","endsWith","existingFontSize","round","normalizeFontSize","small","medium","large","rel","anchorId","relationship","anchorTitle","anchorClass","strikethrough","superOrSubScriptSequence","split","join","trim","reverse","color","implicitColor","BorderCollapsed","borderCollapse","borderSpacing","DeprecatedColors","isBackground","darkColor","findLightColorFromDarkColor","tryGetFontColor","parseColorValue","lightModeColor","effectiveColor","registerColor","ltr","rtl","end","initial","justify","align","MarginValueRegex","getFontSize","currentSizeOrElement","styleInPt","defaultView","getComputedStyle","ptToPx","parseFloat","pt","currentSizePxOrElement","resultUnit","px","exec","numStr","unit","num","domToContentModel","contentModelToDom","get","areSameFormats","hasMetadata","default","addCode","addLink","isGeneralSegment","unwrapBlock","isWhiteSpacePreserved","normalizeSingleSegment","applySegmentFormatToElement","createDomToModelContext","createModelToDomContext","createModelToDomContextWithConfig","createModelToDomConfig","newSegment","lastSegment","segmentType","applyFormat","formatAppliers","lastBlock","SPACE_TEXT_REGEX","isBlockEmpty","isBlockGroupEmpty","blockGroupType","isSegmentEmpty","isBlockGroup","isSegment","WHITESPACE_PRE_VALUES","normalizeParagraph","r","c","last","secondLast","noMarkerSegments","normalizeAllSegments","find","markerIndex","prev","next","removeEmptyLinks","j","removeEmptySegments","SPACE","NONE_BREAK_SPACE","LEADING_SPACE_REGEX","TRAILING_SPACE_REGEX","resetNormalizeSegmentContext","textSegments","ignoreLeadingSpaces","ignoreTrailingSpaces","lastInlineSegment","lastTextSegment","normalizeSegment","normalizeTextSegments","normalizeLastTextSegment","first","substr","groupToUnwrap","wrapper","formatHolder","rowCount","spanLeftOrColSpan","spanAboveOrRowSpan","isHeader","spanLeft","spanAbove","calcPosition","pos","offset","childNodes","lastChild","doc","onNodeCreated","modelHandlers","blockGroupChildren","startPosition","endPosition","imageSelection","createRange","setStart","setEnd","extractSelectionRange","normalize","regularSelection","current","defaultContentModelHandlers","modelHandlerOverride","buildFormatAppliers","formatApplierOverride","additionalFormatAppliers","defaultModelHandlers","additionalAppliersArray","appliers","handleBlock","handleBlockGroupChildren","handleBr","entityBlock","handleEntityBlock","entitySegment","handleEntitySegment","generalBlock","handleGeneralBlock","generalSegment","handleGeneralSegment","handleDivider","handleImage","handleList","handleListItem","handleParagraph","handleFormatContainer","handleSegment","segmentDecorator","handleSegmentDecorator","handleTable","handleText","refNode","handlers","childBlock","segmentNodes","handleSegmentCommon","reuseCachedElement","insertBefore","newSegments","wrap","addDelimiterForEntity","addDelimiters","after","before","PreChildFormat","cloneNode","imageModel","document","widthNum","heightNum","layer","stackLevel","itemLevel","editingInfo","newList","unwrap","needParagraphWrapper","formatOnWrapper","handleSegments","firstSegment","optimize","onParagraph","codeNode","tableNode","max","createTextNode","OptimizeTags","hasSameAttributes","element1","element2","attr1","attributes","attr2","removeUnnecessarySpan","mergeNode","newNode","applier","segmentNode","containerNode","tagNameOrFormat","newFormat","BorderStyles","BorderSizeRegex","combinedBorder","v","NumberDefinition","ImageMetadataFormatDefinition","widthPx","heightPx","leftPercent","rightPercent","topPercent","bottomPercent","angleRad","createStringDefinition","naturalHeight","naturalWidth","TableCellMetadataFormatDefinition","bgColorOverride","createBooleanDefinition","vAlignOverride","NullStringDefinition","BooleanDefinition","TableFormatDefinition","topBorderColor","bottomBorderColor","verticalBorderColor","hasHeaderRow","headerRowColor","hasFirstColumn","hasBandedColumns","hasBandedRows","bgColorEven","bgColorOdd","tableBorderFormat","SPACES_REGEX","char","charCodeAt","isForward","contentDiv","createContentModelEditorCore","cacheModel","createContentModel","option","selectionOverride","core","this","getCore","api","setContentModel","getDOMSelection","setDOMSelection","EditorBase","cachedModel","cache","lifecycle","shadowEditFragment","cloneModel","includeCachedElement","createEditorContext","domToModelContext","defaultDomToModelOptions","defaultDomToModelConfig","internalCreateContentModel","cachedSelection","checkRootRtl","originalWidth","visualWidth","offsetWidth","checkZoomScale","rangeEx","getSelectionRangeEx","ranges","coordinates","firstCell","lastCell","y","getNewSelection","modelToDomContext","defaultModelToDomOptions","defaultModelToDomConfig","areAllCollapsed","select","switchShadowEdit","editorCore","isOn","getSelectionRange","fragment","createDocumentFragment","selectionPath","getSelectionPath","triggerEvent","eventType","shadowEditSelectionPath","state","editor","onNativeSelectionChange","hasFocus","updateCachedModel","getName","initialize","getDocument","addEventListener","dispose","removeEventListener","getState","onPluginEvent","event","shouldClearCache","invalidateCache","contentModel","isInShadowEdit","forceUpdate","newRangeEx","areSameRangeEx","reconcileSelection","rawEvent","defaultPrevented","which","isCharacterValue","ContentModelCachePlugin","disposer","onPaste","clipboardData","isClipboardEvent","dataTransfer","items","preventDefault","extractClipboardItems","toArray","allowedCustomPasteType","then","isDisposed","addDomEventHandler","paste","e","copy","onCutCopy","cut","isCut","pasteModel","transformToDarkColor","iterateSelections","path","tableContext","getTempDiv","selectionForCopy","newRange","tempDiv","querySelector","elementToSelect","childElementCount","selectNode","domSelectionToRange","triggerPluginEvent","clonedRoot","addRangeToSelection","runAsync","cleanUpAndRestoreSelection","focus","formatWithContentModel","deleteSelection","deleteResult","changeSource","getCustomData","body","handleKeyDownEvent","handledByEditFeature","ContentModelEditPlugin","hasDefaultFormat","isComposing","isInIME","checkAndApplyPendingFormat","data","clearPendingFormat","canApplyPendingFormat","ContentModelFormatPlugin","promoteToContentModelEditorCore","pluginState","cmCore","promoteCorePluginState","tablePreProcessor","promoteContentModelInfo","originalApi","promoteCoreApi","contentModelDomIndexer","copyPaste","textColors","backgroundColors","getPluginState","modifiedOptions","plugins","createContentModelCachePlugin","createContentModelFormatPlugin","createContentModelEditPlugin","corePluginOverride","typeInContainer","createEditorCore","getSelectionRootNode","shouldUseTableProcessor","unknownTagReplacement","ev","domToModelOption","sanitizingOption","getPasteSource","processPastedContentFromWordDesktop","processPastedContentWacComponents","pasteType","processPastedContentFromExcel","getTrustedHTMLHandler","additionalTagReplacements","processPastedContentFromPowerPoint","parseLink","deprecatedBorderColorParser","chainSanitizerCallback","cssStyleCallbacks","blockElementParser","LAST_TD_END_REGEX","LAST_TR_END_REGEX","LAST_TR_REGEX","LAST_TABLE_REGEX","DEFAULT_BORDER_STYLE","excelHandler","html","htmlBefore","trMatch","tableMatch","trustedHTMLHandler","DOMParser","parseFromString","Array","from","replaceChildren","borderStyle","borderBottom","borderLeft","borderRight","borderTop","setProcessor","LIST_CONTAINER_ELEMENT_CLASS_NAME","TABLE_CONTAINER","TEMP_ELEMENTS_CLASSES","CLASSES_TO_KEEP","LIST_ELEMENT_TAGS","LIST_ELEMENT_SELECTOR","wacSubSuperParser","wacElementProcessor","elementTag","matchesSelector","removeProperty","findClosestElementAncestor","shouldClearListContext","wacLiElementProcessor","lastblock","currentLevel","wacListItemParser","wacListLevelParser","paddingLeft","wacBlockParser","wacListProcessor","additionalAllowedCssClasses","isWrappedInContainer","previousElementSibling","toUpperCase","startsWith","PERCENTAGE_REGEX","removeNonValidLineHeight","parsedLineHeight","listLevelParser","wordDesktopElementProcessor","listItemElementParser","elementCallbacks","styles","getStyles","processWordList","processWordComments","MSO_COMMENT_ANCHOR_HREF_REGEX","MSO_LIST","MSO_LIST_IGNORE","startNumberOverrideParser","fakeBullet","wordKnownLevels","wordLevel","wordList","has","getFakeBulletText","isIgnoreNode","textContent","listAttribute","Map","wordListStyle","listProps","isFakeBullet","getFakeBulletTagName","newLevel","lastLevel","processAsListItem","set","entry","dColor","newValue","trimRight","SUPPORTED_PROTOCOLS","INVALID_LINKS_REGEX","url","URL","protocol","isIndexedSegment","__roosterjsContentModel","isArray","reconcileNodeSelection","reconcileTextSelection","insertMarker","isAfter","formatSegment","selectable","middle","newLast","firstIndex","lastIndex","paragraphElement","previousText","item","tableRows","newSelection","oldSelection","setSelection","marker1","marker2","skipUndoSnapshot","isMac","altKey","metaKey","ctrlKey","combineBorderValue","extractBorderValues","updateImageMetadata","updateTableCellMetadata","updateTableMetadata","isNext","newPath","nextBlock","unshift","shift","para","siblingSegment","left","right","TableAlignMap","alignment","paragraphOrListItemOrTable","getOperationalBlocks","newAligment","alignTable","internalSetDirection","setProperty","paddingRight","isBlockGroupOfType","findListItemsInSameThread","indentation","paragraphOrListItem","isIndent","isRtl","originalValue","ceil","isQuote","paragraphOfQuote","blockAndParent","canMergeQuote","wrapBlockStep1","wrapBlockStep2","clearContainerFormat","containerPathIndex","getClosestAncestorBlockGroupIndex","containerIndex","blockIndex","newContainer","clearListFormat","clearBlockFormat","blocksToClear","segmentsToClear","tablesToClear","colIndex","rowIndex","isWholeTableSelected","clearTableCellFormat","includeListFormatHolder","isOnlySelectionMarkerSelected","adjustWordSelection","isWholeBlockSelected","defaultSegmentFormat","clearSegmentsFormat","applyTableFormat","createTablesFormat","cloneModelWithFormat","cloneModelWithDataset","cloneBlockBase","cloneBlockGroupBase","handleCachedElement","cloneFormatContainer","cloneGeneralBlock","cloneSelectionMarker","cloneListLevel","cloneListItem","cloneDivider","cloneEntity","newParagraph","cloneSegmentBase","general","cloneGeneralSegment","textSegment","cloneSegment","cloneParagraph","cloneTableCell","cloneTableRow","cloneTable","cloneBlock","Error","newModel","blockGroupTypes","stopTypes","input","HeadingTags","mergeParagraph","markerPosition","newPara","mergeToCurrentParagraph","splitParagraph","segmentIndex","mergeFormat","newEntities","newImages","sourceKeys","mergeTable","newTable","newCell","k","leftCell","aboveCell","normalizeTable","insertBlock","mergeList","listItemIndex","newParaFormat","paraIndex","newListItem","applyDefaultFormat","applyDefaultFormatOption","mergeSegmentFormat","targetformat","sourceFormat","insertPosition","insertPoint","mergeValue","isFirst","pendingFormat","formatState","firstTableContext","firstBlock","isFirstImage","isFirstSegment","retrieveStructureFormat","isMultilineSelection","headingLevel","validHeadingLevel","retrieveParagraphFormat","extractedBorder","borderColor","borderWidth","modelFormat","mergedFormat","superOrSubscript","isBold","retrieveSegmentFormat","canUnlink","canAddImageAltText","borderRadius","canMergeTableCell","tableFormat","isInTable","tableHasHeader","retrieveTableFormat","step1Result","blockToWrap","creator","canMerge","prevBlock","createAndAdd","additionalSteps","formatContext","deleteExpandedSelection","step","isValidDeleteSelectionContext","lastParagraph","lastTableContext","mergeParagraphAfterDelete","deleteAllSegmentBefore","deleteSegment","getDeleteCollapsedSelection","segmentsWithoutBr","fixupBr","blockToDelete","segmentToDelete","getLeafSiblingBlock","createInsertPoint","deleteBlock","forwardDeleteCollapsedSelection","backwardDeleteCollapsedSelection","DeleteWordState","getDeleteWordSelection","startIndex","deleteNext","iterator","forward","preserveWhiteSpace","punctuation","isPunctuation","space","isSpace","newText","normalizeText","iterateSegments","curr","done","forwardDeleteWordSelection","backwardDeleteWordSelection","replacement","operation","deletedEntities","DeleteSelectionIteratingOptions","contentUnderSelectedTableCell","contentUnderSelectedGeneralElement","markerFormat","insertMarkerIndex","isBackward","currentIndex","normalizePreviousSegment","deleteSingleChar","array","deleteLength","deleteState","position","focusAfterEntity","blockParent","pathIndex","directChild","childIndex","blocksToInsert","nextParagraph","getPendingFormatHolder","posContainer","posOffset","holder","getFocusedPosition","PendingFormatHolderKey","borderFormat","findListItems","pushNullIfNecessary","areListTypesCompatible","listItems","compareToIndex","currentLevels","compareToLevels","hasStartNumberOverride","levelLength","currentItem","isOrderedList","filterListItems","shouldIgnoreBlock","paragraphOrListItems","alreadyInExpectedType","existingListItems","hasIgnoredParagraphBefore","itemIndex","firstMatcher","siblingMatcher","paragraphs","getSelectedParagraphs","changed","findIndex","findDelimiter","moveRightward","word","splitTextSegment","found","newSegmentLeft","newSegmentRight","markerBlock","tempSegments","markerSelectionIndex","currentSegment","sel1","sel2","r1","r2","firstCol","deepFirst","findSequence","selections","collectSelections","removeUnmeaningfulSelections","groupIndex","checkFirstParagraph","allSegments","includingFormatHolder","resultPath","commonAncestorContainer","internalIterateSelections","treatAllAsSelect","hasSelectedSegment","hasUnselectedSegment","handleGeneralContent","handleGeneralElement","setSelectionToBlockGroup","handleSelection","setIsSelected","findCell","currentRow","currentCell","setSelectionToTable","segmentsToDelete","setSelectionToSegment","setSelectionToBlock","TextAlignValueMap","VerticalAlignValueMap","sel","getSelectedCells","lastCol","DEFAULT_FORMAT","keepCellShade","effectiveMetadata","metaOverrides","removeCellShade","bgColorOverrides","vAlignOverrides","updateOverrides","clearCache","transparentBorderMatrix","BorderFormatters","formatColor","alwaysUseTransparent","getBorderStyleFromColor","setTableCellBackgroundColor","formatCells","cellIndex","setBorderColor","setFirstColumnFormat","setHeaderRowFormat","noSpanAbove","noSpanLeft","noDifferentBelowSpan","spanCount","getBelowSpanCount","noDifferentRightSpan","getRightSpanCount","columns","cellInNextCol","collapseTableSelection","cellInNextRow","createEmptyParagraph","hasSelection","insertLeft","insertAbove","sourceRow","canMergeCells","mergingColIndex","newSelectedCol","mergingRowIndex","newSelectedRow","getTableCellWidth","tryMoveBlocks","targetCell","sourceCell","isColorOverride","applyToSegments","lightness","colorValues","parseColor","red","green","blue","min","calculateLightness","newWidth","belowRow","belowCell","newHeight","newRow","setModelAlignment","setModelDirection","HeaderFontSizes","formatParagraphWithContentModel","setModelIndentation","preservePendingFormat","spacing","toString","DefaultQuoteFormat","BuildInQuoteFormat","quoteFormat","fullQuoteFormat","toggleModelBlockQuote","isDeleted","isModifierKey","previousSibling","canDeleteBefore","canDeleteAfter","shouldDeleteWithContentModel","shouldDeleteAllSegmentsBefore","shouldDeleteWord","Browser","getDeleteSteps","handleKeyboardEventResult","getChangeData","contentNode","wrapperDisplay","insertEntityModel","internalApplyDefaultFormat","currentFormat","getPendingFormat","setPendingFormat","addUndoSnapshot","blockCount","previousBlock","__","previousSegment","clearModelFormat","reducedModelChildProcessor","selectionRootNode","startNode","createNodeStack","stackChild","getChildIndex","getUndoState","getZoomScale","retrieveModelFormatState","adjustSegmentSelection","ref","file","readFile","dataUrl","previousSrc","newSrc","originalSrc","getImageSrc","getMetadata","insertImageWithSrc","mergeModel","imageFileOrSrc","altText","URI_REGEX","MAILTO_REGEX","FTP_REGEX","displayText","sanitizer","HtmlSanitizer","sanitize","checkXss","matchLink","normalizedUrl","prefix","search","applyLinkPrefix","originalText","createLink","originalUrl","modelElement","isChanged","getFirstSelectedListItem","setListType","formatSegmentWithContentModel","capitalization","language","toLocaleUpperCase","wordArray","charAt","regex","RegExp","FONT_SIZES","change","sizeInPt","newSize","changeBase","fontSizes","getNewFontSize","setFontSizeInternal","changeFontSizeInternal","lastSegmentIndex","fontName","boldStyle","isTurningOn","DefaultCode","getSelectedSegmentsAndParagraphs","getFirstSelectedTable","tableModel","alignTableCell","deleteTableColumn","deleteTableRow","deleteTable","insertTableRow","insertTableColumn","mergeTableRow","mergeTableCells","mergeTableColumn","splitTableCellHorizontally","splitTableCellVertically","ensureFocusableParagraphForTable","createTableStructure","apiName","eventChangeData","setStyleCallback","toggleStyleCallback","segmentHasStyleCallback","afterFormatCallback","segmentAndParagraphs","isCollapsedSelection","formatsAndSegments","isTurningOff","formatter","writeBack","handleNewEntities","handleDeletedEntities","viewport","getVisibleViewport","bottom","handleImages","formatApiName","eventData","additionalData","mergePasteContent","applyCurrentFormat","customizedMerge","shouldMergeTable","pasteAsText","pasteAsImage","snapshotBeforePaste","setContent","getContent","createDefaultHtmlSanitizerOptions","htmlAfter","htmlAttributes","createBeforePasteEventData","getPasteType","rawHtml","imageDataUri","retrieveMetadataFromClipboard","handleImagePaste","handleTextPaste","pluginEvent","sanitizePasteContent","triggerPluginEventAndCreatePasteFragment","additionalPlugins","initialContent","ContentModelPastePlugin","getDarkColor","ContentModelEditor","createContentModelEditor","module","exports","roosterjs","extendStatics","d","setPrototypeOf","__proto__","prototype","hasOwnProperty","__extends","TypeError","constructor","create","__assign","t","n","arguments","__rest","getOwnPropertySymbols","propertyIsEnumerable","__decorate","decorators","desc","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__param","paramIndex","__esDecorate","ctor","descriptorIn","contextIn","initializers","extraInitializers","accept","f","kind","descriptor","access","addInitializer","init","__runInitializers","thisArg","useValue","__propKey","__setFunctionName","description","configurable","__metadata","metadataKey","metadataValue","__awaiter","_arguments","P","generator","Promise","resolve","reject","fulfilled","rejected","__generator","g","label","sent","trys","ops","verb","Symbol","op","__createBinding","o","m","k2","__esModule","writable","enumerable","__exportStar","__values","__read","ar","error","__spread","__spreadArrays","il","jl","__spreadArray","to","pack","l","__await","__asyncGenerator","asyncIterator","q","resume","fulfill","settle","__asyncDelegator","__asyncValues","__makeTemplateObject","cooked","raw","__setModuleDefault","__importStar","mod","__importDefault","__classPrivateFieldGet","receiver","__classPrivateFieldSet","__classPrivateFieldIn","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","prop","toStringTag","__webpack_exports__"],"sourceRoot":""}