export interface TargetWindow {
    Node: Node;
    Element: Element;
    SVGElement: SVGElement;
    SVGViewElement: SVGViewElement;
    SVGTitleElement: SVGTitleElement;
    SVGSymbolElement: SVGSymbolElement;
    SVGStyleElement: SVGStyleElement;
    SVGStopElement: SVGStopElement;
    SVGScriptElement: SVGScriptElement;
    SVGPatternElement: SVGPatternElement;
    SVGMetadataElement: SVGMetadataElement;
    SVGMaskElement: SVGMaskElement;
    SVGMarkerElement: SVGMarkerElement;
    SVGGraphicsElement: SVGGraphicsElement;
    SVGUseElement: SVGUseElement;
    SVGTextContentElement: SVGTextContentElement;
    SVGTextPositioningElement: SVGTextPositioningElement;
    SVGTextElement: SVGTextElement;
    SVGTSpanElement: SVGTSpanElement;
    SVGTextPathElement: SVGTextPathElement;
    SVGSwitchElement: SVGSwitchElement;
    SVGSVGElement: SVGSVGElement;
    SVGPathElement: SVGPathElement;
    SVGImageElement: SVGImageElement;
    SVGGeometryElement: SVGGeometryElement;
    SVGRectElement: SVGRectElement;
    SVGPolylineElement: SVGPolylineElement;
    SVGPolygonElement: SVGPolygonElement;
    SVGLineElement: SVGLineElement;
    SVGEllipseElement: SVGEllipseElement;
    SVGCircleElement: SVGCircleElement;
    SVGGElement: SVGGElement;
    SVGForeignObjectElement: SVGForeignObjectElement;
    SVGDefsElement: SVGDefsElement;
    SVGAElement: SVGAElement;
    SVGGradientElement: SVGGradientElement;
    SVGRadialGradientElement: SVGRadialGradientElement;
    SVGLinearGradientElement: SVGLinearGradientElement;
    SVGFilterElement: SVGFilterElement;
    SVGFETurbulenceElement: SVGFETurbulenceElement;
    SVGFETileElement: SVGFETileElement;
    SVGFESpotLightElement: SVGFESpotLightElement;
    SVGFESpecularLightingElement: SVGFESpecularLightingElement;
    SVGFEPointLightElement: SVGFEPointLightElement;
    SVGFEOffsetElement: SVGFEOffsetElement;
    SVGFEMorphologyElement: SVGFEMorphologyElement;
    SVGFEMergeNodeElement: SVGFEMergeNodeElement;
    SVGFEMergeElement: SVGFEMergeElement;
    SVGFEImageElement: SVGFEImageElement;
    SVGFEGaussianBlurElement: SVGFEGaussianBlurElement;
    SVGFEFloodElement: SVGFEFloodElement;
    SVGFEDropShadowElement: SVGFEDropShadowElement;
    SVGFEDistantLightElement: SVGFEDistantLightElement;
    SVGFEDisplacementMapElement: SVGFEDisplacementMapElement;
    SVGFEDiffuseLightingElement: SVGFEDiffuseLightingElement;
    SVGFEConvolveMatrixElement: SVGFEConvolveMatrixElement;
    SVGFECompositeElement: SVGFECompositeElement;
    SVGFEComponentTransferElement: SVGFEComponentTransferElement;
    SVGFEColorMatrixElement: SVGFEColorMatrixElement;
    SVGFEBlendElement: SVGFEBlendElement;
    SVGDescElement: SVGDescElement;
    SVGCursorElement: SVGCursorElement;
    SVGComponentTransferFunctionElement: SVGComponentTransferFunctionElement;
    SVGFEFuncRElement: SVGFEFuncRElement;
    SVGFEFuncGElement: SVGFEFuncGElement;
    SVGFEFuncBElement: SVGFEFuncBElement;
    SVGFEFuncAElement: SVGFEFuncAElement;
    SVGClipPathElement: SVGClipPathElement;
    SVGAnimationElement: SVGAnimationElement;
    SVGAnimateTransformElement: SVGAnimateTransformElement;
    SVGAnimateMotionElement: SVGAnimateMotionElement;
    SVGAnimateElement: SVGAnimateElement;
    HTMLElement: HTMLElement;
    HTMLUnknownElement: HTMLUnknownElement;
    HTMLUListElement: HTMLUListElement;
    HTMLTrackElement: HTMLTrackElement;
    HTMLTitleElement: HTMLTitleElement;
    HTMLTimeElement: HTMLTimeElement;
    HTMLTextAreaElement: HTMLTextAreaElement;
    HTMLTemplateElement: HTMLTemplateElement;
    HTMLTableSectionElement: HTMLTableSectionElement;
    HTMLTableRowElement: HTMLTableRowElement;
    HTMLTableElement: HTMLTableElement;
    HTMLTableColElement: HTMLTableColElement;
    HTMLTableCellElement: HTMLTableCellElement;
    HTMLTableHeaderCellElement: HTMLTableHeaderCellElement;
    HTMLTableDataCellElement: HTMLTableDataCellElement;
    HTMLTableCaptionElement: HTMLTableCaptionElement;
    HTMLStyleElement: HTMLStyleElement;
    HTMLSpanElement: HTMLSpanElement;
    HTMLSourceElement: HTMLSourceElement;
    HTMLSlotElement: HTMLSlotElement;
    HTMLSelectElement: HTMLSelectElement;
    HTMLScriptElement: HTMLScriptElement;
    HTMLQuoteElement: HTMLQuoteElement;
    HTMLProgressElement: HTMLProgressElement;
    HTMLPreElement: HTMLPreElement;
    HTMLPictureElement: HTMLPictureElement;
    HTMLParamElement: HTMLParamElement;
    HTMLParagraphElement: HTMLParagraphElement;
    HTMLOutputElement: HTMLOutputElement;
    HTMLOptionElement: HTMLOptionElement;
    HTMLOptGroupElement: HTMLOptGroupElement;
    HTMLObjectElement: HTMLObjectElement;
    HTMLOListElement: HTMLOListElement;
    HTMLModElement: HTMLModElement;
    HTMLMeterElement: HTMLMeterElement;
    HTMLMetaElement: HTMLMetaElement;
    HTMLMenuElement: HTMLMenuElement;
    HTMLMediaElement: HTMLMediaElement;
    HTMLVideoElement: HTMLVideoElement;
    HTMLAudioElement: HTMLAudioElement;
    HTMLMarqueeElement: HTMLMarqueeElement;
    HTMLMapElement: HTMLMapElement;
    HTMLLinkElement: HTMLLinkElement;
    HTMLLegendElement: HTMLLegendElement;
    HTMLLabelElement: HTMLLabelElement;
    HTMLLIElement: HTMLLIElement;
    HTMLInputElement: HTMLInputElement;
    HTMLImageElement: HTMLImageElement;
    HTMLIFrameElement: HTMLIFrameElement;
    HTMLHtmlElement: HTMLHtmlElement;
    HTMLHeadingElement: HTMLHeadingElement;
    HTMLHeadElement: HTMLHeadElement;
    HTMLHRElement: HTMLHRElement;
    HTMLFrameSetElement: HTMLFrameSetElement;
    HTMLFrameElement: HTMLFrameElement;
    HTMLFormElement: HTMLFormElement;
    HTMLFontElement: HTMLFontElement;
    HTMLFieldSetElement: HTMLFieldSetElement;
    HTMLEmbedElement: HTMLEmbedElement;
    HTMLDivElement: HTMLDivElement;
    HTMLDirectoryElement: HTMLDirectoryElement;
    HTMLDialogElement: HTMLDialogElement;
    HTMLDetailsElement: HTMLDetailsElement;
    HTMLDataListElement: HTMLDataListElement;
    HTMLDataElement: HTMLDataElement;
    HTMLDListElement: HTMLDListElement;
    HTMLCanvasElement: HTMLCanvasElement;
    HTMLButtonElement: HTMLButtonElement;
    HTMLBodyElement: HTMLBodyElement;
    HTMLBaseFontElement: HTMLBaseFontElement;
    HTMLBaseElement: HTMLBaseElement;
    HTMLBRElement: HTMLBRElement;
    HTMLAreaElement: HTMLAreaElement;
    HTMLAppletElement: HTMLAppletElement;
    HTMLAnchorElement: HTMLAnchorElement;
    DocumentType: DocumentType;
    DocumentFragment: DocumentFragment;
    ShadowRoot: ShadowRoot;
    Document: Document;
    XMLDocument: XMLDocument;
    HTMLDocument: HTMLDocument;
    ChildNode: ChildNode;
    CharacterData: CharacterData;
    Text: Text;
    CDATASection: CDATASection;
    ProcessingInstruction: ProcessingInstruction;
    Comment: Comment;
    Attr: Attr;
    Range: Range;
}

/**
 * Try get window from the given node or range
 * @param source Source node or range
 */
export function getTargetWindow(source: Node | Range): TargetWindow {
    const node = source && ((<Range>source).commonAncestorContainer || <Node>source);
    const document =
        node &&
        (node.ownerDocument ||
            (Object.prototype.toString.apply(node) == '[object HTMLDocument]'
                ? <Document>node
                : null));

    // If document exists but document.defaultView doesn't exist, it is a detached object, just use current window instead
    const targetWindow = document && ((document.defaultView || window) as any);
    return targetWindow as TargetWindow;
}

/**
 * Check if the given object is instance of the target type
 * @param obj Object to check
 * @param typeName Target type name
 */
export default function safeInstanceOf<T extends keyof TargetWindow>(
    obj: Node | Range,
    typeName: T
): obj is TargetWindow[T] {
    const targetWindow = getTargetWindow(obj);
    const targetType = targetWindow && (targetWindow[typeName] as any);
    const mainWindow = (window as any) as TargetWindow;
    const mainWindowType = mainWindow && (mainWindow[typeName] as any);
    return (
        (mainWindowType && obj instanceof mainWindowType) ||
        (targetType && obj instanceof targetType)
    );
}
